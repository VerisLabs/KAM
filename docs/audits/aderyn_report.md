# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Aderyn Analysis Report](#aderyn-analysis-report)
- [Table of Contents](#table-of-contents)
- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Yul block contains `return`](#h-1-yul-block-contains-return)
  - [H-2: Weak Randomness](#h-2-weak-randomness)
  - [H-3: Contract locks Ether without a withdraw function](#h-3-contract-locks-ether-without-a-withdraw-function)
  - [H-4: Reentrancy: State change after external call](#h-4-reentrancy-state-change-after-external-call)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Unspecific Solidity Pragma](#l-2-unspecific-solidity-pragma)
  - [L-3: Public Function Not Used Internally](#l-3-public-function-not-used-internally)
  - [L-4: Empty `require()` / `revert()` Statement](#l-4-empty-require--revert-statement)
  - [L-5: PUSH0 Opcode](#l-5-push0-opcode)
  - [L-6: Modifier Invoked Only Once](#l-6-modifier-invoked-only-once)
  - [L-7: Large Numeric Literal](#l-7-large-numeric-literal)
  - [L-8: Unused Error](#l-8-unused-error)
  - [L-9: Loop Contains `require`/`revert`](#l-9-loop-contains-requirerevert)
  - [L-10: Unused State Variable](#l-10-unused-state-variable)
  - [L-11: Dead Code](#l-11-dead-code)
  - [L-12: Costly operations inside loop](#l-12-costly-operations-inside-loop)
  - [L-13: Unused Import](#l-13-unused-import)
  - [L-14: State Change Without Event](#l-14-state-change-without-event)
  - [L-15: Unchecked Return](#l-15-unchecked-return)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 25 |
| Total nSLOC | 2612 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/abstracts/Extsload.sol | 46 |
| src/abstracts/Proxy.sol | 20 |
| src/adapters/BaseAdapter.sol | 98 |
| src/adapters/CustodialAdapter.sol | 119 |
| src/base/MultiFacetProxy.sol | 60 |
| src/base/kBase.sol | 112 |
| src/interfaces/IAdapter.sol | 18 |
| src/interfaces/IExtsload.sol | 6 |
| src/interfaces/IkAssetRouter.sol | 114 |
| src/interfaces/IkBatchReceiver.sol | 13 |
| src/interfaces/IkMinter.sol | 49 |
| src/interfaces/IkRegistry.sol | 295 |
| src/interfaces/IkStakingVault.sol | 32 |
| src/interfaces/IkToken.sol | 36 |
| src/kAssetRouter.sol | 328 |
| src/kBatchReceiver.sol | 28 |
| src/kMinter.sol | 184 |
| src/kRegistry.sol | 194 |
| src/kStakingVault/base/BaseVaultModule.sol | 204 |
| src/kStakingVault/kStakingVault.sol | 216 |
| src/kStakingVault/modules/BatchModule.sol | 64 |
| src/kStakingVault/modules/ClaimModule.sol | 56 |
| src/kStakingVault/modules/FeesModule.sol | 146 |
| src/kStakingVault/types/BaseVaultModuleTypes.sol | 30 |
| src/kToken.sol | 144 |
| **Total** | **2612** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 4 |
| Low | 15 |


# High Issues

## H-1: Yul block contains `return`

This causes the transaction execution to halt, and nothing after that call will execute including code following the assembly block.

<details><summary>4 Found Instances</summary>


- Found in src/abstracts/Extsload.sol [Line: 14](src/abstracts/Extsload.sol#L14)

    ```solidity
                return(0, 0x20)
    ```

- Found in src/abstracts/Extsload.sol [Line: 34](src/abstracts/Extsload.sol#L34)

    ```solidity
                return(start, sub(end, start))
    ```

- Found in src/abstracts/Extsload.sol [Line: 54](src/abstracts/Extsload.sol#L54)

    ```solidity
                return(start, sub(end, start))
    ```

- Found in src/abstracts/Proxy.sol [Line: 39](src/abstracts/Proxy.sol#L39)

    ```solidity
                default { return(0, returndatasize()) }
    ```

</details>



## H-2: Weak Randomness

The use of keccak256 hash functions on predictable values like block.timestamp, block.number, or similar data, including modulo operations on these values, should be avoided for generating randomness, as they are easily predictable and manipulable. The `PREVRANDAO` opcode also should not be used as a source of randomness. Instead, utilize Chainlink VRF for cryptographically secure and provably random values to ensure protocol integrity.

<details><summary>2 Found Instances</summary>


- Found in src/kAssetRouter.sol [Line: 263](src/kAssetRouter.sol#L263)

    ```solidity
            proposalId = keccak256(abi.encodePacked(vault, batchId, block.timestamp));
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 294](src/kStakingVault/kStakingVault.sol#L294)

    ```solidity
                keccak256(abi.encodePacked(address(this), currentBatch, block.chainid, block.timestamp, $.underlyingAsset));
    ```

</details>



## H-3: Contract locks Ether without a withdraw function

It appears that the contract includes a payable function to accept Ether but lacks a corresponding function to withdraw it, which leads to the Ether being locked in the contract. To resolve this issue, please implement a public or external function that allows for the withdrawal of Ether from the contract.

<details><summary>14 Found Instances</summary>


- Found in src/abstracts/Proxy.sol [Line: 16](src/abstracts/Proxy.sol#L16)

    ```solidity
    abstract contract Proxy {
    ```

- Found in src/adapters/BaseAdapter.sol [Line: 14](src/adapters/BaseAdapter.sol#L14)

    ```solidity
    contract BaseAdapter is OwnableRoles, ReentrancyGuardTransient {
    ```

- Found in src/adapters/CustodialAdapter.sol [Line: 15](src/adapters/CustodialAdapter.sol#L15)

    ```solidity
    contract CustodialAdapter is BaseAdapter, Initializable, UUPSUpgradeable {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 11](src/base/MultiFacetProxy.sol#L11)

    ```solidity
    contract MultiFacetProxy is Proxy, OwnableRoles {
    ```

- Found in src/base/kBase.sol [Line: 12](src/base/kBase.sol#L12)

    ```solidity
    contract kBase is OwnableRoles, ReentrancyGuardTransient {
    ```

- Found in src/kAssetRouter.sol [Line: 20](src/kAssetRouter.sol#L20)

    ```solidity
    contract kAssetRouter is IkAssetRouter, Initializable, UUPSUpgradeable, kBase, Multicallable {
    ```

- Found in src/kMinter.sol [Line: 22](src/kMinter.sol#L22)

    ```solidity
    contract kMinter is IkMinter, Initializable, UUPSUpgradeable, kBase, Extsload {
    ```

- Found in src/kRegistry.sol [Line: 15](src/kRegistry.sol#L15)

    ```solidity
    contract kRegistry is IkRegistry, Initializable, UUPSUpgradeable, OwnableRoles {
    ```

- Found in src/kStakingVault/base/BaseVaultModule.sol [Line: 29](src/kStakingVault/base/BaseVaultModule.sol#L29)

    ```solidity
    abstract contract BaseVaultModule is OwnableRoles, ERC20, ReentrancyGuardTransient, Extsload {
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 24](src/kStakingVault/kStakingVault.sol#L24)

    ```solidity
    contract kStakingVault is Initializable, UUPSUpgradeable, BaseVaultModule, MultiFacetProxy {
    ```

- Found in src/kStakingVault/modules/BatchModule.sol [Line: 14](src/kStakingVault/modules/BatchModule.sol#L14)

    ```solidity
    contract BatchModule is BaseVaultModule {
    ```

- Found in src/kStakingVault/modules/ClaimModule.sol [Line: 17](src/kStakingVault/modules/ClaimModule.sol#L17)

    ```solidity
    contract ClaimModule is BaseVaultModule {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 15](src/kStakingVault/modules/FeesModule.sol#L15)

    ```solidity
    contract FeesModule is BaseVaultModule {
    ```

- Found in src/kToken.sol [Line: 15](src/kToken.sol#L15)

    ```solidity
    contract kToken is Initializable, UUPSUpgradeable, ERC20, OwnableRoles, ReentrancyGuard, Multicallable {
    ```

</details>



## H-4: Reentrancy: State change after external call

Changing state after an external call can lead to re-entrancy attacks.Use the checks-effects-interactions pattern to avoid this issue.

<details><summary>4 Found Instances</summary>


- Found in src/adapters/CustodialAdapter.sol [Line: 207](src/adapters/CustodialAdapter.sol#L207)

    State is changed at: `$.vaultDestinations[vault] = custodialAddress`
    ```solidity
            if (!_registry().isVault(vault)) {
    ```

- Found in src/kRegistry.sol [Line: 188](src/kRegistry.sol#L188)

    State is changed at: `$.registeredAdapters[adapter] = true`
    ```solidity
            if (!IAdapter(adapter).registered()) revert AdapterNotRegistered();
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 84](src/kStakingVault/kStakingVault.sol#L84)

    State is changed at: `$.receiverImplementation = address(new kBatchReceiver(_registry().getContractById(K_MINTER)))`
    ```solidity
            $.kToken = _registry().assetToKToken(asset_);
    ```

- Found in src/kStakingVault/modules/BatchModule.sol [Line: 73](src/kStakingVault/modules/BatchModule.sol#L73)

    State is changed at: `$.batches[_batchId].batchReceiver = receiver`
    ```solidity
            kBatchReceiver(receiver).initialize(_batchId, $.underlyingAsset);
    ```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>36 Found Instances</summary>


- Found in src/adapters/CustodialAdapter.sol [Line: 201](src/adapters/CustodialAdapter.sol#L201)

    ```solidity
        function setVaultDestination(address vault, address custodialAddress) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/adapters/CustodialAdapter.sol [Line: 234](src/adapters/CustodialAdapter.sol#L234)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal view override onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 61](src/base/MultiFacetProxy.sol#L61)

    ```solidity
            onlyRoles(_proxyAdminRole())
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 83](src/base/MultiFacetProxy.sol#L83)

    ```solidity
        function removeFunction(bytes4 selector) public onlyRoles(_proxyAdminRole()) {
    ```

- Found in src/kAssetRouter.sol [Line: 398](src/kAssetRouter.sol#L398)

    ```solidity
        function setPaused(bool paused) external onlyRoles(EMERGENCY_ADMIN_ROLE) {
    ```

- Found in src/kAssetRouter.sol [Line: 405](src/kAssetRouter.sol#L405)

    ```solidity
        function setSettlementCooldown(uint256 cooldown) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kAssetRouter.sol [Line: 529](src/kAssetRouter.sol#L529)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal view override onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kMinter.sol [Line: 285](src/kMinter.sol#L285)

    ```solidity
        function setPaused(bool paused) external onlyRoles(EMERGENCY_ADMIN_ROLE) {
    ```

- Found in src/kMinter.sol [Line: 329](src/kMinter.sol#L329)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal view override onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 103](src/kRegistry.sol#L103)

    ```solidity
        function setSingletonContract(bytes32 id, address contractAddress) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 120](src/kRegistry.sol#L120)

    ```solidity
        function registerAsset(address asset, address kToken, bytes32 id) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 150](src/kRegistry.sol#L150)

    ```solidity
        function registerVault(address vault, VaultType type_, address asset) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 176](src/kRegistry.sol#L176)

    ```solidity
        function registerAdapter(address vault, address adapter) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 198](src/kRegistry.sol#L198)

    ```solidity
        function removeAdapter(address vault, address adapter) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kRegistry.sol [Line: 363](src/kRegistry.sol#L363)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal view override onlyOwner {
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 260](src/kStakingVault/kStakingVault.sol#L260)

    ```solidity
        function setPaused(bool paused_) external onlyRoles(EMERGENCY_ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 355](src/kStakingVault/kStakingVault.sol#L355)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal view override onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 66](src/kStakingVault/modules/FeesModule.sol#L66)

    ```solidity
        function setHurdleRate(uint16 _hurdleRate) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 76](src/kStakingVault/modules/FeesModule.sol#L76)

    ```solidity
        function setHardHurdleRate(bool _isHard) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 85](src/kStakingVault/modules/FeesModule.sol#L85)

    ```solidity
        function setManagementFee(uint16 _managementFee) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 96](src/kStakingVault/modules/FeesModule.sol#L96)

    ```solidity
        function setPerformanceFee(uint16 _performanceFee) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 107](src/kStakingVault/modules/FeesModule.sol#L107)

    ```solidity
        function notifyManagementFeesCharged(uint64 _timestamp) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 118](src/kStakingVault/modules/FeesModule.sol#L118)

    ```solidity
        function notifyPerformanceFeesCharged(uint64 _timestamp) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 129](src/kToken.sol#L129)

    ```solidity
        function setupMetadata(string calldata name_, string calldata symbol_) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 145](src/kToken.sol#L145)

    ```solidity
        function mint(address _to, uint256 _amount) external nonReentrant whenNotPaused onlyRoles(MINTER_ROLE) {
    ```

- Found in src/kToken.sol [Line: 154](src/kToken.sol#L154)

    ```solidity
        function burn(address _from, uint256 _amount) external nonReentrant whenNotPaused onlyRoles(MINTER_ROLE) {
    ```

- Found in src/kToken.sol [Line: 163](src/kToken.sol#L163)

    ```solidity
        function burnFrom(address _from, uint256 _amount) external nonReentrant whenNotPaused onlyRoles(MINTER_ROLE) {
    ```

- Found in src/kToken.sol [Line: 207](src/kToken.sol#L207)

    ```solidity
        function grantAdminRole(address admin) external onlyOwner {
    ```

- Found in src/kToken.sol [Line: 213](src/kToken.sol#L213)

    ```solidity
        function revokeAdminRole(address admin) external onlyOwner {
    ```

- Found in src/kToken.sol [Line: 219](src/kToken.sol#L219)

    ```solidity
        function grantEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 225](src/kToken.sol#L225)

    ```solidity
        function revokeEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 232](src/kToken.sol#L232)

    ```solidity
        function grantMinterRole(address minter) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 239](src/kToken.sol#L239)

    ```solidity
        function revokeMinterRole(address minter) external onlyRoles(ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 246](src/kToken.sol#L246)

    ```solidity
        function setPaused(bool _isPaused) external onlyRoles(EMERGENCY_ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 256](src/kToken.sol#L256)

    ```solidity
        function emergencyWithdraw(address token, address to, uint256 amount) external onlyRoles(EMERGENCY_ADMIN_ROLE) {
    ```

- Found in src/kToken.sol [Line: 293](src/kToken.sol#L293)

    ```solidity
        function _authorizeUpgrade(address newImplementation) internal override onlyRoles(ADMIN_ROLE) {
    ```

</details>



## L-2: Unspecific Solidity Pragma

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>3 Found Instances</summary>


- Found in src/abstracts/Extsload.sol [Line: 2](src/abstracts/Extsload.sol#L2)

    ```solidity
    pragma solidity ^0.8.0;
    ```

- Found in src/abstracts/Proxy.sol [Line: 4](src/abstracts/Proxy.sol#L4)

    ```solidity
    pragma solidity ^0.8.20;
    ```

- Found in src/interfaces/IExtsload.sol [Line: 2](src/interfaces/IExtsload.sol#L2)

    ```solidity
    pragma solidity ^0.8.0;
    ```

</details>



## L-3: Public Function Not Used Internally

If a function is marked public but is not used internally, consider marking it as `external`.

<details><summary>10 Found Instances</summary>


- Found in src/base/MultiFacetProxy.sol [Line: 74](src/base/MultiFacetProxy.sol#L74)

    ```solidity
        function addFunctions(bytes4[] calldata selectors, address implementation, bool forceOverride) public {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 90](src/base/MultiFacetProxy.sol#L90)

    ```solidity
        function removeFunctions(bytes4[] calldata selectors) public {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 130](src/kStakingVault/modules/FeesModule.sol#L130)

    ```solidity
        function computeLastBatchFees()
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 212](src/kStakingVault/modules/FeesModule.sol#L212)

    ```solidity
        function hurdleRate() public view returns (uint16) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 218](src/kStakingVault/modules/FeesModule.sol#L218)

    ```solidity
        function performanceFee() public view returns (uint16) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 224](src/kStakingVault/modules/FeesModule.sol#L224)

    ```solidity
        function nextPerformanceFeeTimestamp() public view returns (uint256) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 230](src/kStakingVault/modules/FeesModule.sol#L230)

    ```solidity
        function nextManagementFeeTimestamp() public view returns (uint256) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 236](src/kStakingVault/modules/FeesModule.sol#L236)

    ```solidity
        function managementFee() public view returns (uint16) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 242](src/kStakingVault/modules/FeesModule.sol#L242)

    ```solidity
        function feeReceiver() public view returns (address) {
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 248](src/kStakingVault/modules/FeesModule.sol#L248)

    ```solidity
        function sharePriceWatermark() public view returns (uint256) {
    ```

</details>



## L-4: Empty `require()` / `revert()` Statement

Use descriptive reason strings or custom errors for revert paths.

<details><summary>4 Found Instances</summary>


- Found in src/base/MultiFacetProxy.sol [Line: 65](src/base/MultiFacetProxy.sol#L65)

    ```solidity
                if ($.selectorToImplementation[selector] != address(0)) revert();
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 103](src/base/MultiFacetProxy.sol#L103)

    ```solidity
            if (implementation == address(0)) revert();
    ```

- Found in src/kBatchReceiver.sol [Line: 38](src/kBatchReceiver.sol#L38)

    ```solidity
            if (asset != address(0)) revert();
    ```

- Found in src/kBatchReceiver.sol [Line: 39](src/kBatchReceiver.sol#L39)

    ```solidity
            if (_asset == address(0)) revert();
    ```

</details>



## L-5: PUSH0 Opcode

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

<details><summary>3 Found Instances</summary>


- Found in src/abstracts/Extsload.sol [Line: 2](src/abstracts/Extsload.sol#L2)

    ```solidity
    pragma solidity ^0.8.0;
    ```

- Found in src/abstracts/Proxy.sol [Line: 4](src/abstracts/Proxy.sol#L4)

    ```solidity
    pragma solidity ^0.8.20;
    ```

- Found in src/interfaces/IExtsload.sol [Line: 2](src/interfaces/IExtsload.sol#L2)

    ```solidity
    pragma solidity ^0.8.0;
    ```

</details>



## L-6: Modifier Invoked Only Once

Consider removing the modifier or inlining the logic into the calling function.

<details><summary>2 Found Instances</summary>


- Found in src/base/kBase.sol [Line: 236](src/base/kBase.sol#L236)

    ```solidity
        modifier onlyRelayer() {
    ```

- Found in src/base/kBase.sol [Line: 243](src/base/kBase.sol#L243)

    ```solidity
        modifier onlyGuardian() {
    ```

</details>



## L-7: Large Numeric Literal

Large literal values multiples of 10000 can be replaced with scientific notation.Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>2 Found Instances</summary>


- Found in src/kStakingVault/base/BaseVaultModule.sol [Line: 66](src/kStakingVault/base/BaseVaultModule.sol#L66)

    ```solidity
        uint256 public constant ONE_HUNDRED_PERCENT = 10_000;
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 59](src/kStakingVault/modules/FeesModule.sol#L59)

    ```solidity
        uint256 constant MAX_BPS = 10_000;
    ```

</details>



## L-8: Unused Error

Consider using or removing the unused error.

<details><summary>6 Found Instances</summary>


- Found in src/interfaces/IkMinter.sol [Line: 50](src/interfaces/IkMinter.sol#L50)

    ```solidity
        error BatchNotSettled();
    ```

- Found in src/interfaces/IkToken.sol [Line: 24](src/interfaces/IkToken.sol#L24)

    ```solidity
        error Paused();
    ```

- Found in src/interfaces/IkToken.sol [Line: 25](src/interfaces/IkToken.sol#L25)

    ```solidity
        error ZeroAddress();
    ```

- Found in src/interfaces/IkToken.sol [Line: 26](src/interfaces/IkToken.sol#L26)

    ```solidity
        error ZeroAmount();
    ```

- Found in src/interfaces/IkToken.sol [Line: 27](src/interfaces/IkToken.sol#L27)

    ```solidity
        error ContractNotPaused();
    ```

- Found in src/kStakingVault/modules/ClaimModule.sol [Line: 30](src/kStakingVault/modules/ClaimModule.sol#L30)

    ```solidity
        error MinimumOutputNotMet();
    ```

</details>



## L-9: Loop Contains `require`/`revert`

Avoid `require` / `revert` statements in a loop because a single bad item can cause the whole transaction to fail. It's better to forgive on fail and return failed elements post processing of the loop

<details><summary>2 Found Instances</summary>


- Found in src/base/MultiFacetProxy.sol [Line: 75](src/base/MultiFacetProxy.sol#L75)

    ```solidity
            for (uint256 i = 0; i < selectors.length; i++) {
    ```

- Found in src/kRegistry.sol [Line: 239](src/kRegistry.sol#L239)

    ```solidity
            for (uint256 i; i < $.supportedAssets.length();) {
    ```

</details>



## L-10: Unused State Variable

State variable appears to be unused. No analysis has been performed to see if any inline assembly references it. Consider removing this unused variable.

<details><summary>11 Found Instances</summary>


- Found in src/adapters/BaseAdapter.sol [Line: 22](src/adapters/BaseAdapter.sol#L22)

    ```solidity
        uint256 internal constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
    ```

- Found in src/adapters/BaseAdapter.sol [Line: 28](src/adapters/BaseAdapter.sol#L28)

    ```solidity
        bytes32 internal constant K_MINTER = keccak256("K_MINTER");
    ```

- Found in src/adapters/BaseAdapter.sol [Line: 57](src/adapters/BaseAdapter.sol#L57)

    ```solidity
        bytes32 private constant BASE_ADAPTER_STORAGE_LOCATION =
    ```

- Found in src/adapters/CustodialAdapter.sol [Line: 49](src/adapters/CustodialAdapter.sol#L49)

    ```solidity
        bytes32 private constant CUSTODIAL_ADAPTER_STORAGE_LOCATION =
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 13](src/base/MultiFacetProxy.sol#L13)

    ```solidity
        bytes32 internal constant MULTIFACET_PROXY_STORAGE_LOCATION =
    ```

- Found in src/base/kBase.sol [Line: 59](src/base/kBase.sol#L59)

    ```solidity
        bytes32 private constant KBASE_STORAGE_LOCATION = 0xe91688684975c4d7d54a65dd96da5d4dcbb54b8971c046d5351d3c111e43a800;
    ```

- Found in src/kAssetRouter.sol [Line: 39](src/kAssetRouter.sol#L39)

    ```solidity
        bytes32 private constant KASSETROUTER_STORAGE_LOCATION =
    ```

- Found in src/kMinter.sol [Line: 46](src/kMinter.sol#L46)

    ```solidity
        bytes32 private constant KMINTER_STORAGE_LOCATION =
    ```

- Found in src/kRegistry.sol [Line: 23](src/kRegistry.sol#L23)

    ```solidity
        uint256 internal constant FACTORY_ROLE = _ROLE_1;
    ```

- Found in src/kRegistry.sol [Line: 64](src/kRegistry.sol#L64)

    ```solidity
        bytes32 private constant KREGISTRY_STORAGE_LOCATION =
    ```

- Found in src/kToken.sol [Line: 39](src/kToken.sol#L39)

    ```solidity
        bytes32 private constant KTOKEN_STORAGE_LOCATION =
    ```

</details>



## L-11: Dead Code

Functions that are not used. Consider removing them.

<details><summary>2 Found Instances</summary>


- Found in src/adapters/BaseAdapter.sol [Line: 135](src/adapters/BaseAdapter.sol#L135)

    ```solidity
        function _getKTokenForAsset(address asset) internal view returns (address kToken) {
    ```

- Found in src/adapters/BaseAdapter.sol [Line: 144](src/adapters/BaseAdapter.sol#L144)

    ```solidity
        function _getVaultAssets(address vault) internal view returns (address[] memory assets) {
    ```

</details>



## L-12: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>2 Found Instances</summary>


- Found in src/base/MultiFacetProxy.sol [Line: 75](src/base/MultiFacetProxy.sol#L75)

    ```solidity
            for (uint256 i = 0; i < selectors.length; i++) {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 91](src/base/MultiFacetProxy.sol#L91)

    ```solidity
            for (uint256 i = 0; i < selectors.length; i++) {
    ```

</details>



## L-13: Unused Import

Redundant import statement. Consider removing it.

<details><summary>9 Found Instances</summary>


- Found in src/adapters/CustodialAdapter.sol [Line: 4](src/adapters/CustodialAdapter.sol#L4)

    ```solidity
    import { IERC20 } from "forge-std/interfaces/IERC20.sol";
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 5](src/base/MultiFacetProxy.sol#L5)

    ```solidity
    import { UUPSUpgradeable } from "solady/utils/UUPSUpgradeable.sol";
    ```

- Found in src/kStakingVault/base/BaseVaultModule.sol [Line: 14](src/kStakingVault/base/BaseVaultModule.sol#L14)

    ```solidity
    import { IAdapter } from "src/interfaces/IAdapter.sol";
    ```

- Found in src/kStakingVault/modules/ClaimModule.sol [Line: 9](src/kStakingVault/modules/ClaimModule.sol#L9)

    ```solidity
    import { IAdapter } from "src/interfaces/IAdapter.sol";
    ```

- Found in src/kStakingVault/modules/ClaimModule.sol [Line: 10](src/kStakingVault/modules/ClaimModule.sol#L10)

    ```solidity
    import { IkStakingVault } from "src/interfaces/IkStakingVault.sol";
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 5](src/kStakingVault/modules/FeesModule.sol#L5)

    ```solidity
    import { LibClone } from "solady/utils/LibClone.sol";
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 6](src/kStakingVault/modules/FeesModule.sol#L6)

    ```solidity
    import { SafeCastLib } from "solady/utils/SafeCastLib.sol";
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 8](src/kStakingVault/modules/FeesModule.sol#L8)

    ```solidity
    import { kBatchReceiver } from "src/kBatchReceiver.sol";
    ```

- Found in src/kStakingVault/modules/FeesModule.sol [Line: 10](src/kStakingVault/modules/FeesModule.sol#L10)

    ```solidity
    import { BaseVaultModuleTypes } from "src/kStakingVault/types/BaseVaultModuleTypes.sol";
    ```

</details>



## L-14: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>6 Found Instances</summary>


- Found in src/adapters/CustodialAdapter.sol [Line: 75](src/adapters/CustodialAdapter.sol#L75)

    ```solidity
        function initialize(address registry_, address owner_, address admin_) external initializer {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 55](src/base/MultiFacetProxy.sol#L55)

    ```solidity
        function addFunction(
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 74](src/base/MultiFacetProxy.sol#L74)

    ```solidity
        function addFunctions(bytes4[] calldata selectors, address implementation, bool forceOverride) public {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 83](src/base/MultiFacetProxy.sol#L83)

    ```solidity
        function removeFunction(bytes4 selector) public onlyRoles(_proxyAdminRole()) {
    ```

- Found in src/base/MultiFacetProxy.sol [Line: 90](src/base/MultiFacetProxy.sol#L90)

    ```solidity
        function removeFunctions(bytes4[] calldata selectors) public {
    ```

- Found in src/kToken.sol [Line: 99](src/kToken.sol#L99)

    ```solidity
        function initialize(
    ```

</details>



## L-15: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>13 Found Instances</summary>


- Found in src/kMinter.sol [Line: 193](src/kMinter.sol#L193)

    ```solidity
            $.userRequests[to_].add(requestId);
    ```

- Found in src/kMinter.sol [Line: 229](src/kMinter.sol#L229)

    ```solidity
            $.userRequests[redeemRequest.user].remove(requestId);
    ```

- Found in src/kMinter.sol [Line: 250](src/kMinter.sol#L250)

    ```solidity
            $.userRequests[redeemRequest.user].remove(requestId);
    ```

- Found in src/kRegistry.sol [Line: 128](src/kRegistry.sol#L128)

    ```solidity
                $.supportedAssets.add(asset);
    ```

- Found in src/kRegistry.sol [Line: 159](src/kRegistry.sol#L159)

    ```solidity
            $.vaultAsset[vault].add(asset);
    ```

- Found in src/kRegistry.sol [Line: 160](src/kRegistry.sol#L160)

    ```solidity
            $.allVaults.add(vault);
    ```

- Found in src/kRegistry.sol [Line: 164](src/kRegistry.sol#L164)

    ```solidity
            $.vaultsByAsset[asset].add(vault);
    ```

- Found in src/kRegistry.sol [Line: 190](src/kRegistry.sol#L190)

    ```solidity
            $.vaultAdapters[vault].add(adapter);
    ```

- Found in src/kRegistry.sol [Line: 202](src/kRegistry.sol#L202)

    ```solidity
            $.vaultAdapters[vault].remove(adapter);
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 129](src/kStakingVault/kStakingVault.sol#L129)

    ```solidity
            $.userRequests[msg.sender].add(requestId);
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 177](src/kStakingVault/kStakingVault.sol#L177)

    ```solidity
            $.userRequests[msg.sender].add(requestId);
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 199](src/kStakingVault/kStakingVault.sol#L199)

    ```solidity
            $.userRequests[msg.sender].remove(requestId);
    ```

- Found in src/kStakingVault/kStakingVault.sol [Line: 225](src/kStakingVault/kStakingVault.sol#L225)

    ```solidity
            $.userRequests[msg.sender].remove(requestId);
    ```

</details>



