<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>KAM Contracts Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">KAM Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/VerisLabs/KAM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="kam-protocol"><a class="header" href="#kam-protocol">KAM Protocol</a></h1>
<p>KAM is an institutional asset management protocol that implements a dual-track architecture for both institutional and retail access. The protocol creates kTokens (kUSD, kBTC) backed 1:1 by real assets (USDC, WBTC), providing institutions with direct minting and redemption capabilities while offering retail users yield opportunities through external strategy deployment. The system features batch processing with virtual balance accounting, two-phase settlement with timelock proposals, and modular vault architecture through diamond pattern implementation.</p>
<p>For more information, refer to the <a href="./docs/architecture.html">architecture documentation</a>.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>KAM comes with a comprehensive set of tests written in Solidity, which can be executed using Foundry.</p>
<p>To install Foundry:</p>
<pre><code class="language-sh">curl -L https://foundry.paradigm.xyz | bash
</code></pre>
<p>This will download foundryup. To start Foundry, run:</p>
<pre><code class="language-sh">foundryup
</code></pre>
<p>To clone the repo:</p>
<pre><code class="language-sh">git clone https://github.com/kam-protocol/kam.git &amp;&amp; cd kam
</code></pre>
<h3 id="installing-dependencies"><a class="header" href="#installing-dependencies">Installing Dependencies</a></h3>
<p>The project uses Soldeer for dependency management. To install all dependencies:</p>
<pre><code class="language-sh">forge soldeer install
</code></pre>
<p>This will install all dependencies specified in <code>soldeer.toml</code> and <code>soldeer.lock</code>.</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="in-default-mode"><a class="header" href="#in-default-mode">in <code>default</code> mode</a></h3>
<p>To run the tests in a <code>default</code> mode:</p>
<pre><code class="language-sh">forge test
</code></pre>
<h3 id="in-coverage-mode"><a class="header" href="#in-coverage-mode">in <code>coverage</code> mode</a></h3>
<pre><code class="language-sh">forge coverage
</code></pre>
<h3 id="using-solx-compiler-optional"><a class="header" href="#using-solx-compiler-optional">Using solx compiler (optional)</a></h3>
<p>For faster compilation with the LLVM-based Solidity compiler, you can install and use solx:</p>
<p>Install solx:</p>
<pre><code class="language-sh">curl -L https://raw.githubusercontent.com/matter-labs/solx/main/install-solx | bash
</code></pre>
<p>Use with forge:</p>
<pre><code class="language-sh">forge build --use $(which solx)
forge test --use $(which solx)
</code></pre>
<h2 id="smart-contracts-documentation"><a class="header" href="#smart-contracts-documentation">Smart Contracts Documentation</a></h2>
<p>Generate and view the Foundry documentation:</p>
<pre><code class="language-sh">forge doc --serve --port 4000
</code></pre>
<p>This will open the documentation at http://localhost:4000</p>
<h2 id="protocol-documentation"><a class="header" href="#protocol-documentation">Protocol Documentation</a></h2>
<ul>
<li><a href="./docs/architecture.html">Architecture</a> - Complete protocol architecture and operational flows</li>
<li><a href="./docs/interfaces.html">Interfaces</a> - Interface documentation for all protocol contracts</li>
<li><a href="./docs/audits/audit-scope.html">Audit Scope</a> - Comprehensive audit scope and security considerations</li>
</ul>
<h2 id="for-integrators"><a class="header" href="#for-integrators">For Integrators</a></h2>
<h3 id="institutional-operations"><a class="header" href="#institutional-operations">Institutional Operations</a></h3>
<p>Institutions can mint kTokens 1:1 with underlying assets and request redemptions through batch settlement:</p>
<ul>
<li><code>kMinter.mint()</code> - Creates new kTokens by accepting underlying asset deposits</li>
<li><code>kMinter.requestRedeem()</code> - Initiates redemption process through batch settlement</li>
<li><code>kMinter.redeem()</code> - Executes redemption for settled batch requests</li>
<li><code>kMinter.cancelRequest()</code> - Cancels redemption requests before settlement</li>
</ul>
<h3 id="retail-operations"><a class="header" href="#retail-operations">Retail Operations</a></h3>
<p>Retail users can stake kTokens to earn yield from external strategies:</p>
<ul>
<li><code>kStakingVault.requestStake()</code> - Request to stake kTokens for yield-bearing stkTokens</li>
<li><code>kStakingVault.requestUnstake()</code> - Request to unstake stkTokens back to kTokens</li>
<li>Claims processed through vault's VaultClaims after batch settlement</li>
</ul>
<h3 id="virtual-balance-system"><a class="header" href="#virtual-balance-system">Virtual Balance System</a></h3>
<p>The protocol uses virtual balance accounting to optimize gas efficiency:</p>
<ul>
<li><code>kAssetRouter</code> maintains virtual balances between vaults and strategies</li>
<li>Physical transfers minimized to settlement operations only</li>
<li>All inter-vault transfers are virtual until settlement execution</li>
</ul>
<h3 id="batch-processing"><a class="header" href="#batch-processing">Batch Processing</a></h3>
<p>Requests are grouped into time-based batches for gas-efficient settlement:</p>
<ul>
<li>Each vault manages independent batch cycles</li>
<li>Batch receivers deployed per batch for isolated asset distribution</li>
<li>Settlement coordinated through timelock proposals with correction mechanisms</li>
</ul>
<h2 id="role-hierarchy"><a class="header" href="#role-hierarchy">Role Hierarchy</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Role</th><th>Permissions</th><th>Contracts</th></tr></thead><tbody>
<tr><td>OWNER</td><td>Ultimate control, upgrades</td><td>All</td></tr>
<tr><td>ADMIN_ROLE</td><td>Operational management</td><td>All</td></tr>
<tr><td>EMERGENCY_ADMIN_ROLE</td><td>Emergency pause</td><td>All</td></tr>
<tr><td>MINTER_ROLE</td><td>Mint/burn tokens</td><td>kToken</td></tr>
<tr><td>INSTITUTION_ROLE</td><td>Mint/redeem kTokens</td><td>kMinter</td></tr>
<tr><td>RELAYER_ROLE</td><td>Settle batches</td><td>kAssetRouter, VaultBatches</td></tr>
<tr><td>VENDOR_ROLE</td><td>Adds Institutions</td><td>kRegistry</td></tr>
</tbody></table>
</div>
<h2 id="safety"><a class="header" href="#safety">Safety</a></h2>
<p>This software is experimental and is provided "as is" and "as available".</p>
<p>No warranties are provided and no liability will be accepted for any loss incurred through the use of this codebase.</p>
<p>Always include thorough tests when using KAM to ensure it interacts correctly with your code.</p>
<h2 id="known-limitations"><a class="header" href="#known-limitations">Known Limitations</a></h2>
<ul>
<li>Settlement proposals require timelock delays, potentially causing settlement delays if parameters need correction</li>
<li>Virtual balances must remain synchronized with actual adapter holdings</li>
<li>Redemption completion depends on successful batch settlement and adapter cooperation</li>
<li>Adapter integrations require careful validation of different DeFi protocol settlement patterns</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The code is currently in a closed development phase. This is a proprietary protocol with restricted access.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>(c) 2025 KAM Protocol Ltd.</p>
<p>All rights reserved. This project uses a proprietary license.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></li>
<li><a href="src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></li>
<li><a href="src/abstracts/Proxy.sol/abstract.Proxy.html">Proxy</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extsload"><a class="header" href="#extsload">Extsload</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/abstracts/Extsload.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/abstracts/Extsload.sol//src/interfaces/IExtsload.sol/interface.IExtsload.html">IExtsload</a></p>
<p>Enables public storage access for efficient state retrieval by external contracts</p>
<p>This was taken from https://github.com/Uniswap/v4-core/blob/main/src/Extsload.sol</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="extsload-1"><a class="header" href="#extsload-1">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 slot) external view returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slot</code></td><td><code>bytes32</code></td><td>Storage slot to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-2"><a class="header" href="#extsload-2">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 startSlot, uint256 nSlots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startSlot</code></td><td><code>bytes32</code></td><td></td></tr>
<tr><td><code>nSlots</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-3"><a class="header" href="#extsload-3">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32[] calldata slots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slots</code></td><td><code>bytes32[]</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedreentrancyguardtransient"><a class="header" href="#optimizedreentrancyguardtransient">OptimizedReentrancyGuardTransient</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/abstracts/OptimizedReentrancyGuardTransient.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/ReentrancyGuardTransient.sol)</p>
<p>Optimized reentrancy guard mixin (transient storage variant).</p>
<p><em>This implementation utilizes a internal function instead of a modifier
to check the reentrant condition, with the purpose of reducing contract size</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="_reentrancy_guard_slot"><a class="header" href="#_reentrancy_guard_slot">_REENTRANCY_GUARD_SLOT</a></h3>
<p><em>Equivalent to: <code>uint32(bytes4(keccak256("Reentrancy()"))) | 1 &lt;&lt; 71</code>.
9 bytes is large enough to avoid collisions in practice,
but not too large to result in excessive bytecode bloat.</em></p>
<pre><code class="language-solidity">uint256 private constant _REENTRANCY_GUARD_SLOT = 0x8000000000ab143c06;
</code></pre>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="_lockreentrant"><a class="header" href="#_lockreentrant">_lockReentrant</a></h3>
<pre><code class="language-solidity">function _lockReentrant() internal;
</code></pre>
<h3 id="_unlockreentrant"><a class="header" href="#_unlockreentrant">_unlockReentrant</a></h3>
<pre><code class="language-solidity">function _unlockReentrant() internal;
</code></pre>
<h3 id="_usetransientreentrancyguardonlyonmainnet"><a class="header" href="#_usetransientreentrancyguardonlyonmainnet">_useTransientReentrancyGuardOnlyOnMainnet</a></h3>
<p><em>For widespread compatibility with L2s.
Only Ethereum mainnet is expensive anyways.</em></p>
<pre><code class="language-solidity">function _useTransientReentrancyGuardOnlyOnMainnet() internal view virtual returns (bool);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="reentrancy"><a class="header" href="#reentrancy">Reentrancy</a></h3>
<p><em>Unauthorized reentrant call.</em></p>
<pre><code class="language-solidity">error Reentrancy();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="proxy"><a class="header" href="#proxy">Proxy</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/abstracts/Proxy.sol">Git Source</a></p>
<p><em>This abstract contract provides a fallback function that delegates all calls to another contract using the EVM
instruction <code>delegatecall</code>. We refer to the second contract as the <em>implementation</em> behind the proxy, and it has to
be specified by overriding the virtual <a href="src/abstracts/Proxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html#_implementation">_implementation</a> function.
Additionally, delegation to the implementation can be triggered manually through the {_fallback} function, or to a
different contract through the {_delegate} function.
The success and return data of the delegated call will be returned back to the caller of the proxy.</em></p>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="_delegate"><a class="header" href="#_delegate">_delegate</a></h3>
<p><em>Delegates the current call to <code>implementation</code>.
This function does not return to its internal call site, it will return directly to the external caller.</em></p>
<pre><code class="language-solidity">function _delegate(address implementation) internal virtual;
</code></pre>
<h3 id="_implementation"><a class="header" href="#_implementation">_implementation</a></h3>
<p><em>This is a virtual function that should be overridden so it returns the address to which the fallback
function and <a href="src/abstracts/Proxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html#_fallback">_fallback</a> should delegate.</em></p>
<pre><code class="language-solidity">function _implementation() internal view virtual returns (address);
</code></pre>
<h3 id="_fallback"><a class="header" href="#_fallback">_fallback</a></h3>
<p><em>Delegates the current call to the address returned by <code>_implementation()</code>.
This function does not return to its internal call site, it will return directly to the external caller.</em></p>
<pre><code class="language-solidity">function _fallback() internal virtual;
</code></pre>
<h3 id="fallback"><a class="header" href="#fallback">fallback</a></h3>
<p><em>Fallback function that delegates calls to the address returned by <code>_implementation()</code>. Will run if no other
function in the contract matches the call data.</em></p>
<pre><code class="language-solidity">fallback() external payable virtual;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-1"><a class="header" href="#contents-1">Contents</a></h1>
<ul>
<li><a href="src/adapters/BaseAdapter.sol/contract.BaseAdapter.html">BaseAdapter</a></li>
<li><a href="src/adapters/CustodialAdapter.sol/contract.CustodialAdapter.html">CustodialAdapter</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="baseadapter"><a class="header" href="#baseadapter">BaseAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/adapters/BaseAdapter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/adapters/BaseAdapter.sol//src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></p>
<p>Foundation contract providing essential shared functionality for all protocol adapter implementations</p>
<p><em>This abstract contract serves as the base layer for adapter pattern implementations that integrate external
yield strategies (CEX, DeFi protocols, custodial solutions) with the KAM protocol. Key responsibilities include:
(1) Registry integration to maintain protocol-wide configuration consistency and access control, (2) Asset rescue
mechanisms to recover stuck funds while protecting protocol assets from unauthorized extraction, (3) Standardized
initialization patterns ensuring proper setup across all adapter types, (4) Version tracking for upgrade management
and compatibility checks, (5) Role-based access control validation through registry lookups. Adapters enable the
protocol to generate yield from diverse sources while maintaining a unified interface for the kAssetRouter. Each
adapter implementation (CustodialAdapter, AaveAdapter, etc.) extends this base to handle strategy-specific logic
while inheriting critical safety features and protocol integration. The ERC-7201 storage pattern prevents collisions
during upgrades and enables safe composition with other base contracts.</em></p>
<h2 id="state-variables-1"><a class="header" href="#state-variables-1">State Variables</a></h2>
<h3 id="k_asset_router"><a class="header" href="#k_asset_router">K_ASSET_ROUTER</a></h3>
<p>Registry lookup key for the kAssetRouter singleton contract</p>
<p><em>Used to retrieve and validate the kAssetRouter address from registry. Only kAssetRouter
can trigger adapter deposits/redemptions, ensuring centralized control over asset flows.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="base_adapter_storage_location"><a class="header" href="#base_adapter_storage_location">BASE_ADAPTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant BASE_ADAPTER_STORAGE_LOCATION =
    0x5547882c17743d50a538cd94a34f6308d65f7005fe26b376dcedda44d3aab800;
</code></pre>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="_getbaseadapterstorage"><a class="header" href="#_getbaseadapterstorage">_getBaseAdapterStorage</a></h3>
<p><em>Returns the base adapter storage pointer</em></p>
<pre><code class="language-solidity">function _getBaseAdapterStorage() internal pure returns (BaseAdapterStorage storage $);
</code></pre>
<h3 id="__baseadapter_init"><a class="header" href="#__baseadapter_init">__BaseAdapter_init</a></h3>
<p>Initializes the base adapter with registry integration and metadata</p>
<p><em>This internal initialization establishes the foundation for all adapter implementations. The process:
(1) Validates initialization hasn't occurred to prevent reinitialization in proxy patterns, (2) Ensures
registry address is valid since all access control depends on it, (3) Sets adapter metadata for tracking
and identification, (4) Marks initialization complete. Must be called by inheriting adapter contracts
during their initialization phase to establish proper protocol integration. The internal visibility
ensures only inheriting contracts can initialize, preventing external manipulation.</em></p>
<pre><code class="language-solidity">function __BaseAdapter_init(address registry_, string memory name_, string memory version_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address for protocol configuration and access control</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>Human-readable adapter identifier (e.g., "CustodialAdapter", "AaveV3Adapter")</td></tr>
<tr><td><code>version_</code></td><td><code>string</code></td><td>Semantic version string for upgrade management (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h3 id="registry"><a class="header" href="#registry">registry</a></h3>
<p>Returns the registry contract address</p>
<p><em>Reverts if contract not initialized</em></p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The kRegistry contract address</td></tr>
</tbody></table>
</div>
<h3 id="_registry"><a class="header" href="#_registry">_registry</a></h3>
<p>Returns the registry contract interface</p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets"><a class="header" href="#rescueassets">rescueAssets</a></h3>
<p>Rescues accidentally sent assets preventing permanent loss in the adapter</p>
<p><em>Critical safety mechanism for recovering tokens or ETH stuck in the adapter through user error
or airdrops. The rescue process: (1) Validates admin authorization to prevent unauthorized extraction,
(2) Ensures recipient address validity to prevent burning funds, (3) For ETH (asset_=address(0)):
validates balance and uses low-level call for transfer, (4) For ERC20: critically verifies the token
is NOT a registered protocol asset to protect user deposits, then validates balance and uses
SafeTransferLib. Protocol assets are blocked to prevent admin abuse and maintain user trust. This
function is essential for adapter contracts that may receive unexpected transfers.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_, address to_, uint256 amount_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The asset to rescue (address(0) for ETH, token address for ERC20)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address for rescued assets (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity to rescue (must not exceed available balance)</td></tr>
</tbody></table>
</div>
<h3 id="name"><a class="header" href="#name">name</a></h3>
<p>Returns the adapter's name</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Human readable adapter name</td></tr>
</tbody></table>
</div>
<h3 id="version"><a class="header" href="#version">version</a></h3>
<p>Returns the adapter's version</p>
<pre><code class="language-solidity">function version() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string</td></tr>
</tbody></table>
</div>
<h3 id="_isadmin"><a class="header" href="#_isadmin">_isAdmin</a></h3>
<p>Checks if an address has admin role for adapter management</p>
<p><em>Admins can rescue assets and configure adapter parameters. Access control through registry.</em></p>
<pre><code class="language-solidity">function _isAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an admin</td></tr>
</tbody></table>
</div>
<h3 id="_iskassetrouter"><a class="header" href="#_iskassetrouter">_isKAssetRouter</a></h3>
<p>Checks if an address is the kAssetRouter contract</p>
<p><em>Only kAssetRouter can trigger deposits/redemptions in adapters, ensuring centralized control
over asset flows between vaults and external strategies. Critical for maintaining protocol integrity.</em></p>
<pre><code class="language-solidity">function _isKAssetRouter(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to validate against kAssetRouter</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is the registered kAssetRouter</td></tr>
</tbody></table>
</div>
<h3 id="_isasset"><a class="header" href="#_isasset">_isAsset</a></h3>
<p>Checks if an asset is registered in the protocol</p>
<p><em>Registered assets (USDC, WBTC, etc.) cannot be rescued to protect user deposits.
This distinction ensures protocol assets remain under vault control.</em></p>
<pre><code class="language-solidity">function _isAsset(address asset) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the asset is a registered protocol asset</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="rescuedassets"><a class="header" href="#rescuedassets">RescuedAssets</a></h3>
<p>Emitted when ERC20 tokens are rescued from the adapter to prevent permanent loss</p>
<p><em>Rescue mechanism restricted to non-protocol assets to protect user funds. Typically recovers
accidentally sent tokens or airdrops that would otherwise be locked in the adapter contract.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The ERC20 token address being rescued (must not be a registered protocol asset)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address receiving the rescued tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth"><a class="header" href="#rescuedeth">RescuedETH</a></h3>
<p>Emitted when native ETH is rescued from the adapter contract</p>
<p><em>Separate from ERC20 rescue due to different transfer mechanisms. Prevents ETH from being
permanently locked if sent to the adapter accidentally.</em></p>
<pre><code class="language-solidity">event RescuedETH(address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address receiving the rescued ETH</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of ETH rescued in wei</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="baseadapterstorage"><a class="header" href="#baseadapterstorage">BaseAdapterStorage</a></h3>
<p><em>Storage struct following ERC-7201 namespaced storage pattern for upgrade safety.
Prevents storage collisions when adapters inherit from multiple base contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.BaseAdapter</p>
<pre><code class="language-solidity">struct BaseAdapterStorage {
    address registry;
    bool initialized;
    string name;
    string version;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custodialadapter"><a class="header" href="#custodialadapter">CustodialAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/adapters/CustodialAdapter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/adapters/CustodialAdapter.sol//src/adapters/BaseAdapter.sol/contract.BaseAdapter.html">BaseAdapter</a>, <a href="src/adapters/CustodialAdapter.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/adapters/CustodialAdapter.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a></p>
<p>Specialized adapter enabling yield generation through custodial services like CEX staking and institutional
platforms</p>
<p><em>This adapter implements the bridge between KAM protocol vaults and external custodial yield sources
(centralized
exchanges, CEFFU, institutional staking providers). Key functionality includes: (1) Virtual balance tracking that
maintains on-chain accounting while assets are held off-chain, (2) Configurable custodial destinations per vault
allowing flexible routing to different providers, (3) Two-phase deposit/redemption flow where deposits are tracked
virtually and actual transfers happen through manual processes, (4) Total assets management for accurate yield
calculation during settlements, (5) Request ID system for tracking redemption operations. The adapter operates on
a trust-minimized model where admin-controlled totalAssets updates reflect off-chain yields, which are then
distributed
through the settlement process. This design enables institutional-grade yield opportunities while maintaining the
protocol's unified settlement and distribution mechanisms. The virtual balance system ensures accurate accounting
even when assets are temporarily off-chain for yield generation.</em></p>
<h2 id="state-variables-2"><a class="header" href="#state-variables-2">State Variables</a></h2>
<h3 id="custodial_adapter_storage_location"><a class="header" href="#custodial_adapter_storage_location">CUSTODIAL_ADAPTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant CUSTODIAL_ADAPTER_STORAGE_LOCATION =
    0x6096605776f37a069e5fb3b2282c592b4e41a8f7c82e8665fde33e5acbdbaf00;
</code></pre>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="_getcustodialadapterstorage"><a class="header" href="#_getcustodialadapterstorage">_getCustodialAdapterStorage</a></h3>
<p><em>Returns the custodial adapter storage pointer</em></p>
<pre><code class="language-solidity">function _getCustodialAdapterStorage() internal pure returns (CustodialAdapterStorage storage $);
</code></pre>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Empty constructor to ensure clean initialization state</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p>Initializes the CustodialAdapter with registry integration and request tracking</p>
<p><em>Initialization process: (1) Calls BaseAdapter initialization for registry setup and metadata,
(2) Initializes request ID counter for redemption tracking, (3) Emits initialization event for
monitoring. The adapter starts with no vault destinations configured - these must be set by admin
before deposits can occur. Uses OpenZeppelin's initializer modifier for reentrancy protection.</em></p>
<pre><code class="language-solidity">function initialize(address registry_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address for protocol configuration and access control</td></tr>
</tbody></table>
</div>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<p>Virtually deposits assets for custodial yield generation while maintaining on-chain accounting</p>
<p><em>This function handles the on-chain accounting when assets are routed to custodial services. Process:
(1) Validates caller is kAssetRouter ensuring centralized control over deposits, (2) Validates parameters
to prevent zero deposits or invalid addresses, (3) Checks vault has configured custodial destination,
(4) Verifies adapter has received the assets from kAssetRouter, (5) Updates virtual balance tracking
for accurate accounting. Note: This doesn't transfer to custodial address - that happens through separate
manual processes. The virtual tracking ensures the protocol knows asset locations even when off-chain.
This two-phase approach enables yield generation through custodial services while maintaining protocol
accounting integrity for settlements.</em></p>
<pre><code class="language-solidity">function deposit(address asset, uint256 amount, address onBehalfOf) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being deposited (must be protocol-registered)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity being virtually deposited (must be non-zero)</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault that owns these assets for yield attribution</td></tr>
</tbody></table>
</div>
<h3 id="redeem"><a class="header" href="#redeem">redeem</a></h3>
<p>Virtually redeems assets from custodial holdings by updating on-chain accounting</p>
<p><em>Handles the accounting for asset redemptions from custodial services. Process: (1) Validates
caller is kAssetRouter for centralized control, (2) Validates parameters preventing invalid redemptions,
(3) Checks vault has configured destination ensuring proper setup, (4) Decrements virtual balance
reflecting the redemption request. Like deposits, actual asset return from custodial address happens
through manual processes. The virtual balance update ensures accurate protocol accounting during the
redemption period. This function is virtual allowing specialized implementations to add custom logic
while maintaining base redemption accounting.</em></p>
<pre><code class="language-solidity">function redeem(address asset, uint256 amount, address onBehalfOf) external virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity to redeem (must not exceed virtual balance)</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault requesting redemption of its assets</td></tr>
</tbody></table>
</div>
<h3 id="totalestimatedassets"><a class="header" href="#totalestimatedassets">totalEstimatedAssets</a></h3>
<p>Returns the current total assets across all custodial addresses for this asset</p>
<pre><code class="language-solidity">function totalEstimatedAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault to query</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held across all custodial addresses managed by this adapter</td></tr>
</tbody></table>
</div>
<h3 id="totalvirtualassets"><a class="header" href="#totalvirtualassets">totalVirtualAssets</a></h3>
<p>Returns the total assets in storage for a given vault</p>
<pre><code class="language-solidity">function totalVirtualAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held in storage for this vault</td></tr>
</tbody></table>
</div>
<h3 id="totalassets"><a class="header" href="#totalassets">totalAssets</a></h3>
<p>Returns the total assets for a given vault and asset</p>
<pre><code class="language-solidity">function totalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held for this vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="getlasttotalassets"><a class="header" href="#getlasttotalassets">getLastTotalAssets</a></h3>
<p>Returns the last total assets for a given vault and asset</p>
<pre><code class="language-solidity">function getLastTotalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The last total assets for the vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultdestination"><a class="header" href="#getvaultdestination">getVaultDestination</a></h3>
<p>Returns the custodial address for a given vault</p>
<pre><code class="language-solidity">function getVaultDestination(address vault) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The custodial address for the vault</td></tr>
</tbody></table>
</div>
<h3 id="setvaultdestination"><a class="header" href="#setvaultdestination">setVaultDestination</a></h3>
<p>Configures the custodial destination address for a specific vault's assets</p>
<p><em>Admin function to map vaults to their custodial service providers. Process: (1) Validates admin
authorization for security, (2) Ensures both addresses are valid preventing misconfiguration,
(3) Validates vault is registered in protocol ensuring only authorized vaults use custodial services,
(4) Updates mapping and emits event for tracking. Each vault can have a unique destination enabling
diversification across custodial providers. Must be configured before deposits can occur.</em></p>
<pre><code class="language-solidity">function setVaultDestination(address vault, address custodialAddress) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to configure custodial destination for</td></tr>
<tr><td><code>custodialAddress</code></td><td><code>address</code></td><td>The off-chain custodial address (CEX wallet, institutional account)</td></tr>
</tbody></table>
</div>
<h3 id="settotalassets"><a class="header" href="#settotalassets">setTotalAssets</a></h3>
<p>Updates total assets to reflect off-chain yields for settlement calculations</p>
<p><em>Critical function for yield distribution - allows kAssetRouter to update asset values based on
off-chain performance. Process: (1) Validates caller is kAssetRouter ensuring only settlement process
can update, (2) Sets new total reflecting yields or losses from custodial services, (3) Emits event
for tracking. The difference between previous and new totalAssets represents yield to be distributed
during settlement. This trust-minimized approach requires careful monitoring but enables access to
institutional yield opportunities not available on-chain.</em></p>
<pre><code class="language-solidity">function setTotalAssets(address vault, address asset, uint256 totalAssets_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault whose assets are being updated</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The specific asset being updated</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td>The new total value including any yields or losses</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade"><a class="header" href="#_authorizeupgrade">_authorizeUpgrade</a></h3>
<p>Authorizes contract upgrades through UUPS pattern with admin validation</p>
<p><em>Security-critical function controlling adapter upgrades. Only admin can authorize ensuring
governance control over adapter evolution. Validates new implementation address preventing
accidental upgrades to zero address. Part of UUPS upgrade pattern for gas-efficient upgrades.</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>The new adapter implementation contract address</td></tr>
</tbody></table>
</div>
<h2 id="events-1"><a class="header" href="#events-1">Events</a></h2>
<h3 id="vaultdestinationupdated"><a class="header" href="#vaultdestinationupdated">VaultDestinationUpdated</a></h3>
<p>Emitted when a vault's custodial destination address is configured or updated</p>
<p><em>Custodial addresses represent off-chain destinations (CEX wallets, institutional accounts) where
assets are sent for yield generation. Each vault can have its own destination for segregation.</em></p>
<pre><code class="language-solidity">event VaultDestinationUpdated(address indexed vault, address indexed oldAddress, address indexed newAddress);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address whose custodial destination is being updated</td></tr>
<tr><td><code>oldAddress</code></td><td><code>address</code></td><td>The previous custodial address (address(0) if first configuration)</td></tr>
<tr><td><code>newAddress</code></td><td><code>address</code></td><td>The new custodial address for this vault's assets</td></tr>
</tbody></table>
</div>
<h3 id="totalassetsupdated"><a class="header" href="#totalassetsupdated">TotalAssetsUpdated</a></h3>
<p>Emitted when total assets are updated to reflect off-chain yields or losses</p>
<p><em>This update mechanism allows the protocol to account for yields generated in custodial accounts.
The kAssetRouter uses these values during settlement to calculate and distribute yields.</em></p>
<pre><code class="language-solidity">event TotalAssetsUpdated(address indexed vault, uint256 totalAssets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address whose total assets are being updated</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>The new total asset value including any yields or losses</td></tr>
</tbody></table>
</div>
<h3 id="deposited"><a class="header" href="#deposited">Deposited</a></h3>
<p>Emitted when assets are virtually deposited for custodial yield generation</p>
<p><em>Marks the virtual accounting update when kAssetRouter routes assets to this adapter.
Actual transfer to custodial address happens separately through manual processes.</em></p>
<pre><code class="language-solidity">event Deposited(address indexed asset, uint256 amount, address indexed onBehalfOf);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being deposited (USDC, WBTC, etc.)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being virtually deposited</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address that owns these deposited assets</td></tr>
</tbody></table>
</div>
<h3 id="redemptionrequested"><a class="header" href="#redemptionrequested">RedemptionRequested</a></h3>
<p>Emitted when redemption is requested from custodial holdings</p>
<p><em>Initiates the redemption process by updating virtual balances. Actual asset return
from custodial address happens through manual processes coordinated off-chain.</em></p>
<pre><code class="language-solidity">event RedemptionRequested(address indexed asset, uint256 amount, address indexed onBehalfOf);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity requested for redemption</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault requesting the redemption</td></tr>
</tbody></table>
</div>
<h3 id="redemptionprocessed"><a class="header" href="#redemptionprocessed">RedemptionProcessed</a></h3>
<p>Emitted when a redemption is processed</p>
<pre><code class="language-solidity">event RedemptionProcessed(uint256 indexed requestId, uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID</td></tr>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The amount of assets processed</td></tr>
</tbody></table>
</div>
<h3 id="adapterbalanceupdated"><a class="header" href="#adapterbalanceupdated">AdapterBalanceUpdated</a></h3>
<p>Emitted when the adapter balance is updated</p>
<pre><code class="language-solidity">event AdapterBalanceUpdated(address indexed vault, address indexed asset, uint256 newBalance);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>newBalance</code></td><td><code>uint256</code></td><td>The new balance</td></tr>
</tbody></table>
</div>
<h3 id="initialised"><a class="header" href="#initialised">Initialised</a></h3>
<p>Emitted when the adapter is initialized</p>
<pre><code class="language-solidity">event Initialised(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The registry address</td></tr>
</tbody></table>
</div>
<h2 id="structs-1"><a class="header" href="#structs-1">Structs</a></h2>
<h3 id="custodialadapterstorage"><a class="header" href="#custodialadapterstorage">CustodialAdapterStorage</a></h3>
<p><em>Storage layout using ERC-7201 pattern for upgrade safety and collision prevention</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.CustodialAdapter</p>
<pre><code class="language-solidity">struct CustodialAdapterStorage {
    uint256 nextRequestId;
    mapping(address vault =&gt; mapping(address asset =&gt; uint256 balance)) balanceOf;
    mapping(address vault =&gt; mapping(address asset =&gt; uint256 totalAssets)) totalAssets;
    mapping(address vault =&gt; address custodialAddress) vaultDestinations;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-2"><a class="header" href="#contents-2">Contents</a></h1>
<ul>
<li><a href="src/base/MultiFacetProxy.sol/abstract.MultiFacetProxy.html">MultiFacetProxy</a></li>
<li><a href="src/base/kBase.sol/contract.kBase.html">kBase</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multifacetproxy"><a class="header" href="#multifacetproxy">MultiFacetProxy</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/base/MultiFacetProxy.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/base/MultiFacetProxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html">Proxy</a></p>
<p>A proxy contract that can route function calls to different implementation contracts</p>
<p><em>Inherits from Base and OpenZeppelin's Proxy contract</em></p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="multifacet_proxy_storage_location"><a class="header" href="#multifacet_proxy_storage_location">MULTIFACET_PROXY_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 internal constant MULTIFACET_PROXY_STORAGE_LOCATION =
    0xfeaf205b5229ea10e902c7b89e4768733c756362b2becb0bfd65a97f71b02d00;
</code></pre>
<h2 id="functions-5"><a class="header" href="#functions-5">Functions</a></h2>
<h3 id="_getmultifacetproxystorage"><a class="header" href="#_getmultifacetproxystorage">_getMultiFacetProxyStorage</a></h3>
<p><em>Returns the MultiFacetProxy storage pointer</em></p>
<pre><code class="language-solidity">function _getMultiFacetProxyStorage() internal pure returns (MultiFacetProxyStorage storage $);
</code></pre>
<h3 id="addfunction"><a class="header" href="#addfunction">addFunction</a></h3>
<p>Adds a function selector mapping to an implementation address</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function addFunction(bytes4 selector, address implementation, bool forceOverride) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selector</code></td><td><code>bytes4</code></td><td>The function selector to add</td></tr>
<tr><td><code>implementation</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
<tr><td><code>forceOverride</code></td><td><code>bool</code></td><td>If true, allows overwriting existing mappings</td></tr>
</tbody></table>
</div>
<h3 id="addfunctions"><a class="header" href="#addfunctions">addFunctions</a></h3>
<p>Adds multiple function selector mappings to an implementation</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function addFunctions(bytes4[] calldata selectors, address implementation, bool forceOverride) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selectors</code></td><td><code>bytes4[]</code></td><td>Array of function selectors to add</td></tr>
<tr><td><code>implementation</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
<tr><td><code>forceOverride</code></td><td><code>bool</code></td><td>If true, allows overwriting existing mappings</td></tr>
</tbody></table>
</div>
<h3 id="removefunction"><a class="header" href="#removefunction">removeFunction</a></h3>
<p>Removes a function selector mapping</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function removeFunction(bytes4 selector) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selector</code></td><td><code>bytes4</code></td><td>The function selector to remove</td></tr>
</tbody></table>
</div>
<h3 id="removefunctions"><a class="header" href="#removefunctions">removeFunctions</a></h3>
<p>Removes multiple function selector mappings</p>
<pre><code class="language-solidity">function removeFunctions(bytes4[] calldata selectors) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selectors</code></td><td><code>bytes4[]</code></td><td>Array of function selectors to remove</td></tr>
</tbody></table>
</div>
<h3 id="_authorizemodifyfunctions"><a class="header" href="#_authorizemodifyfunctions">_authorizeModifyFunctions</a></h3>
<p><em>Authorize the sender to modify functions</em></p>
<pre><code class="language-solidity">function _authorizeModifyFunctions(address sender) internal virtual;
</code></pre>
<h3 id="_implementation-1"><a class="header" href="#_implementation-1">_implementation</a></h3>
<p>Returns the implementation address for a function selector</p>
<p><em>Required override from OpenZeppelin Proxy contract</em></p>
<pre><code class="language-solidity">function _implementation() internal view override returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
</tbody></table>
</div>
<h2 id="structs-2"><a class="header" href="#structs-2">Structs</a></h2>
<h3 id="multifacetproxystorage"><a class="header" href="#multifacetproxystorage">MultiFacetProxyStorage</a></h3>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.MultiFacetProxy</p>
<pre><code class="language-solidity">struct MultiFacetProxyStorage {
    mapping(bytes4 =&gt; address) selectorToImplementation;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kbase"><a class="header" href="#kbase">kBase</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/base/kBase.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/base/kBase.sol//src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></p>
<p>Foundation contract providing essential shared functionality and registry integration for all KAM protocol
contracts</p>
<p><em>This abstract contract serves as the architectural foundation for the entire KAM protocol, establishing
critical patterns and utilities that ensure consistency across all protocol components. Key responsibilities
include: (1) Registry integration through a singleton pattern that enables dynamic protocol configuration and
contract discovery, (2) Role-based access control validation that enforces protocol governance permissions,
(3) Emergency pause functionality for protocol-wide risk mitigation during critical events, (4) Asset rescue
mechanisms to recover stuck funds while protecting protocol assets, (5) Vault and asset validation to ensure
only registered components interact, (6) Batch processing coordination through ID management and receiver tracking.
The contract employs ERC-7201 namespaced storage to prevent storage collisions during upgrades and enable safe
inheritance patterns. All inheriting contracts (kMinter, kAssetRouter, etc.) leverage these utilities to maintain
protocol integrity, reduce code duplication, and ensure consistent security checks across the ecosystem. The
registry serves as the single source of truth for protocol configuration, making the system highly modular and
upgradeable.</em></p>
<h2 id="state-variables-4"><a class="header" href="#state-variables-4">State Variables</a></h2>
<h3 id="k_minter"><a class="header" href="#k_minter">K_MINTER</a></h3>
<p>Registry lookup key for the kMinter singleton contract</p>
<p><em>This hash is used to retrieve the kMinter address from the registry's contract mapping.
kMinter handles institutional minting/redemption flows, so many contracts need to identify it
for access control and routing decisions. The hash ensures consistent lookups across the protocol.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router-1"><a class="header" href="#k_asset_router-1">K_ASSET_ROUTER</a></h3>
<p>Registry lookup key for the kAssetRouter singleton contract</p>
<p><em>This hash is used to retrieve the kAssetRouter address from the registry's contract mapping.
kAssetRouter coordinates all asset movements and settlements, making it a critical dependency
for vaults and other protocol components. The hash-based lookup enables dynamic upgrades.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="kbase_storage_location"><a class="header" href="#kbase_storage_location">KBASE_STORAGE_LOCATION</a></h3>
<p><em>ERC-7201 storage location calculated as: keccak256(abi.encode(uint256(keccak256("kam.storage.kBase")) - 1))
&amp; ~bytes32(uint256(0xff))
This specific slot is chosen to avoid any possible collision with standard storage layouts while maintaining
deterministic addressing. The calculation ensures the storage location is unique to this namespace and won't
conflict with other inherited contracts or future upgrades. The 0xff mask ensures proper alignment.</em></p>
<pre><code class="language-solidity">bytes32 private constant KBASE_STORAGE_LOCATION = 0xe91688684975c4d7d54a65dd96da5d4dcbb54b8971c046d5351d3c111e43a800;
</code></pre>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="_getbasestorage"><a class="header" href="#_getbasestorage">_getBaseStorage</a></h3>
<p><em>Returns the kBase storage pointer using ERC-7201 namespaced storage pattern</em></p>
<pre><code class="language-solidity">function _getBaseStorage() internal pure returns (kBaseStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kBaseStorage</code></td><td>Storage pointer to the kBaseStorage struct at the designated storage location This function uses inline assembly to directly set the storage pointer to our namespaced location, ensuring efficient access to storage variables while maintaining upgrade safety. The pure modifier is used because we're only returning a storage pointer, not reading storage values.</td></tr>
</tbody></table>
</div>
<h3 id="__kbase_init"><a class="header" href="#__kbase_init">__kBase_init</a></h3>
<p>Initializes the base contract with registry integration and default operational state</p>
<p><em>This internal initialization function establishes the foundational connection between any inheriting
contract and the protocol's registry system. The initialization process: (1) Validates that initialization
hasn't occurred to prevent reinitialization attacks in proxy patterns, (2) Ensures registry address is valid
since the registry is critical for all protocol operations, (3) Sets the contract to unpaused state enabling
normal operations, (4) Marks initialization complete to prevent future calls. This function MUST be called
by all inheriting contracts during their initialization phase to establish proper protocol integration.
The internal visibility ensures only inheriting contracts can initialize, preventing external manipulation.</em></p>
<pre><code class="language-solidity">function __kBase_init(address registry_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address that serves as the protocol's configuration and discovery hub</td></tr>
</tbody></table>
</div>
<h3 id="setpaused"><a class="header" href="#setpaused">setPaused</a></h3>
<p>Toggles the emergency pause state affecting all protocol operations in this contract</p>
<p><em>This function provides critical risk management capability by allowing emergency admins to halt
contract operations during security incidents or market anomalies. The pause mechanism: (1) Affects all
state-changing operations in inheriting contracts that check _isPaused(), (2) Does not affect view/pure
functions ensuring protocol state remains readable, (3) Enables rapid response to potential exploits by
halting operations protocol-wide, (4) Requires emergency admin role ensuring only authorized governance
can trigger pauses. Inheriting contracts should check _isPaused() modifier in critical functions to
respect the pause state. The external visibility with role check prevents unauthorized pause manipulation.</em></p>
<pre><code class="language-solidity">function setPaused(bool paused_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The desired pause state (true = halt operations, false = resume normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets-1"><a class="header" href="#rescueassets-1">rescueAssets</a></h3>
<p>Rescues accidentally sent assets (ETH or ERC20 tokens) preventing permanent loss of funds</p>
<p><em>This function implements a critical safety mechanism for recovering tokens or ETH that become stuck
in the contract through user error or airdrops. The rescue process: (1) Validates admin authorization to
prevent unauthorized fund extraction, (2) Ensures recipient address is valid to prevent burning funds,
(3) For ETH rescue (asset_=address(0)): validates balance sufficiency and uses low-level call for transfer,
(4) For ERC20 rescue: critically checks the token is NOT a registered protocol asset (USDC, WBTC, etc.) to
protect user deposits and protocol integrity, then validates balance and uses SafeTransferLib for secure
transfer. The distinction between ETH and ERC20 handling accounts for their different transfer mechanisms.
Protocol assets are explicitly blocked from rescue to prevent admin abuse and maintain user trust.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_, address to_, uint256 amount_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The asset to rescue (use address(0) for native ETH, otherwise ERC20 token address)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address that will receive the rescued assets (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity to rescue (must not exceed available balance)</td></tr>
</tbody></table>
</div>
<h3 id="registry-1"><a class="header" href="#registry-1">registry</a></h3>
<p>Returns the registry contract address</p>
<p><em>Reverts if contract not initialized</em></p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The kRegistry contract address</td></tr>
</tbody></table>
</div>
<h3 id="_registry-1"><a class="header" href="#_registry-1">_registry</a></h3>
<p>Returns the registry contract interface</p>
<p><em>Internal helper for typed registry access</em></p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchid"><a class="header" href="#_getbatchid">_getBatchId</a></h3>
<p>Gets the current batch ID for a given vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchId(address vault) internal view returns (bytes32 batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch ID</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchreceiver"><a class="header" href="#_getbatchreceiver">_getBatchReceiver</a></h3>
<p>Gets the current batch receiver for a given batchId</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchReceiver(address vault_, bytes32 batchId_) internal view returns (address batchReceiver);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault_</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>batchId_</code></td><td><code>bytes32</code></td><td>The batch ID</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The address of the batchReceiver where tokens will be sent</td></tr>
</tbody></table>
</div>
<h3 id="_getkminter"><a class="header" href="#_getkminter">_getKMinter</a></h3>
<p>Gets the kMinter singleton contract address</p>
<p><em>Reverts if kMinter not set in registry</em></p>
<pre><code class="language-solidity">function _getKMinter() internal view returns (address minter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter"><a class="header" href="#_getkassetrouter">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<p><em>Reverts if kAssetRouter not set in registry</em></p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getktokenforasset"><a class="header" href="#_getktokenforasset">_getKTokenForAsset</a></h3>
<p>Gets the kToken address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getKTokenForAsset(address asset) internal view returns (address kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="_getvaultassets"><a class="header" href="#_getvaultassets">_getVaultAssets</a></h3>
<p>Gets the asset managed by a vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getVaultAssets(address vault) internal view returns (address[] memory assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>address[]</code></td><td>The asset address managed by the vault</td></tr>
</tbody></table>
</div>
<h3 id="_getdnvaultbyasset"><a class="header" href="#_getdnvaultbyasset">_getDNVaultByAsset</a></h3>
<p>Gets the DN vault address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getDNVaultByAsset(address asset) internal view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The corresponding DN vault address</td></tr>
</tbody></table>
</div>
<h3 id="_isadmin-1"><a class="header" href="#_isadmin-1">_isAdmin</a></h3>
<p>Checks if an address has admin role in the protocol governance</p>
<p><em>Admins can execute critical functions like asset rescue and protocol configuration changes.
This validation is used throughout inheriting contracts to enforce permission boundaries.</em></p>
<pre><code class="language-solidity">function _isAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an admin in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isemergencyadmin"><a class="header" href="#_isemergencyadmin">_isEmergencyAdmin</a></h3>
<p>Checks if an address has emergency admin role for critical protocol interventions</p>
<p><em>Emergency admins can pause/unpause contracts during security incidents or market anomalies.
This elevated role enables rapid response to threats while limiting scope to emergency functions only.</em></p>
<pre><code class="language-solidity">function _isEmergencyAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for emergency admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an emergency admin in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isguardian"><a class="header" href="#_isguardian">_isGuardian</a></h3>
<p>Checks if an address has guardian role for protocol monitoring and verification</p>
<p><em>Guardians verify settlement proposals and can cancel incorrect settlements during cooldown periods.
This role provides an additional security layer for yield distribution accuracy.</em></p>
<pre><code class="language-solidity">function _isGuardian(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for guardian privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as a guardian in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isrelayer"><a class="header" href="#_isrelayer">_isRelayer</a></h3>
<p>Checks if an address has relayer role for automated protocol operations</p>
<p><em>Relayers execute batched operations and trigger settlements on behalf of users to optimize gas costs.
This role enables automation while maintaining security through limited permissions.</em></p>
<pre><code class="language-solidity">function _isRelayer(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for relayer privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as a relayer in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isinstitution"><a class="header" href="#_isinstitution">_isInstitution</a></h3>
<p>Checks if an address is registered as an institutional user</p>
<p><em>Institutions have special privileges in kMinter for large-scale minting and redemption operations.
This distinction enables optimized flows for high-volume users while maintaining retail accessibility.</em></p>
<pre><code class="language-solidity">function _isInstitution(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for institutional status</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an institution in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_ispaused"><a class="header" href="#_ispaused">_isPaused</a></h3>
<p>Checks if the contract is currently in emergency pause state</p>
<p><em>Used by inheriting contracts to halt operations during emergencies. When paused, state-changing
functions should revert while view functions remain accessible for protocol monitoring.</em></p>
<pre><code class="language-solidity">function _isPaused() internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the contract is currently paused</td></tr>
</tbody></table>
</div>
<h3 id="_iskminter"><a class="header" href="#_iskminter">_isKMinter</a></h3>
<p>Checks if an address is the kMinter contract</p>
<p><em>Validates if the caller is the protocol's kMinter singleton for access control in vault operations.
Used to ensure only kMinter can trigger institutional deposit and redemption flows.</em></p>
<pre><code class="language-solidity">function _isKMinter(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check against kMinter</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is the registered kMinter contract</td></tr>
</tbody></table>
</div>
<h3 id="_isvault"><a class="header" href="#_isvault">_isVault</a></h3>
<p>Checks if an address is a registered vault</p>
<pre><code class="language-solidity">function _isVault(address vault) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is a registered vault</td></tr>
</tbody></table>
</div>
<h3 id="_isasset-1"><a class="header" href="#_isasset-1">_isAsset</a></h3>
<p>Checks if an asset is registered</p>
<pre><code class="language-solidity">function _isAsset(address asset) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the asset is registered</td></tr>
</tbody></table>
</div>
<h2 id="events-2"><a class="header" href="#events-2">Events</a></h2>
<h3 id="paused"><a class="header" href="#paused">Paused</a></h3>
<p>Emitted when the emergency pause state is toggled for protocol-wide risk mitigation</p>
<p><em>This event signals a critical protocol state change that affects all inheriting contracts.
When paused=true, protocol operations are halted to prevent potential exploits or manage emergencies.
Only emergency admins can trigger this, providing rapid response capability during security incidents.</em></p>
<pre><code class="language-solidity">event Paused(bool paused_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The new pause state (true = operations halted, false = normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets-1"><a class="header" href="#rescuedassets-1">RescuedAssets</a></h3>
<p>Emitted when ERC20 tokens are rescued from the contract to prevent permanent loss</p>
<p><em>This rescue mechanism is restricted to non-protocol assets only - registered assets (USDC, WBTC, etc.)
cannot be rescued to protect user funds and maintain protocol integrity. Typically used to recover
accidentally sent tokens or airdrops. Only admin role can execute rescues as a security measure.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset_, address indexed to_, uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The ERC20 token address being rescued (must not be a registered protocol asset)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address receiving the rescued tokens (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity of tokens rescued (must not exceed contract balance)</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth-1"><a class="header" href="#rescuedeth-1">RescuedETH</a></h3>
<p>Emitted when native ETH is rescued from the contract to recover stuck funds</p>
<p><em>ETH rescue is separate from ERC20 rescue due to different transfer mechanisms. This prevents
ETH from being permanently locked if sent to the contract accidentally. Uses low-level call for
ETH transfer with proper success checking. Only admin role authorized for security.</em></p>
<pre><code class="language-solidity">event RescuedETH(address indexed to_, uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address receiving the rescued ETH (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity of ETH rescued in wei (must not exceed contract balance)</td></tr>
</tbody></table>
</div>
<h2 id="structs-3"><a class="header" href="#structs-3">Structs</a></h2>
<h3 id="kbasestorage"><a class="header" href="#kbasestorage">kBaseStorage</a></h3>
<p><em>Storage struct following ERC-7201 namespaced storage pattern to prevent collisions during upgrades.
This pattern ensures that storage layout remains consistent across proxy upgrades and prevents
accidental overwriting when contracts inherit from multiple base contracts. The namespace
"kam.storage.kBase" uniquely identifies this storage area within the contract's storage space.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kBase</p>
<pre><code class="language-solidity">struct kBaseStorage {
    address registry;
    bool initialized;
    bool paused;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-3"><a class="header" href="#contents-3">Contents</a></h1>
<ul>
<li><a href="src/errors/Errors.sol/constants.Errors.html">Errors constants</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constants"><a class="header" href="#constants">Constants</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/errors/Errors.sol">Git Source</a></p>
<h3 id="kassetrouter_already_registered"><a class="header" href="#kassetrouter_already_registered">KASSETROUTER_ALREADY_REGISTERED</a></h3>
<p>*All error codes use contract-specific prefixes for easier debugging:</p>
<ul>
<li>A*: kAssetRouter errors</li>
<li>BA*: BaseAdapter errors</li>
<li>BV*: BaseVault errors</li>
<li>B*: kBatchReceiver errors</li>
<li>C*: Custodial adapter errors</li>
<li>K*: kBase errors</li>
<li>M*: kMinter errors</li>
<li>R*: kRegistry errors</li>
<li>SV*: kStakingVault errors</li>
<li>T*: kToken errors</li>
<li>VB*: VaultBatches errors</li>
<li>VC*: VaultClaims errors</li>
<li>VF*: VaultFees errors*</li>
</ul>
<pre><code class="language-solidity">string constant KASSETROUTER_ALREADY_REGISTERED = "A1";
</code></pre>
<h3 id="kassetrouter_batch_closed"><a class="header" href="#kassetrouter_batch_closed">KASSETROUTER_BATCH_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_CLOSED = "A2";
</code></pre>
<h3 id="kassetrouter_batch_id_proposed"><a class="header" href="#kassetrouter_batch_id_proposed">KASSETROUTER_BATCH_ID_PROPOSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_ID_PROPOSED = "A3";
</code></pre>
<h3 id="kassetrouter_batch_settled"><a class="header" href="#kassetrouter_batch_settled">KASSETROUTER_BATCH_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_SETTLED = "A4";
</code></pre>
<h3 id="kassetrouter_cooldoown_is_up"><a class="header" href="#kassetrouter_cooldoown_is_up">KASSETROUTER_COOLDOOWN_IS_UP</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_COOLDOOWN_IS_UP = "A5";
</code></pre>
<h3 id="kassetrouter_insufficient_virtual_balance"><a class="header" href="#kassetrouter_insufficient_virtual_balance">KASSETROUTER_INSUFFICIENT_VIRTUAL_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INSUFFICIENT_VIRTUAL_BALANCE = "A6";
</code></pre>
<h3 id="kassetrouter_invalid_cooldown"><a class="header" href="#kassetrouter_invalid_cooldown">KASSETROUTER_INVALID_COOLDOWN</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INVALID_COOLDOWN = "A7";
</code></pre>
<h3 id="kassetrouter_invalid_vault"><a class="header" href="#kassetrouter_invalid_vault">KASSETROUTER_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INVALID_VAULT = "A8";
</code></pre>
<h3 id="kassetrouter_is_paused"><a class="header" href="#kassetrouter_is_paused">KASSETROUTER_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_IS_PAUSED = "A9";
</code></pre>
<h3 id="kassetrouter_no_proposal"><a class="header" href="#kassetrouter_no_proposal">KASSETROUTER_NO_PROPOSAL</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_NO_PROPOSAL = "A10";
</code></pre>
<h3 id="kassetrouter_only_kminter"><a class="header" href="#kassetrouter_only_kminter">KASSETROUTER_ONLY_KMINTER</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ONLY_KMINTER = "A11";
</code></pre>
<h3 id="kassetrouter_only_kstaking_vault"><a class="header" href="#kassetrouter_only_kstaking_vault">KASSETROUTER_ONLY_KSTAKING_VAULT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ONLY_KSTAKING_VAULT = "A12";
</code></pre>
<h3 id="kassetrouter_proposal_executed"><a class="header" href="#kassetrouter_proposal_executed">KASSETROUTER_PROPOSAL_EXECUTED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_EXECUTED = "A13";
</code></pre>
<h3 id="kassetrouter_proposal_exists"><a class="header" href="#kassetrouter_proposal_exists">KASSETROUTER_PROPOSAL_EXISTS</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_EXISTS = "A14";
</code></pre>
<h3 id="kassetrouter_proposal_not_found"><a class="header" href="#kassetrouter_proposal_not_found">KASSETROUTER_PROPOSAL_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_NOT_FOUND = "A15";
</code></pre>
<h3 id="kassetrouter_wrong_role"><a class="header" href="#kassetrouter_wrong_role">KASSETROUTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_WRONG_ROLE = "A16";
</code></pre>
<h3 id="kassetrouter_zero_address"><a class="header" href="#kassetrouter_zero_address">KASSETROUTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ZERO_ADDRESS = "A17";
</code></pre>
<h3 id="kassetrouter_zero_amount"><a class="header" href="#kassetrouter_zero_amount">KASSETROUTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ZERO_AMOUNT = "A18";
</code></pre>
<h3 id="adapter_already_initialized"><a class="header" href="#adapter_already_initialized">ADAPTER_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ALREADY_INITIALIZED = "BA1";
</code></pre>
<h3 id="adapter_invalid_registry"><a class="header" href="#adapter_invalid_registry">ADAPTER_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_INVALID_REGISTRY = "BA2";
</code></pre>
<h3 id="adapter_transfer_failed"><a class="header" href="#adapter_transfer_failed">ADAPTER_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_TRANSFER_FAILED = "BA3";
</code></pre>
<h3 id="adapter_wrong_asset"><a class="header" href="#adapter_wrong_asset">ADAPTER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_WRONG_ASSET = "BA4";
</code></pre>
<h3 id="adapter_wrong_role"><a class="header" href="#adapter_wrong_role">ADAPTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_WRONG_ROLE = "BA5";
</code></pre>
<h3 id="adapter_zero_address"><a class="header" href="#adapter_zero_address">ADAPTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ZERO_ADDRESS = "BA6";
</code></pre>
<h3 id="adapter_zero_amount"><a class="header" href="#adapter_zero_amount">ADAPTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ZERO_AMOUNT = "BA7";
</code></pre>
<h3 id="adapter_insufficient_balance"><a class="header" href="#adapter_insufficient_balance">ADAPTER_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_INSUFFICIENT_BALANCE = "BA8";
</code></pre>
<h3 id="basevault_already_initialized"><a class="header" href="#basevault_already_initialized">BASEVAULT_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_ALREADY_INITIALIZED = "BV1";
</code></pre>
<h3 id="basevault_contract_not_found"><a class="header" href="#basevault_contract_not_found">BASEVAULT_CONTRACT_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_CONTRACT_NOT_FOUND = "BV2";
</code></pre>
<h3 id="basevault_invalid_registry"><a class="header" href="#basevault_invalid_registry">BASEVAULT_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_INVALID_REGISTRY = "BV3";
</code></pre>
<h3 id="basevault_invalid_vault"><a class="header" href="#basevault_invalid_vault">BASEVAULT_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_INVALID_VAULT = "BV4";
</code></pre>
<h3 id="basevault_not_initialized"><a class="header" href="#basevault_not_initialized">BASEVAULT_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_NOT_INITIALIZED = "BV5";
</code></pre>
<h3 id="kbatchreceiver_already_initialized"><a class="header" href="#kbatchreceiver_already_initialized">KBATCHRECEIVER_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ALREADY_INITIALIZED = "B1";
</code></pre>
<h3 id="kbatchreceiver_invalid_batch_id"><a class="header" href="#kbatchreceiver_invalid_batch_id">KBATCHRECEIVER_INVALID_BATCH_ID</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_INVALID_BATCH_ID = "B2";
</code></pre>
<h3 id="kbatchreceiver_only_kminter"><a class="header" href="#kbatchreceiver_only_kminter">KBATCHRECEIVER_ONLY_KMINTER</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ONLY_KMINTER = "B3";
</code></pre>
<h3 id="kbatchreceiver_transfer_failed"><a class="header" href="#kbatchreceiver_transfer_failed">KBATCHRECEIVER_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_TRANSFER_FAILED = "B4";
</code></pre>
<h3 id="kbatchreceiver_wrong_asset"><a class="header" href="#kbatchreceiver_wrong_asset">KBATCHRECEIVER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_WRONG_ASSET = "B5";
</code></pre>
<h3 id="kbatchreceiver_zero_address"><a class="header" href="#kbatchreceiver_zero_address">KBATCHRECEIVER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ZERO_ADDRESS = "B6";
</code></pre>
<h3 id="kbatchreceiver_zero_amount"><a class="header" href="#kbatchreceiver_zero_amount">KBATCHRECEIVER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ZERO_AMOUNT = "B7";
</code></pre>
<h3 id="custodial_invalid_custodial_address"><a class="header" href="#custodial_invalid_custodial_address">CUSTODIAL_INVALID_CUSTODIAL_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_INVALID_CUSTODIAL_ADDRESS = "C1";
</code></pre>
<h3 id="custodial_transfer_failed"><a class="header" href="#custodial_transfer_failed">CUSTODIAL_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_TRANSFER_FAILED = "C2";
</code></pre>
<h3 id="custodial_vault_destination_not_set"><a class="header" href="#custodial_vault_destination_not_set">CUSTODIAL_VAULT_DESTINATION_NOT_SET</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_VAULT_DESTINATION_NOT_SET = "C3";
</code></pre>
<h3 id="custodial_wrong_asset"><a class="header" href="#custodial_wrong_asset">CUSTODIAL_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_WRONG_ASSET = "C4";
</code></pre>
<h3 id="custodial_wrong_role"><a class="header" href="#custodial_wrong_role">CUSTODIAL_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_WRONG_ROLE = "C5";
</code></pre>
<h3 id="custodial_zero_address"><a class="header" href="#custodial_zero_address">CUSTODIAL_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_ZERO_ADDRESS = "C6";
</code></pre>
<h3 id="custodial_zero_amount"><a class="header" href="#custodial_zero_amount">CUSTODIAL_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_ZERO_AMOUNT = "C7";
</code></pre>
<h3 id="kbase_already_initialized"><a class="header" href="#kbase_already_initialized">KBASE_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBASE_ALREADY_INITIALIZED = "K1";
</code></pre>
<h3 id="kbase_invalid_registry"><a class="header" href="#kbase_invalid_registry">KBASE_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant KBASE_INVALID_REGISTRY = "K2";
</code></pre>
<h3 id="kbase_not_initialized"><a class="header" href="#kbase_not_initialized">KBASE_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBASE_NOT_INITIALIZED = "K3";
</code></pre>
<h3 id="kbase_wrong_role"><a class="header" href="#kbase_wrong_role">KBASE_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KBASE_WRONG_ROLE = "K4";
</code></pre>
<h3 id="kbase_zero_address"><a class="header" href="#kbase_zero_address">KBASE_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KBASE_ZERO_ADDRESS = "K5";
</code></pre>
<h3 id="kbase_zero_amount"><a class="header" href="#kbase_zero_amount">KBASE_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KBASE_ZERO_AMOUNT = "K6";
</code></pre>
<h3 id="kbase_transfer_failed"><a class="header" href="#kbase_transfer_failed">KBASE_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KBASE_TRANSFER_FAILED = "K7";
</code></pre>
<h3 id="kbase_wrong_asset"><a class="header" href="#kbase_wrong_asset">KBASE_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KBASE_WRONG_ASSET = "K8";
</code></pre>
<h3 id="kbase_contract_not_found"><a class="header" href="#kbase_contract_not_found">KBASE_CONTRACT_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KBASE_CONTRACT_NOT_FOUND = "K9";
</code></pre>
<h3 id="kbase_asset_not_supported"><a class="header" href="#kbase_asset_not_supported">KBASE_ASSET_NOT_SUPPORTED</a></h3>
<pre><code class="language-solidity">string constant KBASE_ASSET_NOT_SUPPORTED = "K10";
</code></pre>
<h3 id="kbase_invalid_vault"><a class="header" href="#kbase_invalid_vault">KBASE_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant KBASE_INVALID_VAULT = "K11";
</code></pre>
<h3 id="kminter_batch_closed"><a class="header" href="#kminter_batch_closed">KMINTER_BATCH_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_BATCH_CLOSED = "M1";
</code></pre>
<h3 id="kminter_batch_settled"><a class="header" href="#kminter_batch_settled">KMINTER_BATCH_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_BATCH_SETTLED = "M2";
</code></pre>
<h3 id="kminter_insufficient_balance"><a class="header" href="#kminter_insufficient_balance">KMINTER_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_INSUFFICIENT_BALANCE = "M3";
</code></pre>
<h3 id="kminter_is_paused"><a class="header" href="#kminter_is_paused">KMINTER_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_IS_PAUSED = "M4";
</code></pre>
<h3 id="kminter_request_not_eligible"><a class="header" href="#kminter_request_not_eligible">KMINTER_REQUEST_NOT_ELIGIBLE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_NOT_ELIGIBLE = "M5";
</code></pre>
<h3 id="kminter_request_not_found"><a class="header" href="#kminter_request_not_found">KMINTER_REQUEST_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_NOT_FOUND = "M6";
</code></pre>
<h3 id="kminter_request_processed"><a class="header" href="#kminter_request_processed">KMINTER_REQUEST_PROCESSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_PROCESSED = "M7";
</code></pre>
<h3 id="kminter_wrong_asset"><a class="header" href="#kminter_wrong_asset">KMINTER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KMINTER_WRONG_ASSET = "M8";
</code></pre>
<h3 id="kminter_wrong_role"><a class="header" href="#kminter_wrong_role">KMINTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_WRONG_ROLE = "M9";
</code></pre>
<h3 id="kminter_zero_address"><a class="header" href="#kminter_zero_address">KMINTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KMINTER_ZERO_ADDRESS = "M10";
</code></pre>
<h3 id="kminter_zero_amount"><a class="header" href="#kminter_zero_amount">KMINTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KMINTER_ZERO_AMOUNT = "M11";
</code></pre>
<h3 id="kregistry_adapter_already_set"><a class="header" href="#kregistry_adapter_already_set">KREGISTRY_ADAPTER_ALREADY_SET</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ADAPTER_ALREADY_SET = "R1";
</code></pre>
<h3 id="kregistry_already_registered"><a class="header" href="#kregistry_already_registered">KREGISTRY_ALREADY_REGISTERED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ALREADY_REGISTERED = "R2";
</code></pre>
<h3 id="kregistry_asset_not_supported"><a class="header" href="#kregistry_asset_not_supported">KREGISTRY_ASSET_NOT_SUPPORTED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ASSET_NOT_SUPPORTED = "R3";
</code></pre>
<h3 id="kregistry_invalid_adapter"><a class="header" href="#kregistry_invalid_adapter">KREGISTRY_INVALID_ADAPTER</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_INVALID_ADAPTER = "R4";
</code></pre>
<h3 id="kregistry_transfer_failed"><a class="header" href="#kregistry_transfer_failed">KREGISTRY_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_TRANSFER_FAILED = "R5";
</code></pre>
<h3 id="kregistry_wrong_asset"><a class="header" href="#kregistry_wrong_asset">KREGISTRY_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_WRONG_ASSET = "R6";
</code></pre>
<h3 id="kregistry_wrong_role"><a class="header" href="#kregistry_wrong_role">KREGISTRY_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_WRONG_ROLE = "R7";
</code></pre>
<h3 id="kregistry_zero_address"><a class="header" href="#kregistry_zero_address">KREGISTRY_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ZERO_ADDRESS = "R8";
</code></pre>
<h3 id="kregistry_zero_amount"><a class="header" href="#kregistry_zero_amount">KREGISTRY_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ZERO_AMOUNT = "R9";
</code></pre>
<h3 id="kregistry_fee_exceeds_maximum"><a class="header" href="#kregistry_fee_exceeds_maximum">KREGISTRY_FEE_EXCEEDS_MAXIMUM</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_FEE_EXCEEDS_MAXIMUM = "R10";
</code></pre>
<h3 id="kstakingvault_insufficient_balance"><a class="header" href="#kstakingvault_insufficient_balance">KSTAKINGVAULT_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_INSUFFICIENT_BALANCE = "SV1";
</code></pre>
<h3 id="kstakingvault_is_paused"><a class="header" href="#kstakingvault_is_paused">KSTAKINGVAULT_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_IS_PAUSED = "SV2";
</code></pre>
<h3 id="kstakingvault_not_initialized"><a class="header" href="#kstakingvault_not_initialized">KSTAKINGVAULT_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_NOT_INITIALIZED = "SV3";
</code></pre>
<h3 id="kstakingvault_request_not_eligible"><a class="header" href="#kstakingvault_request_not_eligible">KSTAKINGVAULT_REQUEST_NOT_ELIGIBLE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_REQUEST_NOT_ELIGIBLE = "SV4";
</code></pre>
<h3 id="kstakingvault_request_not_found"><a class="header" href="#kstakingvault_request_not_found">KSTAKINGVAULT_REQUEST_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_REQUEST_NOT_FOUND = "SV5";
</code></pre>
<h3 id="kstakingvault_unauthorized"><a class="header" href="#kstakingvault_unauthorized">KSTAKINGVAULT_UNAUTHORIZED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_UNAUTHORIZED = "SV6";
</code></pre>
<h3 id="kstakingvault_vault_closed"><a class="header" href="#kstakingvault_vault_closed">KSTAKINGVAULT_VAULT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_VAULT_CLOSED = "SV7";
</code></pre>
<h3 id="kstakingvault_vault_settled"><a class="header" href="#kstakingvault_vault_settled">KSTAKINGVAULT_VAULT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_VAULT_SETTLED = "SV8";
</code></pre>
<h3 id="kstakingvault_wrong_role"><a class="header" href="#kstakingvault_wrong_role">KSTAKINGVAULT_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_WRONG_ROLE = "SV9";
</code></pre>
<h3 id="kstakingvault_zero_address"><a class="header" href="#kstakingvault_zero_address">KSTAKINGVAULT_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_ZERO_ADDRESS = "SV10";
</code></pre>
<h3 id="kstakingvault_zero_amount"><a class="header" href="#kstakingvault_zero_amount">KSTAKINGVAULT_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_ZERO_AMOUNT = "SV11";
</code></pre>
<h3 id="ktoken_is_paused"><a class="header" href="#ktoken_is_paused">KTOKEN_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_IS_PAUSED = "T1";
</code></pre>
<h3 id="ktoken_transfer_failed"><a class="header" href="#ktoken_transfer_failed">KTOKEN_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_TRANSFER_FAILED = "T2";
</code></pre>
<h3 id="ktoken_zero_address"><a class="header" href="#ktoken_zero_address">KTOKEN_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_ZERO_ADDRESS = "T3";
</code></pre>
<h3 id="ktoken_zero_amount"><a class="header" href="#ktoken_zero_amount">KTOKEN_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_ZERO_AMOUNT = "T4";
</code></pre>
<h3 id="vaultbatches_not_closed"><a class="header" href="#vaultbatches_not_closed">VAULTBATCHES_NOT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_NOT_CLOSED = "VB1";
</code></pre>
<h3 id="vaultbatches_vault_closed"><a class="header" href="#vaultbatches_vault_closed">VAULTBATCHES_VAULT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_VAULT_CLOSED = "VB2";
</code></pre>
<h3 id="vaultbatches_vault_settled"><a class="header" href="#vaultbatches_vault_settled">VAULTBATCHES_VAULT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_VAULT_SETTLED = "VB3";
</code></pre>
<h3 id="vaultclaims_batch_not_settled"><a class="header" href="#vaultclaims_batch_not_settled">VAULTCLAIMS_BATCH_NOT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_BATCH_NOT_SETTLED = "VC1";
</code></pre>
<h3 id="vaultclaims_invalid_batch_id"><a class="header" href="#vaultclaims_invalid_batch_id">VAULTCLAIMS_INVALID_BATCH_ID</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_INVALID_BATCH_ID = "VC2";
</code></pre>
<h3 id="vaultclaims_not_beneficiary"><a class="header" href="#vaultclaims_not_beneficiary">VAULTCLAIMS_NOT_BENEFICIARY</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_NOT_BENEFICIARY = "VC4";
</code></pre>
<h3 id="vaultclaims_request_not_pending"><a class="header" href="#vaultclaims_request_not_pending">VAULTCLAIMS_REQUEST_NOT_PENDING</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_REQUEST_NOT_PENDING = "VC5";
</code></pre>
<h3 id="vaultfees_fee_exceeds_maximum"><a class="header" href="#vaultfees_fee_exceeds_maximum">VAULTFEES_FEE_EXCEEDS_MAXIMUM</a></h3>
<pre><code class="language-solidity">string constant VAULTFEES_FEE_EXCEEDS_MAXIMUM = "VF1";
</code></pre>
<h3 id="vaultfees_invalid_timestamp"><a class="header" href="#vaultfees_invalid_timestamp">VAULTFEES_INVALID_TIMESTAMP</a></h3>
<pre><code class="language-solidity">string constant VAULTFEES_INVALID_TIMESTAMP = "VF2";
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-4"><a class="header" href="#contents-4">Contents</a></h1>
<ul>
<li><a href="src/interfaces//src/interfaces/modules">modules</a></li>
<li><a href="src/interfaces/IAdapter.sol/interface.IAdapter.html">IAdapter</a></li>
<li><a href="src/interfaces/IExtsload.sol/interface.IExtsload.html">IExtsload</a></li>
<li><a href="src/interfaces/IVault.sol/interface.IVault.html">IVault</a></li>
<li><a href="src/interfaces/IVaultBatch.sol/interface.IVaultBatch.html">IVaultBatch</a></li>
<li><a href="src/interfaces/IVaultClaim.sol/interface.IVaultClaim.html">IVaultClaim</a></li>
<li><a href="src/interfaces/IVaultFees.sol/interface.IVaultFees.html">IVaultFees</a></li>
<li><a href="src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html">IkAssetRouter</a></li>
<li><a href="src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html">IkBatchReceiver</a></li>
<li><a href="src/interfaces/IkMinter.sol/interface.IkMinter.html">IkMinter</a></li>
<li><a href="src/interfaces/IkRegistry.sol/interface.IkRegistry.html">IkRegistry</a></li>
<li><a href="src/interfaces/IkStakingVault.sol/interface.IkStakingVault.html">IkStakingVault</a></li>
<li><a href="src/interfaces/IkToken.sol/interface.IkToken.html">IkToken</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-5"><a class="header" href="#contents-5">Contents</a></h1>
<ul>
<li><a href="src/interfaces/modules/IVaultReader.sol/interface.IVaultReader.html">IVaultReader</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultreader"><a class="header" href="#ivaultreader">IVaultReader</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/modules/IVaultReader.sol">Git Source</a></p>
<p>Read-only interface for querying vault state, calculations, and metrics without modifying contract state</p>
<p><em>This interface provides comprehensive access to vault information for external integrations, front-ends, and
analytics without gas costs or state modifications. The interface covers several key areas: (1) Configuration:
Registry references, underlying assets, and fee parameters, (2) Financial Metrics: Share prices, total assets,
and fee calculations for accurate vault valuation, (3) Batch Information: Current and historical batch states
for settlement tracking, (4) Fee Calculations: Real-time fee accruals and next fee timestamps, (5) Safety Functions:
Validated batch ID and receiver retrieval preventing errors. This read-only approach enables efficient monitoring
and integration while maintaining clear separation from state-modifying operations. All calculations reflect current
vault state including pending fees and accrued yields, providing accurate real-time vault metrics for users and
integrations.</em></p>
<h2 id="functions-7"><a class="header" href="#functions-7">Functions</a></h2>
<h3 id="registry-2"><a class="header" href="#registry-2">registry</a></h3>
<p>Returns the protocol registry address for configuration and role management</p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the kRegistry contract managing protocol-wide settings</td></tr>
</tbody></table>
</div>
<h3 id="asset"><a class="header" href="#asset">asset</a></h3>
<p>Returns the vault's share token (stkToken) address for ERC20 operations</p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of this vault's stkToken contract representing user shares</td></tr>
</tbody></table>
</div>
<h3 id="underlyingasset"><a class="header" href="#underlyingasset">underlyingAsset</a></h3>
<p>Returns the underlying asset address that this vault generates yield on</p>
<pre><code class="language-solidity">function underlyingAsset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the base asset (USDC, WBTC, etc.) managed by this vault</td></tr>
</tbody></table>
</div>
<h3 id="computelastbatchfees"><a class="header" href="#computelastbatchfees">computeLastBatchFees</a></h3>
<p>Calculates accumulated fees for the current period including management and performance components</p>
<p><em>Computes real-time fee accruals based on time elapsed and vault performance since last fee charge.
Management fees accrue continuously based on assets under management and time passed. Performance fees
are calculated on share price appreciation above watermarks and hurdle rates. This function provides
accurate fee projections for settlement planning and user transparency without modifying state.</em></p>
<pre><code class="language-solidity">function computeLastBatchFees()
    external
    view
    returns (uint256 managementFees, uint256 performanceFees, uint256 totalFees);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>managementFees</code></td><td><code>uint256</code></td><td>Accrued management fees in underlying asset terms</td></tr>
<tr><td><code>performanceFees</code></td><td><code>uint256</code></td><td>Accrued performance fees in underlying asset terms</td></tr>
<tr><td><code>totalFees</code></td><td><code>uint256</code></td><td>Combined management and performance fees for total fee burden</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedmanagement"><a class="header" href="#lastfeeschargedmanagement">lastFeesChargedManagement</a></h3>
<p>Returns the timestamp when management fees were last processed</p>
<pre><code class="language-solidity">function lastFeesChargedManagement() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Timestamp of last management fee charge for accrual calculations</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedperformance"><a class="header" href="#lastfeeschargedperformance">lastFeesChargedPerformance</a></h3>
<p>Returns the timestamp when performance fees were last processed</p>
<pre><code class="language-solidity">function lastFeesChargedPerformance() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Timestamp of last performance fee charge for watermark tracking</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerate"><a class="header" href="#hurdlerate">hurdleRate</a></h3>
<p>Returns the hurdle rate threshold for performance fee calculations</p>
<pre><code class="language-solidity">function hurdleRate() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Hurdle rate in basis points that vault performance must exceed</td></tr>
</tbody></table>
</div>
<h3 id="performancefee"><a class="header" href="#performancefee">performanceFee</a></h3>
<p>Returns the current performance fee rate charged on excess returns</p>
<pre><code class="language-solidity">function performanceFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Performance fee rate in basis points (1% = 100)</td></tr>
</tbody></table>
</div>
<h3 id="nextperformancefeetimestamp"><a class="header" href="#nextperformancefeetimestamp">nextPerformanceFeeTimestamp</a></h3>
<p>Calculates the next timestamp when performance fees can be charged</p>
<pre><code class="language-solidity">function nextPerformanceFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Projected timestamp for next performance fee evaluation</td></tr>
</tbody></table>
</div>
<h3 id="nextmanagementfeetimestamp"><a class="header" href="#nextmanagementfeetimestamp">nextManagementFeeTimestamp</a></h3>
<p>Calculates the next timestamp when management fees can be charged</p>
<pre><code class="language-solidity">function nextManagementFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Projected timestamp for next management fee evaluation</td></tr>
</tbody></table>
</div>
<h3 id="managementfee"><a class="header" href="#managementfee">managementFee</a></h3>
<p>Returns the current management fee rate charged on assets under management</p>
<pre><code class="language-solidity">function managementFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Management fee rate in basis points (1% = 100)</td></tr>
</tbody></table>
</div>
<h3 id="sharepricewatermark"><a class="header" href="#sharepricewatermark">sharePriceWatermark</a></h3>
<p>Returns the high watermark used for performance fee calculations</p>
<p><em>The watermark tracks the highest share price achieved, ensuring performance fees are only
charged on new highs and preventing double-charging on recovered losses. Reset occurs when new
high watermarks are achieved, establishing a new baseline for future performance fee calculations.</em></p>
<pre><code class="language-solidity">function sharePriceWatermark() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Current high watermark share price in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="isbatchclosed"><a class="header" href="#isbatchclosed">isBatchClosed</a></h3>
<p>Checks if the current batch is closed to new requests</p>
<pre><code class="language-solidity">function isBatchClosed() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if current batch is closed and awaiting settlement</td></tr>
</tbody></table>
</div>
<h3 id="isbatchsettled"><a class="header" href="#isbatchsettled">isBatchSettled</a></h3>
<p>Checks if the current batch has been settled with finalized prices</p>
<pre><code class="language-solidity">function isBatchSettled() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if current batch is settled and ready for claims</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidinfo"><a class="header" href="#getbatchidinfo">getBatchIdInfo</a></h3>
<p>Returns comprehensive information about the current batch</p>
<pre><code class="language-solidity">function getBatchIdInfo()
    external
    view
    returns (bytes32 batchId, address batchReceiver, bool isClosed, bool isSettled);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Current batch identifier</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>Address of batch receiver contract (may be zero if not created)</td></tr>
<tr><td><code>isClosed</code></td><td><code>bool</code></td><td>Whether the batch is closed to new requests</td></tr>
<tr><td><code>isSettled</code></td><td><code>bool</code></td><td>Whether the batch has been settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchreceiver"><a class="header" href="#getbatchreceiver">getBatchReceiver</a></h3>
<p>Returns the batch receiver address for a specific batch ID</p>
<pre><code class="language-solidity">function getBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the batch receiver (may be zero if not deployed)</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchreceiver"><a class="header" href="#getsafebatchreceiver">getSafeBatchReceiver</a></h3>
<p>Returns batch receiver address with validation, creating if necessary</p>
<pre><code class="language-solidity">function getSafeBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the batch receiver (guaranteed non-zero)</td></tr>
</tbody></table>
</div>
<h3 id="shareprice"><a class="header" href="#shareprice">sharePrice</a></h3>
<p>Calculates current share price including all accrued yields</p>
<p><em>Returns gross share price before fee deductions, reflecting total vault performance.
Used for settlement calculations and performance tracking.</em></p>
<pre><code class="language-solidity">function sharePrice() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Share price per stkToken in underlying asset terms (scaled to token decimals)</td></tr>
</tbody></table>
</div>
<h3 id="totalassets-1"><a class="header" href="#totalassets-1">totalAssets</a></h3>
<p>Returns total assets under management including pending fees</p>
<pre><code class="language-solidity">function totalAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total asset value managed by the vault in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="totalnetassets"><a class="header" href="#totalnetassets">totalNetAssets</a></h3>
<p>Returns net assets after deducting accumulated fees</p>
<p><em>Provides user-facing asset value after management and performance fee deductions.
Used for accurate user balance calculations and net yield reporting.</em></p>
<pre><code class="language-solidity">function totalNetAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net asset value available to users after fee deductions</td></tr>
</tbody></table>
</div>
<h3 id="getbatchid"><a class="header" href="#getbatchid">getBatchId</a></h3>
<p>Returns the current active batch identifier</p>
<pre><code class="language-solidity">function getBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Current batch ID for new requests</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchid"><a class="header" href="#getsafebatchid">getSafeBatchId</a></h3>
<p>Returns current batch ID with safety validation</p>
<pre><code class="language-solidity">function getSafeBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Current batch ID (guaranteed to be valid and initialized)</td></tr>
</tbody></table>
</div>
<h3 id="contractname"><a class="header" href="#contractname">contractName</a></h3>
<p>Returns the human-readable contract name for identification</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name string for display and logging purposes</td></tr>
</tbody></table>
</div>
<h3 id="contractversion"><a class="header" href="#contractversion">contractVersion</a></h3>
<p>Returns the contract version for upgrade tracking and compatibility</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string indicating current implementation version</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="iadapter"><a class="header" href="#iadapter">IAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IAdapter.sol">Git Source</a></p>
<p>Interface for protocol adapters that manage external strategy integrations</p>
<p><em>All adapters must implement this interface for kAssetRouter integration</em></p>
<h2 id="functions-8"><a class="header" href="#functions-8">Functions</a></h2>
<h3 id="deposit-1"><a class="header" href="#deposit-1">deposit</a></h3>
<p>Deposits assets to external strategy on behalf of a vault</p>
<pre><code class="language-solidity">function deposit(address asset, uint256 amount, address onBehalfOf) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to deposit</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to deposit</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address this deposit is for</td></tr>
</tbody></table>
</div>
<h3 id="redeem-1"><a class="header" href="#redeem-1">redeem</a></h3>
<p>Redeems assets from external strategy on behalf of a vault</p>
<pre><code class="language-solidity">function redeem(address asset, uint256 amount, address onBehalfOf) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to redeem</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to redeem</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address this redemption is for</td></tr>
</tbody></table>
</div>
<h3 id="processredemption"><a class="header" href="#processredemption">processRedemption</a></h3>
<p>Processes a pending redemption</p>
<pre><code class="language-solidity">function processRedemption(uint256 requestId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID to process</td></tr>
</tbody></table>
</div>
<h3 id="settotalassets-1"><a class="header" href="#settotalassets-1">setTotalAssets</a></h3>
<p>Sets the total assets for a given vault</p>
<pre><code class="language-solidity">function setTotalAssets(address vault, address asset, uint256 totalAssets_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td>The total assets to set</td></tr>
</tbody></table>
</div>
<h3 id="getlasttotalassets-1"><a class="header" href="#getlasttotalassets-1">getLastTotalAssets</a></h3>
<p>Returns the last total assets for a given vault and asset</p>
<pre><code class="language-solidity">function getLastTotalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The last total assets for the vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="converttoassets"><a class="header" href="#converttoassets">convertToAssets</a></h3>
<p>Converts shares to assets</p>
<pre><code class="language-solidity">function convertToAssets(address vault, uint256 shares) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares to convert</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The number of assets converted from shares</td></tr>
</tbody></table>
</div>
<h3 id="totalassets-2"><a class="header" href="#totalassets-2">totalAssets</a></h3>
<p>Returns the current total assets in the external strategy</p>
<pre><code class="language-solidity">function totalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault to query</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently deployed in strategy</td></tr>
</tbody></table>
</div>
<h3 id="getpendingredemption"><a class="header" href="#getpendingredemption">getPendingRedemption</a></h3>
<p>Returns the pending redemption for a request ID</p>
<pre><code class="language-solidity">function getPendingRedemption(uint256 requestId)
    external
    view
    returns (address vault, address asset, uint256 shares, bool processed);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares being redeemed</td></tr>
<tr><td><code>processed</code></td><td><code>bool</code></td><td>Whether the redemption has been processed</td></tr>
</tbody></table>
</div>
<h3 id="getpendingredemptions"><a class="header" href="#getpendingredemptions">getPendingRedemptions</a></h3>
<p>Returns the pending redemptions for a vault</p>
<pre><code class="language-solidity">function getPendingRedemptions(address vault) external view returns (uint256[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256[]</code></td><td>Pending redemptions for the vault</td></tr>
</tbody></table>
</div>
<h3 id="registered"><a class="header" href="#registered">registered</a></h3>
<p>Returns whether this adapter is registered</p>
<pre><code class="language-solidity">function registered() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered and active</td></tr>
</tbody></table>
</div>
<h3 id="name-1"><a class="header" href="#name-1">name</a></h3>
<p>Returns the adapter's name for identification</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Human readable adapter name</td></tr>
</tbody></table>
</div>
<h3 id="version-1"><a class="header" href="#version-1">version</a></h3>
<p>Returns the adapter's version</p>
<pre><code class="language-solidity">function version() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="iextsload"><a class="header" href="#iextsload">IExtsload</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IExtsload.sol">Git Source</a></p>
<p>Interface for external storage access</p>
<h2 id="functions-9"><a class="header" href="#functions-9">Functions</a></h2>
<h3 id="extsload-4"><a class="header" href="#extsload-4">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 slot) external view returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slot</code></td><td><code>bytes32</code></td><td>Storage slot to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-5"><a class="header" href="#extsload-5">extsload</a></h3>
<p>Reads multiple consecutive storage slots</p>
<pre><code class="language-solidity">function extsload(bytes32 startSlot, uint256 nSlots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startSlot</code></td><td><code>bytes32</code></td><td>Starting storage slot</td></tr>
<tr><td><code>nSlots</code></td><td><code>uint256</code></td><td>Number of slots to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of values from the storage slots</td></tr>
</tbody></table>
</div>
<h3 id="extsload-6"><a class="header" href="#extsload-6">extsload</a></h3>
<p>Reads multiple arbitrary storage slots</p>
<pre><code class="language-solidity">function extsload(bytes32[] calldata slots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slots</code></td><td><code>bytes32[]</code></td><td>Array of storage slots to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of values from the storage slots</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivault"><a class="header" href="#ivault">IVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/interfaces/IVault.sol//src/interfaces/IVaultBatch.sol/interface.IVaultBatch.html">IVaultBatch</a>, <a href="src/interfaces/IVault.sol//src/interfaces/IVaultClaim.sol/interface.IVaultClaim.html">IVaultClaim</a>, <a href="src/interfaces/IVault.sol//src/interfaces/IVaultFees.sol/interface.IVaultFees.html">IVaultFees</a></p>
<p>Core interface for retail staking operations enabling kToken holders to earn yield through vault strategies</p>
<p><em>This interface defines the primary user entry points for the KAM protocol's retail staking system. Vaults
implementing this interface provide a gateway for individual kToken holders to participate in yield generation
alongside institutional flows. The system operates on a dual-token model: (1) Users deposit kTokens (1:1 backed
tokens) and receive stkTokens (share tokens) that accrue yield, (2) Batch processing aggregates multiple user
operations for gas efficiency and fair pricing, (3) Two-phase operations (request → claim) enable optimal
settlement coordination with the broader protocol. Key features include: asset flow coordination with kAssetRouter
for virtual balance management, integration with DN vaults for yield source diversification, batch settlement
system for gas-efficient operations, and automated yield distribution through share price appreciation rather
than token rebasing. This approach maintains compatibility with existing DeFi infrastructure while providing
transparent yield accrual for retail participants.</em></p>
<h2 id="functions-10"><a class="header" href="#functions-10">Functions</a></h2>
<h3 id="requeststake"><a class="header" href="#requeststake">requestStake</a></h3>
<p>Initiates kToken staking request for yield-generating stkToken shares in a batch processing system</p>
<p><em>This function begins the retail staking process by: (1) Validating user has sufficient kToken balance
and vault is not paused, (2) Creating a pending stake request with user-specified recipient and current
batch ID for fair settlement, (3) Transferring kTokens from user to vault while updating pending stake
tracking for accurate share calculations, (4) Coordinating with kAssetRouter to virtually move underlying
assets from DN vault to staking vault, enabling proper asset allocation across the protocol. The request
enters pending state until batch settlement, when the final share price is calculated based on vault
performance. Users must later call claimStakedShares() after settlement to receive their stkTokens at
the settled price. This two-phase approach ensures fair pricing for all users within a batch period.</em></p>
<pre><code class="language-solidity">function requestStake(address to, uint256 kTokensAmount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the stkTokens after successful settlement and claiming</td></tr>
<tr><td><code>kTokensAmount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to stake (must not exceed user balance, cannot be zero)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this staking request through settlement and claiming</td></tr>
</tbody></table>
</div>
<h3 id="requestunstake"><a class="header" href="#requestunstake">requestUnstake</a></h3>
<p>Initiates stkToken unstaking request for kToken redemption plus accrued yield through batch processing</p>
<p><em>This function begins the retail unstaking process by: (1) Validating user has sufficient stkToken balance
and vault is operational, (2) Creating pending unstake request with current batch ID for settlement
coordination,
(3) Transferring stkTokens from user to vault contract to maintain stable share price during settlement period,
(4) Notifying kAssetRouter of share redemption request for proper accounting across vault network. The stkTokens
remain locked in the vault until settlement when they are burned and equivalent kTokens (including yield) are
made available. Users must later call claimUnstakedAssets() after settlement to receive their kTokens from
the batch receiver contract. This two-phase design ensures accurate yield calculations and prevents share
price manipulation during the settlement process.</em></p>
<pre><code class="language-solidity">function requestUnstake(address to, uint256 stkTokenAmount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the kTokens after successful settlement and claiming</td></tr>
<tr><td><code>stkTokenAmount</code></td><td><code>uint256</code></td><td>The quantity of stkTokens to unstake (must not exceed user balance, cannot be zero)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this unstaking request through settlement and claiming</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultbatch"><a class="header" href="#ivaultbatch">IVaultBatch</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVaultBatch.sol">Git Source</a></p>
<p>Interface for batch lifecycle management enabling gas-efficient settlement of multiple user operations</p>
<p><em>This interface defines the batch processing system that aggregates individual staking/unstaking requests
for efficient settlement. The batch lifecycle consists of three distinct phases: (1) Open Phase: New requests
can be added to the current batch, enabling users to join the settlement period, (2) Closed Phase: No new
requests accepted, batch is prepared for settlement with final share price calculations, (3) Settled Phase:
Assets distributed and share prices fixed, users can claim their rewards/redemptions. This system provides
several key benefits: gas cost optimization through bulk processing, fair pricing through synchronized settlement,
coordination with kAssetRouter for cross-vault yield distribution, and minimal proxy deployment for isolated
asset distribution. The batch system is critical for maintaining protocol scalability while ensuring equitable
treatment of all participants within each settlement period.</em></p>
<h2 id="functions-11"><a class="header" href="#functions-11">Functions</a></h2>
<h3 id="createnewbatch"><a class="header" href="#createnewbatch">createNewBatch</a></h3>
<p>Creates a new batch to begin aggregating user requests for the next settlement period</p>
<p><em>This function initializes a fresh batch period for collecting staking and unstaking requests. Process:
(1) Increments internal batch counter for unique identification, (2) Generates deterministic batch ID using
chain-specific parameters (vault address, batch number, chainid, timestamp, asset) for collision resistance,
(3) Initializes batch storage with open state enabling new request acceptance, (4) Updates vault's current
batch tracking for request routing. Only relayers can call this function as part of the automated settlement
schedule. The timing is typically coordinated with institutional settlement cycles to optimize capital
efficiency
across the protocol. Each batch remains open until explicitly closed by relayers or governance.</em></p>
<pre><code class="language-solidity">function createNewBatch() external returns (bytes32 batchId);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Unique deterministic identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="closebatch"><a class="header" href="#closebatch">closeBatch</a></h3>
<p>Closes a batch to prevent new requests and prepare for settlement processing</p>
<p><em>This function transitions a batch from open to closed state, finalizing the request set for settlement.
Process: (1) Validates batch exists and is currently open to prevent double-closing, (2) Marks batch as closed
preventing new stake/unstake requests from joining, (3) Optionally creates new batch for continued operations
if _create flag is true, enabling seamless transitions. Once closed, the batch awaits settlement by kAssetRouter
which will calculate final share prices and distribute yields. Only relayers can execute batch closure as part
of the coordinated settlement schedule across all protocol vaults. The timing typically aligns with DN vault
yield calculations to ensure accurate price discovery.</em></p>
<pre><code class="language-solidity">function closeBatch(bytes32 _batchId, bool _create) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The specific batch identifier to close (must be currently open)</td></tr>
<tr><td><code>_create</code></td><td><code>bool</code></td><td>Whether to immediately create a new batch after closing for continued operations</td></tr>
</tbody></table>
</div>
<h3 id="settlebatch"><a class="header" href="#settlebatch">settleBatch</a></h3>
<p>Marks a batch as settled after yield distribution and enables user claiming</p>
<p><em>This function finalizes batch settlement by recording final asset values and enabling claims. Process:
(1) Validates batch is closed and not already settled to prevent duplicate processing, (2) Snapshots both
gross and net share prices at settlement time for accurate reward calculations, (3) Marks batch as settled
enabling users to claim their staked shares or unstaked assets, (4) Completes the batch lifecycle allowing
reward distribution through the claiming mechanism. Only kAssetRouter can settle batches as it coordinates
yield calculations across DN vaults and manages cross-vault asset flows. Settlement triggers share price
finalization based on vault performance during the batch period.</em></p>
<pre><code class="language-solidity">function settleBatch(bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to mark as settled (must be closed, not previously settled)</td></tr>
</tbody></table>
</div>
<h3 id="createbatchreceiver"><a class="header" href="#createbatchreceiver">createBatchReceiver</a></h3>
<p>Deploys a minimal proxy BatchReceiver for isolated asset distribution to unstaking users</p>
<p><em>This function creates batch-specific receivers for secure unstaking asset distribution. Process:
(1) Checks if receiver already exists for batch to prevent duplicate deployments, (2) Clones minimal proxy
from receiver implementation to minimize gas costs while maintaining isolation, (3) Initializes receiver with
batch ID and asset type for proper operation, (4) Stores receiver address in batch info for claiming access.
The receiver pattern provides several benefits: asset isolation between batches preventing cross-contamination,
gas-efficient deployment through EIP-1167 minimal proxies, security through single-batch operation scope,
and simplified distribution logic for unstaking claims. Only kAssetRouter can create receivers as part of
settlement coordination.</em></p>
<pre><code class="language-solidity">function createBatchReceiver(bytes32 _batchId) external returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier requiring a receiver for asset distribution</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the deployed BatchReceiver contract for this specific batch</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultclaim"><a class="header" href="#ivaultclaim">IVaultClaim</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVaultClaim.sol">Git Source</a></p>
<p>Interface for claiming settled staking rewards and unstaking assets after batch processing completion</p>
<p><em>This interface defines the final phase of the two-phase staking/unstaking system where users collect
their rewards after batch settlement. The claiming mechanism operates after batches have been settled by
kAssetRouter with finalized share prices and yield calculations. Key features include: (1) Share Distribution:
For staking claims, users receive stkTokens at the settled share price reflecting vault performance during
the batch period, (2) Asset Distribution: For unstaking claims, users receive kTokens (including accrued yield)
distributed through batch-specific receiver contracts, (3) Request Validation: Claims are validated against
original requests to ensure only authorized recipients can claim, (4) State Management: Claimed requests are
marked to prevent double-claiming while maintaining audit trails. The two-phase approach (request → claim)
provides several advantages: fair pricing through synchronized settlement, gas efficiency by separating request
processing from asset distribution, security through settled price finalization, and operational flexibility
for users to claim rewards at their convenience after settlement.</em></p>
<h2 id="functions-12"><a class="header" href="#functions-12">Functions</a></h2>
<h3 id="claimstakedshares"><a class="header" href="#claimstakedshares">claimStakedShares</a></h3>
<p>Claims stkTokens from a settled staking batch at the finalized share price</p>
<p><em>This function completes the staking process by distributing stkTokens to users after batch settlement.
Process: (1) Validates batch has been settled and share prices are finalized to ensure accurate distribution,
(2) Verifies request ownership and pending status to prevent unauthorized or duplicate claims, (3) Calculates
stkToken amount based on original kToken deposit and settled net share price (after fees), (4) Mints stkTokens
to specified recipient reflecting their proportional vault ownership, (5) Marks request as claimed to prevent
future reprocessing. The net share price accounts for management and performance fees, ensuring users receive
their accurate yield-adjusted position. stkTokens are ERC20-compatible shares that continue accruing yield
through share price appreciation until unstaking.</em></p>
<pre><code class="language-solidity">function claimStakedShares(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The settled batch identifier containing this staking request</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The specific staking request identifier to claim rewards for</td></tr>
</tbody></table>
</div>
<h3 id="claimunstakedassets"><a class="header" href="#claimunstakedassets">claimUnstakedAssets</a></h3>
<p>Claims kTokens plus accrued yield from a settled unstaking batch through batch receiver distribution</p>
<p><em>This function completes the unstaking process by distributing redeemed assets to users after settlement.
Process: (1) Validates batch settlement and asset distribution readiness through batch receiver verification,
(2) Confirms request ownership and pending status to ensure authorized claiming, (3) Calculates kToken amount
based on original stkToken redemption and settled share price including yield, (4) Burns locked stkTokens
that were held during settlement period, (5) Triggers batch receiver to transfer calculated kTokens to
recipient,
(6) Marks request as claimed completing the unstaking cycle. The batch receiver pattern ensures asset isolation
between settlement periods while enabling efficient distribution. Users receive their original investment plus
proportional share of vault yields earned during their staking period.</em></p>
<pre><code class="language-solidity">function claimUnstakedAssets(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The settled batch identifier containing this unstaking request</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The specific unstaking request identifier to claim assets for</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultfees"><a class="header" href="#ivaultfees">IVaultFees</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVaultFees.sol">Git Source</a></p>
<p>Interface for vault fee management including performance and management fees with hurdle rate mechanisms</p>
<p><em>This interface defines the fee structure for staking vaults, implementing traditional fund management fee
models adapted for DeFi yield generation. The system supports two primary fee types: (1) Management Fees: Charged
periodically on assets under management regardless of performance, compensating vault operators for operational
costs and risk management, (2) Performance Fees: Charged on excess returns above hurdle rates, aligning operator
incentives with user returns. The hurdle rate mechanism can operate in two modes: soft hurdle (fees on all profits)
or hard hurdle (fees only on excess above hurdle). Fee calculations integrate with the batch settlement system,
ensuring accurate deductions from user returns during share price calculations. Backend coordination allows for
off-chain fee processing with on-chain validation and tracking. All fees are expressed in basis points (1% = 100 bp)
for precision and standard financial terminology alignment.</em></p>
<h2 id="functions-13"><a class="header" href="#functions-13">Functions</a></h2>
<h3 id="sethardhurdlerate"><a class="header" href="#sethardhurdlerate">setHardHurdleRate</a></h3>
<p>Configures the hurdle rate fee calculation mechanism for performance fee determination</p>
<p><em>This function switches between soft and hard hurdle rate modes affecting performance fee calculations.
Hurdle Rate Modes: (1) Soft Hurdle (_isHard = false): Performance fees are charged on all profits when returns
exceed the hurdle rate threshold, providing simpler fee calculation while maintaining performance incentives,
(2) Hard Hurdle (_isHard = true): Performance fees are only charged on the excess return above the hurdle rate,
ensuring users keep the full hurdle rate return before any performance fees. The hurdle rate itself is set
globally in the registry per asset, providing consistent benchmarks across vaults. This mechanism ensures
vault operators are only rewarded for generating returns above market expectations, protecting user interests
while incentivizing superior performance.</em></p>
<pre><code class="language-solidity">function setHardHurdleRate(bool _isHard) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isHard</code></td><td><code>bool</code></td><td>True for hard hurdle (fees only on excess), false for soft hurdle (fees on all profits)</td></tr>
</tbody></table>
</div>
<h3 id="setmanagementfee"><a class="header" href="#setmanagementfee">setManagementFee</a></h3>
<p>Sets the annual management fee rate charged on assets under management</p>
<p><em>This function configures the periodic fee charged regardless of vault performance, compensating operators
for ongoing vault management, risk monitoring, and operational costs. Management fees are calculated based on
time elapsed since last fee charge and total assets under management. Process: (1) Validates fee rate does not
exceed maximum allowed to protect users from excessive fees, (2) Updates stored management fee rate for future
calculations, (3) Emits event for transparency and off-chain tracking. The fee accrues continuously and is
realized during batch settlements, ensuring users see accurate net returns. Management fees are deducted from
vault assets before performance fee calculations, following traditional fund management practices.</em></p>
<pre><code class="language-solidity">function setManagementFee(uint16 _managementFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_managementFee</code></td><td><code>uint16</code></td><td>Annual management fee rate in basis points (1% = 100 bp, max 10000 bp)</td></tr>
</tbody></table>
</div>
<h3 id="setperformancefee"><a class="header" href="#setperformancefee">setPerformanceFee</a></h3>
<p>Sets the performance fee rate charged on vault returns above hurdle rates</p>
<p><em>This function configures the success fee charged when vault performance exceeds benchmark hurdle rates,
aligning operator incentives with user returns. Performance fees are calculated during settlement based on
share price appreciation above the watermark (highest previous share price) and hurdle rate requirements.
Process: (1) Validates fee rate is within acceptable bounds for user protection, (2) Updates performance fee
rate for future calculations, (3) Emits tracking event for transparency. The fee applies only to new high
watermarks, preventing double-charging on recovered losses. Combined with hurdle rates, this ensures operators
are rewarded for generating superior risk-adjusted returns while protecting users from excessive fee extraction.</em></p>
<pre><code class="language-solidity">function setPerformanceFee(uint16 _performanceFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_performanceFee</code></td><td><code>uint16</code></td><td>Performance fee rate in basis points charged on excess returns (max 10000 bp)</td></tr>
</tbody></table>
</div>
<h3 id="notifymanagementfeescharged"><a class="header" href="#notifymanagementfeescharged">notifyManagementFeesCharged</a></h3>
<p>Updates the timestamp tracking for management fee calculations after backend fee processing</p>
<p><em>This function maintains accurate management fee accrual by recording when fees were last processed.
Backend Coordination: (1) Off-chain systems calculate and process management fees based on time elapsed and
assets under management, (2) Fees are deducted from vault assets through settlement mechanisms, (3) This
function
updates the tracking timestamp to prevent double-charging in future calculations. The timestamp validation
ensures logical progression and prevents manipulation. Management fees accrue continuously, and proper timestamp
tracking is essential for accurate pro-rata fee calculations across all vault participants.</em></p>
<pre><code class="language-solidity">function notifyManagementFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp when management fees were processed (must be &gt;= last timestamp, &lt;= current time)</td></tr>
</tbody></table>
</div>
<h3 id="notifyperformancefeescharged"><a class="header" href="#notifyperformancefeescharged">notifyPerformanceFeesCharged</a></h3>
<p>Updates the timestamp tracking for performance fee calculations after backend fee processing</p>
<p><em>This function maintains accurate performance fee tracking by recording when performance fees were last
calculated and charged. Backend Processing: (1) Off-chain systems evaluate vault performance against watermarks
and hurdle rates, (2) Performance fees are calculated on excess returns and deducted during settlement,
(3) This notification updates tracking timestamp and potentially adjusts watermark levels. The timestamp ensures
proper sequencing of performance evaluations and prevents fee calculation errors. Performance fees are
event-driven
based on new high watermarks, making accurate timestamp tracking crucial for fair fee assessment across all
users.</em></p>
<pre><code class="language-solidity">function notifyPerformanceFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp when performance fees were processed (must be &gt;= last timestamp, &lt;= current time)</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ikassetrouter"><a class="header" href="#ikassetrouter">IkAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkAssetRouter.sol">Git Source</a></p>
<p>Central money flow coordinator for the KAM protocol managing all asset movements and settlements</p>
<p><em>This interface defines the core functionality for kAssetRouter, which serves as the primary coordinator
for all asset movements within the KAM protocol ecosystem. Key responsibilities include: (1) Managing asset
flows from kMinter institutional deposits to DN vaults for yield generation, (2) Coordinating asset transfers
between kStakingVaults for optimal allocation, (3) Processing batch settlements with yield distribution through
kToken minting/burning, (4) Maintaining virtual balance tracking across all vaults, (5) Implementing settlement
cooldown periods for security, (6) Executing peg protection mechanisms during market stress. The router acts as
the central hub that enables efficient capital allocation while maintaining the 1:1 backing guarantee of kTokens
through precise yield distribution and loss management across the protocol's vault network.</em></p>
<h2 id="functions-14"><a class="header" href="#functions-14">Functions</a></h2>
<h3 id="kassetpush"><a class="header" href="#kassetpush">kAssetPush</a></h3>
<p>Pushes assets from kMinter institutional deposits to the designated DN vault for yield generation</p>
<p><em>This function is called by kMinter when institutional users deposit underlying assets. The process
involves: (1) receiving assets already transferred from kMinter, (2) forwarding them to the appropriate
DN vault for the asset type, (3) updating virtual balance tracking for accurate accounting. This enables
immediate kToken minting (1:1 with deposits) while assets begin generating yield in the vault system.
The assets enter the current batch for eventual settlement and yield distribution back to kToken holders.</em></p>
<pre><code class="language-solidity">function kAssetPush(address _asset, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited (must be registered in protocol)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault for yield generation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch identifier from the DN vault for tracking and settlement</td></tr>
</tbody></table>
</div>
<h3 id="kassetrequestpull"><a class="header" href="#kassetrequestpull">kAssetRequestPull</a></h3>
<p>Requests asset withdrawal from vault to fulfill institutional redemption through kMinter</p>
<p><em>This function initiates the first phase of the institutional redemption process. The workflow
involves: (1) registering the redemption request with the vault, (2) creating a kBatchReceiver minimal
proxy to hold assets for distribution, (3) updating virtual balance accounting, (4) preparing for
batch settlement. The actual asset transfer occurs later during batch settlement when the vault
processes all pending requests together. This two-phase approach optimizes gas costs and ensures
fair settlement across all institutional redemption requests in the batch.</em></p>
<pre><code class="language-solidity">function kAssetRequestPull(address _asset, address _vault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being redeemed</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The DN vault address from which assets will be withdrawn</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this redemption with other requests</td></tr>
</tbody></table>
</div>
<h3 id="kassettransfer"><a class="header" href="#kassettransfer">kAssetTransfer</a></h3>
<p>Transfers assets between kStakingVaults for optimal capital allocation and yield optimization</p>
<p><em>This function enables dynamic rebalancing of assets across the vault network to optimize yields
and manage capacity. The transfer is virtual in nature - actual underlying assets may remain in the
same physical vault while accounting balances are updated. This mechanism allows for: (1) moving
assets from lower-yield to higher-yield opportunities, (2) rebalancing vault capacity during high
demand periods, (3) optimizing capital efficiency across the protocol. The batch system ensures
all transfers are processed fairly during settlement periods.</em></p>
<pre><code class="language-solidity">function kAssetTransfer(
    address sourceVault,
    address targetVault,
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address transferring assets (will lose virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The kStakingVault address receiving assets (will gain virtual balance)</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred between vaults</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer for rebalancing</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this transfer with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpush"><a class="header" href="#ksharesrequestpush">kSharesRequestPush</a></h3>
<p>Requests shares to be pushed for kStakingVault staking operations and batch processing</p>
<p><em>This function is part of the share-based accounting system for retail users in kStakingVaults.
When users stake kTokens, the vault requests shares to be pushed to track their ownership. The
process coordinates: (1) conversion of kTokens to vault shares at current share price, (2) updating
user balances in the vault system, (3) preparing for batch settlement. Share requests are batched
to optimize gas costs and ensure fair pricing across all users in the same settlement period.</em></p>
<pre><code class="language-solidity">function kSharesRequestPush(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share push operations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for push to users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share operations with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpull"><a class="header" href="#ksharesrequestpull">kSharesRequestPull</a></h3>
<p>Requests shares to be pulled for kStakingVault redemption operations</p>
<p><em>This function handles the share-based redemption process for retail users withdrawing from
kStakingVaults. The process involves: (1) calculating share amounts to redeem based on user
requests, (2) preparing for conversion back to kTokens at settlement time, (3) coordinating
with the batch settlement system for fair pricing. Unlike institutional redemptions through
kMinter, this uses share-based accounting to handle smaller, more frequent retail operations
efficiently through the vault's batch processing system.</em></p>
<pre><code class="language-solidity">function kSharesRequestPull(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share pull for redemptions</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for pull from users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share redemptions with settlement</td></tr>
</tbody></table>
</div>
<h3 id="proposesettlebatch"><a class="header" href="#proposesettlebatch">proposeSettleBatch</a></h3>
<p>Proposes a batch settlement for a vault with yield distribution through kToken minting/burning</p>
<p><em>This is the core function that initiates yield distribution in the KAM protocol. The settlement
process involves: (1) calculating final yields after a batch period, (2) determining net new deposits/
redemptions, (3) creating a proposal with cooldown period for security verification, (4) preparing for
kToken supply adjustment to maintain 1:1 backing. Positive yields result in kToken minting (distributing
gains to all holders), while losses result in kToken burning (socializing losses). The cooldown period
allows guardians to verify calculations before execution, ensuring protocol integrity.</em></p>
<pre><code class="language-solidity">function proposeSettleBatch(
    address asset,
    address vault,
    bytes32 batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    payable
    returns (bytes32 proposalId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being settled (USDC, WBTC, etc.)</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address where yield was generated</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation/loss</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits minus redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute amount of yield generated (positive) or lost (negative)</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive (will mint kTokens), false if negative (will burn kTokens)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>Unique identifier for this settlement proposal for tracking and execution</td></tr>
</tbody></table>
</div>
<h3 id="executesettlebatch"><a class="header" href="#executesettlebatch">executeSettleBatch</a></h3>
<p>Executes a settlement proposal after the security cooldown period has elapsed</p>
<p><em>This function completes the yield distribution process by: (1) verifying the cooldown period has
passed, (2) executing the actual kToken minting/burning to distribute yield or account for losses,
(3) updating all vault balances and user accounting, (4) processing any pending redemption requests
from the batch. This is where the 1:1 backing is maintained - the kToken supply is adjusted to exactly
reflect the underlying asset changes, ensuring every kToken remains backed by real assets plus distributed
yield.</em></p>
<pre><code class="language-solidity">function executeSettleBatch(bytes32 proposalId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to execute</td></tr>
</tbody></table>
</div>
<h3 id="cancelproposal"><a class="header" href="#cancelproposal">cancelProposal</a></h3>
<p>Cancels a settlement proposal before execution if errors are detected</p>
<p><em>Provides a safety mechanism for guardians to cancel potentially incorrect settlement proposals.
This can be used when: (1) yield calculations appear incorrect, (2) system errors are detected,
(3) market conditions require recalculation. Cancellation allows for proposal correction and
resubmission with accurate data, preventing incorrect yield distribution that could affect the
protocol's 1:1 backing guarantee. Only callable before the proposal execution.</em></p>
<pre><code class="language-solidity">function cancelProposal(bytes32 proposalId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to cancel</td></tr>
</tbody></table>
</div>
<h3 id="setsettlementcooldown"><a class="header" href="#setsettlementcooldown">setSettlementCooldown</a></h3>
<p>Sets the security cooldown period for settlement proposals</p>
<p><em>The cooldown period provides critical security by requiring a delay between proposal creation
and execution. This allows: (1) protocol guardians to verify yield calculations, (2) detection of
potential errors or malicious proposals, (3) emergency intervention if needed. The cooldown should
balance security (longer is safer) with operational efficiency (shorter enables faster yield
distribution). Only admin roles can modify this parameter as it affects protocol safety.</em></p>
<pre><code class="language-solidity">function setSettlementCooldown(uint256 cooldown) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds before settlement proposals can be executed</td></tr>
</tbody></table>
</div>
<h3 id="getpendingproposals"><a class="header" href="#getpendingproposals">getPendingProposals</a></h3>
<p>Retrieves all pending settlement proposals for a specific vault</p>
<p><em>Returns proposal IDs that have been created but not yet executed or cancelled.
Used for monitoring and management of the settlement queue. Essential for guardians
to track proposals awaiting verification during the cooldown period.</em></p>
<pre><code class="language-solidity">function getPendingProposals(address vault_) external view returns (bytes32[] memory pendingProposals);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault_</code></td><td><code>address</code></td><td>The vault address to query for pending settlement proposals</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pendingProposals</code></td><td><code>bytes32[]</code></td><td>Array of proposal IDs currently pending execution</td></tr>
</tbody></table>
</div>
<h3 id="getdnvaultbyasset"><a class="header" href="#getdnvaultbyasset">getDNVaultByAsset</a></h3>
<p>Gets the DN vault address responsible for yield generation for a specific asset</p>
<p><em>Each supported asset (USDC, WBTC, etc.) has a designated DN vault that handles
yield farming strategies. This mapping is critical for routing institutional deposits
and coordinating settlement processes across the protocol's vault network.</em></p>
<pre><code class="language-solidity">function getDNVaultByAsset(address asset) external view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address that generates yield for this asset</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidbalances"><a class="header" href="#getbatchidbalances">getBatchIdBalances</a></h3>
<p>Retrieves the virtual balance accounting for a specific batch in a vault</p>
<p><em>Returns the deposited and requested amounts that are tracked virtually for batch
processing. These balances coordinate institutional flows (kMinter) and retail flows
(kStakingVault) within the same settlement period, ensuring fair processing and accurate
yield distribution across all participants in the batch.</em></p>
<pre><code class="language-solidity">function getBatchIdBalances(
    address vault,
    bytes32 batchId
)
    external
    view
    returns (uint256 deposited, uint256 requested);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query batch balances for</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to retrieve balance information</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deposited</code></td><td><code>uint256</code></td><td>Total amount of assets deposited into this batch</td></tr>
<tr><td><code>requested</code></td><td><code>uint256</code></td><td>Total amount of assets requested for redemption from this batch</td></tr>
</tbody></table>
</div>
<h3 id="getrequestedshares"><a class="header" href="#getrequestedshares">getRequestedShares</a></h3>
<p>Retrieves the total shares requested for redemption in a specific vault batch</p>
<p><em>Tracks share-based redemption requests from retail users in kStakingVaults.
This is separate from asset-based tracking and enables the protocol to coordinate
both institutional (asset-based) and retail (share-based) operations within the
same batch settlement process, ensuring consistent share price calculations.</em></p>
<pre><code class="language-solidity">function getRequestedShares(address vault, bytes32 batchId) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault address to query</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for the redemption period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of shares requested for redemption in this batch</td></tr>
</tbody></table>
</div>
<h3 id="ispaused"><a class="header" href="#ispaused">isPaused</a></h3>
<p>Checks if the kAssetRouter contract is currently paused</p>
<p><em>When paused, all critical functions (asset movements, settlements) are halted
for emergency protection. This affects the entire protocol's money flow coordination,
preventing new deposits, redemptions, and yield distributions until unpaused.</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused and operations are halted</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementproposal"><a class="header" href="#getsettlementproposal">getSettlementProposal</a></h3>
<p>Retrieves complete details of a specific settlement proposal</p>
<p><em>Returns the full VaultSettlementProposal struct containing all parameters needed
for yield distribution verification. Essential for guardians to review proposal accuracy
during the cooldown period before execution. Contains asset amounts, yield calculations,
and timing information for comprehensive proposal analysis.</em></p>
<pre><code class="language-solidity">function getSettlementProposal(bytes32 proposalId) external view returns (VaultSettlementProposal memory proposal);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The complete settlement proposal struct with all details</td></tr>
</tbody></table>
</div>
<h3 id="canexecuteproposal"><a class="header" href="#canexecuteproposal">canExecuteProposal</a></h3>
<p>Checks if a settlement proposal is ready for execution with detailed status</p>
<p><em>Validates all execution requirements: (1) proposal exists and is pending, (2) cooldown
period has elapsed, (3) proposal hasn't been cancelled. Returns both boolean result and
human-readable reason for failures, enabling better error handling and user feedback.</em></p>
<pre><code class="language-solidity">function canExecuteProposal(bytes32 proposalId) external view returns (bool canExecute, string memory reason);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the proposal to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>canExecute</code></td><td><code>bool</code></td><td>True if the proposal can be executed immediately</td></tr>
<tr><td><code>reason</code></td><td><code>string</code></td><td>Descriptive message explaining why execution is blocked (if applicable)</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementcooldown"><a class="header" href="#getsettlementcooldown">getSettlementCooldown</a></h3>
<p>Gets the current security cooldown period for settlement proposals</p>
<p><em>The cooldown period determines how long proposals must wait before execution.
This security mechanism allows guardians to verify yield calculations and prevents
immediate execution of potentially malicious or incorrect proposals. Critical for
maintaining protocol integrity during yield distribution processes.</em></p>
<pre><code class="language-solidity">function getSettlementCooldown() external view returns (uint256 cooldown);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The current cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="contractname-1"><a class="header" href="#contractname-1">contractName</a></h3>
<p>Returns the standard name identifier for this contract type within the KAM protocol</p>
<p><em>Used for protocol identification and registry management. Provides a consistent way
to identify kAssetRouter contracts across the protocol ecosystem, enabling automated
contract discovery and validation by other protocol components.</em></p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string (typically "kAssetRouter")</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-1"><a class="header" href="#contractversion-1">contractVersion</a></h3>
<p>Returns the version identifier for this contract implementation</p>
<p><em>Used for upgrade management and compatibility checking within the protocol. Enables
the system to verify contract versions during upgrades and ensure compatibility between
protocol components. Critical for protocol governance and maintenance procedures.</em></p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h2 id="events-3"><a class="header" href="#events-3">Events</a></h2>
<h3 id="contractinitialized"><a class="header" href="#contractinitialized">ContractInitialized</a></h3>
<p>Emitted when the kAssetRouter contract is initialized with registry configuration</p>
<pre><code class="language-solidity">event ContractInitialized(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The address of the kRegistry contract that manages protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="assetspushed"><a class="header" href="#assetspushed">AssetsPushed</a></h3>
<p>Emitted when assets are pushed from kMinter to a DN vault for yield generation</p>
<p><em>This occurs when institutional users deposit assets through kMinter, and the router
forwards these assets to the appropriate DN vault for yield farming strategies</em></p>
<pre><code class="language-solidity">event AssetsPushed(address indexed from, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address initiating the asset push (typically kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault</td></tr>
</tbody></table>
</div>
<h3 id="assetsrequestpulled"><a class="header" href="#assetsrequestpulled">AssetsRequestPulled</a></h3>
<p>Emitted when assets are requested for pull from a vault to fulfill kMinter redemptions</p>
<p><em>Part of the two-phase redemption process - assets are first requested, then later pulled
after batch settlement. The batchReceiver is deployed to hold assets for distribution.</em></p>
<pre><code class="language-solidity">event AssetsRequestPulled(address indexed vault, address indexed asset, address indexed batchReceiver, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address from which assets are being requested</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being requested for redemption</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The minimal proxy contract that will receive and distribute assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
</tbody></table>
</div>
<h3 id="assetstransfered"><a class="header" href="#assetstransfered">AssetsTransfered</a></h3>
<p>Emitted when assets are transferred between kStakingVaults for optimal allocation</p>
<p><em>This is a virtual transfer for accounting purposes - actual assets may remain in the same
physical location while vault balances are updated to reflect the new allocation</em></p>
<pre><code class="language-solidity">event AssetsTransfered(address indexed sourceVault, address indexed targetVault, address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault transferring assets (losing virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets (gaining virtual balance)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being transferred between vaults</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpushed"><a class="header" href="#sharesrequestedpushed">SharesRequestedPushed</a></h3>
<p>Emitted when shares are requested for push operations in kStakingVault flows</p>
<p><em>Part of the share-based accounting system for retail users in kStakingVaults</em></p>
<pre><code class="language-solidity">event SharesRequestedPushed(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share push operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this operation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pushed</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpulled"><a class="header" href="#sharesrequestedpulled">SharesRequestedPulled</a></h3>
<p>Emitted when shares are requested for pull operations in kStakingVault redemptions</p>
<p><em>Coordinates share-based redemptions for retail users through the batch system</em></p>
<pre><code class="language-solidity">event SharesRequestedPulled(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share pull operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this redemption batch</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pulled for redemption</td></tr>
</tbody></table>
</div>
<h3 id="sharessettled"><a class="header" href="#sharessettled">SharesSettled</a></h3>
<p>Emitted when shares are settled across multiple vaults with calculated share prices</p>
<p><em>Marks the completion of a cross-vault settlement with final share price determination</em></p>
<pre><code class="language-solidity">event SharesSettled(
    address[] vaults, bytes32 indexed batchId, uint256 totalRequestedShares, uint256[] totalAssets, uint256 sharePrice
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vaults</code></td><td><code>address[]</code></td><td>Array of vault addresses participating in the settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalRequestedShares</code></td><td><code>uint256</code></td><td>Total shares requested across all vaults in this settlement</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256[]</code></td><td>Array of total assets for each vault after settlement</td></tr>
<tr><td><code>sharePrice</code></td><td><code>uint256</code></td><td>The final calculated share price for this settlement period</td></tr>
</tbody></table>
</div>
<h3 id="batchsettled"><a class="header" href="#batchsettled">BatchSettled</a></h3>
<p>Emitted when a vault batch is settled with final asset accounting</p>
<p><em>Indicates completion of yield distribution and final asset allocation for a batch</em></p>
<pre><code class="language-solidity">event BatchSettled(address indexed vault, bytes32 indexed batchId, uint256 totalAssets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that completed batch settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>The final total asset value in the vault after settlement</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionactivated"><a class="header" href="#pegprotectionactivated">PegProtectionActivated</a></h3>
<p>Emitted when peg protection mechanism is activated due to vault shortfall</p>
<p><em>Triggered when a vault cannot fulfill redemption requests, requiring asset transfers
from other vaults to maintain the protocol's 1:1 backing guarantee</em></p>
<pre><code class="language-solidity">event PegProtectionActivated(address indexed vault, uint256 shortfall);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault experiencing shortfall that triggered peg protection</td></tr>
<tr><td><code>shortfall</code></td><td><code>uint256</code></td><td>The amount of assets needed to fulfill pending redemption requests</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionexecuted"><a class="header" href="#pegprotectionexecuted">PegProtectionExecuted</a></h3>
<p>Emitted when peg protection transfers assets between vaults to cover shortfalls</p>
<p><em>Maintains protocol solvency by redistributing assets from surplus to deficit vaults</em></p>
<pre><code class="language-solidity">event PegProtectionExecuted(address indexed sourceVault, address indexed targetVault, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault providing assets to cover the shortfall</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets to fulfill its redemption obligations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets transferred for peg protection</td></tr>
</tbody></table>
</div>
<h3 id="yielddistributed"><a class="header" href="#yielddistributed">YieldDistributed</a></h3>
<p>Emitted when yield is distributed through kToken minting/burning operations</p>
<p><em>This is the core mechanism for maintaining 1:1 backing while distributing yield.
Positive yield increases kToken supply, negative yield (losses) decreases supply.</em></p>
<pre><code class="language-solidity">event YieldDistributed(address indexed vault, uint256 yield, bool isProfit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault that generated the yield being distributed</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>The absolute amount of yield (positive or negative) being distributed</td></tr>
<tr><td><code>isProfit</code></td><td><code>bool</code></td><td>True if yield is positive (minting kTokens), false if negative (burning kTokens)</td></tr>
</tbody></table>
</div>
<h3 id="deposited-1"><a class="header" href="#deposited-1">Deposited</a></h3>
<p>Emitted when assets are deposited into a vault through various protocol mechanisms</p>
<p><em>Tracks all asset deposits whether from kMinter institutional flows or other sources</em></p>
<pre><code class="language-solidity">event Deposited(address indexed vault, address indexed asset, uint256 amount, bool isKMinter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the deposit</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets deposited</td></tr>
<tr><td><code>isKMinter</code></td><td><code>bool</code></td><td>True if deposit originated from kMinter, false for other sources</td></tr>
</tbody></table>
</div>
<h3 id="settlementproposed"><a class="header" href="#settlementproposed">SettlementProposed</a></h3>
<p>Emitted when a new settlement proposal is created with cooldown period</p>
<p><em>Begins the settlement process with a security cooldown to allow verification</em></p>
<pre><code class="language-solidity">event SettlementProposed(
    bytes32 indexed proposalId,
    address indexed vault,
    bytes32 indexed batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit,
    uint256 executeAfter
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier for this settlement proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement is proposed</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier being settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits/redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute yield amount generated in this batch</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive, false if negative</td></tr>
<tr><td><code>executeAfter</code></td><td><code>uint256</code></td><td>Timestamp after which the proposal can be executed</td></tr>
</tbody></table>
</div>
<h3 id="settlementexecuted"><a class="header" href="#settlementexecuted">SettlementExecuted</a></h3>
<p>Emitted when a settlement proposal is successfully executed</p>
<p><em>Marks completion of the settlement process with yield distribution</em></p>
<pre><code class="language-solidity">event SettlementExecuted(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId, address executor);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the executed proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that was settled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>executor</code></td><td><code>address</code></td><td>The address that executed the settlement (guardian or admin)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcancelled"><a class="header" href="#settlementcancelled">SettlementCancelled</a></h3>
<p>Emitted when a settlement proposal is cancelled before execution</p>
<p><em>Allows guardians to cancel potentially incorrect settlement proposals</em></p>
<pre><code class="language-solidity">event SettlementCancelled(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the cancelled proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement was cancelled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for which settlement was cancelled</td></tr>
</tbody></table>
</div>
<h3 id="settlementupdated"><a class="header" href="#settlementupdated">SettlementUpdated</a></h3>
<p>Emitted when a settlement proposal is updated with new yield calculation data</p>
<p><em>Allows for correction of settlement proposals before execution if needed</em></p>
<pre><code class="language-solidity">event SettlementUpdated(bytes32 indexed proposalId, uint256 totalAssets, uint256 netted, uint256 yield, bool profit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the updated proposal</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Updated total asset value in the vault</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Updated net amount of deposits/redemptions</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Updated yield amount for distribution</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>Updated profit flag (true for gains, false for losses)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcooldownupdated"><a class="header" href="#settlementcooldownupdated">SettlementCooldownUpdated</a></h3>
<p>Emitted when the settlement cooldown period is updated by protocol governance</p>
<p><em>Cooldown provides security by allowing time to verify settlement proposals before execution</em></p>
<pre><code class="language-solidity">event SettlementCooldownUpdated(uint256 oldCooldown, uint256 newCooldown);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldCooldown</code></td><td><code>uint256</code></td><td>The previous cooldown period in seconds</td></tr>
<tr><td><code>newCooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h2 id="structs-4"><a class="header" href="#structs-4">Structs</a></h2>
<h3 id="balances"><a class="header" href="#balances">Balances</a></h3>
<p>Tracks requested and deposited asset amounts for batch processing coordination</p>
<p><em>Used by kAssetRouter to maintain virtual balance accounting across vaults and coordinate
asset flows between kMinter redemption requests and vault settlements. Enables efficient
batch processing by tracking pending operations before physical asset movement occurs.</em></p>
<pre><code class="language-solidity">struct Balances {
    uint128 requested;
    uint128 deposited;
}
</code></pre>
<h3 id="vaultsettlementproposal"><a class="header" href="#vaultsettlementproposal">VaultSettlementProposal</a></h3>
<p>Contains all parameters for a batch settlement proposal in the yield distribution system</p>
<p><em>Settlement proposals implement a cooldown mechanism for security, allowing guardians to verify
yield calculations before execution. Once executed, the proposal triggers kToken minting/burning to
distribute yield or account for losses, maintaining the 1:1 backing ratio across all kTokens.</em></p>
<pre><code class="language-solidity">struct VaultSettlementProposal {
    address asset;
    address vault;
    bytes32 batchId;
    uint256 totalAssets;
    uint256 netted;
    uint256 yield;
    bool profit;
    uint256 executeAfter;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikbatchreceiver"><a class="header" href="#ikbatchreceiver">IkBatchReceiver</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkBatchReceiver.sol">Git Source</a></p>
<p>Interface for minimal proxy contracts that manage asset distribution for completed batch redemptions</p>
<p><em>kBatchReceiver contracts are deployed as minimal proxies (one per batch) to efficiently manage the distribution
of settled assets to users who requested redemptions. This design pattern provides: (1) gas-efficient deployment
since each batch gets its own isolated distribution contract, (2) clear asset segregation preventing cross-batch
contamination, (3) simplified accounting where each receiver holds exactly the assets needed for one batch.
The contract serves as a temporary holding mechanism - kMinter transfers settled assets to the receiver, then users
can pull their proportional share. This architecture ensures fair distribution and prevents front-running during
the redemption settlement process. Only the originating kMinter contract can interact with receivers, maintaining
strict access control throughout the asset distribution phase.</em></p>
<h2 id="functions-15"><a class="header" href="#functions-15">Functions</a></h2>
<h3 id="kminter"><a class="header" href="#kminter">kMinter</a></h3>
<p>Retrieves the address of the kMinter contract authorized to interact with this receiver</p>
<p><em>Returns the immutable kMinter address set during receiver deployment. This address has
exclusive permission to call pullAssets() and rescueAssets(), ensuring only the originating
kMinter can manage asset distribution for this batch. Critical for maintaining access control
and preventing unauthorized asset movements during the redemption settlement process.</em></p>
<pre><code class="language-solidity">function kMinter() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the kMinter contract with administrative permissions over this receiver</td></tr>
</tbody></table>
</div>
<h3 id="asset-1"><a class="header" href="#asset-1">asset</a></h3>
<p>Retrieves the underlying asset contract address managed by this receiver</p>
<p><em>Returns the asset address configured during initialization (e.g., USDC, WBTC). This
determines which token type the receiver will distribute to redemption users. The asset type
must match the asset that was originally deposited and requested for redemption in the batch.</em></p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address of the underlying asset this receiver distributes</td></tr>
</tbody></table>
</div>
<h3 id="batchid"><a class="header" href="#batchid">batchId</a></h3>
<p>Retrieves the unique batch identifier this receiver serves</p>
<p><em>Returns the batch ID set during initialization, which links this receiver to a specific
batch of redemption requests. Used for validation when pulling assets to ensure operations
are performed on the correct batch. Essential for maintaining batch isolation and preventing
cross-contamination between different settlement periods.</em></p>
<pre><code class="language-solidity">function batchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>The unique batch identifier as a bytes32 hash</td></tr>
</tbody></table>
</div>
<h3 id="pullassets"><a class="header" href="#pullassets">pullAssets</a></h3>
<p>Transfers settled assets from the receiver to a redemption user completing their withdrawal</p>
<p><em>This is the core asset distribution function that fulfills redemption requests after batch settlement.
The process works as follows: (1) kMinter calls this function with user's proportional share, (2) receiver
validates the batch ID matches to prevent cross-batch contamination, (3) assets are transferred directly
to the user completing their redemption. Only callable by the authorized kMinter contract to maintain strict
access control. This function is typically called multiple times per batch as individual users claim their
settled redemptions, ensuring fair and orderly asset distribution.</em></p>
<pre><code class="language-solidity">function pullAssets(address receiver, uint256 amount, bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that will receive the settled assets (the user completing redemption)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer based on the user's proportional share</td></tr>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for validation (must match this receiver's configured batch)</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets-2"><a class="header" href="#rescueassets-2">rescueAssets</a></h3>
<p>Emergency recovery function for accidentally sent assets to prevent permanent loss</p>
<p><em>Provides a safety mechanism for recovering tokens or ETH that were mistakenly sent to the receiver
outside of normal settlement operations. The function handles both ERC20 tokens and native ETH recovery.
For ERC20 tokens, it validates that the rescue asset is not the receiver's designated settlement asset
(to prevent interfering with normal operations). Only the authorized kMinter can execute rescues, ensuring
recovered assets return to the proper custodial system. Essential for maintaining protocol security while
preventing accidental asset loss during the receiver contract's operational lifecycle.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The contract address of the asset to rescue (use address(0) for native ETH recovery)</td></tr>
</tbody></table>
</div>
<h2 id="events-4"><a class="header" href="#events-4">Events</a></h2>
<h3 id="batchreceiverinitialized"><a class="header" href="#batchreceiverinitialized">BatchReceiverInitialized</a></h3>
<p>Emitted when a new batch receiver is initialized and ready for asset distribution</p>
<p><em>This event marks the successful deployment and configuration of a minimal proxy receiver
for a specific batch. Essential for tracking the lifecycle of batch settlement processes and
enabling off-chain systems to monitor when settlement assets can begin flowing to receivers.</em></p>
<pre><code class="language-solidity">event BatchReceiverInitialized(address indexed kMinter, bytes32 indexed batchId, address asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kMinter</code></td><td><code>address</code></td><td>The address of the kMinter contract authorized to interact with this receiver</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The unique identifier of the batch this receiver will serve</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address (USDC, WBTC, etc.) this receiver will distribute</td></tr>
</tbody></table>
</div>
<h3 id="pulledassets"><a class="header" href="#pulledassets">PulledAssets</a></h3>
<p>Emitted when assets are successfully distributed from the receiver to a redemption user</p>
<p><em>This event tracks the actual fulfillment of redemption requests, recording when users
receive their settled assets. Critical for reconciliation and ensuring all batch participants
receive their proportional share during the distribution phase.</em></p>
<pre><code class="language-solidity">event PulledAssets(address indexed receiver, address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that received the distributed assets (the redeeming user)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset contract address that was transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets successfully distributed to the receiver</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets-2"><a class="header" href="#rescuedassets-2">RescuedAssets</a></h3>
<p>Emitted when accidentally sent ERC20 tokens are rescued from the receiver contract</p>
<p><em>Provides a safety mechanism for recovering tokens that were mistakenly sent to the receiver
outside of normal operations. This prevents permanent loss of assets while maintaining security.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address of the ERC20 token contract that was rescued</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address that received the rescued tokens (typically the kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens that were successfully rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth-2"><a class="header" href="#rescuedeth-2">RescuedETH</a></h3>
<p>Emitted when accidentally sent ETH is rescued from the receiver contract</p>
<p><em>Handles recovery of native ETH that was mistakenly sent to the contract, ensuring no
value is permanently locked in the receiver contracts during their operational lifecycle.</em></p>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address that received the rescued ETH (typically the kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of ETH (in wei) that was successfully rescued</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ikminter"><a class="header" href="#ikminter">IkMinter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkMinter.sol">Git Source</a></p>
<p>Interface for institutional minting and redemption operations in the KAM protocol</p>
<p><em>This interface defines the core functionality for qualified institutions to mint kTokens
by depositing underlying assets and redeem them through a batch settlement system. The interface
supports a two-phase redemption process to accommodate batch processing and yield distribution.</em></p>
<h2 id="functions-16"><a class="header" href="#functions-16">Functions</a></h2>
<h3 id="mint"><a class="header" href="#mint">mint</a></h3>
<p>Executes institutional minting of kTokens through immediate 1:1 issuance against deposited assets</p>
<p><em>This function enables qualified institutions to mint kTokens by depositing underlying assets. The process
involves: (1) transferring assets from the caller to kAssetRouter, (2) pushing assets into the current batch
of the designated DN vault for yield generation, and (3) immediately minting an equivalent amount of kTokens
to the recipient. Unlike retail operations, institutional mints bypass share-based accounting and provide
immediate token issuance without waiting for batch settlement. The deposited assets are tracked separately
to maintain the 1:1 backing ratio and will participate in vault yield strategies through the batch system.</em></p>
<pre><code class="language-solidity">function mint(address asset, address to, uint256 amount) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to deposit (must be registered in the protocol)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the newly minted kTokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of underlying asset to deposit and kTokens to mint (1:1 ratio)</td></tr>
</tbody></table>
</div>
<h3 id="requestredeem"><a class="header" href="#requestredeem">requestRedeem</a></h3>
<p>Initiates a two-phase institutional redemption by creating a batch request for underlying asset
withdrawal</p>
<p><em>This function implements the first phase of the redemption process for qualified institutions. The workflow
consists of: (1) transferring kTokens from the caller to this contract for escrow (not burned yet), (2)
generating
a unique request ID for tracking, (3) creating a RedeemRequest struct with PENDING status, (4) registering the
request with kAssetRouter for batch processing. The kTokens remain in escrow until the batch is settled and the
user calls redeem() to complete the process. This two-phase approach is necessary because redemptions are
processed
in batches through the DN vault system, which requires waiting for batch settlement to ensure proper asset
availability and yield distribution. The request can be cancelled before batch closure/settlement.</em></p>
<pre><code class="language-solidity">function requestRedeem(address asset, address to, uint256 amount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to redeem (must match the kToken's underlying asset)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the underlying assets after batch settlement</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens to redeem (will receive equivalent underlying assets)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>A unique bytes32 identifier for tracking and executing this redemption request</td></tr>
</tbody></table>
</div>
<h3 id="redeem-2"><a class="header" href="#redeem-2">redeem</a></h3>
<p>Completes the second phase of institutional redemption by executing a settled batch request</p>
<p><em>This function finalizes the redemption process initiated by requestRedeem(). It can only be called after
the batch containing this request has been settled through the kAssetRouter settlement process. The execution
involves: (1) validating the request exists and is in PENDING status, (2) updating the request status to
REDEEMED,
(3) removing the request from tracking, (4) burning the escrowed kTokens permanently, (5) instructing the
kBatchReceiver contract to transfer the underlying assets to the recipient. The kBatchReceiver is a minimal
proxy
deployed per batch that holds the settled assets and ensures isolated distribution. This function will revert if
the batch is not yet settled, ensuring assets are only distributed when available. The separation between
request
and redemption phases allows for efficient batch processing of multiple redemptions while maintaining asset
safety.</em></p>
<pre><code class="language-solidity">function redeem(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to execute (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="cancelrequest"><a class="header" href="#cancelrequest">cancelRequest</a></h3>
<p>Cancels a pending redemption request and returns the escrowed kTokens to the user</p>
<p><em>This function allows institutions to cancel their redemption requests before the batch is closed or
settled.
The cancellation process involves: (1) validating the request exists and is in PENDING status, (2) checking that
the batch is neither closed nor settled (once closed, cancellation is not possible as the batch is being
processed),
(3) updating the request status to CANCELLED, (4) removing the request from tracking, (5) returning the escrowed
kTokens back to the original requester. This mechanism provides flexibility for institutions to manage their
liquidity needs, allowing them to reverse redemption decisions if market conditions change or if they need
immediate
access to their kTokens. The function enforces strict timing constraints - cancellation is only permitted while
the
batch remains open, ensuring batch integrity and preventing manipulation of settled redemptions.</em></p>
<pre><code class="language-solidity">function cancelRequest(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to cancel (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="rescuereceiverassets"><a class="header" href="#rescuereceiverassets">rescueReceiverAssets</a></h3>
<p>Emergency admin function to recover stuck assets from a batch receiver contract</p>
<p><em>This function provides a recovery mechanism for assets that may become stuck in kBatchReceiver contracts
due to failed redemptions or system errors. The process involves two steps: (1) calling rescueAssets on the
kBatchReceiver to transfer assets back to this contract, and (2) using the inherited rescueAssets function
from kBase to forward them to the specified destination. This two-step process ensures proper access control
and maintains the security model where only authorized contracts can interact with batch receivers. This
function should only be used in emergency situations and requires admin privileges to prevent abuse.</em></p>
<pre><code class="language-solidity">function rescueReceiverAssets(address batchReceiver, address asset, address to, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The address of the kBatchReceiver contract holding the stuck assets</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address of the asset token to rescue (must not be a protocol asset)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address to receive the rescued assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of assets to rescue</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-1"><a class="header" href="#ispaused-1">isPaused</a></h3>
<p>Checks if the contract is currently paused</p>
<p><em>Returns the paused state from the base storage for operational control</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="getredeemrequest"><a class="header" href="#getredeemrequest">getRedeemRequest</a></h3>
<p>Retrieves details of a specific redemption request</p>
<p><em>Returns the complete RedeemRequest struct containing all request information</em></p>
<pre><code class="language-solidity">function getRedeemRequest(bytes32 requestId) external view returns (RedeemRequest memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>RedeemRequest</code></td><td>The complete RedeemRequest struct with status, amounts, and batch information</td></tr>
</tbody></table>
</div>
<h3 id="getuserrequests"><a class="header" href="#getuserrequests">getUserRequests</a></h3>
<p>Gets all redemption request IDs for a specific user</p>
<p><em>Returns request IDs from the user's enumerable set for efficient tracking</em></p>
<pre><code class="language-solidity">function getUserRequests(address user) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The user address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of request IDs belonging to the user</td></tr>
</tbody></table>
</div>
<h3 id="getrequestcounter"><a class="header" href="#getrequestcounter">getRequestCounter</a></h3>
<p>Gets the current request counter value</p>
<p><em>Returns the monotonically increasing counter used for generating unique request IDs</em></p>
<pre><code class="language-solidity">function getRequestCounter() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current counter used for generating unique request IDs</td></tr>
</tbody></table>
</div>
<h3 id="gettotallockedassets"><a class="header" href="#gettotallockedassets">getTotalLockedAssets</a></h3>
<p>Gets the total locked assets for a specific asset</p>
<p><em>Returns the cumulative amount of assets deposited through mint operations for accounting</em></p>
<pre><code class="language-solidity">function getTotalLockedAssets(address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of assets locked in the protocol</td></tr>
</tbody></table>
</div>
<h2 id="events-5"><a class="header" href="#events-5">Events</a></h2>
<h3 id="contractinitialized-1"><a class="header" href="#contractinitialized-1">ContractInitialized</a></h3>
<p>Emitted when the kMinter contract is initialized</p>
<pre><code class="language-solidity">event ContractInitialized(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The address of the registry contract used for protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="minted"><a class="header" href="#minted">Minted</a></h3>
<p>Emitted when kTokens are successfully minted for an institution</p>
<pre><code class="language-solidity">event Minted(address indexed to, uint256 amount, bytes32 batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that received the minted kTokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens minted (matches deposited asset amount)</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier where the deposited assets were allocated</td></tr>
</tbody></table>
</div>
<h3 id="redeemrequestcreated"><a class="header" href="#redeemrequestcreated">RedeemRequestCreated</a></h3>
<p>Emitted when a new redemption request is created and enters the batch queue</p>
<pre><code class="language-solidity">event RedeemRequestCreated(
    bytes32 indexed requestId,
    address indexed user,
    address indexed kToken,
    uint256 amount,
    address recipient,
    bytes32 batchId
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier assigned to this redemption request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address that initiated the redemption request</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The kToken contract address being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens being redeemed</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address that will receive the underlying assets</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier this request is associated with</td></tr>
</tbody></table>
</div>
<h3 id="redeemed"><a class="header" href="#redeemed">Redeemed</a></h3>
<p>Emitted when a redemption request is successfully executed after batch settlement</p>
<pre><code class="language-solidity">event Redeemed(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the executed redemption request</td></tr>
</tbody></table>
</div>
<h3 id="cancelled"><a class="header" href="#cancelled">Cancelled</a></h3>
<p>Emitted when a pending redemption request is cancelled before batch closure</p>
<pre><code class="language-solidity">event Cancelled(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the cancelled redemption request</td></tr>
</tbody></table>
</div>
<h2 id="structs-5"><a class="header" href="#structs-5">Structs</a></h2>
<h3 id="redeemrequest"><a class="header" href="#redeemrequest">RedeemRequest</a></h3>
<p>Contains all information related to a redemption request</p>
<p><em>Stored on-chain to track redemption lifecycle and enable proper asset distribution</em></p>
<pre><code class="language-solidity">struct RedeemRequest {
    address user;
    uint256 amount;
    address asset;
    uint64 requestTimestamp;
    RequestStatus status;
    bytes32 batchId;
    address recipient;
}
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="requeststatus"><a class="header" href="#requeststatus">RequestStatus</a></h3>
<p>Represents the lifecycle status of a redemption request</p>
<p><em>Used to track the progression of redemption requests through the batch system</em></p>
<pre><code class="language-solidity">enum RequestStatus {
    PENDING,
    REDEEMED,
    CANCELLED
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikregistry"><a class="header" href="#ikregistry">IkRegistry</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkRegistry.sol">Git Source</a></p>
<h2 id="functions-17"><a class="header" href="#functions-17">Functions</a></h2>
<h3 id="setsingletoncontract"><a class="header" href="#setsingletoncontract">setSingletonContract</a></h3>
<p>Registers a core singleton contract in the protocol</p>
<p><em>Only callable by ADMIN_ROLE. Ensures single source of truth for protocol contracts.</em></p>
<pre><code class="language-solidity">function setSingletonContract(bytes32 id, address contractAddress) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Unique contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>Address of the singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="registerasset"><a class="header" href="#registerasset">registerAsset</a></h3>
<p>Registers a new underlying asset in the protocol and deploys its corresponding kToken</p>
<p><em>This function performs critical asset onboarding: (1) Validates the asset isn't already registered,
(2) Adds asset to the supported set and singleton registry, (3) Deploys a new kToken contract with
matching decimals, (4) Establishes bidirectional asset-kToken mapping, (5) Grants minting privileges
to kMinter. The function automatically inherits decimals from the underlying asset for consistency.
Only callable by ADMIN_ROLE to maintain protocol security and prevent unauthorized token creation.</em></p>
<pre><code class="language-solidity">function registerAsset(
    string memory name,
    string memory symbol,
    address asset,
    bytes32 id
)
    external
    payable
    returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>The name for the kToken (e.g., "KAM USDC")</td></tr>
<tr><td><code>symbol</code></td><td><code>string</code></td><td>The symbol for the kToken (e.g., "kUSDC")</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset contract address to register</td></tr>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>The unique identifier for singleton asset storage (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The deployed kToken contract address</td></tr>
</tbody></table>
</div>
<h3 id="registervault"><a class="header" href="#registervault">registerVault</a></h3>
<p>Registers a new vault contract in the protocol's vault management system</p>
<p><em>This function integrates vaults into the protocol by: (1) Validating the vault isn't already registered,
(2) Verifying the asset is supported by the protocol, (3) Classifying the vault by type for routing,
(4) Establishing vault-asset relationships for both forward and reverse lookups, (5) Setting as primary
vault for the asset-type combination if it's the first registered. The vault type determines routing
logic and strategy selection (DN for institutional, ALPHA/BETA for different risk profiles).
Only callable by ADMIN_ROLE to ensure proper vault vetting and integration.</em></p>
<pre><code class="language-solidity">function registerVault(address vault, VaultType type_, address asset) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to register</td></tr>
<tr><td><code>type_</code></td><td><code>VaultType</code></td><td>The vault classification type (DN, ALPHA, BETA, etc.) determining its role</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address this vault will manage</td></tr>
</tbody></table>
</div>
<h3 id="registeradapter"><a class="header" href="#registeradapter">registerAdapter</a></h3>
<p>Registers an external protocol adapter for a vault</p>
<p><em>Enables yield strategy integrations through external DeFi protocols. Only callable by ADMIN_ROLE.</em></p>
<pre><code class="language-solidity">function registerAdapter(address vault, address adapter) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="removeadapter"><a class="header" href="#removeadapter">removeAdapter</a></h3>
<p>Removes an adapter from a vault's registered adapter set</p>
<p><em>This disables a specific external protocol integration for the vault. Only callable by ADMIN_ROLE
to ensure proper risk assessment before removing yield strategies.</em></p>
<pre><code class="language-solidity">function removeAdapter(address vault, address adapter) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to remove the adapter from</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to remove</td></tr>
</tbody></table>
</div>
<h3 id="grantinstitutionrole"><a class="header" href="#grantinstitutionrole">grantInstitutionRole</a></h3>
<p>Grants institution role to enable privileged protocol access</p>
<p><em>Only callable by VENDOR_ROLE. Institutions gain access to kMinter and other premium features.</em></p>
<pre><code class="language-solidity">function grantInstitutionRole(address institution_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>institution_</code></td><td><code>address</code></td><td>The address to grant institution privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantvendorrole"><a class="header" href="#grantvendorrole">grantVendorRole</a></h3>
<p>Grants vendor role for vendor management capabilities</p>
<p><em>Only callable by ADMIN_ROLE. Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function grantVendorRole(address vendor_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vendor_</code></td><td><code>address</code></td><td>The address to grant vendor privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantrelayerrole"><a class="header" href="#grantrelayerrole">grantRelayerRole</a></h3>
<p>Grants relayer role for external vault operations</p>
<p><em>Only callable by ADMIN_ROLE. Relayers manage external vaults and set hurdle rates.</em></p>
<pre><code class="language-solidity">function grantRelayerRole(address relayer_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>relayer_</code></td><td><code>address</code></td><td>The address to grant relayer privileges</td></tr>
</tbody></table>
</div>
<h3 id="getcontractbyid"><a class="header" href="#getcontractbyid">getContractById</a></h3>
<p>Retrieves a singleton contract address by identifier</p>
<p><em>Reverts if contract not registered. Used for protocol contract discovery.</em></p>
<pre><code class="language-solidity">function getContractById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address</td></tr>
</tbody></table>
</div>
<h3 id="getassetbyid"><a class="header" href="#getassetbyid">getAssetById</a></h3>
<p>Retrieves a singleton asset address by identifier</p>
<p><em>Reverts if asset not registered. Provides named access to common assets.</em></p>
<pre><code class="language-solidity">function getAssetById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Asset identifier (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<h3 id="getallassets"><a class="header" href="#getallassets">getAllAssets</a></h3>
<p>Gets all protocol-supported asset addresses</p>
<p><em>Returns the complete whitelist of supported underlying assets.</em></p>
<pre><code class="language-solidity">function getAllAssets() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of all supported asset addresses</td></tr>
</tbody></table>
</div>
<h3 id="getcorecontracts"><a class="header" href="#getcorecontracts">getCoreContracts</a></h3>
<p>Retrieves core protocol contract addresses in one call</p>
<p><em>Optimized getter for frequently accessed contracts. Reverts if either not set.</em></p>
<pre><code class="language-solidity">function getCoreContracts() external view returns (address kMinter, address kAssetRouter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kMinter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
<tr><td><code>kAssetRouter</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="getvaultsbyasset"><a class="header" href="#getvaultsbyasset">getVaultsByAsset</a></h3>
<p>Gets all vaults that support a specific asset</p>
<p><em>Enables discovery of all vaults capable of handling an asset across different types.</em></p>
<pre><code class="language-solidity">function getVaultsByAsset(address asset) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of vault addresses supporting the asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultbyassetandtype"><a class="header" href="#getvaultbyassetandtype">getVaultByAssetAndType</a></h3>
<p>Retrieves the primary vault for an asset-type combination</p>
<p><em>Used for routing operations to the appropriate vault. Reverts if not found.</em></p>
<pre><code class="language-solidity">function getVaultByAssetAndType(address asset, uint8 vaultType) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>vaultType</code></td><td><code>uint8</code></td><td>The vault type classification</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The vault address for the asset-type pair</td></tr>
</tbody></table>
</div>
<h3 id="getvaulttype"><a class="header" href="#getvaulttype">getVaultType</a></h3>
<p>Gets the classification type of a vault</p>
<p><em>Returns the VaultType enum value for routing and strategy selection.</em></p>
<pre><code class="language-solidity">function getVaultType(address vault) external view returns (uint8);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The vault's type classification</td></tr>
</tbody></table>
</div>
<h3 id="isadmin"><a class="header" href="#isadmin">isAdmin</a></h3>
<p>Checks if an address has admin privileges</p>
<p><em>Admin role has broad protocol management capabilities.</em></p>
<pre><code class="language-solidity">function isAdmin(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isemergencyadmin"><a class="header" href="#isemergencyadmin">isEmergencyAdmin</a></h3>
<p>Checks if an address has emergency admin privileges</p>
<p><em>Emergency admin can perform critical safety operations.</em></p>
<pre><code class="language-solidity">function isEmergencyAdmin(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has EMERGENCY_ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isguardian"><a class="header" href="#isguardian">isGuardian</a></h3>
<p>Checks if an address has guardian privileges</p>
<p><em>Guardian acts as circuit breaker for settlement proposals.</em></p>
<pre><code class="language-solidity">function isGuardian(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has GUARDIAN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isrelayer"><a class="header" href="#isrelayer">isRelayer</a></h3>
<p>Checks if an address has relayer privileges</p>
<p><em>Relayer manages external vault operations and hurdle rates.</em></p>
<pre><code class="language-solidity">function isRelayer(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has RELAYER_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isinstitution"><a class="header" href="#isinstitution">isInstitution</a></h3>
<p>Checks if an address is a qualified institution</p>
<p><em>Institutions have access to privileged operations like kMinter.</em></p>
<pre><code class="language-solidity">function isInstitution(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has INSTITUTION_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isvendor"><a class="header" href="#isvendor">isVendor</a></h3>
<p>Checks if an address has vendor privileges</p>
<p><em>Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function isVendor(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has VENDOR_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isasset"><a class="header" href="#isasset">isAsset</a></h3>
<p>Checks if an asset is supported by the protocol</p>
<p><em>Used for validation before operations. Checks supportedAssets set membership.</em></p>
<pre><code class="language-solidity">function isAsset(address asset) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if asset is in the protocol whitelist</td></tr>
</tbody></table>
</div>
<h3 id="isvault"><a class="header" href="#isvault">isVault</a></h3>
<p>Checks if a vault is registered in the protocol</p>
<p><em>Used for validation before vault operations. Checks allVaults set membership.</em></p>
<pre><code class="language-solidity">function isVault(address vault) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if vault is registered</td></tr>
</tbody></table>
</div>
<h3 id="getadapters"><a class="header" href="#getadapters">getAdapters</a></h3>
<p>Gets all adapters registered for a specific vault</p>
<p><em>Returns external protocol integrations enabling yield strategies.</em></p>
<pre><code class="language-solidity">function getAdapters(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of adapter addresses for the vault</td></tr>
</tbody></table>
</div>
<h3 id="isadapterregistered"><a class="header" href="#isadapterregistered">isAdapterRegistered</a></h3>
<p>Checks if a specific adapter is registered for a vault</p>
<p><em>Used to validate adapter-vault relationships before operations.</em></p>
<pre><code class="language-solidity">function isAdapterRegistered(address vault, address adapter) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to check</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered for the vault</td></tr>
</tbody></table>
</div>
<h3 id="getvaultassets"><a class="header" href="#getvaultassets">getVaultAssets</a></h3>
<p>Gets all assets managed by a specific vault</p>
<p><em>Most vaults manage single asset, some (like kMinter) handle multiple.</em></p>
<pre><code class="language-solidity">function getVaultAssets(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of asset addresses the vault manages</td></tr>
</tbody></table>
</div>
<h3 id="assettoktoken"><a class="header" href="#assettoktoken">assetToKToken</a></h3>
<p>Gets the kToken address for a specific underlying asset</p>
<p><em>Critical for minting/redemption operations. Reverts if no kToken exists.</em></p>
<pre><code class="language-solidity">function assetToKToken(address asset) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="getallvaults"><a class="header" href="#getallvaults">getAllVaults</a></h3>
<p>Gets all registered vaults in the protocol</p>
<p><em>Returns array of all vault addresses that have been registered through addVault().
Includes both active and inactive vaults. Used for protocol monitoring and management operations.</em></p>
<pre><code class="language-solidity">function getAllVaults() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of all registered vault addresses</td></tr>
</tbody></table>
</div>
<h3 id="gettreasury"><a class="header" href="#gettreasury">getTreasury</a></h3>
<p>Gets the protocol treasury address</p>
<p><em>Treasury receives protocol fees and serves as emergency fund holder.</em></p>
<pre><code class="language-solidity">function getTreasury() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The treasury address</td></tr>
</tbody></table>
</div>
<h3 id="sethurdlerate"><a class="header" href="#sethurdlerate">setHurdleRate</a></h3>
<p>Sets the hurdle rate for a specific asset</p>
<p><em>Only relayer can set hurdle rates (performance thresholds). Ensures hurdle rate doesn't exceed 100%.
Asset must be registered before setting hurdle rate. Sets minimum performance threshold for yield distribution.</em></p>
<pre><code class="language-solidity">function setHurdleRate(address asset, uint16 hurdleRate) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to set hurdle rate for</td></tr>
<tr><td><code>hurdleRate</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points (100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="gethurdlerate"><a class="header" href="#gethurdlerate">getHurdleRate</a></h3>
<p>Gets the hurdle rate for a specific asset</p>
<p><em>Returns minimum performance threshold in basis points for yield distribution.
Asset must be registered to query hurdle rate.</em></p>
<pre><code class="language-solidity">function getHurdleRate(address asset) external view returns (uint16);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="removevault"><a class="header" href="#removevault">removeVault</a></h3>
<p>Removes a vault from the protocol registry</p>
<p><em>This function deregisters a vault, removing it from the active vault set. This operation should be
used carefully as it affects routing and asset management. Only callable by ADMIN_ROLE to ensure proper
decommissioning procedures are followed. Note that this doesn't clear all vault mappings for gas efficiency.</em></p>
<pre><code class="language-solidity">function removeVault(address vault) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to remove from the registry</td></tr>
</tbody></table>
</div>
<h3 id="settreasury"><a class="header" href="#settreasury">setTreasury</a></h3>
<p>Sets the treasury address</p>
<p><em>Treasury receives protocol fees and serves as emergency fund holder. Only callable by ADMIN_ROLE.</em></p>
<pre><code class="language-solidity">function setTreasury(address treasury_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>treasury_</code></td><td><code>address</code></td><td>The new treasury address</td></tr>
</tbody></table>
</div>
<h2 id="events-6"><a class="header" href="#events-6">Events</a></h2>
<h3 id="singletoncontractset"><a class="header" href="#singletoncontractset">SingletonContractSet</a></h3>
<p>Emitted when a singleton contract is registered in the protocol</p>
<pre><code class="language-solidity">event SingletonContractSet(bytes32 indexed id, address indexed contractAddress);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>The unique identifier for the contract (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>The address of the registered singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="vaultregistered"><a class="header" href="#vaultregistered">VaultRegistered</a></h3>
<p>Emitted when a new vault is registered in the protocol</p>
<pre><code class="language-solidity">event VaultRegistered(address indexed vault, address indexed asset, VaultType indexed vaultType);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset the vault manages</td></tr>
<tr><td><code>vaultType</code></td><td><code>VaultType</code></td><td>The classification type of the vault</td></tr>
</tbody></table>
</div>
<h3 id="vaultremoved"><a class="header" href="#vaultremoved">VaultRemoved</a></h3>
<p>Emitted when a vault is removed from the protocol</p>
<pre><code class="language-solidity">event VaultRemoved(address indexed vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address being removed</td></tr>
</tbody></table>
</div>
<h3 id="assetregistered"><a class="header" href="#assetregistered">AssetRegistered</a></h3>
<p>Emitted when an asset and its kToken are registered</p>
<pre><code class="language-solidity">event AssetRegistered(address indexed asset, address indexed kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="assetsupported"><a class="header" href="#assetsupported">AssetSupported</a></h3>
<p>Emitted when an asset is added to the supported set</p>
<pre><code class="language-solidity">event AssetSupported(address indexed asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The newly supported asset address</td></tr>
</tbody></table>
</div>
<h3 id="adapterregistered"><a class="header" href="#adapterregistered">AdapterRegistered</a></h3>
<p>Emitted when an adapter is registered for a vault</p>
<pre><code class="language-solidity">event AdapterRegistered(address indexed vault, address indexed adapter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="adapterremoved"><a class="header" href="#adapterremoved">AdapterRemoved</a></h3>
<p>Emitted when an adapter is removed from a vault</p>
<pre><code class="language-solidity">event AdapterRemoved(address indexed vault, address indexed adapter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault losing the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter being removed</td></tr>
</tbody></table>
</div>
<h3 id="ktokendeployed"><a class="header" href="#ktokendeployed">KTokenDeployed</a></h3>
<p>Emitted when a new kToken is deployed</p>
<pre><code class="language-solidity">event KTokenDeployed(address indexed kTokenContract, string name_, string symbol_, uint8 decimals_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kTokenContract</code></td><td><code>address</code></td><td>The deployed kToken address</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>The kToken name</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>The kToken symbol</td></tr>
<tr><td><code>decimals_</code></td><td><code>uint8</code></td><td>The kToken decimals (matches underlying)</td></tr>
</tbody></table>
</div>
<h3 id="ktokenimplementationset"><a class="header" href="#ktokenimplementationset">KTokenImplementationSet</a></h3>
<p>Emitted when the kToken implementation is updated</p>
<pre><code class="language-solidity">event KTokenImplementationSet(address indexed implementation);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>implementation</code></td><td><code>address</code></td><td>The new implementation address</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets-3"><a class="header" href="#rescuedassets-3">RescuedAssets</a></h3>
<p>Emitted when ERC20 assets are rescued from the contract</p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The rescued asset address</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth-3"><a class="header" href="#rescuedeth-3">RescuedETH</a></h3>
<p>Emitted when ETH is rescued from the contract</p>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The recipient address (asset field for consistency)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of ETH rescued</td></tr>
</tbody></table>
</div>
<h3 id="treasuryset"><a class="header" href="#treasuryset">TreasurySet</a></h3>
<p>Emitted when the treasury address is updated</p>
<pre><code class="language-solidity">event TreasurySet(address indexed treasury);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>treasury</code></td><td><code>address</code></td><td>The new treasury address</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerateset"><a class="header" href="#hurdlerateset">HurdleRateSet</a></h3>
<p>Emitted when a hurdle rate is set for an asset</p>
<pre><code class="language-solidity">event HurdleRateSet(address indexed asset, uint16 hurdleRate);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset receiving the hurdle rate</td></tr>
<tr><td><code>hurdleRate</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h2 id="enums-1"><a class="header" href="#enums-1">Enums</a></h2>
<h3 id="vaulttype"><a class="header" href="#vaulttype">VaultType</a></h3>
<pre><code class="language-solidity">enum VaultType {
    MINTER,
    DN,
    ALPHA,
    BETA,
    GAMMA,
    DELTA,
    EPSILON,
    ZETA,
    ETA,
    THETA,
    IOTA,
    KAPPA,
    LAMBDA,
    MU,
    NU,
    XI,
    OMICRON,
    PI,
    RHO,
    SIGMA,
    TAU,
    UPSILON,
    PHI,
    CHI,
    PSI,
    OMEGA,
    VAULT_27,
    VAULT_28,
    VAULT_29,
    VAULT_30,
    VAULT_31,
    VAULT_32,
    VAULT_33,
    VAULT_34,
    VAULT_35,
    VAULT_36,
    VAULT_37,
    VAULT_38,
    VAULT_39,
    VAULT_40,
    VAULT_41,
    VAULT_42,
    VAULT_43,
    VAULT_44,
    VAULT_45,
    VAULT_46,
    VAULT_47,
    VAULT_48,
    VAULT_49,
    VAULT_50,
    VAULT_51,
    VAULT_52,
    VAULT_53,
    VAULT_54,
    VAULT_55,
    VAULT_56,
    VAULT_57,
    VAULT_58,
    VAULT_59,
    VAULT_60,
    VAULT_61,
    VAULT_62,
    VAULT_63,
    VAULT_64,
    VAULT_65,
    VAULT_66,
    VAULT_67,
    VAULT_68,
    VAULT_69,
    VAULT_70,
    VAULT_71,
    VAULT_72,
    VAULT_73,
    VAULT_74,
    VAULT_75,
    VAULT_76,
    VAULT_77,
    VAULT_78,
    VAULT_79,
    VAULT_80,
    VAULT_81,
    VAULT_82,
    VAULT_83,
    VAULT_84,
    VAULT_85,
    VAULT_86,
    VAULT_87,
    VAULT_88,
    VAULT_89,
    VAULT_90,
    VAULT_91,
    VAULT_92,
    VAULT_93,
    VAULT_94,
    VAULT_95,
    VAULT_96,
    VAULT_97,
    VAULT_98,
    VAULT_99,
    VAULT_100,
    VAULT_101,
    VAULT_102,
    VAULT_103,
    VAULT_104,
    VAULT_105,
    VAULT_106,
    VAULT_107,
    VAULT_108,
    VAULT_109,
    VAULT_110,
    VAULT_111,
    VAULT_112,
    VAULT_113,
    VAULT_114,
    VAULT_115,
    VAULT_116,
    VAULT_117,
    VAULT_118,
    VAULT_119,
    VAULT_120,
    VAULT_121,
    VAULT_122,
    VAULT_123,
    VAULT_124,
    VAULT_125,
    VAULT_126,
    VAULT_127,
    VAULT_128,
    VAULT_129,
    VAULT_130,
    VAULT_131,
    VAULT_132,
    VAULT_133,
    VAULT_134,
    VAULT_135,
    VAULT_136,
    VAULT_137,
    VAULT_138,
    VAULT_139,
    VAULT_140,
    VAULT_141,
    VAULT_142,
    VAULT_143,
    VAULT_144,
    VAULT_145,
    VAULT_146,
    VAULT_147,
    VAULT_148,
    VAULT_149,
    VAULT_150,
    VAULT_151,
    VAULT_152,
    VAULT_153,
    VAULT_154,
    VAULT_155,
    VAULT_156,
    VAULT_157,
    VAULT_158,
    VAULT_159,
    VAULT_160,
    VAULT_161,
    VAULT_162,
    VAULT_163,
    VAULT_164,
    VAULT_165,
    VAULT_166,
    VAULT_167,
    VAULT_168,
    VAULT_169,
    VAULT_170,
    VAULT_171,
    VAULT_172,
    VAULT_173,
    VAULT_174,
    VAULT_175,
    VAULT_176,
    VAULT_177,
    VAULT_178,
    VAULT_179,
    VAULT_180,
    VAULT_181,
    VAULT_182,
    VAULT_183,
    VAULT_184,
    VAULT_185,
    VAULT_186,
    VAULT_187,
    VAULT_188,
    VAULT_189,
    VAULT_190,
    VAULT_191,
    VAULT_192,
    VAULT_193,
    VAULT_194,
    VAULT_195,
    VAULT_196,
    VAULT_197,
    VAULT_198,
    VAULT_199,
    VAULT_200,
    VAULT_201,
    VAULT_202,
    VAULT_203,
    VAULT_204,
    VAULT_205,
    VAULT_206,
    VAULT_207,
    VAULT_208,
    VAULT_209,
    VAULT_210,
    VAULT_211,
    VAULT_212,
    VAULT_213,
    VAULT_214,
    VAULT_215,
    VAULT_216,
    VAULT_217,
    VAULT_218,
    VAULT_219,
    VAULT_220,
    VAULT_221,
    VAULT_222,
    VAULT_223,
    VAULT_224,
    VAULT_225,
    VAULT_226,
    VAULT_227,
    VAULT_228,
    VAULT_229,
    VAULT_230,
    VAULT_231,
    VAULT_232,
    VAULT_233,
    VAULT_234,
    VAULT_235,
    VAULT_236,
    VAULT_237,
    VAULT_238,
    VAULT_239,
    VAULT_240,
    VAULT_241,
    VAULT_242,
    VAULT_243,
    VAULT_244,
    VAULT_245,
    VAULT_246,
    VAULT_247,
    VAULT_248,
    VAULT_249,
    VAULT_250,
    VAULT_251,
    VAULT_252,
    VAULT_253,
    VAULT_254,
    VAULT_255
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikstakingvault"><a class="header" href="#ikstakingvault">IkStakingVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkStakingVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/interfaces/IkStakingVault.sol//src/interfaces/IVault.sol/interface.IVault.html">IVault</a>, <a href="src/interfaces/IkStakingVault.sol//src/interfaces/modules/IVaultReader.sol/interface.IVaultReader.html">IVaultReader</a></p>
<p>Comprehensive interface combining retail staking operations with ERC20 share tokens and vault state reading</p>
<p><em>This interface aggregates all kStakingVault functionality by extending IVault (staking/batch/claims/fees) and
IVaultReader (state queries) while adding standard ERC20 operations for stkToken management. The interface provides
a complete view of vault capabilities: (1) Staking Operations: Full request/claim lifecycle for retail users,
(2) Batch Management: Lifecycle control for settlement periods, (3) Share Tokens: Standard ERC20 functionality for
stkTokens that accrue yield, (4) State Reading: Comprehensive vault metrics and calculations, (5) Fee Management:
Performance and management fee configuration. This unified interface enables complete vault interaction through a
single contract, simplifying integration for front-ends and external protocols while maintaining modularity through
interface composition. The combination of vault-specific operations with standard ERC20 compatibility ensures
stkTokens work seamlessly with existing DeFi infrastructure while providing specialized staking functionality.</em></p>
<h2 id="functions-18"><a class="header" href="#functions-18">Functions</a></h2>
<h3 id="owner"><a class="header" href="#owner">owner</a></h3>
<p>Returns the owner of the contract</p>
<pre><code class="language-solidity">function owner() external view returns (address);
</code></pre>
<h3 id="name-2"><a class="header" href="#name-2">name</a></h3>
<p>Returns the name of the token</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<h3 id="symbol"><a class="header" href="#symbol">symbol</a></h3>
<p>Returns the symbol of the token</p>
<pre><code class="language-solidity">function symbol() external view returns (string memory);
</code></pre>
<h3 id="decimals"><a class="header" href="#decimals">decimals</a></h3>
<p>Returns the decimals of the token</p>
<pre><code class="language-solidity">function decimals() external view returns (uint8);
</code></pre>
<h3 id="totalsupply"><a class="header" href="#totalsupply">totalSupply</a></h3>
<p>Returns the total supply of the token</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<h3 id="balanceof"><a class="header" href="#balanceof">balanceOf</a></h3>
<p>Returns the balance of the specified account</p>
<pre><code class="language-solidity">function balanceOf(address account) external view returns (uint256);
</code></pre>
<h3 id="transfer"><a class="header" href="#transfer">transfer</a></h3>
<p>Transfers tokens to the specified recipient</p>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) external returns (bool);
</code></pre>
<h3 id="allowance"><a class="header" href="#allowance">allowance</a></h3>
<p>Returns the remaining allowance that spender has to spend on behalf of owner</p>
<pre><code class="language-solidity">function allowance(address owner, address spender) external view returns (uint256);
</code></pre>
<h3 id="approve"><a class="header" href="#approve">approve</a></h3>
<p>Sets amount as the allowance of spender over the caller's tokens</p>
<pre><code class="language-solidity">function approve(address spender, uint256 amount) external returns (bool);
</code></pre>
<h3 id="transferfrom"><a class="header" href="#transferfrom">transferFrom</a></h3>
<p>Transfers tokens from sender to recipient using the allowance mechanism</p>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) external returns (bool);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="iktoken"><a class="header" href="#iktoken">IkToken</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkToken.sol">Git Source</a></p>
<p>Interface for kToken with role-based minting and burning capabilities</p>
<p><em>Defines the standard interface for kToken implementations with ERC20 compatibility</em></p>
<h2 id="functions-19"><a class="header" href="#functions-19">Functions</a></h2>
<h3 id="mint-1"><a class="header" href="#mint-1">mint</a></h3>
<p>Creates new tokens and assigns them to the specified address</p>
<p><em>Only callable by addresses with MINTER_ROLE, emits Minted event</em></p>
<pre><code class="language-solidity">function mint(address to, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address that will receive the newly minted tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to create and assign</td></tr>
</tbody></table>
</div>
<h3 id="burn"><a class="header" href="#burn">burn</a></h3>
<p>Destroys tokens from the specified address</p>
<p><em>Only callable by addresses with MINTER_ROLE, emits Burned event</em></p>
<pre><code class="language-solidity">function burn(address from, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens will be destroyed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to destroy</td></tr>
</tbody></table>
</div>
<h3 id="burnfrom"><a class="header" href="#burnfrom">burnFrom</a></h3>
<p>Destroys tokens from an address using allowance mechanism</p>
<p><em>Reduces allowance and burns tokens, only callable by addresses with MINTER_ROLE</em></p>
<pre><code class="language-solidity">function burnFrom(address from, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens will be destroyed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to destroy</td></tr>
</tbody></table>
</div>
<h3 id="name-3"><a class="header" href="#name-3">name</a></h3>
<p>Returns the name of the token</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The name of the token as a string</td></tr>
</tbody></table>
</div>
<h3 id="symbol-1"><a class="header" href="#symbol-1">symbol</a></h3>
<p>Returns the symbol of the token</p>
<pre><code class="language-solidity">function symbol() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The symbol of the token as a string</td></tr>
</tbody></table>
</div>
<h3 id="decimals-1"><a class="header" href="#decimals-1">decimals</a></h3>
<p>Returns the number of decimal places for the token</p>
<pre><code class="language-solidity">function decimals() external view returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The number of decimal places as uint8</td></tr>
</tbody></table>
</div>
<h3 id="totalsupply-1"><a class="header" href="#totalsupply-1">totalSupply</a></h3>
<p>Returns the total amount of tokens in existence</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total supply of tokens</td></tr>
</tbody></table>
</div>
<h3 id="balanceof-1"><a class="header" href="#balanceof-1">balanceOf</a></h3>
<p>Returns the token balance of a specific account</p>
<pre><code class="language-solidity">function balanceOf(address account) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account</code></td><td><code>address</code></td><td>The address to query the balance for</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The token balance of the specified account</td></tr>
</tbody></table>
</div>
<h3 id="transfer-1"><a class="header" href="#transfer-1">transfer</a></h3>
<p>Transfers tokens from the caller to another address</p>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to transfer tokens to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens to transfer</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the transfer succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="allowance-1"><a class="header" href="#allowance-1">allowance</a></h3>
<p>Returns the amount of tokens that spender is allowed to spend on behalf of owner</p>
<pre><code class="language-solidity">function allowance(address owner, address spender) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The address that owns the tokens</td></tr>
<tr><td><code>spender</code></td><td><code>address</code></td><td>The address that is approved to spend the tokens</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The amount of tokens the spender is allowed to spend</td></tr>
</tbody></table>
</div>
<h3 id="approve-1"><a class="header" href="#approve-1">approve</a></h3>
<p>Sets approval for another address to spend tokens on behalf of the caller</p>
<pre><code class="language-solidity">function approve(address spender, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>spender</code></td><td><code>address</code></td><td>The address that is approved to spend the tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens the spender is approved to spend</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the approval succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="transferfrom-1"><a class="header" href="#transferfrom-1">transferFrom</a></h3>
<p>Transfers tokens from one address to another using allowance mechanism</p>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address to transfer tokens from</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to transfer tokens to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens to transfer</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the transfer succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-2"><a class="header" href="#ispaused-2">isPaused</a></h3>
<p>Returns the current pause state of the contract</p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-1"><a class="header" href="#setpaused-1">setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Only callable by addresses with EMERGENCY_ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function setPaused(bool _isPaused) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isPaused</code></td><td><code>bool</code></td><td>True to pause the contract, false to unpause</td></tr>
</tbody></table>
</div>
<h3 id="grantadminrole"><a class="header" href="#grantadminrole">grantAdminRole</a></h3>
<p>Grants administrative privileges to an address</p>
<p><em>Only callable by the contract owner</em></p>
<pre><code class="language-solidity">function grantAdminRole(address admin) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to grant admin role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeadminrole"><a class="header" href="#revokeadminrole">revokeAdminRole</a></h3>
<p>Revokes administrative privileges from an address</p>
<p><em>Only callable by the contract owner</em></p>
<pre><code class="language-solidity">function revokeAdminRole(address admin) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to revoke admin role from</td></tr>
</tbody></table>
</div>
<h3 id="grantemergencyrole"><a class="header" href="#grantemergencyrole">grantEmergencyRole</a></h3>
<p>Grants emergency administrative privileges to an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function grantEmergencyRole(address emergency) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to grant emergency admin role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeemergencyrole"><a class="header" href="#revokeemergencyrole">revokeEmergencyRole</a></h3>
<p>Revokes emergency administrative privileges from an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function revokeEmergencyRole(address emergency) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to revoke emergency admin role from</td></tr>
</tbody></table>
</div>
<h3 id="grantminterrole"><a class="header" href="#grantminterrole">grantMinterRole</a></h3>
<p>Grants minting privileges to an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function grantMinterRole(address minter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address to grant minter role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeminterrole"><a class="header" href="#revokeminterrole">revokeMinterRole</a></h3>
<p>Revokes minting privileges from an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function revokeMinterRole(address minter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address to revoke minter role from</td></tr>
</tbody></table>
</div>
<h3 id="contractname-2"><a class="header" href="#contractname-2">contractName</a></h3>
<p>Returns the name identifier for this contract type</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-2"><a class="header" href="#contractversion-2">contractVersion</a></h3>
<p>Returns the version identifier for this contract</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="contents-6"><a class="header" href="#contents-6">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault//src/kStakingVault/base">base</a></li>
<li><a href="src/kStakingVault//src/kStakingVault/modules">modules</a></li>
<li><a href="src/kStakingVault//src/kStakingVault/types">types</a></li>
<li><a href="src/kStakingVault/kStakingVault.sol/contract.kStakingVault.html">kStakingVault</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-7"><a class="header" href="#contents-7">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/base/BaseVault.sol/abstract.BaseVault.html">BaseVault</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basevault"><a class="header" href="#basevault">BaseVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kStakingVault/base/BaseVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/base/BaseVault.sol//src/vendor/ERC20.sol/abstract.ERC20.html">ERC20</a>, <a href="src/kStakingVault/base/BaseVault.sol//src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></p>
<p>Foundation contract providing essential shared functionality for all kStakingVault implementations</p>
<p><em>This abstract contract serves as the architectural foundation for the retail staking system, establishing
critical patterns and utilities that ensure consistency across vault implementations. Key responsibilities include:
(1) ERC-7201 namespaced storage preventing upgrade collisions while enabling safe inheritance, (2) Registry
integration for protocol-wide configuration and role-based access control, (3) Share accounting mathematics
for accurate conversion between assets and stkTokens, (4) Fee calculation framework supporting management and
performance fees with hurdle rate mechanisms, (5) Batch processing coordination for gas-efficient settlement,
(6) Virtual balance tracking for pending operations and accurate share price calculations. The contract employs
optimized storage packing in the config field to minimize gas costs while maintaining extensive configurability.
Mathematical operations use the OptimizedFixedPointMathLib for precision and overflow protection in share
calculations. All inheriting vault implementations leverage these utilities to maintain protocol integrity
while reducing code duplication and ensuring consistent behavior across the vault network.</em></p>
<h2 id="state-variables-5"><a class="header" href="#state-variables-5">State Variables</a></h2>
<h3 id="k_asset_router-2"><a class="header" href="#k_asset_router-2">K_ASSET_ROUTER</a></h3>
<p>kAssetRouter key</p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="k_minter-1"><a class="header" href="#k_minter-1">K_MINTER</a></h3>
<p>kMinter key</p>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="decimals_mask"><a class="header" href="#decimals_mask">DECIMALS_MASK</a></h3>
<p><em>Bitmask and shift constants for module configuration</em></p>
<pre><code class="language-solidity">uint256 internal constant DECIMALS_MASK = 0xFF;
</code></pre>
<h3 id="decimals_shift"><a class="header" href="#decimals_shift">DECIMALS_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant DECIMALS_SHIFT = 0;
</code></pre>
<h3 id="performance_fee_mask"><a class="header" href="#performance_fee_mask">PERFORMANCE_FEE_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant PERFORMANCE_FEE_MASK = 0xFFFF;
</code></pre>
<h3 id="performance_fee_shift"><a class="header" href="#performance_fee_shift">PERFORMANCE_FEE_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant PERFORMANCE_FEE_SHIFT = 8;
</code></pre>
<h3 id="management_fee_mask"><a class="header" href="#management_fee_mask">MANAGEMENT_FEE_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant MANAGEMENT_FEE_MASK = 0xFFFF;
</code></pre>
<h3 id="management_fee_shift"><a class="header" href="#management_fee_shift">MANAGEMENT_FEE_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant MANAGEMENT_FEE_SHIFT = 24;
</code></pre>
<h3 id="initialized_mask"><a class="header" href="#initialized_mask">INITIALIZED_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant INITIALIZED_MASK = 0x1;
</code></pre>
<h3 id="initialized_shift"><a class="header" href="#initialized_shift">INITIALIZED_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant INITIALIZED_SHIFT = 40;
</code></pre>
<h3 id="paused_mask"><a class="header" href="#paused_mask">PAUSED_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant PAUSED_MASK = 0x1;
</code></pre>
<h3 id="paused_shift"><a class="header" href="#paused_shift">PAUSED_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant PAUSED_SHIFT = 41;
</code></pre>
<h3 id="is_hard_hurdle_rate_mask"><a class="header" href="#is_hard_hurdle_rate_mask">IS_HARD_HURDLE_RATE_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant IS_HARD_HURDLE_RATE_MASK = 0x1;
</code></pre>
<h3 id="is_hard_hurdle_rate_shift"><a class="header" href="#is_hard_hurdle_rate_shift">IS_HARD_HURDLE_RATE_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant IS_HARD_HURDLE_RATE_SHIFT = 42;
</code></pre>
<h3 id="last_fees_charged_management_mask"><a class="header" href="#last_fees_charged_management_mask">LAST_FEES_CHARGED_MANAGEMENT_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant LAST_FEES_CHARGED_MANAGEMENT_MASK = 0xFFFFFFFFFFFFFFFF;
</code></pre>
<h3 id="last_fees_charged_management_shift"><a class="header" href="#last_fees_charged_management_shift">LAST_FEES_CHARGED_MANAGEMENT_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant LAST_FEES_CHARGED_MANAGEMENT_SHIFT = 43;
</code></pre>
<h3 id="last_fees_charged_performance_mask"><a class="header" href="#last_fees_charged_performance_mask">LAST_FEES_CHARGED_PERFORMANCE_MASK</a></h3>
<pre><code class="language-solidity">uint256 internal constant LAST_FEES_CHARGED_PERFORMANCE_MASK = 0xFFFFFFFFFFFFFFFF;
</code></pre>
<h3 id="last_fees_charged_performance_shift"><a class="header" href="#last_fees_charged_performance_shift">LAST_FEES_CHARGED_PERFORMANCE_SHIFT</a></h3>
<pre><code class="language-solidity">uint256 internal constant LAST_FEES_CHARGED_PERFORMANCE_SHIFT = 107;
</code></pre>
<h3 id="module_base_storage_location"><a class="header" href="#module_base_storage_location">MODULE_BASE_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 internal constant MODULE_BASE_STORAGE_LOCATION =
    0x50bc60b877273d55cac3903fd4818902e5fd7aa256278ee2dc6b212f256c0b00;
</code></pre>
<h2 id="functions-20"><a class="header" href="#functions-20">Functions</a></h2>
<h3 id="_getbasevaultstorage"><a class="header" href="#_getbasevaultstorage">_getBaseVaultStorage</a></h3>
<p>Returns the base vault storage struct using ERC-7201 pattern</p>
<pre><code class="language-solidity">function _getBaseVaultStorage() internal pure returns (BaseVaultStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>BaseVaultStorage</code></td><td>Storage reference for base vault state variables</td></tr>
</tbody></table>
</div>
<h3 id="_getdecimals"><a class="header" href="#_getdecimals">_getDecimals</a></h3>
<pre><code class="language-solidity">function _getDecimals(BaseVaultStorage storage $) internal view returns (uint8);
</code></pre>
<h3 id="_setdecimals"><a class="header" href="#_setdecimals">_setDecimals</a></h3>
<pre><code class="language-solidity">function _setDecimals(BaseVaultStorage storage $, uint8 value) internal;
</code></pre>
<h3 id="_gethurdlerate"><a class="header" href="#_gethurdlerate">_getHurdleRate</a></h3>
<pre><code class="language-solidity">function _getHurdleRate(BaseVaultStorage storage $) internal view returns (uint16);
</code></pre>
<h3 id="_getperformancefee"><a class="header" href="#_getperformancefee">_getPerformanceFee</a></h3>
<pre><code class="language-solidity">function _getPerformanceFee(BaseVaultStorage storage $) internal view returns (uint16);
</code></pre>
<h3 id="_setperformancefee"><a class="header" href="#_setperformancefee">_setPerformanceFee</a></h3>
<pre><code class="language-solidity">function _setPerformanceFee(BaseVaultStorage storage $, uint16 value) internal;
</code></pre>
<h3 id="_getmanagementfee"><a class="header" href="#_getmanagementfee">_getManagementFee</a></h3>
<pre><code class="language-solidity">function _getManagementFee(BaseVaultStorage storage $) internal view returns (uint16);
</code></pre>
<h3 id="_setmanagementfee"><a class="header" href="#_setmanagementfee">_setManagementFee</a></h3>
<pre><code class="language-solidity">function _setManagementFee(BaseVaultStorage storage $, uint16 value) internal;
</code></pre>
<h3 id="_getinitialized"><a class="header" href="#_getinitialized">_getInitialized</a></h3>
<pre><code class="language-solidity">function _getInitialized(BaseVaultStorage storage $) internal view returns (bool);
</code></pre>
<h3 id="_setinitialized"><a class="header" href="#_setinitialized">_setInitialized</a></h3>
<pre><code class="language-solidity">function _setInitialized(BaseVaultStorage storage $, bool value) internal;
</code></pre>
<h3 id="_getpaused"><a class="header" href="#_getpaused">_getPaused</a></h3>
<pre><code class="language-solidity">function _getPaused(BaseVaultStorage storage $) internal view returns (bool);
</code></pre>
<h3 id="_setpaused"><a class="header" href="#_setpaused">_setPaused</a></h3>
<pre><code class="language-solidity">function _setPaused(BaseVaultStorage storage $, bool value) internal;
</code></pre>
<h3 id="_getishardhurdlerate"><a class="header" href="#_getishardhurdlerate">_getIsHardHurdleRate</a></h3>
<pre><code class="language-solidity">function _getIsHardHurdleRate(BaseVaultStorage storage $) internal view returns (bool);
</code></pre>
<h3 id="_setishardhurdlerate"><a class="header" href="#_setishardhurdlerate">_setIsHardHurdleRate</a></h3>
<pre><code class="language-solidity">function _setIsHardHurdleRate(BaseVaultStorage storage $, bool value) internal;
</code></pre>
<h3 id="_getlastfeeschargedmanagement"><a class="header" href="#_getlastfeeschargedmanagement">_getLastFeesChargedManagement</a></h3>
<pre><code class="language-solidity">function _getLastFeesChargedManagement(BaseVaultStorage storage $) internal view returns (uint64);
</code></pre>
<h3 id="_setlastfeeschargedmanagement"><a class="header" href="#_setlastfeeschargedmanagement">_setLastFeesChargedManagement</a></h3>
<pre><code class="language-solidity">function _setLastFeesChargedManagement(BaseVaultStorage storage $, uint64 value) internal;
</code></pre>
<h3 id="_getlastfeeschargedperformance"><a class="header" href="#_getlastfeeschargedperformance">_getLastFeesChargedPerformance</a></h3>
<pre><code class="language-solidity">function _getLastFeesChargedPerformance(BaseVaultStorage storage $) internal view returns (uint64);
</code></pre>
<h3 id="_setlastfeeschargedperformance"><a class="header" href="#_setlastfeeschargedperformance">_setLastFeesChargedPerformance</a></h3>
<pre><code class="language-solidity">function _setLastFeesChargedPerformance(BaseVaultStorage storage $, uint64 value) internal;
</code></pre>
<h3 id="__basevault_init"><a class="header" href="#__basevault_init">__BaseVault_init</a></h3>
<p>Initializes the base vault foundation with registry integration and operational state</p>
<p><em>This internal initialization function establishes the core foundation for all vault implementations.
The initialization process: (1) Validates single initialization to prevent reinitialization attacks in proxy
patterns, (2) Ensures registry address is valid since all protocol operations depend on it, (3) Sets initial
operational state enabling normal vault operations or emergency pause, (4) Initializes fee tracking timestamps
to current block time for accurate fee accrual calculations, (5) Marks initialization complete to prevent
future calls. The registry serves as the single source of truth for protocol configuration, role management,
and contract discovery. Fee timestamps are initialized to prevent immediate fee charges on new vaults.</em></p>
<pre><code class="language-solidity">function __BaseVault_init(address registry_, bool paused_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address providing protocol configuration and role management</td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial operational state (true = paused, false = active)</td></tr>
</tbody></table>
</div>
<h3 id="_registry-2"><a class="header" href="#_registry-2">_registry</a></h3>
<p>Returns the registry contract interface</p>
<p><em>Internal helper for typed registry access</em></p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getkminter-1"><a class="header" href="#_getkminter-1">_getKMinter</a></h3>
<p>Gets the kMinter singleton contract address</p>
<p><em>Reverts if kMinter not set in registry</em></p>
<pre><code class="language-solidity">function _getKMinter() internal view returns (address minter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter-1"><a class="header" href="#_getkassetrouter-1">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<p><em>Reverts if kAssetRouter not set in registry</em></p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="name-4"><a class="header" href="#name-4">name</a></h3>
<p>Returns the vault shares token name</p>
<pre><code class="language-solidity">function name() public view override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Token name</td></tr>
</tbody></table>
</div>
<h3 id="symbol-2"><a class="header" href="#symbol-2">symbol</a></h3>
<p>Returns the vault shares token symbol</p>
<pre><code class="language-solidity">function symbol() public view override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Token symbol</td></tr>
</tbody></table>
</div>
<h3 id="decimals-2"><a class="header" href="#decimals-2">decimals</a></h3>
<pre><code class="language-solidity">function decimals() public view override returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>Token decimals</td></tr>
</tbody></table>
</div>
<h3 id="_setpaused-1"><a class="header" href="#_setpaused-1">_setPaused</a></h3>
<p>Updates the vault's operational pause state for emergency risk management</p>
<p><em>This internal function enables vault implementations to halt operations during emergencies or maintenance.
The pause mechanism: (1) Validates vault initialization to prevent invalid state changes, (2) Updates the
packed config storage with new pause state, (3) Emits event for monitoring and user notification. When paused,
state-changing operations should be blocked while view functions remain accessible for monitoring. The pause
state is stored in packed config for gas efficiency. This function provides the foundation for emergency
controls while maintaining transparency through event emission.</em></p>
<pre><code class="language-solidity">function _setPaused(bool paused_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The desired pause state (true = halt operations, false = resume normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="_converttoassets"><a class="header" href="#_converttoassets">_convertToAssets</a></h3>
<p>Converts stkToken shares to underlying asset value based on current vault performance</p>
<p><em>This function implements the core share accounting mechanism that determines asset value for stkToken
holders. The conversion process: (1) Handles edge case where total supply is zero by returning 1:1 conversion,
(2) Uses precise fixed-point math to calculate proportional asset value based on share ownership percentage,
(3) Applies current total net assets (after fees) to ensure accurate user valuations. The calculation
maintains precision through fullMulDiv to prevent rounding errors that could accumulate over time. This
function is critical for determining redemption values, share price calculations, and user balance queries.</em></p>
<pre><code class="language-solidity">function _convertToAssets(uint256 shares) internal view returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The quantity of stkTokens to convert to underlying asset terms</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The equivalent value in underlying assets based on current vault performance</td></tr>
</tbody></table>
</div>
<h3 id="_converttoshares"><a class="header" href="#_converttoshares">_convertToShares</a></h3>
<p>Converts underlying asset amount to equivalent stkToken shares at current vault valuation</p>
<p><em>This function determines how many stkTokens should be issued for a given asset deposit based on current
vault performance. The conversion process: (1) Handles edge case of zero total supply with 1:1 initial pricing,
(2) Calculates proportional share amount based on current vault valuation and total outstanding shares,
(3) Uses total net assets to ensure new shares are priced fairly relative to existing holders. The precise
fixed-point mathematics prevent dilution attacks and ensure fair pricing for all participants. This function
is essential for determining share issuance during staking operations and maintaining equitable vault ownership.</em></p>
<pre><code class="language-solidity">function _convertToShares(uint256 assets) internal view returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The underlying asset amount to convert to share terms</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The equivalent stkToken amount based on current share price</td></tr>
</tbody></table>
</div>
<h3 id="_netshareprice"><a class="header" href="#_netshareprice">_netSharePrice</a></h3>
<p>Calculates net share price per stkToken after deducting accumulated fees</p>
<p><em>This function provides the user-facing share price that reflects actual value after management and
performance fee deductions. The calculation: (1) Uses vault decimals for proper scaling to match token
precision, (2) Calls _convertToAssets with unit share amount to determine per-token value, (3) Reflects
total net assets which exclude accrued but unpaid fees. This net pricing ensures users see accurate
value after all fee obligations, providing transparent visibility into their true vault position value.
Used primarily for user-facing calculations and accurate balance reporting.</em></p>
<pre><code class="language-solidity">function _netSharePrice() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net price per stkToken in underlying asset terms (scaled to vault decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_shareprice"><a class="header" href="#_shareprice">_sharePrice</a></h3>
<p>Calculates gross share price per stkToken including accumulated fees</p>
<p><em>This function provides the total vault performance-based share price before fee deductions. The
calculation:
(1) Handles zero total supply edge case with 1:1 initial pricing, (2) Uses total gross assets including accrued
fees for complete performance measurement, (3) Applies precise fixed-point mathematics for accurate pricing.
This gross pricing is used for settlement calculations, performance fee assessments, and watermark tracking.
The inclusion of fees provides complete vault performance measurement for fee calculations and settlement
coordination.</em></p>
<pre><code class="language-solidity">function _sharePrice() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Gross price per stkToken in underlying asset terms (scaled to vault decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_totalassets"><a class="header" href="#_totalassets">_totalAssets</a></h3>
<p>Calculates total assets under management including pending stakes and accrued yields</p>
<p><em>This function determines the complete asset base managed by the vault for share price calculations.
The calculation: (1) Starts with total kToken balance held by the vault contract, (2) Subtracts pending
stakes that haven't yet been converted to stkTokens to avoid double-counting during settlement periods,
(3) Includes all accrued yields and performance gains. The pending stake adjustment is crucial for accurate
share pricing during batch processing periods when assets are deposited but shares haven't been issued.
This total forms the basis for both gross and net share price calculations.</em></p>
<pre><code class="language-solidity">function _totalAssets() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total asset value managed by the vault including yields but excluding pending operations</td></tr>
</tbody></table>
</div>
<h3 id="_totalnetassets"><a class="header" href="#_totalnetassets">_totalNetAssets</a></h3>
<p>Calculates net assets available to users after deducting accumulated fees</p>
<p><em>This function provides the user-facing asset value by removing management and performance fee obligations.
The calculation: (1) Takes total gross assets as the starting point, (2) Subtracts accumulated fees calculated
by the fee computation module, (3) Results in the net value attributable to stkToken holders. This net asset
calculation is critical for fair share pricing, ensuring new entrants pay appropriate prices and existing
holders receive accurate valuations. The fee deduction prevents users from claiming value that belongs to
vault operators through fee mechanisms.</em></p>
<pre><code class="language-solidity">function _totalNetAssets() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net asset value available to users after all fee deductions</td></tr>
</tbody></table>
</div>
<h3 id="_accumulatedfees"><a class="header" href="#_accumulatedfees">_accumulatedFees</a></h3>
<p>Delegates fee calculation to the vault reader module for comprehensive fee computation</p>
<p><em>This function serves as a gateway to the modular fee calculation system implemented in the vault reader.
The delegation pattern: (1) Calls the reader module which implements detailed fee calculation logic including
management fee accrual and performance fee assessment, (2) Returns total accumulated fees for asset
calculations,
(3) Maintains separation of concerns by isolating complex fee logic in dedicated modules. The reader module
handles time-based management fees, watermark-based performance fees, and hurdle rate calculations.
This modular approach enables upgradeable fee calculation logic while maintaining consistent interfaces.</em></p>
<pre><code class="language-solidity">function _accumulatedFees() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total accumulated fees (management + performance) in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="_isadmin-2"><a class="header" href="#_isadmin-2">_isAdmin</a></h3>
<p>Validates admin role permissions for vault configuration and emergency functions</p>
<p><em>Queries the protocol registry to verify admin status for access control. Admins can execute
critical vault management functions including fee parameter changes and emergency interventions.</em></p>
<pre><code class="language-solidity">function _isAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to validate for admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the address is registered as an admin in the protocol registry</td></tr>
</tbody></table>
</div>
<h3 id="_isemergencyadmin-1"><a class="header" href="#_isemergencyadmin-1">_isEmergencyAdmin</a></h3>
<p>Validates emergency admin role for critical pause/unpause operations</p>
<p><em>Emergency admins have elevated privileges to halt vault operations during security incidents
or market anomalies. This role provides rapid response capability for risk management.</em></p>
<pre><code class="language-solidity">function _isEmergencyAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to validate for emergency admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the address is registered as an emergency admin in the protocol registry</td></tr>
</tbody></table>
</div>
<h3 id="_isrelayer-1"><a class="header" href="#_isrelayer-1">_isRelayer</a></h3>
<p>Validates relayer role for automated batch processing operations</p>
<p><em>Relayers execute scheduled operations including batch creation, closure, and settlement
coordination. This role enables automation while maintaining security through limited permissions.</em></p>
<pre><code class="language-solidity">function _isRelayer(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to validate for relayer privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the address is registered as a relayer in the protocol registry</td></tr>
</tbody></table>
</div>
<h3 id="_iskassetrouter-1"><a class="header" href="#_iskassetrouter-1">_isKAssetRouter</a></h3>
<p>Validates kAssetRouter contract identity for settlement coordination</p>
<p><em>Only the protocol's kAssetRouter singleton can trigger vault settlements and coordinate
cross-vault asset flows. This validation ensures settlement integrity and prevents unauthorized access.</em></p>
<pre><code class="language-solidity">function _isKAssetRouter(address kAssetRouter_) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kAssetRouter_</code></td><td><code>address</code></td><td>The address to validate against the registered kAssetRouter</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the address matches the registered kAssetRouter contract</td></tr>
</tbody></table>
</div>
<h2 id="events-7"><a class="header" href="#events-7">Events</a></h2>
<h3 id="stakerequestcreated"><a class="header" href="#stakerequestcreated">StakeRequestCreated</a></h3>
<p>Emitted when a stake request is created</p>
<pre><code class="language-solidity">event StakeRequestCreated(
    bytes32 indexed requestId,
    address indexed user,
    address indexed kToken,
    uint256 amount,
    address recipient,
    bytes32 batchId
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address of the user who created the request</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The address of the kToken associated with the request</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens requested</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address to which the kTokens will be sent</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID associated with the request</td></tr>
</tbody></table>
</div>
<h3 id="stakerequestredeemed"><a class="header" href="#stakerequestredeemed">StakeRequestRedeemed</a></h3>
<p>Emitted when a stake request is redeemed</p>
<pre><code class="language-solidity">event StakeRequestRedeemed(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
</tbody></table>
</div>
<h3 id="stakerequestcancelled"><a class="header" href="#stakerequestcancelled">StakeRequestCancelled</a></h3>
<p>Emitted when a stake request is cancelled</p>
<pre><code class="language-solidity">event StakeRequestCancelled(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
</tbody></table>
</div>
<h3 id="unstakerequestcreated"><a class="header" href="#unstakerequestcreated">UnstakeRequestCreated</a></h3>
<p>Emitted when an unstake request is created</p>
<pre><code class="language-solidity">event UnstakeRequestCreated(
    bytes32 indexed requestId, address indexed user, uint256 amount, address recipient, bytes32 batchId
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the unstake request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address of the user who created the request</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens requested</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address to which the kTokens will be sent</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID associated with the request</td></tr>
</tbody></table>
</div>
<h3 id="unstakerequestcancelled"><a class="header" href="#unstakerequestcancelled">UnstakeRequestCancelled</a></h3>
<p>Emitted when an unstake request is cancelled</p>
<pre><code class="language-solidity">event UnstakeRequestCancelled(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the unstake request</td></tr>
</tbody></table>
</div>
<h3 id="paused-1"><a class="header" href="#paused-1">Paused</a></h3>
<p>Emitted when the vault is paused</p>
<pre><code class="language-solidity">event Paused(bool paused);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused</code></td><td><code>bool</code></td><td>The new paused state</td></tr>
</tbody></table>
</div>
<h3 id="initialized"><a class="header" href="#initialized">Initialized</a></h3>
<p>Emitted when the vault is initialized</p>
<pre><code class="language-solidity">event Initialized(address registry, string name, string symbol, uint8 decimals, address asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The registry address</td></tr>
<tr><td><code>name</code></td><td><code>string</code></td><td>The name of the vault</td></tr>
<tr><td><code>symbol</code></td><td><code>string</code></td><td>The symbol of the vault</td></tr>
<tr><td><code>decimals</code></td><td><code>uint8</code></td><td>The decimals of the vault</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset of the vault</td></tr>
</tbody></table>
</div>
<h2 id="structs-6"><a class="header" href="#structs-6">Structs</a></h2>
<h3 id="basevaultstorage"><a class="header" href="#basevaultstorage">BaseVaultStorage</a></h3>
<p><strong>Note:</strong>
storage-location: erc7201.kam.storage.BaseVault</p>
<pre><code class="language-solidity">struct BaseVaultStorage {
    uint256 config;
    uint128 sharePriceWatermark;
    uint128 totalPendingStake;
    uint256 currentBatch;
    bytes32 currentBatchId;
    address registry;
    address receiverImplementation;
    address underlyingAsset;
    address kToken;
    string name;
    string symbol;
    mapping(bytes32 =&gt; BaseVaultTypes.BatchInfo) batches;
    mapping(bytes32 =&gt; BaseVaultTypes.StakeRequest) stakeRequests;
    mapping(bytes32 =&gt; BaseVaultTypes.UnstakeRequest) unstakeRequests;
    mapping(address =&gt; OptimizedBytes32EnumerableSetLib.Bytes32Set) userRequests;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-8"><a class="header" href="#contents-8">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/modules/ReaderModule.sol/contract.ReaderModule.html">ReaderModule</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="readermodule"><a class="header" href="#readermodule">ReaderModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kStakingVault/modules/ReaderModule.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/modules/ReaderModule.sol//src/kStakingVault/base/BaseVault.sol/abstract.BaseVault.html">BaseVault</a>, <a href="src/kStakingVault/modules/ReaderModule.sol//src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></p>
<p>Contains all the public getters for the Staking Vault</p>
<h2 id="state-variables-6"><a class="header" href="#state-variables-6">State Variables</a></h2>
<h3 id="management_fee_interval"><a class="header" href="#management_fee_interval">MANAGEMENT_FEE_INTERVAL</a></h3>
<p>Interval for management fee (1 month)</p>
<pre><code class="language-solidity">uint256 constant MANAGEMENT_FEE_INTERVAL = 657_436;
</code></pre>
<h3 id="performance_fee_interval"><a class="header" href="#performance_fee_interval">PERFORMANCE_FEE_INTERVAL</a></h3>
<p>Interval for performance fee (3 months)</p>
<pre><code class="language-solidity">uint256 constant PERFORMANCE_FEE_INTERVAL = 7_889_238;
</code></pre>
<h3 id="max_bps"><a class="header" href="#max_bps">MAX_BPS</a></h3>
<p>Maximum basis points</p>
<pre><code class="language-solidity">uint256 constant MAX_BPS = 10_000;
</code></pre>
<h3 id="secs_per_year"><a class="header" href="#secs_per_year">SECS_PER_YEAR</a></h3>
<p>Number of seconds in a year</p>
<pre><code class="language-solidity">uint256 constant SECS_PER_YEAR = 31_556_952;
</code></pre>
<h2 id="functions-21"><a class="header" href="#functions-21">Functions</a></h2>
<h3 id="registry-3"><a class="header" href="#registry-3">registry</a></h3>
<p>GENERAL</p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<h3 id="asset-2"><a class="header" href="#asset-2">asset</a></h3>
<p>Returns the underlying asset address (for compatibility)</p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="underlyingasset-1"><a class="header" href="#underlyingasset-1">underlyingAsset</a></h3>
<p>Returns the underlying asset address</p>
<pre><code class="language-solidity">function underlyingAsset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="computelastbatchfees-1"><a class="header" href="#computelastbatchfees-1">computeLastBatchFees</a></h3>
<p>FEES</p>
<p>Computes the last fee batch</p>
<pre><code class="language-solidity">function computeLastBatchFees()
    external
    view
    returns (uint256 managementFees, uint256 performanceFees, uint256 totalFees);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>managementFees</code></td><td><code>uint256</code></td><td>The management fees for the last batch</td></tr>
<tr><td><code>performanceFees</code></td><td><code>uint256</code></td><td>The performance fees for the last batch</td></tr>
<tr><td><code>totalFees</code></td><td><code>uint256</code></td><td>The total fees for the last batch</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedmanagement-1"><a class="header" href="#lastfeeschargedmanagement-1">lastFeesChargedManagement</a></h3>
<p>Returns the last time management fees were charged</p>
<pre><code class="language-solidity">function lastFeesChargedManagement() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>lastFeesChargedManagement Timestamp of last management fee charge</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedperformance-1"><a class="header" href="#lastfeeschargedperformance-1">lastFeesChargedPerformance</a></h3>
<p>Returns the last time performance fees were charged</p>
<pre><code class="language-solidity">function lastFeesChargedPerformance() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>lastFeesChargedPerformance Timestamp of last performance fee charge</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerate-1"><a class="header" href="#hurdlerate-1">hurdleRate</a></h3>
<p>Returns the current hurdle rate used for performance fee calculations</p>
<pre><code class="language-solidity">function hurdleRate() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points (e.g., 500 = 5%)</td></tr>
</tbody></table>
</div>
<h3 id="performancefee-1"><a class="header" href="#performancefee-1">performanceFee</a></h3>
<p>Returns the current performance fee percentage</p>
<pre><code class="language-solidity">function performanceFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The performance fee in basis points (e.g., 2000 = 20%)</td></tr>
</tbody></table>
</div>
<h3 id="nextperformancefeetimestamp-1"><a class="header" href="#nextperformancefeetimestamp-1">nextPerformanceFeeTimestamp</a></h3>
<p>Returns the next performance fee timestamp so the backend can schedule the fee collection</p>
<pre><code class="language-solidity">function nextPerformanceFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The next performance fee timestamp</td></tr>
</tbody></table>
</div>
<h3 id="nextmanagementfeetimestamp-1"><a class="header" href="#nextmanagementfeetimestamp-1">nextManagementFeeTimestamp</a></h3>
<p>Returns the next management fee timestamp so the backend can schedule the fee collection</p>
<pre><code class="language-solidity">function nextManagementFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The next management fee timestamp</td></tr>
</tbody></table>
</div>
<h3 id="managementfee-1"><a class="header" href="#managementfee-1">managementFee</a></h3>
<p>Returns the current management fee percentage</p>
<pre><code class="language-solidity">function managementFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The management fee in basis points (e.g., 100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="sharepricewatermark-1"><a class="header" href="#sharepricewatermark-1">sharePriceWatermark</a></h3>
<p>Returns the high watermark for share price used in performance fee calculations</p>
<pre><code class="language-solidity">function sharePriceWatermark() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The share price watermark value</td></tr>
</tbody></table>
</div>
<h3 id="isbatchclosed-1"><a class="header" href="#isbatchclosed-1">isBatchClosed</a></h3>
<p>Returns whether the current batch is closed</p>
<pre><code class="language-solidity">function isBatchClosed() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the current batch is closed</td></tr>
</tbody></table>
</div>
<h3 id="isbatchsettled-1"><a class="header" href="#isbatchsettled-1">isBatchSettled</a></h3>
<p>Returns whether the current batch is settled</p>
<pre><code class="language-solidity">function isBatchSettled() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the current batch is settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidinfo-1"><a class="header" href="#getbatchidinfo-1">getBatchIdInfo</a></h3>
<p>Returns the current batch ID, whether it is closed, and whether it is settled</p>
<pre><code class="language-solidity">function getBatchIdInfo()
    external
    view
    returns (bytes32 batchId, address batchReceiver, bool isClosed, bool isSettled);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Current batch ID</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>Current batch receiver</td></tr>
<tr><td><code>isClosed</code></td><td><code>bool</code></td><td>Whether the current batch is closed</td></tr>
<tr><td><code>isSettled</code></td><td><code>bool</code></td><td>Whether the current batch is settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchreceiver-1"><a class="header" href="#getbatchreceiver-1">getBatchReceiver</a></h3>
<p>Returns the batch receiver for a given batch (alias for getBatchIdReceiver)</p>
<pre><code class="language-solidity">function getBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Batch receiver</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchreceiver-1"><a class="header" href="#getsafebatchreceiver-1">getSafeBatchReceiver</a></h3>
<p>Returns the batch receiver for a given batch (alias for getBatchIdReceiver)</p>
<p><em>Throws if the batch is settled</em></p>
<pre><code class="language-solidity">function getSafeBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Batch receiver</td></tr>
</tbody></table>
</div>
<h3 id="shareprice-1"><a class="header" href="#shareprice-1">sharePrice</a></h3>
<p>Calculates the price of stkTokens in underlying asset terms</p>
<p><em>Uses the last total assets and total supply to calculate the price</em></p>
<pre><code class="language-solidity">function sharePrice() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>price Price per stkToken in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="totalassets-3"><a class="header" href="#totalassets-3">totalAssets</a></h3>
<p>Returns the current total assets</p>
<pre><code class="language-solidity">function totalAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently deployed in strategies</td></tr>
</tbody></table>
</div>
<h3 id="totalnetassets-1"><a class="header" href="#totalnetassets-1">totalNetAssets</a></h3>
<p>Returns the current total assets after fees</p>
<pre><code class="language-solidity">function totalNetAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total net assets currently deployed in strategies</td></tr>
</tbody></table>
</div>
<h3 id="getbatchid-1"><a class="header" href="#getbatchid-1">getBatchId</a></h3>
<p>Returns the current batch</p>
<pre><code class="language-solidity">function getBatchId() public view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Batch</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchid-1"><a class="header" href="#getsafebatchid-1">getSafeBatchId</a></h3>
<p>Returns the safe batch</p>
<pre><code class="language-solidity">function getSafeBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Batch</td></tr>
</tbody></table>
</div>
<h3 id="contractname-3"><a class="header" href="#contractname-3">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-3"><a class="header" href="#contractversion-3">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h3 id="selectors"><a class="header" href="#selectors">selectors</a></h3>
<p>Returns the selectors for functions in this module</p>
<pre><code class="language-solidity">function selectors() public pure returns (bytes4[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes4[]</code></td><td>selectors Array of function selectors</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="contents-9"><a class="header" href="#contents-9">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/types/BaseVaultTypes.sol/library.BaseVaultTypes.html">BaseVaultTypes</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basevaulttypes"><a class="header" href="#basevaulttypes">BaseVaultTypes</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kStakingVault/types/BaseVaultTypes.sol">Git Source</a></p>
<p>Library containing all data structures used in the ModuleBase</p>
<p><em>Defines standardized data types for cross-contract communication and storage</em></p>
<h2 id="structs-7"><a class="header" href="#structs-7">Structs</a></h2>
<h3 id="stakerequest"><a class="header" href="#stakerequest">StakeRequest</a></h3>
<p>Stake request structure</p>
<pre><code class="language-solidity">struct StakeRequest {
    address user;
    uint128 kTokenAmount;
    address recipient;
    bytes32 batchId;
    uint64 requestTimestamp;
    RequestStatus status;
}
</code></pre>
<h3 id="unstakerequest"><a class="header" href="#unstakerequest">UnstakeRequest</a></h3>
<p>Unstake request structure</p>
<pre><code class="language-solidity">struct UnstakeRequest {
    address user;
    uint128 stkTokenAmount;
    address recipient;
    bytes32 batchId;
    uint64 requestTimestamp;
    RequestStatus status;
}
</code></pre>
<h3 id="batchinfo"><a class="header" href="#batchinfo">BatchInfo</a></h3>
<p>Batch information structure</p>
<pre><code class="language-solidity">struct BatchInfo {
    address batchReceiver;
    bool isClosed;
    bool isSettled;
    bytes32 batchId;
    uint128 sharePrice;
    uint128 netSharePrice;
}
</code></pre>
<h2 id="enums-2"><a class="header" href="#enums-2">Enums</a></h2>
<h3 id="requeststatus-1"><a class="header" href="#requeststatus-1">RequestStatus</a></h3>
<p>Request status</p>
<pre><code class="language-solidity">enum RequestStatus {
    PENDING,
    CLAIMED,
    CANCELLED
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kstakingvault"><a class="header" href="#kstakingvault">kStakingVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kStakingVault/kStakingVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/kStakingVault.sol//src/interfaces/IVault.sol/interface.IVault.html">IVault</a>, <a href="src/kStakingVault/kStakingVault.sol//src/kStakingVault/base/BaseVault.sol/abstract.BaseVault.html">BaseVault</a>, <a href="src/kStakingVault/kStakingVault.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/kStakingVault/kStakingVault.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a>, <a href="src/kStakingVault/kStakingVault.sol//src/vendor/Ownable.sol/abstract.Ownable.html">Ownable</a>, <a href="src/kStakingVault/kStakingVault.sol//src/base/MultiFacetProxy.sol/abstract.MultiFacetProxy.html">MultiFacetProxy</a></p>
<p>Retail staking vault enabling kToken holders to earn yield through batch-processed share tokens</p>
<p><em>This contract implements the complete retail staking system for the KAM protocol, providing individual
kToken holders access to institutional-grade yield opportunities through a share-based mechanism. The implementation
combines several architectural patterns: (1) Dual-token system where kTokens convert to yield-bearing stkTokens,
(2) Batch processing for gas-efficient operations and fair pricing across multiple users, (3) Virtual balance
coordination with kAssetRouter for cross-vault yield optimization, (4) Two-phase operations (request → claim)
ensuring accurate settlement and preventing MEV attacks, (5) Fee management system supporting both management
and performance fees with hurdle rate mechanisms. The vault integrates with the broader protocol through
kAssetRouter for asset flow coordination and yield distribution. Gas optimizations include packed storage,
minimal proxy deployment for batch receivers, and efficient batch settlement processing. The modular architecture
enables upgrades while maintaining state integrity through UUPS pattern and ERC-7201 storage.</em></p>
<h2 id="functions-22"><a class="header" href="#functions-22">Functions</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-1"><a class="header" href="#initialize-1">initialize</a></h3>
<p>Initializes the kStakingVault with complete protocol integration and share token configuration</p>
<p><em>This function establishes the vault's integration with the KAM protocol ecosystem. The initialization
process: (1) Validates asset address to prevent deployment with invalid configuration, (2) Initializes
BaseVault foundation with registry and operational state, (3) Sets up ownership and access control through
Ownable pattern, (4) Configures share token metadata and decimals for ERC20 functionality, (5) Establishes
kToken integration through registry lookup for asset-to-token mapping, (6) Sets initial share price watermark
for performance fee calculations, (7) Deploys BatchReceiver implementation for settlement asset distribution.
The initialization creates a complete retail staking solution integrated with the protocol's institutional
flows.</em></p>
<pre><code class="language-solidity">function initialize(
    address owner_,
    address registry_,
    bool paused_,
    string memory name_,
    string memory symbol_,
    uint8 decimals_,
    address asset_
)
    external
    initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>The address that will have administrative control over the vault</td></tr>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address for protocol configuration integration</td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial operational state (true = paused, false = active)</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>ERC20 token name for the stkToken (e.g., "Staked kUSDC")</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>ERC20 token symbol for the stkToken (e.g., "stkUSDC")</td></tr>
<tr><td><code>decimals_</code></td><td><code>uint8</code></td><td>Token decimals matching the underlying asset precision</td></tr>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>Underlying asset address that this vault will generate yield on</td></tr>
</tbody></table>
</div>
<h3 id="requeststake-1"><a class="header" href="#requeststake-1">requestStake</a></h3>
<p>Initiates kToken staking request for yield-generating stkToken shares in a batch processing system</p>
<p><em>This function begins the retail staking process by: (1) Validating user has sufficient kToken balance
and vault is not paused, (2) Creating a pending stake request with user-specified recipient and current
batch ID for fair settlement, (3) Transferring kTokens from user to vault while updating pending stake
tracking for accurate share calculations, (4) Coordinating with kAssetRouter to virtually move underlying
assets from DN vault to staking vault, enabling proper asset allocation across the protocol. The request
enters pending state until batch settlement, when the final share price is calculated based on vault
performance. Users must later call claimStakedShares() after settlement to receive their stkTokens at
the settled price. This two-phase approach ensures fair pricing for all users within a batch period.</em></p>
<pre><code class="language-solidity">function requestStake(address to, uint256 amount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the stkTokens after successful settlement and claiming</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this staking request through settlement and claiming</td></tr>
</tbody></table>
</div>
<h3 id="requestunstake-1"><a class="header" href="#requestunstake-1">requestUnstake</a></h3>
<p>Initiates stkToken unstaking request for kToken redemption plus accrued yield through batch processing</p>
<p><em>This function begins the retail unstaking process by: (1) Validating user has sufficient stkToken balance
and vault is operational, (2) Creating pending unstake request with current batch ID for settlement
coordination,
(3) Transferring stkTokens from user to vault contract to maintain stable share price during settlement period,
(4) Notifying kAssetRouter of share redemption request for proper accounting across vault network. The stkTokens
remain locked in the vault until settlement when they are burned and equivalent kTokens (including yield) are
made available. Users must later call claimUnstakedAssets() after settlement to receive their kTokens from
the batch receiver contract. This two-phase design ensures accurate yield calculations and prevents share
price manipulation during the settlement process.</em></p>
<pre><code class="language-solidity">function requestUnstake(address to, uint256 stkTokenAmount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the kTokens after successful settlement and claiming</td></tr>
<tr><td><code>stkTokenAmount</code></td><td><code>uint256</code></td><td>The quantity of stkTokens to unstake (must not exceed user balance, cannot be zero)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this unstaking request through settlement and claiming</td></tr>
</tbody></table>
</div>
<h3 id="cancelstakerequest"><a class="header" href="#cancelstakerequest">cancelStakeRequest</a></h3>
<p>Cancels a staking request</p>
<pre><code class="language-solidity">function cancelStakeRequest(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="cancelunstakerequest"><a class="header" href="#cancelunstakerequest">cancelUnstakeRequest</a></h3>
<p>Cancels an unstaking request</p>
<pre><code class="language-solidity">function cancelUnstakeRequest(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="createnewbatch-1"><a class="header" href="#createnewbatch-1">createNewBatch</a></h3>
<p>Creates a new batch to begin aggregating user requests for the next settlement period</p>
<p><em>This function initializes a fresh batch period for collecting staking and unstaking requests. Process:
(1) Increments internal batch counter for unique identification, (2) Generates deterministic batch ID using
chain-specific parameters (vault address, batch number, chainid, timestamp, asset) for collision resistance,
(3) Initializes batch storage with open state enabling new request acceptance, (4) Updates vault's current
batch tracking for request routing. Only relayers can call this function as part of the automated settlement
schedule. The timing is typically coordinated with institutional settlement cycles to optimize capital
efficiency
across the protocol. Each batch remains open until explicitly closed by relayers or governance.</em></p>
<pre><code class="language-solidity">function createNewBatch() external returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>batchId Unique deterministic identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="closebatch-1"><a class="header" href="#closebatch-1">closeBatch</a></h3>
<p>Closes a batch to prevent new requests and prepare for settlement processing</p>
<p><em>This function transitions a batch from open to closed state, finalizing the request set for settlement.
Process: (1) Validates batch exists and is currently open to prevent double-closing, (2) Marks batch as closed
preventing new stake/unstake requests from joining, (3) Optionally creates new batch for continued operations
if _create flag is true, enabling seamless transitions. Once closed, the batch awaits settlement by kAssetRouter
which will calculate final share prices and distribute yields. Only relayers can execute batch closure as part
of the coordinated settlement schedule across all protocol vaults. The timing typically aligns with DN vault
yield calculations to ensure accurate price discovery.</em></p>
<pre><code class="language-solidity">function closeBatch(bytes32 _batchId, bool _create) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The specific batch identifier to close (must be currently open)</td></tr>
<tr><td><code>_create</code></td><td><code>bool</code></td><td>Whether to immediately create a new batch after closing for continued operations</td></tr>
</tbody></table>
</div>
<h3 id="settlebatch-1"><a class="header" href="#settlebatch-1">settleBatch</a></h3>
<p>Marks a batch as settled after yield distribution and enables user claiming</p>
<p><em>This function finalizes batch settlement by recording final asset values and enabling claims. Process:
(1) Validates batch is closed and not already settled to prevent duplicate processing, (2) Snapshots both
gross and net share prices at settlement time for accurate reward calculations, (3) Marks batch as settled
enabling users to claim their staked shares or unstaked assets, (4) Completes the batch lifecycle allowing
reward distribution through the claiming mechanism. Only kAssetRouter can settle batches as it coordinates
yield calculations across DN vaults and manages cross-vault asset flows. Settlement triggers share price
finalization based on vault performance during the batch period.</em></p>
<pre><code class="language-solidity">function settleBatch(bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to mark as settled (must be closed, not previously settled)</td></tr>
</tbody></table>
</div>
<h3 id="createbatchreceiver-1"><a class="header" href="#createbatchreceiver-1">createBatchReceiver</a></h3>
<p>Deploys a minimal proxy BatchReceiver for isolated asset distribution to unstaking users</p>
<p><em>This function creates batch-specific receivers for secure unstaking asset distribution. Process:
(1) Checks if receiver already exists for batch to prevent duplicate deployments, (2) Clones minimal proxy
from receiver implementation to minimize gas costs while maintaining isolation, (3) Initializes receiver with
batch ID and asset type for proper operation, (4) Stores receiver address in batch info for claiming access.
The receiver pattern provides several benefits: asset isolation between batches preventing cross-contamination,
gas-efficient deployment through EIP-1167 minimal proxies, security through single-batch operation scope,
and simplified distribution logic for unstaking claims. Only kAssetRouter can create receivers as part of
settlement coordination.</em></p>
<pre><code class="language-solidity">function createBatchReceiver(bytes32 _batchId) external returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier requiring a receiver for asset distribution</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the deployed BatchReceiver contract for this specific batch</td></tr>
</tbody></table>
</div>
<h3 id="_createnewbatch"><a class="header" href="#_createnewbatch">_createNewBatch</a></h3>
<p>Internal function to create deterministic batch IDs with collision resistance</p>
<p><em>This function generates unique batch identifiers using multiple entropy sources for security. The ID
generation process: (1) Increments internal batch counter to ensure uniqueness within the vault, (2) Combines
vault address, batch number, chain ID, timestamp, and asset address for collision resistance, (3) Uses
optimized hashing function for gas efficiency, (4) Initializes batch storage with default state for new
requests. The deterministic approach enables consistent batch identification across different contexts while
the multiple entropy sources prevent prediction or collision attacks. Each batch starts in open state ready
to accept user requests until explicitly closed by relayers.</em></p>
<pre><code class="language-solidity">function _createNewBatch() private returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Deterministic batch identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused"><a class="header" href="#_checkpaused">_checkPaused</a></h3>
<p>Validates vault operational state preventing actions during emergency pause</p>
<p><em>This internal validation function ensures vault safety by blocking operations when paused. Emergency
pause can be triggered by emergency admins during security incidents or market anomalies. The function
provides consistent pause checking across all vault operations while maintaining gas efficiency through
direct storage access. When paused, users cannot create new requests but can still query vault state.</em></p>
<pre><code class="language-solidity">function _checkPaused(BaseVaultStorage storage $) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>BaseVaultStorage</code></td><td>Direct storage pointer for gas-efficient pause state access</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero"><a class="header" href="#_checkamountnotzero">_checkAmountNotZero</a></h3>
<p>Validates non-zero amounts preventing invalid operations</p>
<p><em>This utility function prevents zero-amount operations that would waste gas or create invalid state.
Zero amounts are rejected for staking, unstaking, and fee operations to maintain data integrity and
prevent operational errors. The pure function enables gas-efficient validation without state access.</em></p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount value to validate (must be greater than zero)</td></tr>
</tbody></table>
</div>
<h3 id="_checkvalidbps"><a class="header" href="#_checkvalidbps">_checkValidBPS</a></h3>
<p>Validates basis point values preventing excessive fee configuration</p>
<p><em>This function ensures fee parameters remain within acceptable bounds (0-10000 bp = 0-100%) to
protect users from excessive fee extraction. The 10000 bp limit enforces the maximum fee cap while
enabling flexible fee configuration within reasonable ranges. Used for both management and performance
fee validation to maintain consistent fee bounds across all fee types.</em></p>
<pre><code class="language-solidity">function _checkValidBPS(uint256 bps) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>bps</code></td><td><code>uint256</code></td><td>The basis point value to validate (must be &lt;= 10000)</td></tr>
</tbody></table>
</div>
<h3 id="_checkrelayer"><a class="header" href="#_checkrelayer">_checkRelayer</a></h3>
<p>Validates relayer role authorization for batch management operations</p>
<p><em>This access control function ensures only authorized relayers can execute batch lifecycle operations.
Relayers are responsible for automated batch creation, closure, and coordination with settlement processes.
The role-based access prevents unauthorized manipulation of batch timing while enabling protocol automation.</em></p>
<pre><code class="language-solidity">function _checkRelayer(address relayer) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>relayer</code></td><td><code>address</code></td><td>The address to validate against registered relayer roles</td></tr>
</tbody></table>
</div>
<h3 id="_checkrouter"><a class="header" href="#_checkrouter">_checkRouter</a></h3>
<p>Validates kAssetRouter authorization for settlement and asset coordination</p>
<p><em>This critical access control ensures only the protocol's kAssetRouter can trigger settlement operations
and coordinate cross-vault asset flows. The router manages complex settlement logic including yield distribution
and virtual balance coordination, making this validation essential for protocol integrity and security.</em></p>
<pre><code class="language-solidity">function _checkRouter(address router) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The address to validate against the registered kAssetRouter contract</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin"><a class="header" href="#_checkadmin">_checkAdmin</a></h3>
<p>Validates admin role authorization for vault configuration changes</p>
<p><em>This access control function restricts administrative operations to authorized admin addresses.
Admins can modify fee parameters, update vault settings, and execute emergency functions requiring
elevated privileges. The role validation maintains security while enabling necessary governance operations.</em></p>
<pre><code class="language-solidity">function _checkAdmin(address admin) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to validate against registered admin roles</td></tr>
</tbody></table>
</div>
<h3 id="_validatetimestamp"><a class="header" href="#_validatetimestamp">_validateTimestamp</a></h3>
<p>Validates timestamp progression preventing manipulation and ensuring logical sequence</p>
<p><em>This function ensures fee timestamp updates follow logical progression and remain within valid ranges.
Validation checks: (1) New timestamp must be &gt;= last timestamp to prevent backwards time manipulation,
(2) New timestamp must be &lt;= current block time to prevent future-dating. These validations are critical
for accurate fee calculations and preventing temporal manipulation attacks on the fee system.</em></p>
<pre><code class="language-solidity">function _validateTimestamp(uint256 timestamp, uint256 lastTimestamp) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>The new timestamp being set for fee tracking</td></tr>
<tr><td><code>lastTimestamp</code></td><td><code>uint256</code></td><td>The previous timestamp for progression validation</td></tr>
</tbody></table>
</div>
<h3 id="claimstakedshares-1"><a class="header" href="#claimstakedshares-1">claimStakedShares</a></h3>
<p>Claims stkTokens from a settled staking batch</p>
<pre><code class="language-solidity">function claimStakedShares(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Batch ID to claim from</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to claim</td></tr>
</tbody></table>
</div>
<h3 id="claimunstakedassets-1"><a class="header" href="#claimunstakedassets-1">claimUnstakedAssets</a></h3>
<p>Claims kTokens from a settled unstaking batch (simplified implementation)</p>
<pre><code class="language-solidity">function claimUnstakedAssets(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Batch ID to claim from</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to claim</td></tr>
</tbody></table>
</div>
<h3 id="sethardhurdlerate-1"><a class="header" href="#sethardhurdlerate-1">setHardHurdleRate</a></h3>
<p>Sets the hard hurdle rate</p>
<p><em>If true, performance fees will only be charged to the excess return</em></p>
<pre><code class="language-solidity">function setHardHurdleRate(bool _isHard) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isHard</code></td><td><code>bool</code></td><td>Whether the hard hurdle rate is enabled</td></tr>
</tbody></table>
</div>
<h3 id="setmanagementfee-1"><a class="header" href="#setmanagementfee-1">setManagementFee</a></h3>
<p>Sets the management fee</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setManagementFee(uint16 _managementFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_managementFee</code></td><td><code>uint16</code></td><td>The new management fee</td></tr>
</tbody></table>
</div>
<h3 id="setperformancefee-1"><a class="header" href="#setperformancefee-1">setPerformanceFee</a></h3>
<p>Sets the performance fee</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setPerformanceFee(uint16 _performanceFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_performanceFee</code></td><td><code>uint16</code></td><td>The new performance fee</td></tr>
</tbody></table>
</div>
<h3 id="notifymanagementfeescharged-1"><a class="header" href="#notifymanagementfeescharged-1">notifyManagementFeesCharged</a></h3>
<p>Notifies the module that management fees have been charged from backend</p>
<p><em>Should only be called by the vault</em></p>
<pre><code class="language-solidity">function notifyManagementFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="notifyperformancefeescharged-1"><a class="header" href="#notifyperformancefeescharged-1">notifyPerformanceFeesCharged</a></h3>
<p>Notifies the module that performance fees have been charged from backend</p>
<p><em>Should only be called by the vault</em></p>
<pre><code class="language-solidity">function notifyPerformanceFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="_updateglobalwatermark"><a class="header" href="#_updateglobalwatermark">_updateGlobalWatermark</a></h3>
<p>Updates the share price watermark</p>
<p><em>Updates the high water mark if the current share price exceeds the previous mark</em></p>
<pre><code class="language-solidity">function _updateGlobalWatermark() private;
</code></pre>
<h3 id="_createstakerequestid"><a class="header" href="#_createstakerequestid">_createStakeRequestId</a></h3>
<p>Creates a unique request ID for a staking request</p>
<pre><code class="language-solidity">function _createStakeRequestId(address user, uint256 amount, uint256 timestamp) private returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>User address</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount of underlying assets</td></tr>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Request ID</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-2"><a class="header" href="#setpaused-2">setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">function setPaused(bool paused_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>New pause state</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade-1"><a class="header" href="#_authorizeupgrade-1">_authorizeUpgrade</a></h3>
<p>Authorize upgrade (only owner can upgrade)</p>
<p><em>This allows upgrading the main contract while keeping modules separate</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<h3 id="_authorizemodifyfunctions-1"><a class="header" href="#_authorizemodifyfunctions-1">_authorizeModifyFunctions</a></h3>
<p>Authorize function modification</p>
<p><em>This allows modifying functions while keeping modules separate</em></p>
<pre><code class="language-solidity">function _authorizeModifyFunctions(address sender) internal override;
</code></pre>
<h2 id="events-8"><a class="header" href="#events-8">Events</a></h2>
<h3 id="batchcreated"><a class="header" href="#batchcreated">BatchCreated</a></h3>
<p>Emitted when a new batch is created</p>
<pre><code class="language-solidity">event BatchCreated(bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the new batch</td></tr>
</tbody></table>
</div>
<h3 id="batchsettled-1"><a class="header" href="#batchsettled-1">BatchSettled</a></h3>
<p>Emitted when a batch is settled</p>
<pre><code class="language-solidity">event BatchSettled(bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the settled batch</td></tr>
</tbody></table>
</div>
<h3 id="batchclosed"><a class="header" href="#batchclosed">BatchClosed</a></h3>
<p>Emitted when a batch is closed</p>
<pre><code class="language-solidity">event BatchClosed(bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the closed batch</td></tr>
</tbody></table>
</div>
<h3 id="batchreceivercreated"><a class="header" href="#batchreceivercreated">BatchReceiverCreated</a></h3>
<p>Emitted when a BatchReceiver is created</p>
<pre><code class="language-solidity">event BatchReceiverCreated(address indexed receiver, bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address of the created BatchReceiver</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the BatchReceiver</td></tr>
</tbody></table>
</div>
<h3 id="stakingsharesclaimed"><a class="header" href="#stakingsharesclaimed">StakingSharesClaimed</a></h3>
<p>Emitted when a user claims staking shares</p>
<pre><code class="language-solidity">event StakingSharesClaimed(bytes32 indexed batchId, bytes32 requestId, address indexed user, uint256 shares);
</code></pre>
<h3 id="unstakingassetsclaimed"><a class="header" href="#unstakingassetsclaimed">UnstakingAssetsClaimed</a></h3>
<p>Emitted when a user claims unstaking assets</p>
<pre><code class="language-solidity">event UnstakingAssetsClaimed(bytes32 indexed batchId, bytes32 requestId, address indexed user, uint256 assets);
</code></pre>
<h3 id="ktokenunstaked"><a class="header" href="#ktokenunstaked">KTokenUnstaked</a></h3>
<p>Emitted when kTokens are unstaked</p>
<pre><code class="language-solidity">event KTokenUnstaked(address indexed user, uint256 shares, uint256 kTokenAmount);
</code></pre>
<h3 id="managementfeeupdated"><a class="header" href="#managementfeeupdated">ManagementFeeUpdated</a></h3>
<p>Emitted when the management fee is updated</p>
<pre><code class="language-solidity">event ManagementFeeUpdated(uint16 oldFee, uint16 newFee);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldFee</code></td><td><code>uint16</code></td><td>Previous management fee in basis points</td></tr>
<tr><td><code>newFee</code></td><td><code>uint16</code></td><td>New management fee in basis points</td></tr>
</tbody></table>
</div>
<h3 id="performancefeeupdated"><a class="header" href="#performancefeeupdated">PerformanceFeeUpdated</a></h3>
<p>Emitted when the performance fee is updated</p>
<pre><code class="language-solidity">event PerformanceFeeUpdated(uint16 oldFee, uint16 newFee);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldFee</code></td><td><code>uint16</code></td><td>Previous performance fee in basis points</td></tr>
<tr><td><code>newFee</code></td><td><code>uint16</code></td><td>New performance fee in basis points</td></tr>
</tbody></table>
</div>
<h3 id="feesassesed"><a class="header" href="#feesassesed">FeesAssesed</a></h3>
<p>Emitted when fees are charged to the vault</p>
<pre><code class="language-solidity">event FeesAssesed(uint256 managementFees, uint256 performanceFees);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>managementFees</code></td><td><code>uint256</code></td><td>Amount of management fees collected</td></tr>
<tr><td><code>performanceFees</code></td><td><code>uint256</code></td><td>Amount of performance fees collected</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerateupdated"><a class="header" href="#hurdlerateupdated">HurdleRateUpdated</a></h3>
<p>Emitted when the hurdle rate is updated</p>
<pre><code class="language-solidity">event HurdleRateUpdated(uint16 newRate);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newRate</code></td><td><code>uint16</code></td><td>New hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="hardhurdlerateupdated"><a class="header" href="#hardhurdlerateupdated">HardHurdleRateUpdated</a></h3>
<p>Emitted when the hard hurdle rate is updated</p>
<pre><code class="language-solidity">event HardHurdleRateUpdated(bool newRate);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newRate</code></td><td><code>bool</code></td><td>New hard hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="managementfeescharged"><a class="header" href="#managementfeescharged">ManagementFeesCharged</a></h3>
<p>Emitted when management fees are charged</p>
<pre><code class="language-solidity">event ManagementFeesCharged(uint256 timestamp);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="performancefeescharged"><a class="header" href="#performancefeescharged">PerformanceFeesCharged</a></h3>
<p>Emitted when performance fees are charged</p>
<pre><code class="language-solidity">event PerformanceFeesCharged(uint256 timestamp);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp of the fee charge</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="contents-10"><a class="header" href="#contents-10">Contents</a></h1>
<ul>
<li><a href="src/libraries/OptimizedAddressEnumerableSetLib.sol/library.OptimizedAddressEnumerableSetLib.html">OptimizedAddressEnumerableSetLib</a></li>
<li><a href="src/libraries/OptimizedBytes32EnumerableSetLib.sol/library.OptimizedBytes32EnumerableSetLib.html">OptimizedBytes32EnumerableSetLib</a></li>
<li><a href="src/libraries/OptimizedEfficientHashLib.sol/library.OptimizedEfficientHashLib.html">OptimizedEfficientHashLib</a></li>
<li><a href="src/libraries/OptimizedFixedPointMathLib.sol/library.OptimizedFixedPointMathLib.html">OptimizedFixedPointMathLib</a></li>
<li><a href="src/libraries/OptimizedLibClone.sol/library.OptimizedLibClone.html">OptimizedLibClone</a></li>
<li><a href="src/libraries/OptimizedOwnableRoles.sol/abstract.OptimizedOwnableRoles.html">OptimizedOwnableRoles</a></li>
<li><a href="src/libraries/OptimizedSafeCastLib.sol/library.OptimizedSafeCastLib.html">OptimizedSafeCastLib</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedaddressenumerablesetlib"><a class="header" href="#optimizedaddressenumerablesetlib">OptimizedAddressEnumerableSetLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedAddressEnumerableSetLib.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/EnumerableSetLib.sol)</p>
<p>Library for managing enumerable sets in storage.</p>
<p><em>Note:
In many applications, the number of elements in an enumerable set is small.
This enumerable set implementation avoids storing the length and indices
for up to 3 elements. Once the length exceeds 3 for the first time, the length
and indices will be initialized. The amortized cost of adding elements is O(1).
The AddressSet implementation packs the length with the 0th entry.
All enumerable sets except Uint8Set use a pop and swap mechanism to remove elements.
This means that the iteration order of elements can change between element removals.</em></p>
<h2 id="state-variables-7"><a class="header" href="#state-variables-7">State Variables</a></h2>
<h3 id="not_found"><a class="header" href="#not_found">NOT_FOUND</a></h3>
<p><em>The index to represent a value that does not exist.</em></p>
<pre><code class="language-solidity">uint256 internal constant NOT_FOUND = type(uint256).max;
</code></pre>
<h3 id="_zero_sentinel"><a class="header" href="#_zero_sentinel">_ZERO_SENTINEL</a></h3>
<p><em>A sentinel value to denote the zero value in storage.
No elements can be equal to this value.
<code>uint72(bytes9(keccak256(bytes("_ZERO_SENTINEL"))))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _ZERO_SENTINEL = 0xfbb67fda52d4bfb8bf;
</code></pre>
<h3 id="_enumerable_address_set_slot_seed"><a class="header" href="#_enumerable_address_set_slot_seed">_ENUMERABLE_ADDRESS_SET_SLOT_SEED</a></h3>
<p>*The storage layout is given by:</p>
<pre><code>mstore(0x04, _ENUMERABLE_ADDRESS_SET_SLOT_SEED)
mstore(0x00, set.slot)
let rootSlot := keccak256(0x00, 0x24)
mstore(0x20, rootSlot)
mstore(0x00, shr(96, shl(96, value)))
let positionSlot := keccak256(0x00, 0x40)
let valueSlot := add(rootSlot, sload(positionSlot))
let valueInStorage := shr(96, sload(valueSlot))
let lazyLength := shr(160, shl(160, sload(rootSlot)))
```*


```solidity
uint256 private constant _ENUMERABLE_ADDRESS_SET_SLOT_SEED = 0x978aab92;
</code></pre>
<h3 id="_enumerable_word_set_slot_seed"><a class="header" href="#_enumerable_word_set_slot_seed">_ENUMERABLE_WORD_SET_SLOT_SEED</a></h3>
<p>*The storage layout is given by:</p>
<pre><code>mstore(0x04, _ENUMERABLE_WORD_SET_SLOT_SEED)
mstore(0x00, set.slot)
let rootSlot := keccak256(0x00, 0x24)
mstore(0x20, rootSlot)
mstore(0x00, value)
let positionSlot := keccak256(0x00, 0x40)
let valueSlot := add(rootSlot, sload(positionSlot))
let valueInStorage := sload(valueSlot)
let lazyLength := sload(not(rootSlot))
```*


```solidity
uint256 private constant _ENUMERABLE_WORD_SET_SLOT_SEED = 0x18fb5864;
</code></pre>
<h2 id="functions-23"><a class="header" href="#functions-23">Functions</a></h2>
<h3 id="length"><a class="header" href="#length">length</a></h3>
<p><em>Returns the number of elements in the set.</em></p>
<pre><code class="language-solidity">function length(AddressSet storage set) internal view returns (uint256 result);
</code></pre>
<h3 id="contains"><a class="header" href="#contains">contains</a></h3>
<p><em>Returns whether <code>value</code> is in the set.</em></p>
<pre><code class="language-solidity">function contains(AddressSet storage set, address value) internal view returns (bool result);
</code></pre>
<h3 id="add"><a class="header" href="#add">add</a></h3>
<p><em>Adds <code>value</code> to the set. Returns whether <code>value</code> was not in the set.</em></p>
<pre><code class="language-solidity">function add(AddressSet storage set, address value) internal returns (bool result);
</code></pre>
<h3 id="remove"><a class="header" href="#remove">remove</a></h3>
<p><em>Removes <code>value</code> from the set. Returns whether <code>value</code> was in the set.</em></p>
<pre><code class="language-solidity">function remove(AddressSet storage set, address value) internal returns (bool result);
</code></pre>
<h3 id="values"><a class="header" href="#values">values</a></h3>
<p><em>Returns all of the values in the set.
Note: This can consume more gas than the block gas limit for large sets.</em></p>
<pre><code class="language-solidity">function values(AddressSet storage set) internal view returns (address[] memory result);
</code></pre>
<h3 id="at"><a class="header" href="#at">at</a></h3>
<p><em>Returns the element at index <code>i</code> in the set. Reverts if <code>i</code> is out-of-bounds.</em></p>
<pre><code class="language-solidity">function at(AddressSet storage set, uint256 i) internal view returns (address result);
</code></pre>
<h3 id="indexof"><a class="header" href="#indexof">indexOf</a></h3>
<p><em>Returns the index of <code>value</code>. Returns <code>NOT_FOUND</code> if the value does not exist.</em></p>
<pre><code class="language-solidity">function indexOf(AddressSet storage set, address value) internal view returns (uint256 result);
</code></pre>
<h3 id="_rootslot"><a class="header" href="#_rootslot">_rootSlot</a></h3>
<p><em>Returns the root slot.</em></p>
<pre><code class="language-solidity">function _rootSlot(AddressSet storage s) private pure returns (bytes32 r);
</code></pre>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<h3 id="indexoutofbounds"><a class="header" href="#indexoutofbounds">IndexOutOfBounds</a></h3>
<p><em>The index must be less than the length.</em></p>
<pre><code class="language-solidity">error IndexOutOfBounds();
</code></pre>
<h3 id="valueiszerosentinel"><a class="header" href="#valueiszerosentinel">ValueIsZeroSentinel</a></h3>
<p><em>The value cannot be the zero sentinel.</em></p>
<pre><code class="language-solidity">error ValueIsZeroSentinel();
</code></pre>
<h3 id="exceedscapacity"><a class="header" href="#exceedscapacity">ExceedsCapacity</a></h3>
<p><em>Cannot accommodate a new unique value with the capacity.</em></p>
<pre><code class="language-solidity">error ExceedsCapacity();
</code></pre>
<h2 id="structs-8"><a class="header" href="#structs-8">Structs</a></h2>
<h3 id="addressset"><a class="header" href="#addressset">AddressSet</a></h3>
<p><em>An enumerable address set in storage.</em></p>
<pre><code class="language-solidity">struct AddressSet {
    uint256 _spacer;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedbytes32enumerablesetlib"><a class="header" href="#optimizedbytes32enumerablesetlib">OptimizedBytes32EnumerableSetLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedBytes32EnumerableSetLib.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady(https://github.com/Vectorized/solady/blob/main/src/utils/OptimizedBytes32EnumerableSetLib.sol)</p>
<p>Library for managing enumerable sets in storage.</p>
<p><em>The library size has been reduced to only use bytes32 sets</em></p>
<h2 id="state-variables-8"><a class="header" href="#state-variables-8">State Variables</a></h2>
<h3 id="_zero_sentinel-1"><a class="header" href="#_zero_sentinel-1">_ZERO_SENTINEL</a></h3>
<p><em>A sentinel value to denote the zero value in storage.
No elements can be equal to this value.
<code>uint72(bytes9(keccak256(bytes("_ZERO_SENTINEL"))))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _ZERO_SENTINEL = 0xfbb67fda52d4bfb8bf;
</code></pre>
<h3 id="_enumerable_word_set_slot_seed-1"><a class="header" href="#_enumerable_word_set_slot_seed-1">_ENUMERABLE_WORD_SET_SLOT_SEED</a></h3>
<p>*The storage layout is given by:</p>
<pre><code>mstore(0x04, _ENUMERABLE_WORD_SET_SLOT_SEED)
mstore(0x00, set.slot)
let rootSlot := keccak256(0x00, 0x24)
mstore(0x20, rootSlot)
mstore(0x00, value)
let positionSlot := keccak256(0x00, 0x40)
let valueSlot := add(rootSlot, sload(positionSlot))
let valueInStorage := sload(valueSlot)
let lazyLength := sload(not(rootSlot))
```*


```solidity
uint256 private constant _ENUMERABLE_WORD_SET_SLOT_SEED = 0x18fb5864;
</code></pre>
<h2 id="functions-24"><a class="header" href="#functions-24">Functions</a></h2>
<h3 id="length-1"><a class="header" href="#length-1">length</a></h3>
<p><em>Returns the number of elements in the set.</em></p>
<pre><code class="language-solidity">function length(Bytes32Set storage set) internal view returns (uint256 result);
</code></pre>
<h3 id="contains-1"><a class="header" href="#contains-1">contains</a></h3>
<p><em>Returns whether <code>value</code> is in the set.</em></p>
<pre><code class="language-solidity">function contains(Bytes32Set storage set, bytes32 value) internal view returns (bool result);
</code></pre>
<h3 id="add-1"><a class="header" href="#add-1">add</a></h3>
<p><em>Adds <code>value</code> to the set. Returns whether <code>value</code> was not in the set.</em></p>
<pre><code class="language-solidity">function add(Bytes32Set storage set, bytes32 value) internal returns (bool result);
</code></pre>
<h3 id="add-2"><a class="header" href="#add-2">add</a></h3>
<p><em>Adds <code>value</code> to the set. Returns whether <code>value</code> was not in the set.
Reverts if the set grows bigger than the custom on-the-fly capacity <code>cap</code>.</em></p>
<pre><code class="language-solidity">function add(Bytes32Set storage set, bytes32 value, uint256 cap) internal returns (bool result);
</code></pre>
<h3 id="remove-1"><a class="header" href="#remove-1">remove</a></h3>
<p><em>Removes <code>value</code> from the set. Returns whether <code>value</code> was in the set.</em></p>
<pre><code class="language-solidity">function remove(Bytes32Set storage set, bytes32 value) internal returns (bool result);
</code></pre>
<h3 id="update"><a class="header" href="#update">update</a></h3>
<p><em>Shorthand for <code>isAdd ? set.add(value, cap) : set.remove(value)</code>.</em></p>
<pre><code class="language-solidity">function update(Bytes32Set storage set, bytes32 value, bool isAdd, uint256 cap) internal returns (bool);
</code></pre>
<h3 id="values-1"><a class="header" href="#values-1">values</a></h3>
<p><em>Returns all of the values in the set.
Note: This can consume more gas than the block gas limit for large sets.</em></p>
<pre><code class="language-solidity">function values(Bytes32Set storage set) internal view returns (bytes32[] memory result);
</code></pre>
<h3 id="at-1"><a class="header" href="#at-1">at</a></h3>
<p><em>Returns the element at index <code>i</code> in the set. Reverts if <code>i</code> is out-of-bounds.</em></p>
<pre><code class="language-solidity">function at(Bytes32Set storage set, uint256 i) internal view returns (bytes32 result);
</code></pre>
<h3 id="_rootslot-1"><a class="header" href="#_rootslot-1">_rootSlot</a></h3>
<p><em>Returns the root slot.</em></p>
<pre><code class="language-solidity">function _rootSlot(Bytes32Set storage s) private pure returns (bytes32 r);
</code></pre>
<h2 id="errors-2"><a class="header" href="#errors-2">Errors</a></h2>
<h3 id="indexoutofbounds-1"><a class="header" href="#indexoutofbounds-1">IndexOutOfBounds</a></h3>
<p><em>The index must be less than the length.</em></p>
<pre><code class="language-solidity">error IndexOutOfBounds();
</code></pre>
<h3 id="valueiszerosentinel-1"><a class="header" href="#valueiszerosentinel-1">ValueIsZeroSentinel</a></h3>
<p><em>The value cannot be the zero sentinel.</em></p>
<pre><code class="language-solidity">error ValueIsZeroSentinel();
</code></pre>
<h3 id="exceedscapacity-1"><a class="header" href="#exceedscapacity-1">ExceedsCapacity</a></h3>
<p><em>Cannot accommodate a new unique value with the capacity.</em></p>
<pre><code class="language-solidity">error ExceedsCapacity();
</code></pre>
<h2 id="structs-9"><a class="header" href="#structs-9">Structs</a></h2>
<h3 id="bytes32set"><a class="header" href="#bytes32set">Bytes32Set</a></h3>
<p><em>An enumerable bytes32 set in storage.</em></p>
<pre><code class="language-solidity">struct Bytes32Set {
    uint256 _spacer;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedefficienthashlib"><a class="header" href="#optimizedefficienthashlib">OptimizedEfficientHashLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedEfficientHashLib.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/OptimizedEfficientHashLib.sol)</p>
<p>Library for efficiently performing keccak256 hashes.</p>
<p>*To avoid stack-too-deep, you can use:</p>
<pre><code>bytes32[] memory buffer = OptimizedEfficientHashLib.malloc(10);
OptimizedEfficientHashLib.set(buffer, 0, value0);
..
OptimizedEfficientHashLib.set(buffer, 9, value9);
bytes32 finalHash = OptimizedEfficientHashLib.hash(buffer);
```*


## Functions
### hash

*Returns `keccak256(abi.encode(v0, v1, v2, v3))`.*


```solidity
function hash(uint256 v0, uint256 v1, uint256 v2, uint256 v3) internal pure returns (bytes32 result);
</code></pre>
<h3 id="hash"><a class="header" href="#hash">hash</a></h3>
<p><em>Returns <code>keccak256(abi.encode(v0, .., v4))</code>.</em></p>
<pre><code class="language-solidity">function hash(uint256 v0, uint256 v1, uint256 v2, uint256 v3, uint256 v4) internal pure returns (bytes32 result);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedfixedpointmathlib"><a class="header" href="#optimizedfixedpointmathlib">OptimizedFixedPointMathLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedFixedPointMathLib.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/OptimizedFixedPointMathLib.sol), Modified from Solmate
(https://github.com/transmissions11/solmate/blob/main/src/utils/OptimizedFixedPointMathLib.sol)</p>
<p>Arithmetic library with operations for fixed-point numbers.</p>
<h2 id="functions-25"><a class="header" href="#functions-25">Functions</a></h2>
<h3 id="fullmuldiv"><a class="header" href="#fullmuldiv">fullMulDiv</a></h3>
<p><em>Calculates <code>floor(x * y / d)</code> with full precision.
Throws if result overflows a uint256 or when <code>d</code> is zero.
Credit to Remco Bloemen under MIT license: https://2π.com/21/muldiv</em></p>
<pre><code class="language-solidity">function fullMulDiv(uint256 x, uint256 y, uint256 d) internal pure returns (uint256 z);
</code></pre>
<h2 id="errors-3"><a class="header" href="#errors-3">Errors</a></h2>
<h3 id="fullmuldivfailed"><a class="header" href="#fullmuldivfailed">FullMulDivFailed</a></h3>
<p><em>The full precision multiply-divide operation failed, either due
to the result being larger than 256 bits, or a division by a zero.</em></p>
<pre><code class="language-solidity">error FullMulDivFailed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedlibclone"><a class="header" href="#optimizedlibclone">OptimizedLibClone</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedLibClone.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/OptimizedLibClone.sol), Minimal proxy by 0age (https://github.com/0age), Clones with immutable args by wighawag, zefram.eth, Saw-mon &amp; Natalie
(https://github.com/Saw-mon-and-Natalie/clones-with-immutable-args), Minimal ERC1967 proxy by jtriley-eth (https://github.com/jtriley-eth/minimum-viable-proxy)</p>
<p>Minimal proxy library.</p>
<p>*Minimal proxy:
Although the sw0nt pattern saves 5 gas over the ERC1167 pattern during runtime,
it is not supported out-of-the-box on Etherscan. Hence, we choose to use the 0age pattern,
which saves 4 gas over the ERC1167 pattern during runtime, and has the smallest bytecode.</p>
<ul>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p>*Minimal proxy (PUSH0 variant):
This is a new minimal proxy that uses the PUSH0 opcode introduced during Shanghai.
It is optimized first for minimal runtime gas, then for minimal bytecode.
The PUSH0 clone functions are intentionally postfixed with a jarring "_PUSH0" as
many EVM chains may not support the PUSH0 opcode in the early months after Shanghai.
Please use with caution.</p>
<ul>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p>*Clones with immutable args (CWIA):
The implementation of CWIA here does NOT append the immutable args into the calldata
passed into delegatecall. It is simply an ERC1167 minimal proxy with the immutable arguments
appended to the back of the runtime bytecode.</p>
<ul>
<li>Uses the identity precompile (0x4) to copy args during deployment.*</li>
</ul>
<p>*Minimal ERC1967 proxy:
A minimal ERC1967 proxy, intended to be upgraded with UUPS.
This is NOT the same as ERC1967Factory's transparent proxy, which includes admin logic.</p>
<ul>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p>*Minimal ERC1967 proxy with immutable args:</p>
<ul>
<li>Uses the identity precompile (0x4) to copy args during deployment.</li>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p><em>ERC1967I proxy:
A variant of the minimal ERC1967 proxy, with a special code path that activates
if <code>calldatasize() == 1</code>. This code path skips the delegatecall and directly returns the
<code>implementation</code> address. The returned implementation is guaranteed to be valid if the
keccak256 of the proxy's code is equal to <code>ERC1967I_CODE_HASH</code>.</em></p>
<p>*ERC1967I proxy with immutable args:
A variant of the minimal ERC1967 proxy, with a special code path that activates
if <code>calldatasize() == 1</code>. This code path skips the delegatecall and directly returns the</p>
<ul>
<li>Uses the identity precompile (0x4) to copy args during deployment.*</li>
</ul>
<p>*Minimal ERC1967 beacon proxy:
A minimal beacon proxy, intended to be upgraded with an upgradable beacon.</p>
<ul>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p>*Minimal ERC1967 beacon proxy with immutable args:</p>
<ul>
<li>Uses the identity precompile (0x4) to copy args during deployment.</li>
<li>Automatically verified on Etherscan.*</li>
</ul>
<p><em>ERC1967I beacon proxy:
A variant of the minimal ERC1967 beacon proxy, with a special code path that activates
if <code>calldatasize() == 1</code>. This code path skips the delegatecall and directly returns the
<code>implementation</code> address. The returned implementation is guaranteed to be valid if the
keccak256 of the proxy's code is equal to <code>ERC1967I_CODE_HASH</code>.</em></p>
<p>*ERC1967I proxy with immutable args:
A variant of the minimal ERC1967 beacon proxy, with a special code path that activates
if <code>calldatasize() == 1</code>. This code path skips the delegatecall and directly returns the</p>
<ul>
<li>Uses the identity precompile (0x4) to copy args during deployment.*</li>
</ul>
<h2 id="functions-26"><a class="header" href="#functions-26">Functions</a></h2>
<h3 id="clone"><a class="header" href="#clone">clone</a></h3>
<p><em>Deploys a clone of <code>implementation</code>.</em></p>
<pre><code class="language-solidity">function clone(address implementation) internal returns (address instance);
</code></pre>
<h3 id="clone-1"><a class="header" href="#clone-1">clone</a></h3>
<p><em>Deploys a clone of <code>implementation</code>.
Deposits <code>value</code> ETH during deployment.</em></p>
<pre><code class="language-solidity">function clone(uint256 value, address implementation) internal returns (address instance);
</code></pre>
<h2 id="errors-4"><a class="header" href="#errors-4">Errors</a></h2>
<h3 id="deploymentfailed"><a class="header" href="#deploymentfailed">DeploymentFailed</a></h3>
<p><em>Unable to deploy the clone.</em></p>
<pre><code class="language-solidity">error DeploymentFailed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedownableroles"><a class="header" href="#optimizedownableroles">OptimizedOwnableRoles</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedOwnableRoles.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/libraries/OptimizedOwnableRoles.sol//src/vendor/Ownable.sol/abstract.Ownable.html">Ownable</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/auth/OptimizedOwnableRoles.sol)</p>
<p>Simple single owner and multiroles authorization mixin.</p>
<p><em>Note:
This implementation does NOT auto-initialize the owner to <code>msg.sender</code>.
You MUST call the <code>_initializeOwner</code> in the constructor / initializer.
While the ownable portion follows
<a href="https://eips.ethereum.org/EIPS/eip-173">EIP-173</a> for compatibility,
the nomenclature for the 2-step ownership handover may be unique to this codebase.</em></p>
<h2 id="state-variables-9"><a class="header" href="#state-variables-9">State Variables</a></h2>
<h3 id="_roles_updated_event_signature"><a class="header" href="#_roles_updated_event_signature">_ROLES_UPDATED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("RolesUpdated(address,uint256)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _ROLES_UPDATED_EVENT_SIGNATURE =
    0x715ad5ce61fc9595c7b415289d59cf203f23a94fa06f04af7e489a0a76e1fe26;
</code></pre>
<h3 id="_role_slot_seed"><a class="header" href="#_role_slot_seed">_ROLE_SLOT_SEED</a></h3>
<p>*The role slot of <code>user</code> is given by:</p>
<pre><code>mstore(0x00, or(shl(96, user), _ROLE_SLOT_SEED))
let roleSlot := keccak256(0x00, 0x20)
</code></pre>
<p>This automatically ignores the upper bits of the <code>user</code> in case
they are not clean, as well as keep the <code>keccak256</code> under 32-bytes.
Note: This is equivalent to <code>uint32(bytes4(keccak256("_OWNER_SLOT_NOT")))</code>.*</p>
<pre><code class="language-solidity">uint256 private constant _ROLE_SLOT_SEED = 0x8b78c6d8;
</code></pre>
<h3 id="_role_0"><a class="header" href="#_role_0">_ROLE_0</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_0 = 1 &lt;&lt; 0;
</code></pre>
<h3 id="_role_1"><a class="header" href="#_role_1">_ROLE_1</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_1 = 1 &lt;&lt; 1;
</code></pre>
<h3 id="_role_2"><a class="header" href="#_role_2">_ROLE_2</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_2 = 1 &lt;&lt; 2;
</code></pre>
<h3 id="_role_3"><a class="header" href="#_role_3">_ROLE_3</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_3 = 1 &lt;&lt; 3;
</code></pre>
<h3 id="_role_4"><a class="header" href="#_role_4">_ROLE_4</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_4 = 1 &lt;&lt; 4;
</code></pre>
<h3 id="_role_5"><a class="header" href="#_role_5">_ROLE_5</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_5 = 1 &lt;&lt; 5;
</code></pre>
<h3 id="_role_6"><a class="header" href="#_role_6">_ROLE_6</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_6 = 1 &lt;&lt; 6;
</code></pre>
<h3 id="_role_7"><a class="header" href="#_role_7">_ROLE_7</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_7 = 1 &lt;&lt; 7;
</code></pre>
<h3 id="_role_8"><a class="header" href="#_role_8">_ROLE_8</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_8 = 1 &lt;&lt; 8;
</code></pre>
<h3 id="_role_9"><a class="header" href="#_role_9">_ROLE_9</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_9 = 1 &lt;&lt; 9;
</code></pre>
<h3 id="_role_10"><a class="header" href="#_role_10">_ROLE_10</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_10 = 1 &lt;&lt; 10;
</code></pre>
<h3 id="_role_11"><a class="header" href="#_role_11">_ROLE_11</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_11 = 1 &lt;&lt; 11;
</code></pre>
<h3 id="_role_12"><a class="header" href="#_role_12">_ROLE_12</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_12 = 1 &lt;&lt; 12;
</code></pre>
<h3 id="_role_13"><a class="header" href="#_role_13">_ROLE_13</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_13 = 1 &lt;&lt; 13;
</code></pre>
<h3 id="_role_14"><a class="header" href="#_role_14">_ROLE_14</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_14 = 1 &lt;&lt; 14;
</code></pre>
<h3 id="_role_15"><a class="header" href="#_role_15">_ROLE_15</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_15 = 1 &lt;&lt; 15;
</code></pre>
<h3 id="_role_16"><a class="header" href="#_role_16">_ROLE_16</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_16 = 1 &lt;&lt; 16;
</code></pre>
<h3 id="_role_17"><a class="header" href="#_role_17">_ROLE_17</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_17 = 1 &lt;&lt; 17;
</code></pre>
<h3 id="_role_18"><a class="header" href="#_role_18">_ROLE_18</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_18 = 1 &lt;&lt; 18;
</code></pre>
<h3 id="_role_19"><a class="header" href="#_role_19">_ROLE_19</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_19 = 1 &lt;&lt; 19;
</code></pre>
<h3 id="_role_20"><a class="header" href="#_role_20">_ROLE_20</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_20 = 1 &lt;&lt; 20;
</code></pre>
<h3 id="_role_21"><a class="header" href="#_role_21">_ROLE_21</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_21 = 1 &lt;&lt; 21;
</code></pre>
<h3 id="_role_22"><a class="header" href="#_role_22">_ROLE_22</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_22 = 1 &lt;&lt; 22;
</code></pre>
<h3 id="_role_23"><a class="header" href="#_role_23">_ROLE_23</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_23 = 1 &lt;&lt; 23;
</code></pre>
<h3 id="_role_24"><a class="header" href="#_role_24">_ROLE_24</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_24 = 1 &lt;&lt; 24;
</code></pre>
<h3 id="_role_25"><a class="header" href="#_role_25">_ROLE_25</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_25 = 1 &lt;&lt; 25;
</code></pre>
<h3 id="_role_26"><a class="header" href="#_role_26">_ROLE_26</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_26 = 1 &lt;&lt; 26;
</code></pre>
<h3 id="_role_27"><a class="header" href="#_role_27">_ROLE_27</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_27 = 1 &lt;&lt; 27;
</code></pre>
<h3 id="_role_28"><a class="header" href="#_role_28">_ROLE_28</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_28 = 1 &lt;&lt; 28;
</code></pre>
<h3 id="_role_29"><a class="header" href="#_role_29">_ROLE_29</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_29 = 1 &lt;&lt; 29;
</code></pre>
<h3 id="_role_30"><a class="header" href="#_role_30">_ROLE_30</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_30 = 1 &lt;&lt; 30;
</code></pre>
<h3 id="_role_31"><a class="header" href="#_role_31">_ROLE_31</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_31 = 1 &lt;&lt; 31;
</code></pre>
<h3 id="_role_32"><a class="header" href="#_role_32">_ROLE_32</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_32 = 1 &lt;&lt; 32;
</code></pre>
<h3 id="_role_33"><a class="header" href="#_role_33">_ROLE_33</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_33 = 1 &lt;&lt; 33;
</code></pre>
<h3 id="_role_34"><a class="header" href="#_role_34">_ROLE_34</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_34 = 1 &lt;&lt; 34;
</code></pre>
<h3 id="_role_35"><a class="header" href="#_role_35">_ROLE_35</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_35 = 1 &lt;&lt; 35;
</code></pre>
<h3 id="_role_36"><a class="header" href="#_role_36">_ROLE_36</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_36 = 1 &lt;&lt; 36;
</code></pre>
<h3 id="_role_37"><a class="header" href="#_role_37">_ROLE_37</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_37 = 1 &lt;&lt; 37;
</code></pre>
<h3 id="_role_38"><a class="header" href="#_role_38">_ROLE_38</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_38 = 1 &lt;&lt; 38;
</code></pre>
<h3 id="_role_39"><a class="header" href="#_role_39">_ROLE_39</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_39 = 1 &lt;&lt; 39;
</code></pre>
<h3 id="_role_40"><a class="header" href="#_role_40">_ROLE_40</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_40 = 1 &lt;&lt; 40;
</code></pre>
<h3 id="_role_41"><a class="header" href="#_role_41">_ROLE_41</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_41 = 1 &lt;&lt; 41;
</code></pre>
<h3 id="_role_42"><a class="header" href="#_role_42">_ROLE_42</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_42 = 1 &lt;&lt; 42;
</code></pre>
<h3 id="_role_43"><a class="header" href="#_role_43">_ROLE_43</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_43 = 1 &lt;&lt; 43;
</code></pre>
<h3 id="_role_44"><a class="header" href="#_role_44">_ROLE_44</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_44 = 1 &lt;&lt; 44;
</code></pre>
<h3 id="_role_45"><a class="header" href="#_role_45">_ROLE_45</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_45 = 1 &lt;&lt; 45;
</code></pre>
<h3 id="_role_46"><a class="header" href="#_role_46">_ROLE_46</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_46 = 1 &lt;&lt; 46;
</code></pre>
<h3 id="_role_47"><a class="header" href="#_role_47">_ROLE_47</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_47 = 1 &lt;&lt; 47;
</code></pre>
<h3 id="_role_48"><a class="header" href="#_role_48">_ROLE_48</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_48 = 1 &lt;&lt; 48;
</code></pre>
<h3 id="_role_49"><a class="header" href="#_role_49">_ROLE_49</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_49 = 1 &lt;&lt; 49;
</code></pre>
<h3 id="_role_50"><a class="header" href="#_role_50">_ROLE_50</a></h3>
<pre><code class="language-solidity">uint256 internal constant _ROLE_50 = 1 &lt;&lt; 50;
</code></pre>
<h2 id="functions-27"><a class="header" href="#functions-27">Functions</a></h2>
<h3 id="_setroles"><a class="header" href="#_setroles">_setRoles</a></h3>
<p><em>Overwrite the roles directly without authorization guard.</em></p>
<pre><code class="language-solidity">function _setRoles(address user, uint256 roles) internal virtual;
</code></pre>
<h3 id="_updateroles"><a class="header" href="#_updateroles">_updateRoles</a></h3>
<p><em>Updates the roles directly without authorization guard.
If <code>on</code> is true, each set bit of <code>roles</code> will be turned on,
otherwise, each set bit of <code>roles</code> will be turned off.</em></p>
<pre><code class="language-solidity">function _updateRoles(address user, uint256 roles, bool on) internal virtual;
</code></pre>
<h3 id="_grantroles"><a class="header" href="#_grantroles">_grantRoles</a></h3>
<p><em>Grants the roles directly without authorization guard.
Each bit of <code>roles</code> represents the role to turn on.</em></p>
<pre><code class="language-solidity">function _grantRoles(address user, uint256 roles) internal virtual;
</code></pre>
<h3 id="_removeroles"><a class="header" href="#_removeroles">_removeRoles</a></h3>
<p><em>Removes the roles directly without authorization guard.
Each bit of <code>roles</code> represents the role to turn off.</em></p>
<pre><code class="language-solidity">function _removeRoles(address user, uint256 roles) internal virtual;
</code></pre>
<h3 id="_checkroles"><a class="header" href="#_checkroles">_checkRoles</a></h3>
<p><em>Throws if the sender does not have any of the <code>roles</code>.</em></p>
<pre><code class="language-solidity">function _checkRoles(uint256 roles) internal view virtual;
</code></pre>
<h3 id="_checkownerorroles"><a class="header" href="#_checkownerorroles">_checkOwnerOrRoles</a></h3>
<p><em>Throws if the sender is not the owner,
and does not have any of the <code>roles</code>.
Checks for ownership first, then lazily checks for roles.</em></p>
<pre><code class="language-solidity">function _checkOwnerOrRoles(uint256 roles) internal view virtual;
</code></pre>
<h3 id="_checkrolesorowner"><a class="header" href="#_checkrolesorowner">_checkRolesOrOwner</a></h3>
<p><em>Throws if the sender does not have any of the <code>roles</code>,
and is not the owner.
Checks for roles first, then lazily checks for ownership.</em></p>
<pre><code class="language-solidity">function _checkRolesOrOwner(uint256 roles) internal view virtual;
</code></pre>
<h3 id="_rolesfromordinals"><a class="header" href="#_rolesfromordinals">_rolesFromOrdinals</a></h3>
<p><em>Convenience function to return a <code>roles</code> bitmap from an array of <code>ordinals</code>.
This is meant for frontends like Etherscan, and is therefore not fully optimized.
Not recommended to be called on-chain.
Made internal to conserve bytecode. Wrap it in a public function if needed.</em></p>
<pre><code class="language-solidity">function _rolesFromOrdinals(uint8[] memory ordinals) internal pure returns (uint256 roles);
</code></pre>
<h3 id="_ordinalsfromroles"><a class="header" href="#_ordinalsfromroles">_ordinalsFromRoles</a></h3>
<p><em>Convenience function to return an array of <code>ordinals</code> from the <code>roles</code> bitmap.
This is meant for frontends like Etherscan, and is therefore not fully optimized.
Not recommended to be called on-chain.
Made internal to conserve bytecode. Wrap it in a public function if needed.</em></p>
<pre><code class="language-solidity">function _ordinalsFromRoles(uint256 roles) internal pure returns (uint8[] memory ordinals);
</code></pre>
<h3 id="grantroles"><a class="header" href="#grantroles">grantRoles</a></h3>
<p><em>Allows the owner to grant <code>user</code> <code>roles</code>.
If the <code>user</code> already has a role, then it will be an no-op for the role.</em></p>
<pre><code class="language-solidity">function grantRoles(address user, uint256 roles) public payable virtual onlyOwner;
</code></pre>
<h3 id="revokeroles"><a class="header" href="#revokeroles">revokeRoles</a></h3>
<p><em>Allows the owner to remove <code>user</code> <code>roles</code>.
If the <code>user</code> does not have a role, then it will be an no-op for the role.</em></p>
<pre><code class="language-solidity">function revokeRoles(address user, uint256 roles) public payable virtual onlyOwner;
</code></pre>
<h3 id="renounceroles"><a class="header" href="#renounceroles">renounceRoles</a></h3>
<p><em>Allow the caller to remove their own roles.
If the caller does not have a role, then it will be an no-op for the role.</em></p>
<pre><code class="language-solidity">function renounceRoles(uint256 roles) public payable virtual;
</code></pre>
<h3 id="rolesof"><a class="header" href="#rolesof">rolesOf</a></h3>
<p><em>Returns the roles of <code>user</code>.</em></p>
<pre><code class="language-solidity">function rolesOf(address user) public view virtual returns (uint256 roles);
</code></pre>
<h3 id="hasanyrole"><a class="header" href="#hasanyrole">hasAnyRole</a></h3>
<p><em>Returns whether <code>user</code> has any of <code>roles</code>.</em></p>
<pre><code class="language-solidity">function hasAnyRole(address user, uint256 roles) public view virtual returns (bool);
</code></pre>
<h3 id="hasallroles"><a class="header" href="#hasallroles">hasAllRoles</a></h3>
<p><em>Returns whether <code>user</code> has all of <code>roles</code>.</em></p>
<pre><code class="language-solidity">function hasAllRoles(address user, uint256 roles) public view virtual returns (bool);
</code></pre>
<h3 id="onlyroles"><a class="header" href="#onlyroles">onlyRoles</a></h3>
<p><em>Marks a function as only callable by an account with <code>roles</code>.</em></p>
<pre><code class="language-solidity">modifier onlyRoles(uint256 roles) virtual;
</code></pre>
<h3 id="onlyownerorroles"><a class="header" href="#onlyownerorroles">onlyOwnerOrRoles</a></h3>
<p><em>Marks a function as only callable by the owner or by an account
with <code>roles</code>. Checks for ownership first, then lazily checks for roles.</em></p>
<pre><code class="language-solidity">modifier onlyOwnerOrRoles(uint256 roles) virtual;
</code></pre>
<h3 id="onlyrolesorowner"><a class="header" href="#onlyrolesorowner">onlyRolesOrOwner</a></h3>
<p><em>Marks a function as only callable by an account with <code>roles</code>
or the owner. Checks for roles first, then lazily checks for ownership.</em></p>
<pre><code class="language-solidity">modifier onlyRolesOrOwner(uint256 roles) virtual;
</code></pre>
<h2 id="events-9"><a class="header" href="#events-9">Events</a></h2>
<h3 id="rolesupdated"><a class="header" href="#rolesupdated">RolesUpdated</a></h3>
<p><em>The <code>user</code>'s roles is updated to <code>roles</code>.
Each bit of <code>roles</code> represents whether the role is set.</em></p>
<pre><code class="language-solidity">event RolesUpdated(address indexed user, uint256 indexed roles);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optimizedsafecastlib"><a class="header" href="#optimizedsafecastlib">OptimizedSafeCastLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/libraries/OptimizedSafeCastLib.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/SafeCastLib.sol), Modified from OpenZeppelin
(https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/math/SafeCast.sol)</p>
<p>Safe integer casting library that reverts on overflow.</p>
<p><em>Optimized for runtime gas for very high number of optimizer runs (i.e. &gt;= 1000000).</em></p>
<h2 id="functions-28"><a class="header" href="#functions-28">Functions</a></h2>
<h3 id="touint64"><a class="header" href="#touint64">toUint64</a></h3>
<p><em>Casts <code>x</code> to a uint64. Reverts on overflow.</em></p>
<pre><code class="language-solidity">function toUint64(uint256 x) internal pure returns (uint64);
</code></pre>
<h3 id="touint128"><a class="header" href="#touint128">toUint128</a></h3>
<p><em>Casts <code>x</code> to a uint128. Reverts on overflow.</em></p>
<pre><code class="language-solidity">function toUint128(uint256 x) internal pure returns (uint128);
</code></pre>
<h3 id="touint256"><a class="header" href="#touint256">toUint256</a></h3>
<p><em>Casts <code>x</code> to a uint256. Reverts on overflow.</em></p>
<pre><code class="language-solidity">function toUint256(int256 x) internal pure returns (uint256);
</code></pre>
<h3 id="_revertoverflow"><a class="header" href="#_revertoverflow">_revertOverflow</a></h3>
<pre><code class="language-solidity">function _revertOverflow() private pure;
</code></pre>
<h2 id="errors-5"><a class="header" href="#errors-5">Errors</a></h2>
<h3 id="overflow"><a class="header" href="#overflow">Overflow</a></h3>
<p><em>Unable to cast to the target type due to overflow.</em></p>
<pre><code class="language-solidity">error Overflow();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-11"><a class="header" href="#contents-11">Contents</a></h1>
<ul>
<li><a href="src/vendor/ERC1967Factory.sol/contract.ERC1967Factory.html">ERC1967Factory</a></li>
<li><a href="src/vendor/ERC20.sol/abstract.ERC20.html">ERC20</a></li>
<li><a href="src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a></li>
<li><a href="src/vendor/Multicallable.sol/abstract.Multicallable.html">Multicallable</a></li>
<li><a href="src/vendor/Ownable.sol/abstract.Ownable.html">Ownable</a></li>
<li><a href="src/vendor/SafeTransferLib.sol/library.SafeTransferLib.html">SafeTransferLib</a></li>
<li><a href="src/vendor/UUPSUpgradeable.sol/contract.CallContextChecker.html">CallContextChecker</a></li>
<li><a href="src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="erc1967factory"><a class="header" href="#erc1967factory">ERC1967Factory</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/ERC1967Factory.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/ERC1967Factory.sol), jtriley-eth (https://github.com/jtriley-eth/minimum-viable-proxy)</p>
<p>Factory for deploying and managing ERC1967 proxy contracts.</p>
<h2 id="state-variables-10"><a class="header" href="#state-variables-10">State Variables</a></h2>
<h3 id="_unauthorized_error_selector"><a class="header" href="#_unauthorized_error_selector">_UNAUTHORIZED_ERROR_SELECTOR</a></h3>
<p><em><code>bytes4(keccak256(bytes("Unauthorized()")))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _UNAUTHORIZED_ERROR_SELECTOR = 0x82b42900;
</code></pre>
<h3 id="_deployment_failed_error_selector"><a class="header" href="#_deployment_failed_error_selector">_DEPLOYMENT_FAILED_ERROR_SELECTOR</a></h3>
<p><em><code>bytes4(keccak256(bytes("DeploymentFailed()")))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _DEPLOYMENT_FAILED_ERROR_SELECTOR = 0x30116425;
</code></pre>
<h3 id="_upgrade_failed_error_selector"><a class="header" href="#_upgrade_failed_error_selector">_UPGRADE_FAILED_ERROR_SELECTOR</a></h3>
<p><em><code>bytes4(keccak256(bytes("UpgradeFailed()")))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _UPGRADE_FAILED_ERROR_SELECTOR = 0x55299b49;
</code></pre>
<h3 id="_salt_does_not_start_with_caller_error_selector"><a class="header" href="#_salt_does_not_start_with_caller_error_selector">_SALT_DOES_NOT_START_WITH_CALLER_ERROR_SELECTOR</a></h3>
<p><em><code>bytes4(keccak256(bytes("SaltDoesNotStartWithCaller()")))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _SALT_DOES_NOT_START_WITH_CALLER_ERROR_SELECTOR = 0x2f634836;
</code></pre>
<h3 id="_admin_changed_event_signature"><a class="header" href="#_admin_changed_event_signature">_ADMIN_CHANGED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("AdminChanged(address,address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _ADMIN_CHANGED_EVENT_SIGNATURE =
    0x7e644d79422f17c01e4894b5f4f588d331ebfa28653d42ae832dc59e38c9798f;
</code></pre>
<h3 id="_upgraded_event_signature"><a class="header" href="#_upgraded_event_signature">_UPGRADED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Upgraded(address,address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _UPGRADED_EVENT_SIGNATURE = 0x5d611f318680d00598bb735d61bacf0c514c6b50e1e5ad30040a4df2b12791c7;
</code></pre>
<h3 id="_deployed_event_signature"><a class="header" href="#_deployed_event_signature">_DEPLOYED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Deployed(address,address,address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _DEPLOYED_EVENT_SIGNATURE = 0xc95935a66d15e0da5e412aca0ad27ae891d20b2fb91cf3994b6a3bf2b8178082;
</code></pre>
<h3 id="_implementation_slot"><a class="header" href="#_implementation_slot">_IMPLEMENTATION_SLOT</a></h3>
<p><em>The ERC-1967 storage slot for the implementation in the proxy.
<code>uint256(keccak256("eip1967.proxy.implementation")) - 1</code>.</em></p>
<pre><code class="language-solidity">uint256 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;
</code></pre>
<h2 id="functions-29"><a class="header" href="#functions-29">Functions</a></h2>
<h3 id="adminof"><a class="header" href="#adminof">adminOf</a></h3>
<p><em>Returns the admin of the proxy.</em></p>
<pre><code class="language-solidity">function adminOf(address proxy) public view returns (address admin);
</code></pre>
<h3 id="changeadmin"><a class="header" href="#changeadmin">changeAdmin</a></h3>
<p><em>Sets the admin of the proxy.
The caller of this function must be the admin of the proxy on this factory.</em></p>
<pre><code class="language-solidity">function changeAdmin(address proxy, address admin) public;
</code></pre>
<h3 id="upgrade"><a class="header" href="#upgrade">upgrade</a></h3>
<p><em>Upgrades the proxy to point to <code>implementation</code>.
The caller of this function must be the admin of the proxy on this factory.</em></p>
<pre><code class="language-solidity">function upgrade(address proxy, address implementation) public payable;
</code></pre>
<h3 id="upgradeandcall"><a class="header" href="#upgradeandcall">upgradeAndCall</a></h3>
<p><em>Upgrades the proxy to point to <code>implementation</code>.
Then, calls the proxy with abi encoded <code>data</code>.
The caller of this function must be the admin of the proxy on this factory.</em></p>
<pre><code class="language-solidity">function upgradeAndCall(address proxy, address implementation, bytes calldata data) public payable;
</code></pre>
<h3 id="deploy"><a class="header" href="#deploy">deploy</a></h3>
<p><em>Deploys a proxy for <code>implementation</code>, with <code>admin</code>,
and returns its address.
The value passed into this function will be forwarded to the proxy.</em></p>
<pre><code class="language-solidity">function deploy(address implementation, address admin) public payable returns (address proxy);
</code></pre>
<h3 id="deployandcall"><a class="header" href="#deployandcall">deployAndCall</a></h3>
<p><em>Deploys a proxy for <code>implementation</code>, with <code>admin</code>,
and returns its address.
The value passed into this function will be forwarded to the proxy.
Then, calls the proxy with abi encoded <code>data</code>.</em></p>
<pre><code class="language-solidity">function deployAndCall(
    address implementation,
    address admin,
    bytes calldata data
)
    public
    payable
    returns (address proxy);
</code></pre>
<h3 id="deploydeterministic"><a class="header" href="#deploydeterministic">deployDeterministic</a></h3>
<p><em>Deploys a proxy for <code>implementation</code>, with <code>admin</code>, <code>salt</code>,
and returns its deterministic address.
The value passed into this function will be forwarded to the proxy.</em></p>
<pre><code class="language-solidity">function deployDeterministic(
    address implementation,
    address admin,
    bytes32 salt
)
    public
    payable
    returns (address proxy);
</code></pre>
<h3 id="deploydeterministicandcall"><a class="header" href="#deploydeterministicandcall">deployDeterministicAndCall</a></h3>
<p><em>Deploys a proxy for <code>implementation</code>, with <code>admin</code>, <code>salt</code>,
and returns its deterministic address.
The value passed into this function will be forwarded to the proxy.
Then, calls the proxy with abi encoded <code>data</code>.</em></p>
<pre><code class="language-solidity">function deployDeterministicAndCall(
    address implementation,
    address admin,
    bytes32 salt,
    bytes calldata data
)
    public
    payable
    returns (address proxy);
</code></pre>
<h3 id="_deploy"><a class="header" href="#_deploy">_deploy</a></h3>
<p><em>Deploys the proxy, with optionality to deploy deterministically with a <code>salt</code>.</em></p>
<pre><code class="language-solidity">function _deploy(
    address implementation,
    address admin,
    bytes32 salt,
    bool useSalt,
    bytes calldata data
)
    internal
    returns (address proxy);
</code></pre>
<h3 id="predictdeterministicaddress"><a class="header" href="#predictdeterministicaddress">predictDeterministicAddress</a></h3>
<p><em>Returns the address of the proxy deployed with <code>salt</code>.</em></p>
<pre><code class="language-solidity">function predictDeterministicAddress(bytes32 salt) public view returns (address predicted);
</code></pre>
<h3 id="initcodehash"><a class="header" href="#initcodehash">initCodeHash</a></h3>
<p><em>Returns the initialization code hash of the proxy.
Used for mining vanity addresses with create2crunch.</em></p>
<pre><code class="language-solidity">function initCodeHash() public view returns (bytes32 result);
</code></pre>
<h3 id="_initcode"><a class="header" href="#_initcode">_initCode</a></h3>
<p><em>Returns a pointer to the initialization code of a proxy created via this factory.</em></p>
<pre><code class="language-solidity">function _initCode() internal view returns (bytes32 m);
</code></pre>
<h3 id="_emptydata"><a class="header" href="#_emptydata">_emptyData</a></h3>
<p>-------------------------------------------------------------------------------------+
CREATION (9 bytes)                                                                   |
-------------------------------------------------------------------------------------|
Opcode     | Mnemonic        | Stack               | Memory                          |
-------------------------------------------------------------------------------------|
60 runSize | PUSH1 runSize   | r                   |                                 |
3d         | RETURNDATASIZE  | 0 r                 |                                 |
81         | DUP2            | r 0 r               |                                 |
60 offset  | PUSH1 offset    | o r 0 r             |                                 |
3d         | RETURNDATASIZE  | 0 o r 0 r           |                                 |
39         | CODECOPY        | 0 r                 | [0..runSize): runtime code      |
f3         | RETURN          |                     | [0..runSize): runtime code      |
-------------------------------------------------------------------------------------|
RUNTIME (127 bytes)                                                                  |
-------------------------------------------------------------------------------------|
Opcode      | Mnemonic       | Stack               | Memory                          |
-------------------------------------------------------------------------------------|
|
::: keep some values in stack :::::::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | 0                   |                                 |
3d          | RETURNDATASIZE | 0 0                 |                                 |
|
::: check if caller is factory ::::::::::::::::::::::::::::::::::::::::::::::::::::: |
33          | CALLER         | c 0 0               |                                 |
73 factory  | PUSH20 factory | f c 0 0             |                                 |
14          | EQ             | isf 0 0             |                                 |
60 0x57     | PUSH1 0x57     | dest isf 0 0        |                                 |
57          | JUMPI          | 0 0                 |                                 |
|
::: copy calldata to memory :::::::::::::::::::::::::::::::::::::::::::::::::::::::: |
36          | CALLDATASIZE   | cds 0 0             |                                 |
3d          | RETURNDATASIZE | 0 cds 0 0           |                                 |
3d          | RETURNDATASIZE | 0 0 cds 0 0         |                                 |
37          | CALLDATACOPY   | 0 0                 | [0..calldatasize): calldata     |
|
::: delegatecall to implementation ::::::::::::::::::::::::::::::::::::::::::::::::: |
36          | CALLDATASIZE   | cds 0 0             | [0..calldatasize): calldata     |
3d          | RETURNDATASIZE | 0 cds 0 0           | [0..calldatasize): calldata     |
7f slot     | PUSH32 slot    | s 0 cds 0 0         | [0..calldatasize): calldata     |
54          | SLOAD          | i 0 cds 0 0         | [0..calldatasize): calldata     |
5a          | GAS            | g i 0 cds 0 0       | [0..calldatasize): calldata     |
f4          | DELEGATECALL   | succ                | [0..calldatasize): calldata     |
|
::: copy returndata to memory :::::::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | rds succ            | [0..calldatasize): calldata     |
60 0x00     | PUSH1 0x00     | 0 rds succ          | [0..calldatasize): calldata     |
80          | DUP1           | 0 0 rds succ        | [0..calldatasize): calldata     |
3e          | RETURNDATACOPY | succ                | [0..returndatasize): returndata |
|
::: branch on delegatecall status :::::::::::::::::::::::::::::::::::::::::::::::::: |
60 0x52     | PUSH1 0x52     | dest succ           | [0..returndatasize): returndata |
57          | JUMPI          |                     | [0..returndatasize): returndata |
|
::: delegatecall failed, revert :::::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | rds                 | [0..returndatasize): returndata |
60 0x00     | PUSH1 0x00     | 0 rds               | [0..returndatasize): returndata |
fd          | REVERT         |                     | [0..returndatasize): returndata |
|
::: delegatecall succeeded, return ::::::::::::::::::::::::::::::::::::::::::::::::: |
5b          | JUMPDEST       |                     | [0..returndatasize): returndata |
3d          | RETURNDATASIZE | rds                 | [0..returndatasize): returndata |
60 0x00     | PUSH1 0x00     | 0 rds               | [0..returndatasize): returndata |
f3          | RETURN         |                     | [0..returndatasize): returndata |
|
::: set new implementation (caller is factory) ::::::::::::::::::::::::::::::::::::: |
5b          | JUMPDEST       | 0 0                 |                                 |
3d          | RETURNDATASIZE | 0 0 0               |                                 |
35          | CALLDATALOAD   | impl 0 0            |                                 |
60 0x20     | PUSH1 0x20     | w impl 0 0          |                                 |
35          | CALLDATALOAD   | slot impl 0 0       |                                 |
55          | SSTORE         | 0 0                 |                                 |
|
::: no extra calldata, return :::::::::::::::::::::::::::::::::::::::::::::::::::::: |
60 0x40     | PUSH1 0x40     | 2w 0 0              |                                 |
80          | DUP1           | 2w 2w 0 0           |                                 |
36          | CALLDATASIZE   | cds 2w 2w 0 0       |                                 |
11          | GT             | gt 2w 0 0           |                                 |
15          | ISZERO         | lte 2w 0 0          |                                 |
60 0x52     | PUSH1 0x52     | dest lte 2w 0 0     |                                 |
57          | JUMPI          | 2w 0 0              |                                 |
|
::: copy extra calldata to memory :::::::::::::::::::::::::::::::::::::::::::::::::: |
36          | CALLDATASIZE   | cds 2w 0 0          |                                 |
03          | SUB            | t 0 0               |                                 |
80          | DUP1           | t t 0 0             |                                 |
60 0x40     | PUSH1 0x40     | 2w t t 0 0          |                                 |
3d          | RETURNDATASIZE | 0 2w t t 0 0        |                                 |
37          | CALLDATACOPY   | t 0 0               | [0..t): extra calldata          |
|
::: delegatecall to implementation ::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | 0 t 0 0             | [0..t): extra calldata          |
3d          | RETURNDATASIZE | 0 0 t 0 0           | [0..t): extra calldata          |
35          | CALLDATALOAD   | i 0 t 0 0           | [0..t): extra calldata          |
5a          | GAS            | g i 0 t 0 0         | [0..t): extra calldata          |
f4          | DELEGATECALL   | succ                | [0..t): extra calldata          |
|
::: copy returndata to memory :::::::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | rds succ            | [0..t): extra calldata          |
60 0x00     | PUSH1 0x00     | 0 rds succ          | [0..t): extra calldata          |
80          | DUP1           | 0 0 rds succ        | [0..t): extra calldata          |
3e          | RETURNDATACOPY | succ                | [0..returndatasize): returndata |
|
::: branch on delegatecall status :::::::::::::::::::::::::::::::::::::::::::::::::: |
60 0x52     | PUSH1 0x52     | dest succ           | [0..returndatasize): returndata |
57          | JUMPI          |                     | [0..returndatasize): returndata |
|
::: delegatecall failed, revert :::::::::::::::::::::::::::::::::::::::::::::::::::: |
3d          | RETURNDATASIZE | rds                 | [0..returndatasize): returndata |
60 0x00     | PUSH1 0x00     | 0 rds               | [0..returndatasize): returndata |
fd          | REVERT         |                     | [0..returndatasize): returndata |
-------------------------------------------------------------------------------------+</p>
<p><em>Helper function to return an empty bytes calldata.</em></p>
<pre><code class="language-solidity">function _emptyData() internal pure returns (bytes calldata data);
</code></pre>
<h2 id="events-10"><a class="header" href="#events-10">Events</a></h2>
<h3 id="adminchanged"><a class="header" href="#adminchanged">AdminChanged</a></h3>
<p><em>The admin of a proxy contract has been changed.</em></p>
<pre><code class="language-solidity">event AdminChanged(address indexed proxy, address indexed admin);
</code></pre>
<h3 id="upgraded"><a class="header" href="#upgraded">Upgraded</a></h3>
<p><em>The implementation for a proxy has been upgraded.</em></p>
<pre><code class="language-solidity">event Upgraded(address indexed proxy, address indexed implementation);
</code></pre>
<h3 id="deployed"><a class="header" href="#deployed">Deployed</a></h3>
<p><em>A proxy has been deployed.</em></p>
<pre><code class="language-solidity">event Deployed(address indexed proxy, address indexed implementation, address indexed admin);
</code></pre>
<h2 id="errors-6"><a class="header" href="#errors-6">Errors</a></h2>
<h3 id="unauthorized"><a class="header" href="#unauthorized">Unauthorized</a></h3>
<p><em>The caller is not authorized to call the function.</em></p>
<pre><code class="language-solidity">error Unauthorized();
</code></pre>
<h3 id="deploymentfailed-1"><a class="header" href="#deploymentfailed-1">DeploymentFailed</a></h3>
<p><em>The proxy deployment failed.</em></p>
<pre><code class="language-solidity">error DeploymentFailed();
</code></pre>
<h3 id="upgradefailed"><a class="header" href="#upgradefailed">UpgradeFailed</a></h3>
<p><em>The upgrade failed.</em></p>
<pre><code class="language-solidity">error UpgradeFailed();
</code></pre>
<h3 id="saltdoesnotstartwithcaller"><a class="header" href="#saltdoesnotstartwithcaller">SaltDoesNotStartWithCaller</a></h3>
<p><em>The salt does not start with the caller.</em></p>
<pre><code class="language-solidity">error SaltDoesNotStartWithCaller();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="erc20"><a class="header" href="#erc20">ERC20</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/ERC20.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/tokens/ERC20.sol), Modified from Solmate (https://github.com/transmissions11/solmate/blob/main/src/tokens/ERC20.sol), Modified from OpenZeppelin
(https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol)</p>
<p>Simple ERC20 + EIP-2612 implementation.</p>
<p>*Note:</p>
<ul>
<li>The ERC20 standard allows minting and transferring to and from the zero address,
minting and transferring zero tokens, as well as self-approvals.
For performance, this implementation WILL NOT revert for such actions.
Please add any checks with overrides if desired.</li>
<li>The <code>permit</code> function uses the ecrecover precompile (0x1).
If you are overriding:</li>
<li>NEVER violate the ERC20 invariant:
the total sum of all balances must be equal to <code>totalSupply()</code>.</li>
<li>Check that the overridden function is actually used in the function you want to
change the behavior of. Much of the code has been manually inlined for performance.*</li>
</ul>
<h2 id="state-variables-11"><a class="header" href="#state-variables-11">State Variables</a></h2>
<h3 id="_transfer_event_signature"><a class="header" href="#_transfer_event_signature">_TRANSFER_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Transfer(address,address,uint256)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _TRANSFER_EVENT_SIGNATURE = 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef;
</code></pre>
<h3 id="_approval_event_signature"><a class="header" href="#_approval_event_signature">_APPROVAL_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Approval(address,address,uint256)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _APPROVAL_EVENT_SIGNATURE = 0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925;
</code></pre>
<h3 id="_total_supply_slot"><a class="header" href="#_total_supply_slot">_TOTAL_SUPPLY_SLOT</a></h3>
<p><em>The storage slot for the total supply.</em></p>
<pre><code class="language-solidity">uint256 private constant _TOTAL_SUPPLY_SLOT = 0x05345cdf77eb68f44c;
</code></pre>
<h3 id="_balance_slot_seed"><a class="header" href="#_balance_slot_seed">_BALANCE_SLOT_SEED</a></h3>
<p>*The balance slot of <code>owner</code> is given by:</p>
<pre><code>mstore(0x0c, _BALANCE_SLOT_SEED)
mstore(0x00, owner)
let balanceSlot := keccak256(0x0c, 0x20)
```*


```solidity
uint256 private constant _BALANCE_SLOT_SEED = 0x87a211a2;
</code></pre>
<h3 id="_allowance_slot_seed"><a class="header" href="#_allowance_slot_seed">_ALLOWANCE_SLOT_SEED</a></h3>
<p>*The allowance slot of (<code>owner</code>, <code>spender</code>) is given by:</p>
<pre><code>mstore(0x20, spender)
mstore(0x0c, _ALLOWANCE_SLOT_SEED)
mstore(0x00, owner)
let allowanceSlot := keccak256(0x0c, 0x34)
```*


```solidity
uint256 private constant _ALLOWANCE_SLOT_SEED = 0x7f5e9f20;
</code></pre>
<h3 id="_nonces_slot_seed"><a class="header" href="#_nonces_slot_seed">_NONCES_SLOT_SEED</a></h3>
<p>*The nonce slot of <code>owner</code> is given by:</p>
<pre><code>mstore(0x0c, _NONCES_SLOT_SEED)
mstore(0x00, owner)
let nonceSlot := keccak256(0x0c, 0x20)
```*


```solidity
uint256 private constant _NONCES_SLOT_SEED = 0x38377508;
</code></pre>
<h3 id="_nonces_slot_seed_with_signature_prefix"><a class="header" href="#_nonces_slot_seed_with_signature_prefix">_NONCES_SLOT_SEED_WITH_SIGNATURE_PREFIX</a></h3>
<p><em><code>(_NONCES_SLOT_SEED &lt;&lt; 16) | 0x1901</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _NONCES_SLOT_SEED_WITH_SIGNATURE_PREFIX = 0x383775081901;
</code></pre>
<h3 id="_domain_typehash"><a class="header" href="#_domain_typehash">_DOMAIN_TYPEHASH</a></h3>
<p><em><code>keccak256("EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)")</code>.</em></p>
<pre><code class="language-solidity">bytes32 private constant _DOMAIN_TYPEHASH = 0x8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f;
</code></pre>
<h3 id="_default_version_hash"><a class="header" href="#_default_version_hash">_DEFAULT_VERSION_HASH</a></h3>
<p><em><code>keccak256("1")</code>.
If you need to use a different version, override <code>_versionHash</code>.</em></p>
<pre><code class="language-solidity">bytes32 private constant _DEFAULT_VERSION_HASH = 0xc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc6;
</code></pre>
<h3 id="_permit_typehash"><a class="header" href="#_permit_typehash">_PERMIT_TYPEHASH</a></h3>
<p><em><code>keccak256("Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)")</code>.</em></p>
<pre><code class="language-solidity">bytes32 private constant _PERMIT_TYPEHASH = 0x6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c9;
</code></pre>
<h3 id="_permit2"><a class="header" href="#_permit2">_PERMIT2</a></h3>
<p><em>The canonical Permit2 address.
For signature-based allowance granting for single transaction ERC20 <code>transferFrom</code>.
Enabled by default. To disable, override <code>_givePermit2InfiniteAllowance()</code>.
<a href="https://github.com/Uniswap/permit2">Github</a>
<a href="https://etherscan.io/address/0x000000000022D473030F116dDEE9F6B43aC78BA3">Etherscan</a></em></p>
<pre><code class="language-solidity">address internal constant _PERMIT2 = 0x000000000022D473030F116dDEE9F6B43aC78BA3;
</code></pre>
<h2 id="functions-30"><a class="header" href="#functions-30">Functions</a></h2>
<h3 id="name-5"><a class="header" href="#name-5">name</a></h3>
<p><em>Returns the name of the token.</em></p>
<pre><code class="language-solidity">function name() public view virtual returns (string memory);
</code></pre>
<h3 id="symbol-3"><a class="header" href="#symbol-3">symbol</a></h3>
<p><em>Returns the symbol of the token.</em></p>
<pre><code class="language-solidity">function symbol() public view virtual returns (string memory);
</code></pre>
<h3 id="decimals-3"><a class="header" href="#decimals-3">decimals</a></h3>
<p><em>Returns the decimals places of the token.</em></p>
<pre><code class="language-solidity">function decimals() public view virtual returns (uint8);
</code></pre>
<h3 id="totalsupply-2"><a class="header" href="#totalsupply-2">totalSupply</a></h3>
<p><em>Returns the amount of tokens in existence.</em></p>
<pre><code class="language-solidity">function totalSupply() public view virtual returns (uint256 result);
</code></pre>
<h3 id="balanceof-2"><a class="header" href="#balanceof-2">balanceOf</a></h3>
<p><em>Returns the amount of tokens owned by <code>owner</code>.</em></p>
<pre><code class="language-solidity">function balanceOf(address owner) public view virtual returns (uint256 result);
</code></pre>
<h3 id="allowance-2"><a class="header" href="#allowance-2">allowance</a></h3>
<p><em>Returns the amount of tokens that <code>spender</code> can spend on behalf of <code>owner</code>.</em></p>
<pre><code class="language-solidity">function allowance(address owner, address spender) public view virtual returns (uint256 result);
</code></pre>
<h3 id="approve-2"><a class="header" href="#approve-2">approve</a></h3>
<p><em>Sets <code>amount</code> as the allowance of <code>spender</code> over the caller's tokens.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#approval">Approval</a> event.</em></p>
<pre><code class="language-solidity">function approve(address spender, uint256 amount) public virtual returns (bool);
</code></pre>
<h3 id="transfer-2"><a class="header" href="#transfer-2">transfer</a></h3>
<p>*Transfer <code>amount</code> tokens from the caller to <code>to</code>.
Requirements:</p>
<ul>
<li><code>from</code> must at least have <code>amount</code>.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#transfer">Transfer</a> event.*</li>
</ul>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) public virtual returns (bool);
</code></pre>
<h3 id="transferfrom-2"><a class="header" href="#transferfrom-2">transferFrom</a></h3>
<p>*Transfers <code>amount</code> tokens from <code>from</code> to <code>to</code>.
Note: Does not update the allowance if it is the maximum uint256 value.
Requirements:</p>
<ul>
<li><code>from</code> must at least have <code>amount</code>.</li>
<li>The caller must have at least <code>amount</code> of allowance to transfer the tokens of <code>from</code>.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#transfer">Transfer</a> event.*</li>
</ul>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) public virtual returns (bool);
</code></pre>
<h3 id="_constantnamehash"><a class="header" href="#_constantnamehash">_constantNameHash</a></h3>
<p><em>For more performance, override to return the constant value
of <code>keccak256(bytes(name()))</code> if <code>name()</code> will never change.</em></p>
<pre><code class="language-solidity">function _constantNameHash() internal view virtual returns (bytes32 result);
</code></pre>
<h3 id="_versionhash"><a class="header" href="#_versionhash">_versionHash</a></h3>
<p><em>If you need a different value, override this function.</em></p>
<pre><code class="language-solidity">function _versionHash() internal view virtual returns (bytes32 result);
</code></pre>
<h3 id="_incrementnonce"><a class="header" href="#_incrementnonce">_incrementNonce</a></h3>
<p><em>For inheriting contracts to increment the nonce.</em></p>
<pre><code class="language-solidity">function _incrementNonce(address owner) internal virtual;
</code></pre>
<h3 id="nonces"><a class="header" href="#nonces">nonces</a></h3>
<p><em>Returns the current nonce for <code>owner</code>.
This value is used to compute the signature for EIP-2612 permit.</em></p>
<pre><code class="language-solidity">function nonces(address owner) public view virtual returns (uint256 result);
</code></pre>
<h3 id="permit"><a class="header" href="#permit">permit</a></h3>
<p><em>Sets <code>value</code> as the allowance of <code>spender</code> over the tokens of <code>owner</code>,
authorized by a signed approval by <code>owner</code>.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#approval">Approval</a> event.</em></p>
<pre><code class="language-solidity">function permit(
    address owner,
    address spender,
    uint256 value,
    uint256 deadline,
    uint8 v,
    bytes32 r,
    bytes32 s
)
    public
    virtual;
</code></pre>
<h3 id="domain_separator"><a class="header" href="#domain_separator">DOMAIN_SEPARATOR</a></h3>
<p><em>Returns the EIP-712 domain separator for the EIP-2612 permit.</em></p>
<pre><code class="language-solidity">function DOMAIN_SEPARATOR() public view virtual returns (bytes32 result);
</code></pre>
<h3 id="_mint"><a class="header" href="#_mint">_mint</a></h3>
<p><em>Mints <code>amount</code> tokens to <code>to</code>, increasing the total supply.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#transfer">Transfer</a> event.</em></p>
<pre><code class="language-solidity">function _mint(address to, uint256 amount) internal virtual;
</code></pre>
<h3 id="_burn"><a class="header" href="#_burn">_burn</a></h3>
<p><em>Burns <code>amount</code> tokens from <code>from</code>, reducing the total supply.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#transfer">Transfer</a> event.</em></p>
<pre><code class="language-solidity">function _burn(address from, uint256 amount) internal virtual;
</code></pre>
<h3 id="_transfer"><a class="header" href="#_transfer">_transfer</a></h3>
<p><em>Moves <code>amount</code> of tokens from <code>from</code> to <code>to</code>.</em></p>
<pre><code class="language-solidity">function _transfer(address from, address to, uint256 amount) internal virtual;
</code></pre>
<h3 id="_spendallowance"><a class="header" href="#_spendallowance">_spendAllowance</a></h3>
<p><em>Updates the allowance of <code>owner</code> for <code>spender</code> based on spent <code>amount</code>.</em></p>
<pre><code class="language-solidity">function _spendAllowance(address owner, address spender, uint256 amount) internal virtual;
</code></pre>
<h3 id="_approve"><a class="header" href="#_approve">_approve</a></h3>
<p><em>Sets <code>amount</code> as the allowance of <code>spender</code> over the tokens of <code>owner</code>.
Emits a <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#approval">Approval</a> event.</em></p>
<pre><code class="language-solidity">function _approve(address owner, address spender, uint256 amount) internal virtual;
</code></pre>
<h3 id="_beforetokentransfer"><a class="header" href="#_beforetokentransfer">_beforeTokenTransfer</a></h3>
<p><em>Hook that is called before any transfer of tokens.
This includes minting and burning.</em></p>
<pre><code class="language-solidity">function _beforeTokenTransfer(address from, address to, uint256 amount) internal virtual;
</code></pre>
<h3 id="_aftertokentransfer"><a class="header" href="#_aftertokentransfer">_afterTokenTransfer</a></h3>
<p><em>Hook that is called after any transfer of tokens.
This includes minting and burning.</em></p>
<pre><code class="language-solidity">function _afterTokenTransfer(address from, address to, uint256 amount) internal virtual;
</code></pre>
<h3 id="_givepermit2infiniteallowance"><a class="header" href="#_givepermit2infiniteallowance">_givePermit2InfiniteAllowance</a></h3>
<p><em>Returns whether to fix the Permit2 contract's allowance at infinity.
This value should be kept constant after contract initialization,
or else the actual allowance values may not match with the <a href="src/vendor/ERC20.sol//src/vendor/ERC20.sol/abstract.ERC20.html#approval">Approval</a> events.
For best performance, return a compile-time constant for zero-cost abstraction.</em></p>
<pre><code class="language-solidity">function _givePermit2InfiniteAllowance() internal view virtual returns (bool);
</code></pre>
<h2 id="events-11"><a class="header" href="#events-11">Events</a></h2>
<h3 id="transfer-3"><a class="header" href="#transfer-3">Transfer</a></h3>
<p><em>Emitted when <code>amount</code> tokens is transferred from <code>from</code> to <code>to</code>.</em></p>
<pre><code class="language-solidity">event Transfer(address indexed from, address indexed to, uint256 amount);
</code></pre>
<h3 id="approval"><a class="header" href="#approval">Approval</a></h3>
<p><em>Emitted when <code>amount</code> tokens is approved by <code>owner</code> to be used by <code>spender</code>.</em></p>
<pre><code class="language-solidity">event Approval(address indexed owner, address indexed spender, uint256 amount);
</code></pre>
<h2 id="errors-7"><a class="header" href="#errors-7">Errors</a></h2>
<h3 id="totalsupplyoverflow"><a class="header" href="#totalsupplyoverflow">TotalSupplyOverflow</a></h3>
<p><em>The total supply has overflowed.</em></p>
<pre><code class="language-solidity">error TotalSupplyOverflow();
</code></pre>
<h3 id="allowanceoverflow"><a class="header" href="#allowanceoverflow">AllowanceOverflow</a></h3>
<p><em>The allowance has overflowed.</em></p>
<pre><code class="language-solidity">error AllowanceOverflow();
</code></pre>
<h3 id="allowanceunderflow"><a class="header" href="#allowanceunderflow">AllowanceUnderflow</a></h3>
<p><em>The allowance has underflowed.</em></p>
<pre><code class="language-solidity">error AllowanceUnderflow();
</code></pre>
<h3 id="insufficientbalance"><a class="header" href="#insufficientbalance">InsufficientBalance</a></h3>
<p><em>Insufficient balance.</em></p>
<pre><code class="language-solidity">error InsufficientBalance();
</code></pre>
<h3 id="insufficientallowance"><a class="header" href="#insufficientallowance">InsufficientAllowance</a></h3>
<p><em>Insufficient allowance.</em></p>
<pre><code class="language-solidity">error InsufficientAllowance();
</code></pre>
<h3 id="invalidpermit"><a class="header" href="#invalidpermit">InvalidPermit</a></h3>
<p><em>The permit is invalid.</em></p>
<pre><code class="language-solidity">error InvalidPermit();
</code></pre>
<h3 id="permitexpired"><a class="header" href="#permitexpired">PermitExpired</a></h3>
<p><em>The permit has expired.</em></p>
<pre><code class="language-solidity">error PermitExpired();
</code></pre>
<h3 id="permit2allowanceisfixedatinfinity"><a class="header" href="#permit2allowanceisfixedatinfinity">Permit2AllowanceIsFixedAtInfinity</a></h3>
<p><em>The allowance of Permit2 is fixed at infinity.</em></p>
<pre><code class="language-solidity">error Permit2AllowanceIsFixedAtInfinity();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initializable"><a class="header" href="#initializable">Initializable</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/Initializable.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/Initializable.sol), Modified from OpenZeppelin
(https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/proxy/utils/Initializable.sol)</p>
<p>Initializable mixin for the upgradeable contracts.</p>
<h2 id="state-variables-12"><a class="header" href="#state-variables-12">State Variables</a></h2>
<h3 id="_initialized_event_signature"><a class="header" href="#_initialized_event_signature">_INITIALIZED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Initialized(uint64)"))</code>.</em></p>
<pre><code class="language-solidity">bytes32 private constant _INITIALIZED_EVENT_SIGNATURE =
    0xc7f505b2f371ae2175ee4913f4499e1f2633a7b5936321eed1cdaeb6115181d2;
</code></pre>
<h3 id="_initializable_slot"><a class="header" href="#_initializable_slot">_INITIALIZABLE_SLOT</a></h3>
<p>*The default initializable slot is given by:
<code>bytes32(~uint256(uint32(bytes4(keccak256("_INITIALIZABLE_SLOT")))))</code>.
Bits Layout:</p>
<ul>
<li>[0]     <code>initializing</code></li>
<li>[1..64] <code>initializedVersion</code>*</li>
</ul>
<pre><code class="language-solidity">bytes32 private constant _INITIALIZABLE_SLOT = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffbf601132;
</code></pre>
<h2 id="functions-31"><a class="header" href="#functions-31">Functions</a></h2>
<h3 id="constructor-2"><a class="header" href="#constructor-2">constructor</a></h3>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="_initializableslot"><a class="header" href="#_initializableslot">_initializableSlot</a></h3>
<p><em>Override to return a non-zero custom storage slot if required.</em></p>
<pre><code class="language-solidity">function _initializableSlot() internal pure virtual returns (bytes32);
</code></pre>
<h3 id="initializer"><a class="header" href="#initializer">initializer</a></h3>
<p><em>Guards an initializer function so that it can be invoked at most once.
You can guard a function with <code>onlyInitializing</code> such that it can be called
through a function guarded with <code>initializer</code>.
This is similar to <code>reinitializer(1)</code>, except that in the context of a constructor,
an <code>initializer</code> guarded function can be invoked multiple times.
This can be useful during testing and is not expected to be used in production.
Emits an <a href="src/vendor/Initializable.sol//src/vendor/Initializable.sol/abstract.Initializable.html#initialized">Initialized</a> event.</em></p>
<pre><code class="language-solidity">modifier initializer() virtual;
</code></pre>
<h3 id="reinitializer"><a class="header" href="#reinitializer">reinitializer</a></h3>
<p><em>Guards a reinitializer function so that it can be invoked at most once.
You can guard a function with <code>onlyInitializing</code> such that it can be called
through a function guarded with <code>reinitializer</code>.
Emits an <a href="src/vendor/Initializable.sol//src/vendor/Initializable.sol/abstract.Initializable.html#initialized">Initialized</a> event.</em></p>
<pre><code class="language-solidity">modifier reinitializer(uint64 version) virtual;
</code></pre>
<h3 id="onlyinitializing"><a class="header" href="#onlyinitializing">onlyInitializing</a></h3>
<p><em>Guards a function such that it can only be called in the scope
of a function guarded with <code>initializer</code> or <code>reinitializer</code>.</em></p>
<pre><code class="language-solidity">modifier onlyInitializing() virtual;
</code></pre>
<h3 id="_checkinitializing"><a class="header" href="#_checkinitializing">_checkInitializing</a></h3>
<p><em>Reverts if the contract is not initializing.</em></p>
<pre><code class="language-solidity">function _checkInitializing() internal view virtual;
</code></pre>
<h3 id="_disableinitializers"><a class="header" href="#_disableinitializers">_disableInitializers</a></h3>
<p><em>Locks any future initializations by setting the initialized version to <code>2**64 - 1</code>.
Calling this in the constructor will prevent the contract from being initialized
or reinitialized. It is recommended to use this to lock implementation contracts
that are designed to be called through proxies.
Emits an <a href="src/vendor/Initializable.sol//src/vendor/Initializable.sol/abstract.Initializable.html#initialized">Initialized</a> event the first time it is successfully called.</em></p>
<pre><code class="language-solidity">function _disableInitializers() internal virtual;
</code></pre>
<h3 id="_getinitializedversion"><a class="header" href="#_getinitializedversion">_getInitializedVersion</a></h3>
<p><em>Returns the highest version that has been initialized.</em></p>
<pre><code class="language-solidity">function _getInitializedVersion() internal view virtual returns (uint64 version);
</code></pre>
<h3 id="_isinitializing"><a class="header" href="#_isinitializing">_isInitializing</a></h3>
<p><em>Returns whether the contract is currently initializing.</em></p>
<pre><code class="language-solidity">function _isInitializing() internal view virtual returns (bool result);
</code></pre>
<h2 id="events-12"><a class="header" href="#events-12">Events</a></h2>
<h3 id="initialized-1"><a class="header" href="#initialized-1">Initialized</a></h3>
<p><em>Triggered when the contract has been initialized.</em></p>
<pre><code class="language-solidity">event Initialized(uint64 version);
</code></pre>
<h2 id="errors-8"><a class="header" href="#errors-8">Errors</a></h2>
<h3 id="invalidinitialization"><a class="header" href="#invalidinitialization">InvalidInitialization</a></h3>
<p><em>The contract is already initialized.</em></p>
<pre><code class="language-solidity">error InvalidInitialization();
</code></pre>
<h3 id="notinitializing"><a class="header" href="#notinitializing">NotInitializing</a></h3>
<p><em>The contract is not initializing.</em></p>
<pre><code class="language-solidity">error NotInitializing();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multicallable"><a class="header" href="#multicallable">Multicallable</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/Multicallable.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/Multicallable.sol), Modified from Solmate (https://github.com/transmissions11/solmate/blob/main/src/utils/Multicallable.sol)
WARNING:
This implementation is NOT to be used with ERC2771 out-of-the-box.
https://blog.openzeppelin.com/arbitrary-address-spoofing-vulnerability-erc2771context-multicall-public-disclosure
This also applies to potentially other ERCs / patterns appending to the back of calldata.
We do NOT have a check for ERC2771, as we do not inherit from OpenZeppelin's context.
Moreover, it is infeasible and inefficient for us to add checks and mitigations
for all possible ERC / patterns appending to the back of calldata.
We would highly recommend using an alternative pattern such as
https://github.com/Vectorized/multicaller
which is more flexible, futureproof, and safer by default.</p>
<p>Contract that enables a single call to call multiple methods on itself.</p>
<h2 id="functions-32"><a class="header" href="#functions-32">Functions</a></h2>
<h3 id="multicall"><a class="header" href="#multicall">multicall</a></h3>
<p><em>Apply <code>delegatecall</code> with the current contract to each calldata in <code>data</code>,
and store the <code>abi.encode</code> formatted results of each <code>delegatecall</code> into <code>results</code>.
If any of the <code>delegatecall</code>s reverts, the entire context is reverted,
and the error is bubbled up.
By default, this function directly returns the results and terminates the call context.
If you need to add before and after actions to the multicall, please override this function.</em></p>
<pre><code class="language-solidity">function multicall(bytes[] calldata data) public payable virtual returns (bytes[] memory);
</code></pre>
<h3 id="_multicall"><a class="header" href="#_multicall">_multicall</a></h3>
<p><em>The inner logic of <code>multicall</code>.
This function is included so that you can override <code>multicall</code>
to add before and after actions, and use the <code>_multicallDirectReturn</code> function.</em></p>
<pre><code class="language-solidity">function _multicall(bytes[] calldata data) internal virtual returns (bytes32 results);
</code></pre>
<h3 id="_multicallresultstobytesarray"><a class="header" href="#_multicallresultstobytesarray">_multicallResultsToBytesArray</a></h3>
<p><em>Decodes the <code>results</code> into an array of bytes.
This can be useful if you need to access the results or re-encode it.</em></p>
<pre><code class="language-solidity">function _multicallResultsToBytesArray(bytes32 results) internal pure virtual returns (bytes[] memory decoded);
</code></pre>
<h3 id="_multicalldirectreturn"><a class="header" href="#_multicalldirectreturn">_multicallDirectReturn</a></h3>
<p><em>Directly returns the <code>results</code> and terminates the current call context.
<code>results</code> must be from <code>_multicall</code>, else behavior is undefined.</em></p>
<pre><code class="language-solidity">function _multicallDirectReturn(bytes32 results) internal pure virtual;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ownable"><a class="header" href="#ownable">Ownable</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/Ownable.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/auth/Ownable.sol)</p>
<p>Simple single owner authorization mixin.</p>
<p><em>Note:
This implementation does NOT auto-initialize the owner to <code>msg.sender</code>.
You MUST call the <code>_initializeOwner</code> in the constructor / initializer.
While the ownable portion follows
<a href="https://eips.ethereum.org/EIPS/eip-173">EIP-173</a> for compatibility,
the nomenclature for the 2-step ownership handover may be unique to this codebase.</em></p>
<h2 id="state-variables-13"><a class="header" href="#state-variables-13">State Variables</a></h2>
<h3 id="_ownership_transferred_event_signature"><a class="header" href="#_ownership_transferred_event_signature">_OWNERSHIP_TRANSFERRED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("OwnershipTransferred(address,address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _OWNERSHIP_TRANSFERRED_EVENT_SIGNATURE =
    0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0;
</code></pre>
<h3 id="_ownership_handover_requested_event_signature"><a class="header" href="#_ownership_handover_requested_event_signature">_OWNERSHIP_HANDOVER_REQUESTED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("OwnershipHandoverRequested(address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _OWNERSHIP_HANDOVER_REQUESTED_EVENT_SIGNATURE =
    0xdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d;
</code></pre>
<h3 id="_ownership_handover_canceled_event_signature"><a class="header" href="#_ownership_handover_canceled_event_signature">_OWNERSHIP_HANDOVER_CANCELED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("OwnershipHandoverCanceled(address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _OWNERSHIP_HANDOVER_CANCELED_EVENT_SIGNATURE =
    0xfa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c92;
</code></pre>
<h3 id="_owner_slot"><a class="header" href="#_owner_slot">_OWNER_SLOT</a></h3>
<p><em>The owner slot is given by:
<code>bytes32(~uint256(uint32(bytes4(keccak256("_OWNER_SLOT_NOT")))))</code>.
It is intentionally chosen to be a high value
to avoid collision with lower slots.
The choice of manual storage layout is to enable compatibility
with both regular and upgradeable contracts.</em></p>
<pre><code class="language-solidity">bytes32 internal constant _OWNER_SLOT = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffff74873927;
</code></pre>
<h3 id="_handover_slot_seed"><a class="header" href="#_handover_slot_seed">_HANDOVER_SLOT_SEED</a></h3>
<p>The ownership handover slot of <code>newOwner</code> is given by:</p>
<pre><code>mstore(0x00, or(shl(96, user), _HANDOVER_SLOT_SEED))
let handoverSlot := keccak256(0x00, 0x20)
</code></pre>
<p>It stores the expiry timestamp of the two-step ownership handover.</p>
<pre><code class="language-solidity">uint256 private constant _HANDOVER_SLOT_SEED = 0x389a75e1;
</code></pre>
<h2 id="functions-33"><a class="header" href="#functions-33">Functions</a></h2>
<h3 id="_guardinitializeowner"><a class="header" href="#_guardinitializeowner">_guardInitializeOwner</a></h3>
<p><em>Override to return true to make <code>_initializeOwner</code> prevent double-initialization.</em></p>
<pre><code class="language-solidity">function _guardInitializeOwner() internal pure virtual returns (bool guard);
</code></pre>
<h3 id="_initializeowner"><a class="header" href="#_initializeowner">_initializeOwner</a></h3>
<p><em>Initializes the owner directly without authorization guard.
This function must be called upon initialization,
regardless of whether the contract is upgradeable or not.
This is to enable generalization to both regular and upgradeable contracts,
and to save gas in case the initial owner is not the caller.
For performance reasons, this function will not check if there
is an existing owner.</em></p>
<pre><code class="language-solidity">function _initializeOwner(address newOwner) internal virtual;
</code></pre>
<h3 id="_setowner"><a class="header" href="#_setowner">_setOwner</a></h3>
<p><em>Sets the owner directly without authorization guard.</em></p>
<pre><code class="language-solidity">function _setOwner(address newOwner) internal virtual;
</code></pre>
<h3 id="_checkowner"><a class="header" href="#_checkowner">_checkOwner</a></h3>
<p><em>Throws if the sender is not the owner.</em></p>
<pre><code class="language-solidity">function _checkOwner() internal view virtual;
</code></pre>
<h3 id="_ownershiphandovervalidfor"><a class="header" href="#_ownershiphandovervalidfor">_ownershipHandoverValidFor</a></h3>
<p><em>Returns how long a two-step ownership handover is valid for in seconds.
Override to return a different value if needed.
Made internal to conserve bytecode. Wrap it in a public function if needed.</em></p>
<pre><code class="language-solidity">function _ownershipHandoverValidFor() internal view virtual returns (uint64);
</code></pre>
<h3 id="transferownership"><a class="header" href="#transferownership">transferOwnership</a></h3>
<p><em>Allows the owner to transfer the ownership to <code>newOwner</code>.</em></p>
<pre><code class="language-solidity">function transferOwnership(address newOwner) public payable virtual onlyOwner;
</code></pre>
<h3 id="renounceownership"><a class="header" href="#renounceownership">renounceOwnership</a></h3>
<p><em>Allows the owner to renounce their ownership.</em></p>
<pre><code class="language-solidity">function renounceOwnership() public payable virtual onlyOwner;
</code></pre>
<h3 id="requestownershiphandover"><a class="header" href="#requestownershiphandover">requestOwnershipHandover</a></h3>
<p><em>Request a two-step ownership handover to the caller.
The request will automatically expire in 48 hours (172800 seconds) by default.</em></p>
<pre><code class="language-solidity">function requestOwnershipHandover() public payable virtual;
</code></pre>
<h3 id="cancelownershiphandover"><a class="header" href="#cancelownershiphandover">cancelOwnershipHandover</a></h3>
<p><em>Cancels the two-step ownership handover to the caller, if any.</em></p>
<pre><code class="language-solidity">function cancelOwnershipHandover() public payable virtual;
</code></pre>
<h3 id="completeownershiphandover"><a class="header" href="#completeownershiphandover">completeOwnershipHandover</a></h3>
<p><em>Allows the owner to complete the two-step ownership handover to <code>pendingOwner</code>.
Reverts if there is no existing ownership handover requested by <code>pendingOwner</code>.</em></p>
<pre><code class="language-solidity">function completeOwnershipHandover(address pendingOwner) public payable virtual onlyOwner;
</code></pre>
<h3 id="owner-1"><a class="header" href="#owner-1">owner</a></h3>
<p><em>Returns the owner of the contract.</em></p>
<pre><code class="language-solidity">function owner() public view virtual returns (address result);
</code></pre>
<h3 id="ownershiphandoverexpiresat"><a class="header" href="#ownershiphandoverexpiresat">ownershipHandoverExpiresAt</a></h3>
<p><em>Returns the expiry timestamp for the two-step ownership handover to <code>pendingOwner</code>.</em></p>
<pre><code class="language-solidity">function ownershipHandoverExpiresAt(address pendingOwner) public view virtual returns (uint256 result);
</code></pre>
<h3 id="onlyowner"><a class="header" href="#onlyowner">onlyOwner</a></h3>
<p><em>Marks a function as only callable by the owner.</em></p>
<pre><code class="language-solidity">modifier onlyOwner() virtual;
</code></pre>
<h2 id="events-13"><a class="header" href="#events-13">Events</a></h2>
<h3 id="ownershiptransferred"><a class="header" href="#ownershiptransferred">OwnershipTransferred</a></h3>
<p><em>The ownership is transferred from <code>oldOwner</code> to <code>newOwner</code>.
This event is intentionally kept the same as OpenZeppelin's Ownable to be
compatible with indexers and <a href="https://eips.ethereum.org/EIPS/eip-173">EIP-173</a>,
despite it not being as lightweight as a single argument event.</em></p>
<pre><code class="language-solidity">event OwnershipTransferred(address indexed oldOwner, address indexed newOwner);
</code></pre>
<h3 id="ownershiphandoverrequested"><a class="header" href="#ownershiphandoverrequested">OwnershipHandoverRequested</a></h3>
<p><em>An ownership handover to <code>pendingOwner</code> has been requested.</em></p>
<pre><code class="language-solidity">event OwnershipHandoverRequested(address indexed pendingOwner);
</code></pre>
<h3 id="ownershiphandovercanceled"><a class="header" href="#ownershiphandovercanceled">OwnershipHandoverCanceled</a></h3>
<p><em>The ownership handover to <code>pendingOwner</code> has been canceled.</em></p>
<pre><code class="language-solidity">event OwnershipHandoverCanceled(address indexed pendingOwner);
</code></pre>
<h2 id="errors-9"><a class="header" href="#errors-9">Errors</a></h2>
<h3 id="unauthorized-1"><a class="header" href="#unauthorized-1">Unauthorized</a></h3>
<p><em>The caller is not authorized to call the function.</em></p>
<pre><code class="language-solidity">error Unauthorized();
</code></pre>
<h3 id="newowneriszeroaddress"><a class="header" href="#newowneriszeroaddress">NewOwnerIsZeroAddress</a></h3>
<p><em>The <code>newOwner</code> cannot be the zero address.</em></p>
<pre><code class="language-solidity">error NewOwnerIsZeroAddress();
</code></pre>
<h3 id="nohandoverrequest"><a class="header" href="#nohandoverrequest">NoHandoverRequest</a></h3>
<p><em>The <code>pendingOwner</code> does not have a valid handover request.</em></p>
<pre><code class="language-solidity">error NoHandoverRequest();
</code></pre>
<h3 id="alreadyinitialized"><a class="header" href="#alreadyinitialized">AlreadyInitialized</a></h3>
<p><em>Cannot double-initialize.</em></p>
<pre><code class="language-solidity">error AlreadyInitialized();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safetransferlib"><a class="header" href="#safetransferlib">SafeTransferLib</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/SafeTransferLib.sol">Git Source</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/SafeTransferLib.sol), Modified from Solmate (https://github.com/transmissions11/solmate/blob/main/src/utils/SafeTransferLib.sol), Permit2 operations from (https://github.com/Uniswap/permit2/blob/main/src/libraries/Permit2Lib.sol)</p>
<p>Safe ETH and ERC20 transfer library that gracefully handles missing return values.</p>
<p>*Note:</p>
<ul>
<li>For ETH transfers, please use <code>forceSafeTransferETH</code> for DoS protection.*</li>
</ul>
<h2 id="state-variables-14"><a class="header" href="#state-variables-14">State Variables</a></h2>
<h3 id="gas_stipend_no_storage_writes"><a class="header" href="#gas_stipend_no_storage_writes">GAS_STIPEND_NO_STORAGE_WRITES</a></h3>
<p><em>Suggested gas stipend for contract receiving ETH that disallows any storage writes.</em></p>
<pre><code class="language-solidity">uint256 internal constant GAS_STIPEND_NO_STORAGE_WRITES = 2300;
</code></pre>
<h3 id="gas_stipend_no_grief"><a class="header" href="#gas_stipend_no_grief">GAS_STIPEND_NO_GRIEF</a></h3>
<p><em>Suggested gas stipend for contract receiving ETH to perform a few
storage reads and writes, but low enough to prevent griefing.</em></p>
<pre><code class="language-solidity">uint256 internal constant GAS_STIPEND_NO_GRIEF = 100_000;
</code></pre>
<h3 id="dai_domain_separator"><a class="header" href="#dai_domain_separator">DAI_DOMAIN_SEPARATOR</a></h3>
<p><em>The unique EIP-712 domain separator for the DAI token contract.</em></p>
<pre><code class="language-solidity">bytes32 internal constant DAI_DOMAIN_SEPARATOR = 0xdbb8cf42e1ecb028be3f3dbc922e1d878b963f411dc388ced501601c60f7c6f7;
</code></pre>
<h3 id="weth9"><a class="header" href="#weth9">WETH9</a></h3>
<p><em>The address for the WETH9 contract on Ethereum mainnet.</em></p>
<pre><code class="language-solidity">address internal constant WETH9 = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;
</code></pre>
<h3 id="permit2"><a class="header" href="#permit2">PERMIT2</a></h3>
<p><em>The canonical Permit2 address.
<a href="https://github.com/Uniswap/permit2">Github</a>
<a href="https://etherscan.io/address/0x000000000022D473030F116dDEE9F6B43aC78BA3">Etherscan</a></em></p>
<pre><code class="language-solidity">address internal constant PERMIT2 = 0x000000000022D473030F116dDEE9F6B43aC78BA3;
</code></pre>
<h2 id="functions-34"><a class="header" href="#functions-34">Functions</a></h2>
<h3 id="safetransfereth"><a class="header" href="#safetransfereth">safeTransferETH</a></h3>
<p><em>Sends <code>amount</code> (in wei) ETH to <code>to</code>.</em></p>
<pre><code class="language-solidity">function safeTransferETH(address to, uint256 amount) internal;
</code></pre>
<h3 id="safetransferalleth"><a class="header" href="#safetransferalleth">safeTransferAllETH</a></h3>
<p><em>Sends all the ETH in the current contract to <code>to</code>.</em></p>
<pre><code class="language-solidity">function safeTransferAllETH(address to) internal;
</code></pre>
<h3 id="forcesafetransfereth"><a class="header" href="#forcesafetransfereth">forceSafeTransferETH</a></h3>
<p><em>Force sends <code>amount</code> (in wei) ETH to <code>to</code>, with a <code>gasStipend</code>.</em></p>
<pre><code class="language-solidity">function forceSafeTransferETH(address to, uint256 amount, uint256 gasStipend) internal;
</code></pre>
<h3 id="forcesafetransferalleth"><a class="header" href="#forcesafetransferalleth">forceSafeTransferAllETH</a></h3>
<p><em>Force sends all the ETH in the current contract to <code>to</code>, with a <code>gasStipend</code>.</em></p>
<pre><code class="language-solidity">function forceSafeTransferAllETH(address to, uint256 gasStipend) internal;
</code></pre>
<h3 id="forcesafetransfereth-1"><a class="header" href="#forcesafetransfereth-1">forceSafeTransferETH</a></h3>
<p><em>Force sends <code>amount</code> (in wei) ETH to <code>to</code>, with <code>GAS_STIPEND_NO_GRIEF</code>.</em></p>
<pre><code class="language-solidity">function forceSafeTransferETH(address to, uint256 amount) internal;
</code></pre>
<h3 id="forcesafetransferalleth-1"><a class="header" href="#forcesafetransferalleth-1">forceSafeTransferAllETH</a></h3>
<p><em>Force sends all the ETH in the current contract to <code>to</code>, with <code>GAS_STIPEND_NO_GRIEF</code>.</em></p>
<pre><code class="language-solidity">function forceSafeTransferAllETH(address to) internal;
</code></pre>
<h3 id="trysafetransfereth"><a class="header" href="#trysafetransfereth">trySafeTransferETH</a></h3>
<p><em>Sends <code>amount</code> (in wei) ETH to <code>to</code>, with a <code>gasStipend</code>.</em></p>
<pre><code class="language-solidity">function trySafeTransferETH(address to, uint256 amount, uint256 gasStipend) internal returns (bool success);
</code></pre>
<h3 id="trysafetransferalleth"><a class="header" href="#trysafetransferalleth">trySafeTransferAllETH</a></h3>
<p><em>Sends all the ETH in the current contract to <code>to</code>, with a <code>gasStipend</code>.</em></p>
<pre><code class="language-solidity">function trySafeTransferAllETH(address to, uint256 gasStipend) internal returns (bool success);
</code></pre>
<h3 id="safetransferfrom"><a class="header" href="#safetransferfrom">safeTransferFrom</a></h3>
<p><em>Sends <code>amount</code> of ERC20 <code>token</code> from <code>from</code> to <code>to</code>.
Reverts upon failure.
The <code>from</code> account must have at least <code>amount</code> approved for
the current contract to manage.</em></p>
<pre><code class="language-solidity">function safeTransferFrom(address token, address from, address to, uint256 amount) internal;
</code></pre>
<h3 id="trysafetransferfrom"><a class="header" href="#trysafetransferfrom">trySafeTransferFrom</a></h3>
<p><em>Sends <code>amount</code> of ERC20 <code>token</code> from <code>from</code> to <code>to</code>.
The <code>from</code> account must have at least <code>amount</code> approved for the current contract to manage.</em></p>
<pre><code class="language-solidity">function trySafeTransferFrom(address token, address from, address to, uint256 amount) internal returns (bool success);
</code></pre>
<h3 id="safetransferallfrom"><a class="header" href="#safetransferallfrom">safeTransferAllFrom</a></h3>
<p><em>Sends all of ERC20 <code>token</code> from <code>from</code> to <code>to</code>.
Reverts upon failure.
The <code>from</code> account must have their entire balance approved for the current contract to manage.</em></p>
<pre><code class="language-solidity">function safeTransferAllFrom(address token, address from, address to) internal returns (uint256 amount);
</code></pre>
<h3 id="safetransfer"><a class="header" href="#safetransfer">safeTransfer</a></h3>
<p><em>Sends <code>amount</code> of ERC20 <code>token</code> from the current contract to <code>to</code>.
Reverts upon failure.</em></p>
<pre><code class="language-solidity">function safeTransfer(address token, address to, uint256 amount) internal;
</code></pre>
<h3 id="safetransferall"><a class="header" href="#safetransferall">safeTransferAll</a></h3>
<p><em>Sends all of ERC20 <code>token</code> from the current contract to <code>to</code>.
Reverts upon failure.</em></p>
<pre><code class="language-solidity">function safeTransferAll(address token, address to) internal returns (uint256 amount);
</code></pre>
<h3 id="safeapprove"><a class="header" href="#safeapprove">safeApprove</a></h3>
<p><em>Sets <code>amount</code> of ERC20 <code>token</code> for <code>to</code> to manage on behalf of the current contract.
Reverts upon failure.</em></p>
<pre><code class="language-solidity">function safeApprove(address token, address to, uint256 amount) internal;
</code></pre>
<h3 id="safeapprovewithretry"><a class="header" href="#safeapprovewithretry">safeApproveWithRetry</a></h3>
<p><em>Sets <code>amount</code> of ERC20 <code>token</code> for <code>to</code> to manage on behalf of the current contract.
If the initial attempt to approve fails, attempts to reset the approved amount to zero,
then retries the approval again (some tokens, e.g. USDT, requires this).
Reverts upon failure.</em></p>
<pre><code class="language-solidity">function safeApproveWithRetry(address token, address to, uint256 amount) internal;
</code></pre>
<h3 id="balanceof-3"><a class="header" href="#balanceof-3">balanceOf</a></h3>
<p><em>Returns the amount of ERC20 <code>token</code> owned by <code>account</code>.
Returns zero if the <code>token</code> does not exist.</em></p>
<pre><code class="language-solidity">function balanceOf(address token, address account) internal view returns (uint256 amount);
</code></pre>
<h3 id="checkbalanceof"><a class="header" href="#checkbalanceof">checkBalanceOf</a></h3>
<p><em>Performs a <code>token.balanceOf(account)</code> check.
<code>implemented</code> denotes whether the <code>token</code> does not implement <code>balanceOf</code>.
<code>amount</code> is zero if the <code>token</code> does not implement <code>balanceOf</code>.</em></p>
<pre><code class="language-solidity">function checkBalanceOf(address token, address account) internal view returns (bool implemented, uint256 amount);
</code></pre>
<h3 id="totalsupply-3"><a class="header" href="#totalsupply-3">totalSupply</a></h3>
<p><em>Returns the total supply of the <code>token</code>.
Reverts if the token does not exist or does not implement <code>totalSupply()</code>.</em></p>
<pre><code class="language-solidity">function totalSupply(address token) internal view returns (uint256 result);
</code></pre>
<h3 id="safetransferfrom2"><a class="header" href="#safetransferfrom2">safeTransferFrom2</a></h3>
<p><em>Sends <code>amount</code> of ERC20 <code>token</code> from <code>from</code> to <code>to</code>.
If the initial attempt fails, try to use Permit2 to transfer the token.
Reverts upon failure.
The <code>from</code> account must have at least <code>amount</code> approved for the current contract to manage.</em></p>
<pre><code class="language-solidity">function safeTransferFrom2(address token, address from, address to, uint256 amount) internal;
</code></pre>
<h3 id="permit2transferfrom"><a class="header" href="#permit2transferfrom">permit2TransferFrom</a></h3>
<p><em>Sends <code>amount</code> of ERC20 <code>token</code> from <code>from</code> to <code>to</code> via Permit2.
Reverts upon failure.</em></p>
<pre><code class="language-solidity">function permit2TransferFrom(address token, address from, address to, uint256 amount) internal;
</code></pre>
<h3 id="permit2-1"><a class="header" href="#permit2-1">permit2</a></h3>
<p><em>Permit a user to spend a given amount of
another user's tokens via native EIP-2612 permit if possible, falling
back to Permit2 if native permit fails or is not implemented on the token.</em></p>
<pre><code class="language-solidity">function permit2(
    address token,
    address owner,
    address spender,
    uint256 amount,
    uint256 deadline,
    uint8 v,
    bytes32 r,
    bytes32 s
)
    internal;
</code></pre>
<h3 id="simplepermit2"><a class="header" href="#simplepermit2">simplePermit2</a></h3>
<p><em>Simple permit on the Permit2 contract.</em></p>
<pre><code class="language-solidity">function simplePermit2(
    address token,
    address owner,
    address spender,
    uint256 amount,
    uint256 deadline,
    uint8 v,
    bytes32 r,
    bytes32 s
)
    internal;
</code></pre>
<h3 id="permit2approve"><a class="header" href="#permit2approve">permit2Approve</a></h3>
<p><em>Approves <code>spender</code> to spend <code>amount</code> of <code>token</code> for <code>address(this)</code>.</em></p>
<pre><code class="language-solidity">function permit2Approve(address token, address spender, uint160 amount, uint48 expiration) internal;
</code></pre>
<h3 id="permit2lockdown"><a class="header" href="#permit2lockdown">permit2Lockdown</a></h3>
<p><em>Revokes an approval for <code>token</code> and <code>spender</code> for <code>address(this)</code>.</em></p>
<pre><code class="language-solidity">function permit2Lockdown(address token, address spender) internal;
</code></pre>
<h2 id="errors-10"><a class="header" href="#errors-10">Errors</a></h2>
<h3 id="ethtransferfailed"><a class="header" href="#ethtransferfailed">ETHTransferFailed</a></h3>
<p><em>The ETH transfer has failed.</em></p>
<pre><code class="language-solidity">error ETHTransferFailed();
</code></pre>
<h3 id="transferfromfailed"><a class="header" href="#transferfromfailed">TransferFromFailed</a></h3>
<p><em>The ERC20 <code>transferFrom</code> has failed.</em></p>
<pre><code class="language-solidity">error TransferFromFailed();
</code></pre>
<h3 id="transferfailed"><a class="header" href="#transferfailed">TransferFailed</a></h3>
<p><em>The ERC20 <code>transfer</code> has failed.</em></p>
<pre><code class="language-solidity">error TransferFailed();
</code></pre>
<h3 id="approvefailed"><a class="header" href="#approvefailed">ApproveFailed</a></h3>
<p><em>The ERC20 <code>approve</code> has failed.</em></p>
<pre><code class="language-solidity">error ApproveFailed();
</code></pre>
<h3 id="totalsupplyqueryfailed"><a class="header" href="#totalsupplyqueryfailed">TotalSupplyQueryFailed</a></h3>
<p><em>The ERC20 <code>totalSupply</code> query has failed.</em></p>
<pre><code class="language-solidity">error TotalSupplyQueryFailed();
</code></pre>
<h3 id="permit2failed"><a class="header" href="#permit2failed">Permit2Failed</a></h3>
<p><em>The Permit2 operation has failed.</em></p>
<pre><code class="language-solidity">error Permit2Failed();
</code></pre>
<h3 id="permit2amountoverflow"><a class="header" href="#permit2amountoverflow">Permit2AmountOverflow</a></h3>
<p><em>The Permit2 amount must be less than <code>2**160 - 1</code>.</em></p>
<pre><code class="language-solidity">error Permit2AmountOverflow();
</code></pre>
<h3 id="permit2approvefailed"><a class="header" href="#permit2approvefailed">Permit2ApproveFailed</a></h3>
<p><em>The Permit2 approve operation has failed.</em></p>
<pre><code class="language-solidity">error Permit2ApproveFailed();
</code></pre>
<h3 id="permit2lockdownfailed"><a class="header" href="#permit2lockdownfailed">Permit2LockdownFailed</a></h3>
<p><em>The Permit2 lockdown operation has failed.</em></p>
<pre><code class="language-solidity">error Permit2LockdownFailed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="callcontextchecker"><a class="header" href="#callcontextchecker">CallContextChecker</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/UUPSUpgradeable.sol">Git Source</a></p>
<p><strong>Author:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/CallContextChecker.sol)</p>
<p>Call context checker mixin.</p>
<h2 id="state-variables-15"><a class="header" href="#state-variables-15">State Variables</a></h2>
<h3 id="__self"><a class="header" href="#__self">__self</a></h3>
<p><em>For checking if the context is a delegate call.
Note: To enable use cases with an immutable default implementation in the bytecode,
(see: ERC6551Proxy), we don't require that the proxy address must match the
value stored in the implementation slot, which may not be initialized.</em></p>
<pre><code class="language-solidity">uint256 private immutable __self = uint256(uint160(address(this)));
</code></pre>
<h2 id="functions-35"><a class="header" href="#functions-35">Functions</a></h2>
<h3 id="_oneip7702authority"><a class="header" href="#_oneip7702authority">_onEIP7702Authority</a></h3>
<p><em>Returns whether the current call context is on a EIP7702 authority
(i.e. externally owned account).</em></p>
<pre><code class="language-solidity">function _onEIP7702Authority() internal view virtual returns (bool result);
</code></pre>
<h3 id="_selfimplementation"><a class="header" href="#_selfimplementation">_selfImplementation</a></h3>
<p><em>Returns the implementation of this contract.</em></p>
<pre><code class="language-solidity">function _selfImplementation() internal view virtual returns (address);
</code></pre>
<h3 id="_onimplementation"><a class="header" href="#_onimplementation">_onImplementation</a></h3>
<p><em>Returns whether the current call context is on the implementation itself.</em></p>
<pre><code class="language-solidity">function _onImplementation() internal view virtual returns (bool);
</code></pre>
<h3 id="_checkonlyeip7702authority"><a class="header" href="#_checkonlyeip7702authority">_checkOnlyEIP7702Authority</a></h3>
<p><em>Requires that the current call context is performed via a EIP7702 authority.</em></p>
<pre><code class="language-solidity">function _checkOnlyEIP7702Authority() internal view virtual;
</code></pre>
<h3 id="_checkonlyproxy"><a class="header" href="#_checkonlyproxy">_checkOnlyProxy</a></h3>
<p><em>Requires that the current call context is performed via a proxy.</em></p>
<pre><code class="language-solidity">function _checkOnlyProxy() internal view virtual;
</code></pre>
<h3 id="_checknotdelegated"><a class="header" href="#_checknotdelegated">_checkNotDelegated</a></h3>
<p><em>Requires that the current call context is NOT performed via a proxy.
This is the opposite of <code>checkOnlyProxy</code>.</em></p>
<pre><code class="language-solidity">function _checkNotDelegated() internal view virtual;
</code></pre>
<h3 id="onlyeip7702authority"><a class="header" href="#onlyeip7702authority">onlyEIP7702Authority</a></h3>
<p><em>Requires that the current call context is performed via a EIP7702 authority.</em></p>
<pre><code class="language-solidity">modifier onlyEIP7702Authority() virtual;
</code></pre>
<h3 id="onlyproxy"><a class="header" href="#onlyproxy">onlyProxy</a></h3>
<p><em>Requires that the current call context is performed via a proxy.</em></p>
<pre><code class="language-solidity">modifier onlyProxy() virtual;
</code></pre>
<h3 id="notdelegated"><a class="header" href="#notdelegated">notDelegated</a></h3>
<p><em>Requires that the current call context is NOT performed via a proxy.
This is the opposite of <code>onlyProxy</code>.</em></p>
<pre><code class="language-solidity">modifier notDelegated() virtual;
</code></pre>
<h3 id="_revertunauthorizedcallcontext"><a class="header" href="#_revertunauthorizedcallcontext">_revertUnauthorizedCallContext</a></h3>
<pre><code class="language-solidity">function _revertUnauthorizedCallContext() private pure;
</code></pre>
<h2 id="errors-11"><a class="header" href="#errors-11">Errors</a></h2>
<h3 id="unauthorizedcallcontext"><a class="header" href="#unauthorizedcallcontext">UnauthorizedCallContext</a></h3>
<p><em>The call is from an unauthorized call context.</em></p>
<pre><code class="language-solidity">error UnauthorizedCallContext();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="uupsupgradeable"><a class="header" href="#uupsupgradeable">UUPSUpgradeable</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/vendor/UUPSUpgradeable.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/vendor/UUPSUpgradeable.sol//src/vendor/UUPSUpgradeable.sol/contract.CallContextChecker.html">CallContextChecker</a></p>
<p><strong>Authors:</strong>
Solady (https://github.com/vectorized/solady/blob/main/src/utils/UUPSUpgradeable.sol), Modified from OpenZeppelin
(https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/proxy/utils/UUPSUpgradeable.sol)</p>
<p>UUPS proxy mixin.</p>
<p>*Note:</p>
<ul>
<li>This implementation is intended to be used with ERC1967 proxies.
See: <code>OptimizedLibClone.deployERC1967</code> and related functions.</li>
<li>This implementation is NOT compatible with legacy OpenZeppelin proxies
which do not store the implementation at <code>_ERC1967_IMPLEMENTATION_SLOT</code>.*</li>
</ul>
<h2 id="state-variables-16"><a class="header" href="#state-variables-16">State Variables</a></h2>
<h3 id="_upgraded_event_signature-1"><a class="header" href="#_upgraded_event_signature-1">_UPGRADED_EVENT_SIGNATURE</a></h3>
<p><em><code>keccak256(bytes("Upgraded(address)"))</code>.</em></p>
<pre><code class="language-solidity">uint256 private constant _UPGRADED_EVENT_SIGNATURE = 0xbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b;
</code></pre>
<h3 id="_erc1967_implementation_slot"><a class="header" href="#_erc1967_implementation_slot">_ERC1967_IMPLEMENTATION_SLOT</a></h3>
<p><em>The ERC-1967 storage slot for the implementation in the proxy.
<code>uint256(keccak256("eip1967.proxy.implementation")) - 1</code>.</em></p>
<pre><code class="language-solidity">bytes32 internal constant _ERC1967_IMPLEMENTATION_SLOT =
    0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;
</code></pre>
<h2 id="functions-36"><a class="header" href="#functions-36">Functions</a></h2>
<h3 id="_authorizeupgrade-2"><a class="header" href="#_authorizeupgrade-2">_authorizeUpgrade</a></h3>
<p>*Please override this function to check if <code>msg.sender</code> is authorized
to upgrade the proxy to <code>newImplementation</code>, reverting if not.</p>
<pre><code>function _authorizeUpgrade(address) internal override onlyOwner {}
```*


```solidity
function _authorizeUpgrade(address newImplementation) internal virtual;
</code></pre>
<h3 id="proxiableuuid"><a class="header" href="#proxiableuuid">proxiableUUID</a></h3>
<p><em>Returns the storage slot used by the implementation,
as specified in <a href="https://eips.ethereum.org/EIPS/eip-1822">ERC1822</a>.
Note: The <code>notDelegated</code> modifier prevents accidental upgrades to
an implementation that is a proxy contract.</em></p>
<pre><code class="language-solidity">function proxiableUUID() public view virtual notDelegated returns (bytes32);
</code></pre>
<h3 id="upgradetoandcall"><a class="header" href="#upgradetoandcall">upgradeToAndCall</a></h3>
<p><em>Upgrades the proxy's implementation to <code>newImplementation</code>.
Emits a <a href="src/vendor/UUPSUpgradeable.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html#upgraded">Upgraded</a> event.
Note: Passing in empty <code>data</code> skips the delegatecall to <code>newImplementation</code>.</em></p>
<pre><code class="language-solidity">function upgradeToAndCall(address newImplementation, bytes calldata data) public payable virtual onlyProxy;
</code></pre>
<h2 id="events-14"><a class="header" href="#events-14">Events</a></h2>
<h3 id="upgraded-1"><a class="header" href="#upgraded-1">Upgraded</a></h3>
<p><em>Emitted when the proxy's implementation is upgraded.</em></p>
<pre><code class="language-solidity">event Upgraded(address indexed implementation);
</code></pre>
<h2 id="errors-12"><a class="header" href="#errors-12">Errors</a></h2>
<h3 id="upgradefailed-1"><a class="header" href="#upgradefailed-1">UpgradeFailed</a></h3>
<p><em>The upgrade failed.</em></p>
<pre><code class="language-solidity">error UpgradeFailed();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kassetrouter"><a class="header" href="#kassetrouter">kAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kAssetRouter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kAssetRouter.sol//src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html">IkAssetRouter</a>, <a href="src/kAssetRouter.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/kAssetRouter.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a>, <a href="src/kAssetRouter.sol//src/base/kBase.sol/contract.kBase.html">kBase</a>, <a href="src/kAssetRouter.sol//src/vendor/Multicallable.sol/abstract.Multicallable.html">Multicallable</a></p>
<p>Central money flow coordinator for the KAM protocol, orchestrating all asset movements and yield
distribution</p>
<p><em>This contract serves as the heart of the KAM protocol's financial infrastructure, coordinating complex
interactions between institutional flows (kMinter), retail flows (kStakingVaults), and yield generation (DN vaults).
Key responsibilities include: (1) Managing asset pushes from kMinter institutional deposits to DN vaults for yield
generation, (2) Coordinating virtual asset transfers between kStakingVaults for optimal capital allocation,
(3) Processing batch settlements with yield distribution through precise kToken minting/burning operations,
(4) Maintaining virtual balance tracking across all vaults for accurate accounting, (5) Implementing security
cooldown periods for settlement proposals, (6) Executing peg protection mechanisms during market stress.
The contract ensures protocol integrity by maintaining the 1:1 backing guarantee through carefully orchestrated
money flows while enabling efficient capital utilization across the entire vault network.</em></p>
<h2 id="state-variables-17"><a class="header" href="#state-variables-17">State Variables</a></h2>
<h3 id="default_vault_settlement_cooldown"><a class="header" href="#default_vault_settlement_cooldown">DEFAULT_VAULT_SETTLEMENT_COOLDOWN</a></h3>
<p>Default cooldown period for vault settlement proposals (1 hour)</p>
<p><em>Provides initial security delay between proposal creation and execution, allowing guardians
to verify yield calculations and detect potential errors before irreversible yield distribution</em></p>
<pre><code class="language-solidity">uint256 private constant DEFAULT_VAULT_SETTLEMENT_COOLDOWN = 1 hours;
</code></pre>
<h3 id="max_vault_settlement_cooldown"><a class="header" href="#max_vault_settlement_cooldown">MAX_VAULT_SETTLEMENT_COOLDOWN</a></h3>
<p>Maximum allowed cooldown period for vault settlement proposals (1 day)</p>
<p><em>Caps the maximum security delay to balance protocol safety with operational efficiency.
Prevents excessive delays that could harm user experience while maintaining security standards</em></p>
<pre><code class="language-solidity">uint256 private constant MAX_VAULT_SETTLEMENT_COOLDOWN = 1 days;
</code></pre>
<h3 id="kassetrouter_storage_location"><a class="header" href="#kassetrouter_storage_location">KASSETROUTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KASSETROUTER_STORAGE_LOCATION =
    0x72fdaf6608fcd614cdab8afd23d0b707bfc44e685019cc3a5ace611655fe7f00;
</code></pre>
<h2 id="functions-37"><a class="header" href="#functions-37">Functions</a></h2>
<h3 id="_getkassetrouterstorage"><a class="header" href="#_getkassetrouterstorage">_getkAssetRouterStorage</a></h3>
<p>Retrieves the kAssetRouter storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkAssetRouterStorage() private pure returns (kAssetRouterStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kAssetRouterStorage</code></td><td>The kAssetRouterStorage struct reference for state modifications</td></tr>
</tbody></table>
</div>
<h3 id="constructor-3"><a class="header" href="#constructor-3">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<p><em>Ensures the implementation contract cannot be initialized directly, only through proxies</em></p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-2"><a class="header" href="#initialize-2">initialize</a></h3>
<p>Initializes the kAssetRouter with protocol configuration and default parameters</p>
<p><em>Sets up the contract with protocol registry connection and default settlement cooldown.
Must be called immediately after proxy deployment to establish connection with the protocol
registry and initialize the money flow coordination system.</em></p>
<pre><code class="language-solidity">function initialize(address registry_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract that manages protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="kassetpush-1"><a class="header" href="#kassetpush-1">kAssetPush</a></h3>
<p>Pushes assets from kMinter institutional deposits to the designated DN vault for yield generation</p>
<p><em>This function is called by kMinter when institutional users deposit underlying assets. The process
involves: (1) receiving assets already transferred from kMinter, (2) forwarding them to the appropriate
DN vault for the asset type, (3) updating virtual balance tracking for accurate accounting. This enables
immediate kToken minting (1:1 with deposits) while assets begin generating yield in the vault system.
The assets enter the current batch for eventual settlement and yield distribution back to kToken holders.</em></p>
<pre><code class="language-solidity">function kAssetPush(address _asset, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited (must be registered in protocol)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault for yield generation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch identifier from the DN vault for tracking and settlement</td></tr>
</tbody></table>
</div>
<h3 id="kassetrequestpull-1"><a class="header" href="#kassetrequestpull-1">kAssetRequestPull</a></h3>
<p>Requests asset withdrawal from vault to fulfill institutional redemption through kMinter</p>
<p><em>This function initiates the first phase of the institutional redemption process. The workflow
involves: (1) registering the redemption request with the vault, (2) creating a kBatchReceiver minimal
proxy to hold assets for distribution, (3) updating virtual balance accounting, (4) preparing for
batch settlement. The actual asset transfer occurs later during batch settlement when the vault
processes all pending requests together. This two-phase approach optimizes gas costs and ensures
fair settlement across all institutional redemption requests in the batch.</em></p>
<pre><code class="language-solidity">function kAssetRequestPull(address _asset, address _vault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being redeemed</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The DN vault address from which assets will be withdrawn</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this redemption with other requests</td></tr>
</tbody></table>
</div>
<h3 id="kassettransfer-1"><a class="header" href="#kassettransfer-1">kAssetTransfer</a></h3>
<p>Transfers assets between kStakingVaults for optimal capital allocation and yield optimization</p>
<p><em>This function enables dynamic rebalancing of assets across the vault network to optimize yields
and manage capacity. The transfer is virtual in nature - actual underlying assets may remain in the
same physical vault while accounting balances are updated. This mechanism allows for: (1) moving
assets from lower-yield to higher-yield opportunities, (2) rebalancing vault capacity during high
demand periods, (3) optimizing capital efficiency across the protocol. The batch system ensures
all transfers are processed fairly during settlement periods.</em></p>
<pre><code class="language-solidity">function kAssetTransfer(
    address sourceVault,
    address targetVault,
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address transferring assets (will lose virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The kStakingVault address receiving assets (will gain virtual balance)</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred between vaults</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer for rebalancing</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this transfer with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpush-1"><a class="header" href="#ksharesrequestpush-1">kSharesRequestPush</a></h3>
<p>Requests shares to be pushed for kStakingVault staking operations and batch processing</p>
<p><em>This function is part of the share-based accounting system for retail users in kStakingVaults.
When users stake kTokens, the vault requests shares to be pushed to track their ownership. The
process coordinates: (1) conversion of kTokens to vault shares at current share price, (2) updating
user balances in the vault system, (3) preparing for batch settlement. Share requests are batched
to optimize gas costs and ensure fair pricing across all users in the same settlement period.</em></p>
<pre><code class="language-solidity">function kSharesRequestPush(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share push operations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for push to users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share operations with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpull-1"><a class="header" href="#ksharesrequestpull-1">kSharesRequestPull</a></h3>
<p>Requests shares to be pulled for kStakingVault redemption operations</p>
<p><em>This function handles the share-based redemption process for retail users withdrawing from
kStakingVaults. The process involves: (1) calculating share amounts to redeem based on user
requests, (2) preparing for conversion back to kTokens at settlement time, (3) coordinating
with the batch settlement system for fair pricing. Unlike institutional redemptions through
kMinter, this uses share-based accounting to handle smaller, more frequent retail operations
efficiently through the vault's batch processing system.</em></p>
<pre><code class="language-solidity">function kSharesRequestPull(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share pull for redemptions</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for pull from users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share redemptions with settlement</td></tr>
</tbody></table>
</div>
<h3 id="proposesettlebatch-1"><a class="header" href="#proposesettlebatch-1">proposeSettleBatch</a></h3>
<p>Proposes a batch settlement for a vault with yield distribution through kToken minting/burning</p>
<p><em>This is the core function that initiates yield distribution in the KAM protocol. The settlement
process involves: (1) calculating final yields after a batch period, (2) determining net new deposits/
redemptions, (3) creating a proposal with cooldown period for security verification, (4) preparing for
kToken supply adjustment to maintain 1:1 backing. Positive yields result in kToken minting (distributing
gains to all holders), while losses result in kToken burning (socializing losses). The cooldown period
allows guardians to verify calculations before execution, ensuring protocol integrity.</em></p>
<pre><code class="language-solidity">function proposeSettleBatch(
    address asset,
    address vault,
    bytes32 batchId,
    uint256 totalAssets_,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    payable
    returns (bytes32 proposalId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being settled (USDC, WBTC, etc.)</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address where yield was generated</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits minus redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute amount of yield generated (positive) or lost (negative)</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive (will mint kTokens), false if negative (will burn kTokens)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>Unique identifier for this settlement proposal for tracking and execution</td></tr>
</tbody></table>
</div>
<h3 id="executesettlebatch-1"><a class="header" href="#executesettlebatch-1">executeSettleBatch</a></h3>
<p>Executes a settlement proposal after the security cooldown period has elapsed</p>
<p><em>This function completes the yield distribution process by: (1) verifying the cooldown period has
passed, (2) executing the actual kToken minting/burning to distribute yield or account for losses,
(3) updating all vault balances and user accounting, (4) processing any pending redemption requests
from the batch. This is where the 1:1 backing is maintained - the kToken supply is adjusted to exactly
reflect the underlying asset changes, ensuring every kToken remains backed by real assets plus distributed
yield.</em></p>
<pre><code class="language-solidity">function executeSettleBatch(bytes32 proposalId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to execute</td></tr>
</tbody></table>
</div>
<h3 id="cancelproposal-1"><a class="header" href="#cancelproposal-1">cancelProposal</a></h3>
<p>Cancels a settlement proposal before execution if errors are detected</p>
<p><em>Provides a safety mechanism for guardians to cancel potentially incorrect settlement proposals.
This can be used when: (1) yield calculations appear incorrect, (2) system errors are detected,
(3) market conditions require recalculation. Cancellation allows for proposal correction and
resubmission with accurate data, preventing incorrect yield distribution that could affect the
protocol's 1:1 backing guarantee. Only callable before the proposal execution.</em></p>
<pre><code class="language-solidity">function cancelProposal(bytes32 proposalId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to cancel</td></tr>
</tbody></table>
</div>
<h3 id="_executesettlement"><a class="header" href="#_executesettlement">_executeSettlement</a></h3>
<p>Internal function to execute the core settlement logic with yield distribution</p>
<p><em>This function performs the critical yield distribution process: (1) mints or burns kTokens
to reflect yield gains/losses, (2) updates vault accounting and batch tracking, (3) coordinates
the 1:1 backing maintenance. This is where the protocol's fundamental promise is maintained -
the kToken supply is adjusted to precisely match underlying asset changes plus distributed yield.</em></p>
<pre><code class="language-solidity">function _executeSettlement(VaultSettlementProposal storage proposal) private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The settlement proposal storage reference containing all settlement parameters</td></tr>
</tbody></table>
</div>
<h3 id="setsettlementcooldown-1"><a class="header" href="#setsettlementcooldown-1">setSettlementCooldown</a></h3>
<p>Sets the security cooldown period for settlement proposals</p>
<p><em>The cooldown period provides critical security by requiring a delay between proposal creation
and execution. This allows: (1) protocol guardians to verify yield calculations, (2) detection of
potential errors or malicious proposals, (3) emergency intervention if needed. The cooldown should
balance security (longer is safer) with operational efficiency (shorter enables faster yield
distribution). Only admin roles can modify this parameter as it affects protocol safety.</em></p>
<pre><code class="language-solidity">function setSettlementCooldown(uint256 cooldown) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds before settlement proposals can be executed</td></tr>
</tbody></table>
</div>
<h3 id="getpendingproposals-1"><a class="header" href="#getpendingproposals-1">getPendingProposals</a></h3>
<p>Retrieves all pending settlement proposals for a specific vault</p>
<p><em>Returns proposal IDs that have been created but not yet executed or cancelled.
Used for monitoring and management of the settlement queue. Essential for guardians
to track proposals awaiting verification during the cooldown period.</em></p>
<pre><code class="language-solidity">function getPendingProposals(address vault) external view returns (bytes32[] memory pendingProposals);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pendingProposals</code></td><td><code>bytes32[]</code></td><td>Array of proposal IDs currently pending execution</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementproposal-1"><a class="header" href="#getsettlementproposal-1">getSettlementProposal</a></h3>
<p>Retrieves complete details of a specific settlement proposal</p>
<p><em>Returns the full VaultSettlementProposal struct containing all parameters needed
for yield distribution verification. Essential for guardians to review proposal accuracy
during the cooldown period before execution. Contains asset amounts, yield calculations,
and timing information for comprehensive proposal analysis.</em></p>
<pre><code class="language-solidity">function getSettlementProposal(bytes32 proposalId) external view returns (VaultSettlementProposal memory proposal);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The complete settlement proposal struct with all details</td></tr>
</tbody></table>
</div>
<h3 id="canexecuteproposal-1"><a class="header" href="#canexecuteproposal-1">canExecuteProposal</a></h3>
<p>Checks if a settlement proposal is ready for execution with detailed status</p>
<p><em>Validates all execution requirements: (1) proposal exists and is pending, (2) cooldown
period has elapsed, (3) proposal hasn't been cancelled. Returns both boolean result and
human-readable reason for failures, enabling better error handling and user feedback.</em></p>
<pre><code class="language-solidity">function canExecuteProposal(bytes32 proposalId) external view returns (bool canExecute, string memory reason);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the proposal to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>canExecute</code></td><td><code>bool</code></td><td>True if the proposal can be executed immediately</td></tr>
<tr><td><code>reason</code></td><td><code>string</code></td><td>Descriptive message explaining why execution is blocked (if applicable)</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementcooldown-1"><a class="header" href="#getsettlementcooldown-1">getSettlementCooldown</a></h3>
<p>Gets the current security cooldown period for settlement proposals</p>
<p><em>The cooldown period determines how long proposals must wait before execution.
This security mechanism allows guardians to verify yield calculations and prevents
immediate execution of potentially malicious or incorrect proposals. Critical for
maintaining protocol integrity during yield distribution processes.</em></p>
<pre><code class="language-solidity">function getSettlementCooldown() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>cooldown The current cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="_virtualbalance"><a class="header" href="#_virtualbalance">_virtualBalance</a></h3>
<p>Calculates the virtual balance of assets for a vault across all its adapters</p>
<p><em>This function aggregates asset balances across all adapters connected to a vault to determine
the total virtual balance available for operations. Essential for coordination between physical
asset locations and protocol accounting. Used for settlement calculations and ensuring sufficient
assets are available for redemptions and transfers within the money flow system.</em></p>
<pre><code class="language-solidity">function _virtualBalance(address vault, address asset) private view returns (uint256 balance);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to calculate virtual balance for</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query balance for</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>balance</code></td><td><code>uint256</code></td><td>The total virtual asset balance across all vault adapters</td></tr>
</tbody></table>
</div>
<h3 id="_checkkminter"><a class="header" href="#_checkkminter">_checkKMinter</a></h3>
<p>Validates that the caller is an authorized kMinter contract</p>
<p><em>Ensures only kMinter can push assets and request pulls for institutional operations.
Critical for maintaining proper access control in the money flow coordination system.</em></p>
<pre><code class="language-solidity">function _checkKMinter(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to validate as authorized kMinter</td></tr>
</tbody></table>
</div>
<h3 id="_checkvault"><a class="header" href="#_checkvault">_checkVault</a></h3>
<p>Validates that the caller is an authorized kStakingVault contract</p>
<p><em>Ensures only registered vaults can request share operations and asset transfers.
Essential for maintaining protocol security and preventing unauthorized money flows.</em></p>
<pre><code class="language-solidity">function _checkVault(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to validate as authorized vault</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero-1"><a class="header" href="#_checkamountnotzero-1">_checkAmountNotZero</a></h3>
<p>Validates that an amount parameter is not zero to prevent invalid operations</p>
<p><em>Prevents zero-amount operations that could cause accounting errors or waste gas</em></p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount value to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero"><a class="header" href="#_checkaddressnotzero">_checkAddressNotZero</a></h3>
<p>Validates that an address parameter is not the zero address</p>
<p><em>Prevents operations with invalid zero addresses that could cause loss of funds</em></p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>The address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checksufficientvirtualbalance"><a class="header" href="#_checksufficientvirtualbalance">_checkSufficientVirtualBalance</a></h3>
<p>Check if virtual balance is sufficient</p>
<pre><code class="language-solidity">function _checkSufficientVirtualBalance(address vault, address asset, uint256 requiredAmount) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>Vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address</td></tr>
<tr><td><code>requiredAmount</code></td><td><code>uint256</code></td><td>Required amount</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-1"><a class="header" href="#_checkadmin-1">_checkAdmin</a></h3>
<p>Check if caller is an admin</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused-1"><a class="header" href="#_checkpaused-1">_checkPaused</a></h3>
<p>Verifies contract is not paused</p>
<pre><code class="language-solidity">function _checkPaused() private view;
</code></pre>
<h3 id="_ispendingproposal"><a class="header" href="#_ispendingproposal">_isPendingProposal</a></h3>
<pre><code class="language-solidity">function _isPendingProposal(address vault, bytes32 proposalId) private view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>the proposalId to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool proposal exists or not</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-3"><a class="header" href="#ispaused-3">isPaused</a></h3>
<p>Checks if the kAssetRouter contract is currently paused</p>
<p><em>When paused, all critical functions (asset movements, settlements) are halted
for emergency protection. This affects the entire protocol's money flow coordination,
preventing new deposits, redemptions, and yield distributions until unpaused.</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused and operations are halted</td></tr>
</tbody></table>
</div>
<h3 id="getdnvaultbyasset-1"><a class="header" href="#getdnvaultbyasset-1">getDNVaultByAsset</a></h3>
<p>Gets the DN vault address responsible for yield generation for a specific asset</p>
<p><em>Each supported asset (USDC, WBTC, etc.) has a designated DN vault that handles
yield farming strategies. This mapping is critical for routing institutional deposits
and coordinating settlement processes across the protocol's vault network.</em></p>
<pre><code class="language-solidity">function getDNVaultByAsset(address asset) external view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address that generates yield for this asset</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidbalances-1"><a class="header" href="#getbatchidbalances-1">getBatchIdBalances</a></h3>
<p>Retrieves the virtual balance accounting for a specific batch in a vault</p>
<p><em>Returns the deposited and requested amounts that are tracked virtually for batch
processing. These balances coordinate institutional flows (kMinter) and retail flows
(kStakingVault) within the same settlement period, ensuring fair processing and accurate
yield distribution across all participants in the batch.</em></p>
<pre><code class="language-solidity">function getBatchIdBalances(
    address vault,
    bytes32 batchId
)
    external
    view
    returns (uint256 deposited, uint256 requested);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query batch balances for</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to retrieve balance information</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deposited</code></td><td><code>uint256</code></td><td>Total amount of assets deposited into this batch</td></tr>
<tr><td><code>requested</code></td><td><code>uint256</code></td><td>Total amount of assets requested for redemption from this batch</td></tr>
</tbody></table>
</div>
<h3 id="getrequestedshares-1"><a class="header" href="#getrequestedshares-1">getRequestedShares</a></h3>
<p>Retrieves the total shares requested for redemption in a specific vault batch</p>
<p><em>Tracks share-based redemption requests from retail users in kStakingVaults.
This is separate from asset-based tracking and enables the protocol to coordinate
both institutional (asset-based) and retail (share-based) operations within the
same batch settlement process, ensuring consistent share price calculations.</em></p>
<pre><code class="language-solidity">function getRequestedShares(address vault, bytes32 batchId) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault address to query</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for the redemption period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of shares requested for redemption in this batch</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade-3"><a class="header" href="#_authorizeupgrade-3">_authorizeUpgrade</a></h3>
<p>Authorize contract upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="receive"><a class="header" href="#receive">receive</a></h3>
<p>Receive ETH (for gas refunds, etc.)</p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="contractname-4"><a class="header" href="#contractname-4">contractName</a></h3>
<p>Returns the standard name identifier for this contract type within the KAM protocol</p>
<p><em>Used for protocol identification and registry management. Provides a consistent way
to identify kAssetRouter contracts across the protocol ecosystem, enabling automated
contract discovery and validation by other protocol components.</em></p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string (typically "kAssetRouter")</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-4"><a class="header" href="#contractversion-4">contractVersion</a></h3>
<p>Returns the version identifier for this contract implementation</p>
<p><em>Used for upgrade management and compatibility checking within the protocol. Enables
the system to verify contract versions during upgrades and ensure compatibility between
protocol components. Critical for protocol governance and maintenance procedures.</em></p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h2 id="structs-10"><a class="header" href="#structs-10">Structs</a></h2>
<h3 id="kassetrouterstorage"><a class="header" href="#kassetrouterstorage">kAssetRouterStorage</a></h3>
<p>Core storage structure for kAssetRouter using ERC-7201 namespaced storage pattern</p>
<p><em>This structure manages all state for money flow coordination and settlement operations.
Uses the diamond storage pattern to avoid storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kAssetRouter</p>
<pre><code class="language-solidity">struct kAssetRouterStorage {
    uint256 proposalCounter;
    uint256 vaultSettlementCooldown;
    OptimizedBytes32EnumerableSetLib.Bytes32Set executedProposalIds;
    OptimizedBytes32EnumerableSetLib.Bytes32Set batchIds;
    mapping(address vault =&gt; OptimizedBytes32EnumerableSetLib.Bytes32Set) vaultPendingProposalIds;
    mapping(address account =&gt; mapping(bytes32 batchId =&gt; Balances)) vaultBatchBalances;
    mapping(address vault =&gt; mapping(bytes32 batchId =&gt; uint256)) vaultRequestedShares;
    mapping(bytes32 proposalId =&gt; VaultSettlementProposal) settlementProposals;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kbatchreceiver"><a class="header" href="#kbatchreceiver">kBatchReceiver</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kBatchReceiver.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kBatchReceiver.sol//src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html">IkBatchReceiver</a></p>
<p>Minimal proxy contract implementation for isolated batch asset distribution in the KAM protocol</p>
<p>*This contract implements the minimal proxy pattern where each batch redemption gets its own dedicated
receiver instance for secure and efficient asset distribution. The implementation provides several key features:
(1) Minimal Proxy Pattern: Uses EIP-1167 minimal proxy deployment to reduce gas costs per batch while maintaining
full isolation between different settlement periods, (2) Batch Isolation: Each receiver handles exactly one batch,
preventing cross-contamination and simplifying accounting, (3) Access Control: Only the originating kMinter can
interact with receivers, ensuring strict security throughout the distribution process, (4) Asset Distribution:
Manages the final step of redemption where settled assets flow from kMinter to individual users, (5) Emergency
Recovery: Provides safety mechanisms for accidentally sent tokens while protecting settlement assets.
Technical Implementation Notes:</p>
<ul>
<li>Uses immutable kMinter reference set at construction for gas efficiency</li>
<li>Implements strict batch ID validation to prevent operational errors</li>
<li>Supports both ERC20 and native ETH rescue operations</li>
<li>Emits comprehensive events for off-chain tracking and reconciliation*</li>
</ul>
<h2 id="state-variables-18"><a class="header" href="#state-variables-18">State Variables</a></h2>
<h3 id="kminter-1"><a class="header" href="#kminter-1">kMinter</a></h3>
<p>Address of the kMinter contract authorized to interact with this receiver</p>
<p><em>Immutable reference set at construction time for gas efficiency and security. This address
has exclusive permission to call pullAssets() and rescueAssets(), ensuring only the originating
kMinter can manage asset distribution for this specific batch. The immutable nature prevents
modification and reduces gas costs for access control checks.</em></p>
<pre><code class="language-solidity">address public immutable kMinter;
</code></pre>
<h3 id="asset-3"><a class="header" href="#asset-3">asset</a></h3>
<p>Address of the underlying asset contract this receiver will distribute</p>
<p><em>Set during initialization to specify which token type (USDC, WBTC, etc.) this receiver
manages. Must match the asset type that was originally deposited and requested for redemption
in the associated batch. Used for asset transfer operations and rescue validation.</em></p>
<pre><code class="language-solidity">address public asset;
</code></pre>
<h3 id="batchid-1"><a class="header" href="#batchid-1">batchId</a></h3>
<p>Unique batch identifier linking this receiver to a specific redemption batch</p>
<p><em>Set during initialization to establish the connection between this receiver and the batch
of redemption requests it serves. Used for validation in pullAssets() to ensure operations
are performed on the correct batch, preventing cross-contamination between settlement periods.</em></p>
<pre><code class="language-solidity">bytes32 public batchId;
</code></pre>
<h3 id="isinitialised"><a class="header" href="#isinitialised">isInitialised</a></h3>
<p>Initialization state flag preventing duplicate configuration</p>
<p><em>Boolean flag that prevents re-initialization after the receiver has been configured.
Set to true during the initialize() call to ensure batch parameters can only be set once,
maintaining the integrity of the receiver's purpose and preventing operational errors.</em></p>
<pre><code class="language-solidity">bool public isInitialised;
</code></pre>
<h2 id="functions-38"><a class="header" href="#functions-38">Functions</a></h2>
<h3 id="constructor-4"><a class="header" href="#constructor-4">constructor</a></h3>
<p>Deploys a new kBatchReceiver with immutable kMinter authorization</p>
<p><em>Constructor for minimal proxy implementation that establishes the sole authorized caller.
The kMinter address is set as immutable during deployment to ensure gas efficiency and prevent
unauthorized modifications. This constructor is called once per batch receiver deployment,
establishing the security foundation for all subsequent operations. The address validation
ensures no receiver can be deployed with invalid authorization.</em></p>
<pre><code class="language-solidity">constructor(address _kMinter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_kMinter</code></td><td><code>address</code></td><td>Address of the kMinter contract that will have exclusive interaction rights</td></tr>
</tbody></table>
</div>
<h3 id="initialize-3"><a class="header" href="#initialize-3">initialize</a></h3>
<p>Configures the receiver with batch-specific parameters after deployment</p>
<p><em>Post-deployment initialization that links this receiver to a specific batch and asset type.
This two-step deployment pattern (constructor + initialize) enables efficient minimal proxy usage
where the implementation is deployed once and initialization customizes each instance. The function:
(1) prevents duplicate initialization with isInitialised flag, (2) validates asset address,
(3) stores batch parameters for operational use, (4) emits initialization event for tracking.
Only callable once per receiver instance to maintain batch isolation integrity.</em></p>
<pre><code class="language-solidity">function initialize(bytes32 _batchId, address _asset) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The unique batch identifier this receiver will serve</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>Address of the underlying asset contract (USDC, WBTC, etc.) to distribute</td></tr>
</tbody></table>
</div>
<h3 id="pullassets-1"><a class="header" href="#pullassets-1">pullAssets</a></h3>
<p>Transfers settled assets from the receiver to a redemption user completing their withdrawal</p>
<p><em>This is the core asset distribution function that fulfills redemption requests after batch settlement.
The process works as follows: (1) kMinter calls this function with user's proportional share, (2) receiver
validates the batch ID matches to prevent cross-batch contamination, (3) assets are transferred directly
to the user completing their redemption. Only callable by the authorized kMinter contract to maintain strict
access control. This function is typically called multiple times per batch as individual users claim their
settled redemptions, ensuring fair and orderly asset distribution.</em></p>
<pre><code class="language-solidity">function pullAssets(address receiver, uint256 amount, bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that will receive the settled assets (the user completing redemption)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer based on the user's proportional share</td></tr>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for validation (must match this receiver's configured batch)</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets-3"><a class="header" href="#rescueassets-3">rescueAssets</a></h3>
<p>Emergency recovery function for accidentally sent assets to prevent permanent loss</p>
<p><em>Provides a safety mechanism for recovering tokens or ETH that were mistakenly sent to the receiver
outside of normal settlement operations. The function handles both ERC20 tokens and native ETH recovery.
For ERC20 tokens, it validates that the rescue asset is not the receiver's designated settlement asset
(to prevent interfering with normal operations). Only the authorized kMinter can execute rescues, ensuring
recovered assets return to the proper custodial system. Essential for maintaining protocol security while
preventing accidental asset loss during the receiver contract's operational lifecycle.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The contract address of the asset to rescue (use address(0) for native ETH recovery)</td></tr>
</tbody></table>
</div>
<h3 id="_checkminter"><a class="header" href="#_checkminter">_checkMinter</a></h3>
<p><em>Only callable by kMinter</em></p>
<pre><code class="language-solidity">function _checkMinter(address minter) private view;
</code></pre>
<h3 id="_checkaddressnotzero-1"><a class="header" href="#_checkaddressnotzero-1">_checkAddressNotZero</a></h3>
<p><em>Checks address is not zero</em></p>
<pre><code class="language-solidity">function _checkAddressNotZero(address address_) private pure;
</code></pre>
<h3 id="_checkamountnotzero-2"><a class="header" href="#_checkamountnotzero-2">_checkAmountNotZero</a></h3>
<p><em>Checks amount is not zero</em></p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kminter-2"><a class="header" href="#kminter-2">kMinter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kMinter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kMinter.sol//src/interfaces/IkMinter.sol/interface.IkMinter.html">IkMinter</a>, <a href="src/kMinter.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/kMinter.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a>, <a href="src/kMinter.sol//src/base/kBase.sol/contract.kBase.html">kBase</a>, <a href="src/kMinter.sol//src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></p>
<p>Institutional gateway for kToken minting and redemption with batch settlement processing</p>
<p><em>This contract serves as the primary interface for qualified institutions to interact with the KAM protocol,
enabling them to mint kTokens by depositing underlying assets and redeem them through a sophisticated batch
settlement system. Key features include: (1) Immediate 1:1 kToken minting upon asset deposit, bypassing the
share-based accounting used for retail users, (2) Two-phase redemption process that handles requests through
batch settlements to optimize gas costs and maintain protocol efficiency, (3) Integration with kStakingVault
for yield generation on deposited assets, (4) Request tracking and management system with unique IDs for each
redemption, (5) Cancellation mechanism for pending requests before batch closure. The contract enforces strict
access control, ensuring only verified institutions can access these privileged operations while maintaining
the security and integrity of the protocol's asset backing.</em></p>
<h2 id="state-variables-19"><a class="header" href="#state-variables-19">State Variables</a></h2>
<h3 id="kminter_storage_location"><a class="header" href="#kminter_storage_location">KMINTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KMINTER_STORAGE_LOCATION = 0xd0574379115d2b8497bfd9020aa9e0becaffc59e5509520aa5fe8c763e40d000;
</code></pre>
<h2 id="functions-39"><a class="header" href="#functions-39">Functions</a></h2>
<h3 id="_getkminterstorage"><a class="header" href="#_getkminterstorage">_getkMinterStorage</a></h3>
<p>Retrieves the kMinter storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkMinterStorage() private pure returns (kMinterStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kMinterStorage</code></td><td>The kMinterStorage struct reference for state modifications</td></tr>
</tbody></table>
</div>
<h3 id="constructor-5"><a class="header" href="#constructor-5">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-4"><a class="header" href="#initialize-4">initialize</a></h3>
<p>Initializes the kMinter contract</p>
<pre><code class="language-solidity">function initialize(address registry_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the registry contract</td></tr>
</tbody></table>
</div>
<h3 id="mint-2"><a class="header" href="#mint-2">mint</a></h3>
<p>Executes institutional minting of kTokens through immediate 1:1 issuance against deposited assets</p>
<p><em>This function enables qualified institutions to mint kTokens by depositing underlying assets. The process
involves: (1) transferring assets from the caller to kAssetRouter, (2) pushing assets into the current batch
of the designated DN vault for yield generation, and (3) immediately minting an equivalent amount of kTokens
to the recipient. Unlike retail operations, institutional mints bypass share-based accounting and provide
immediate token issuance without waiting for batch settlement. The deposited assets are tracked separately
to maintain the 1:1 backing ratio and will participate in vault yield strategies through the batch system.</em></p>
<pre><code class="language-solidity">function mint(address asset_, address to_, uint256 amount_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="requestredeem-1"><a class="header" href="#requestredeem-1">requestRedeem</a></h3>
<p>Initiates a two-phase institutional redemption by creating a batch request for underlying asset
withdrawal</p>
<p><em>This function implements the first phase of the redemption process for qualified institutions. The workflow
consists of: (1) transferring kTokens from the caller to this contract for escrow (not burned yet), (2)
generating
a unique request ID for tracking, (3) creating a RedeemRequest struct with PENDING status, (4) registering the
request with kAssetRouter for batch processing. The kTokens remain in escrow until the batch is settled and the
user calls redeem() to complete the process. This two-phase approach is necessary because redemptions are
processed
in batches through the DN vault system, which requires waiting for batch settlement to ensure proper asset
availability and yield distribution. The request can be cancelled before batch closure/settlement.</em></p>
<pre><code class="language-solidity">function requestRedeem(address asset_, address to_, uint256 amount_) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>A unique bytes32 identifier for tracking and executing this redemption request</td></tr>
</tbody></table>
</div>
<h3 id="redeem-3"><a class="header" href="#redeem-3">redeem</a></h3>
<p>Completes the second phase of institutional redemption by executing a settled batch request</p>
<p><em>This function finalizes the redemption process initiated by requestRedeem(). It can only be called after
the batch containing this request has been settled through the kAssetRouter settlement process. The execution
involves: (1) validating the request exists and is in PENDING status, (2) updating the request status to
REDEEMED,
(3) removing the request from tracking, (4) burning the escrowed kTokens permanently, (5) instructing the
kBatchReceiver contract to transfer the underlying assets to the recipient. The kBatchReceiver is a minimal
proxy
deployed per batch that holds the settled assets and ensures isolated distribution. This function will revert if
the batch is not yet settled, ensuring assets are only distributed when available. The separation between
request
and redemption phases allows for efficient batch processing of multiple redemptions while maintaining asset
safety.</em></p>
<pre><code class="language-solidity">function redeem(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to execute (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="cancelrequest-1"><a class="header" href="#cancelrequest-1">cancelRequest</a></h3>
<p>Cancels a pending redemption request and returns the escrowed kTokens to the user</p>
<p><em>This function allows institutions to cancel their redemption requests before the batch is closed or
settled.
The cancellation process involves: (1) validating the request exists and is in PENDING status, (2) checking that
the batch is neither closed nor settled (once closed, cancellation is not possible as the batch is being
processed),
(3) updating the request status to CANCELLED, (4) removing the request from tracking, (5) returning the escrowed
kTokens back to the original requester. This mechanism provides flexibility for institutions to manage their
liquidity needs, allowing them to reverse redemption decisions if market conditions change or if they need
immediate
access to their kTokens. The function enforces strict timing constraints - cancellation is only permitted while
the
batch remains open, ensuring batch integrity and preventing manipulation of settled redemptions.</em></p>
<pre><code class="language-solidity">function cancelRequest(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to cancel (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="_checknotpaused"><a class="header" href="#_checknotpaused">_checkNotPaused</a></h3>
<p>Check if contract is not paused</p>
<pre><code class="language-solidity">function _checkNotPaused() private view;
</code></pre>
<h3 id="_checkinstitution"><a class="header" href="#_checkinstitution">_checkInstitution</a></h3>
<p>Check if caller is an institution</p>
<pre><code class="language-solidity">function _checkInstitution(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-2"><a class="header" href="#_checkadmin-2">_checkAdmin</a></h3>
<p>Check if caller is an admin</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkvalidasset"><a class="header" href="#_checkvalidasset">_checkValidAsset</a></h3>
<p>Check if asset is valid/supported</p>
<pre><code class="language-solidity">function _checkValidAsset(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero-3"><a class="header" href="#_checkamountnotzero-3">_checkAmountNotZero</a></h3>
<p>Check if amount is not zero</p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero-2"><a class="header" href="#_checkaddressnotzero-2">_checkAddressNotZero</a></h3>
<p>Check if address is not zero</p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_createredeemrequestid"><a class="header" href="#_createredeemrequestid">_createRedeemRequestId</a></h3>
<p>Generates a request ID</p>
<pre><code class="language-solidity">function _createRedeemRequestId(address user, uint256 amount, uint256 timestamp) private returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>User address</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount</td></tr>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Request ID</td></tr>
</tbody></table>
</div>
<h3 id="rescuereceiverassets-1"><a class="header" href="#rescuereceiverassets-1">rescueReceiverAssets</a></h3>
<p>Emergency admin function to recover stuck assets from a batch receiver contract</p>
<p><em>This function provides a recovery mechanism for assets that may become stuck in kBatchReceiver contracts
due to failed redemptions or system errors. The process involves two steps: (1) calling rescueAssets on the
kBatchReceiver to transfer assets back to this contract, and (2) using the inherited rescueAssets function
from kBase to forward them to the specified destination. This two-step process ensures proper access control
and maintains the security model where only authorized contracts can interact with batch receivers. This
function should only be used in emergency situations and requires admin privileges to prevent abuse.</em></p>
<pre><code class="language-solidity">function rescueReceiverAssets(address batchReceiver, address asset_, address to_, uint256 amount_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The address of the kBatchReceiver contract holding the stuck assets</td></tr>
<tr><td><code>asset_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="ispaused-4"><a class="header" href="#ispaused-4">isPaused</a></h3>
<p>Checks if the contract is currently paused</p>
<p><em>Returns the paused state from the base storage for operational control</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="getredeemrequest-1"><a class="header" href="#getredeemrequest-1">getRedeemRequest</a></h3>
<p>Retrieves details of a specific redemption request</p>
<p><em>Returns the complete RedeemRequest struct containing all request information</em></p>
<pre><code class="language-solidity">function getRedeemRequest(bytes32 requestId) external view returns (RedeemRequest memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>RedeemRequest</code></td><td>The complete RedeemRequest struct with status, amounts, and batch information</td></tr>
</tbody></table>
</div>
<h3 id="getuserrequests-1"><a class="header" href="#getuserrequests-1">getUserRequests</a></h3>
<p>Gets all redemption request IDs for a specific user</p>
<p><em>Returns request IDs from the user's enumerable set for efficient tracking</em></p>
<pre><code class="language-solidity">function getUserRequests(address user) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The user address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of request IDs belonging to the user</td></tr>
</tbody></table>
</div>
<h3 id="getrequestcounter-1"><a class="header" href="#getrequestcounter-1">getRequestCounter</a></h3>
<p>Gets the current request counter value</p>
<p><em>Returns the monotonically increasing counter used for generating unique request IDs</em></p>
<pre><code class="language-solidity">function getRequestCounter() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current counter used for generating unique request IDs</td></tr>
</tbody></table>
</div>
<h3 id="gettotallockedassets-1"><a class="header" href="#gettotallockedassets-1">getTotalLockedAssets</a></h3>
<p>Gets the total locked assets for a specific asset</p>
<p><em>Returns the cumulative amount of assets deposited through mint operations for accounting</em></p>
<pre><code class="language-solidity">function getTotalLockedAssets(address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of assets locked in the protocol</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade-4"><a class="header" href="#_authorizeupgrade-4">_authorizeUpgrade</a></h3>
<p>Authorizes contract upgrades</p>
<p><em>Only callable by ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="contractname-5"><a class="header" href="#contractname-5">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-5"><a class="header" href="#contractversion-5">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h2 id="structs-11"><a class="header" href="#structs-11">Structs</a></h2>
<h3 id="kminterstorage"><a class="header" href="#kminterstorage">kMinterStorage</a></h3>
<p>Core storage structure for kMinter using ERC-7201 namespaced storage pattern</p>
<p><em>This structure manages all state for institutional minting and redemption operations.
Uses the diamond storage pattern to avoid storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kMinter</p>
<pre><code class="language-solidity">struct kMinterStorage {
    mapping(address =&gt; uint256) totalLockedAssets;
    uint64 requestCounter;
    mapping(bytes32 =&gt; RedeemRequest) redeemRequests;
    mapping(address =&gt; OptimizedBytes32EnumerableSetLib.Bytes32Set) userRequests;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kregistry"><a class="header" href="#kregistry">kRegistry</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kRegistry.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kRegistry.sol//src/interfaces/IkRegistry.sol/interface.IkRegistry.html">IkRegistry</a>, <a href="src/kRegistry.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/kRegistry.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a>, <a href="src/kRegistry.sol//src/libraries/OptimizedOwnableRoles.sol/abstract.OptimizedOwnableRoles.html">OptimizedOwnableRoles</a></p>
<p>Central configuration hub and contract registry for the KAM protocol ecosystem</p>
<p><em>This contract serves as the protocol's backbone for configuration management and access control. It provides
five critical functions: (1) Singleton contract management - registers and tracks core protocol contracts like
kMinter and kAssetRouter ensuring single source of truth, (2) Asset and kToken management - handles asset
whitelisting, kToken deployment, and maintains bidirectional mappings between underlying assets and their
corresponding kTokens, (3) Vault registry - manages vault registration, classification (DN, ALPHA, BETA, etc.),
and routing logic to direct assets to appropriate vaults based on type and strategy, (4) Role-based access
control - implements a hierarchical permission system with ADMIN, EMERGENCY_ADMIN, GUARDIAN, RELAYER, INSTITUTION,
and VENDOR roles to enforce protocol security, (5) Adapter management - registers and tracks external protocol
adapters per vault enabling yield strategy integrations. The registry uses upgradeable architecture with UUPS
pattern and ERC-7201 namespaced storage to ensure future extensibility while maintaining state consistency.</em></p>
<h2 id="state-variables-20"><a class="header" href="#state-variables-20">State Variables</a></h2>
<h3 id="admin_role"><a class="header" href="#admin_role">ADMIN_ROLE</a></h3>
<p>Admin role for authorized operations</p>
<pre><code class="language-solidity">uint256 internal constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role"><a class="header" href="#emergency_admin_role">EMERGENCY_ADMIN_ROLE</a></h3>
<p>Emergency admin role for emergency operations</p>
<pre><code class="language-solidity">uint256 internal constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="guardian_role"><a class="header" href="#guardian_role">GUARDIAN_ROLE</a></h3>
<p>Guardian role as a circuit breaker for settlement proposals</p>
<pre><code class="language-solidity">uint256 internal constant GUARDIAN_ROLE = _ROLE_2;
</code></pre>
<h3 id="relayer_role"><a class="header" href="#relayer_role">RELAYER_ROLE</a></h3>
<p>Relayer role for external vaults</p>
<pre><code class="language-solidity">uint256 internal constant RELAYER_ROLE = _ROLE_3;
</code></pre>
<h3 id="institution_role"><a class="header" href="#institution_role">INSTITUTION_ROLE</a></h3>
<p>Reserved role for special whitelisted addresses</p>
<pre><code class="language-solidity">uint256 internal constant INSTITUTION_ROLE = _ROLE_4;
</code></pre>
<h3 id="vendor_role"><a class="header" href="#vendor_role">VENDOR_ROLE</a></h3>
<p>Vendor role for vendor vaults</p>
<pre><code class="language-solidity">uint256 internal constant VENDOR_ROLE = _ROLE_5;
</code></pre>
<h3 id="k_minter-2"><a class="header" href="#k_minter-2">K_MINTER</a></h3>
<p>kMinter key</p>
<pre><code class="language-solidity">bytes32 public constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router-3"><a class="header" href="#k_asset_router-3">K_ASSET_ROUTER</a></h3>
<p>kAssetRouter key</p>
<pre><code class="language-solidity">bytes32 public constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="usdc"><a class="header" href="#usdc">USDC</a></h3>
<p>USDC key</p>
<pre><code class="language-solidity">bytes32 public constant USDC = keccak256("USDC");
</code></pre>
<h3 id="wbtc"><a class="header" href="#wbtc">WBTC</a></h3>
<p>WBTC key</p>
<pre><code class="language-solidity">bytes32 public constant WBTC = keccak256("WBTC");
</code></pre>
<h3 id="max_bps-1"><a class="header" href="#max_bps-1">MAX_BPS</a></h3>
<p>Maximum basis points (100%)</p>
<pre><code class="language-solidity">uint256 constant MAX_BPS = 10_000;
</code></pre>
<h3 id="kregistry_storage_location"><a class="header" href="#kregistry_storage_location">KREGISTRY_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KREGISTRY_STORAGE_LOCATION = 0x164f5345d77b48816cdb20100c950b74361454722dab40c51ecf007b721fa800;
</code></pre>
<h2 id="functions-40"><a class="header" href="#functions-40">Functions</a></h2>
<h3 id="_getkregistrystorage"><a class="header" href="#_getkregistrystorage">_getkRegistryStorage</a></h3>
<p>Retrieves the kRegistry storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkRegistryStorage() private pure returns (kRegistryStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kRegistryStorage</code></td><td>The kRegistryStorage struct reference for state modifications</td></tr>
</tbody></table>
</div>
<h3 id="constructor-6"><a class="header" href="#constructor-6">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-5"><a class="header" href="#initialize-5">initialize</a></h3>
<p>Initializes the kRegistry contract</p>
<pre><code class="language-solidity">function initialize(
    address owner_,
    address admin_,
    address emergencyAdmin_,
    address guardian_,
    address relayer_,
    address treasury_
)
    external
    initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Contract owner address</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Admin role recipient</td></tr>
<tr><td><code>emergencyAdmin_</code></td><td><code>address</code></td><td>Emergency admin role recipient</td></tr>
<tr><td><code>guardian_</code></td><td><code>address</code></td><td>Guardian role recipient</td></tr>
<tr><td><code>relayer_</code></td><td><code>address</code></td><td>Relayer role recipient</td></tr>
<tr><td><code>treasury_</code></td><td><code>address</code></td><td>Treasury address</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets-4"><a class="header" href="#rescueassets-4">rescueAssets</a></h3>
<p>Emergency function to rescue accidentally sent assets (ETH or ERC20) from the contract</p>
<p><em>This function provides a recovery mechanism for assets mistakenly sent to the registry. It includes
critical safety checks: (1) Only callable by ADMIN_ROLE to prevent unauthorized access, (2) Cannot rescue
registered protocol assets to prevent draining legitimate funds, (3) Validates amounts and balances.
For ETH rescue, use address(0) as the asset parameter. The function ensures protocol integrity by
preventing rescue of assets that are part of normal protocol operations.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_, address to_, uint256 amount_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The asset address to rescue (use address(0) for ETH)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The destination address that will receive the rescued assets</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The amount of assets to rescue (must not exceed contract balance)</td></tr>
</tbody></table>
</div>
<h3 id="setsingletoncontract-1"><a class="header" href="#setsingletoncontract-1">setSingletonContract</a></h3>
<p>Registers a core singleton contract in the protocol</p>
<p><em>Only callable by ADMIN_ROLE. Ensures single source of truth for protocol contracts.</em></p>
<pre><code class="language-solidity">function setSingletonContract(bytes32 id, address contractAddress) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Unique contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>Address of the singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="grantinstitutionrole-1"><a class="header" href="#grantinstitutionrole-1">grantInstitutionRole</a></h3>
<p>Grants institution role to enable privileged protocol access</p>
<p><em>Only callable by VENDOR_ROLE. Institutions gain access to kMinter and other premium features.</em></p>
<pre><code class="language-solidity">function grantInstitutionRole(address institution_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>institution_</code></td><td><code>address</code></td><td>The address to grant institution privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantvendorrole-1"><a class="header" href="#grantvendorrole-1">grantVendorRole</a></h3>
<p>Grants vendor role for vendor management capabilities</p>
<p><em>Only callable by ADMIN_ROLE. Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function grantVendorRole(address vendor_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vendor_</code></td><td><code>address</code></td><td>The address to grant vendor privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantrelayerrole-1"><a class="header" href="#grantrelayerrole-1">grantRelayerRole</a></h3>
<p>Grants relayer role for external vault operations</p>
<p><em>Only callable by ADMIN_ROLE. Relayers manage external vaults and set hurdle rates.</em></p>
<pre><code class="language-solidity">function grantRelayerRole(address relayer_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>relayer_</code></td><td><code>address</code></td><td>The address to grant relayer privileges</td></tr>
</tbody></table>
</div>
<h3 id="registerasset-1"><a class="header" href="#registerasset-1">registerAsset</a></h3>
<p>Registers a new underlying asset in the protocol and deploys its corresponding kToken</p>
<p><em>This function performs critical asset onboarding: (1) Validates the asset isn't already registered,
(2) Adds asset to the supported set and singleton registry, (3) Deploys a new kToken contract with
matching decimals, (4) Establishes bidirectional asset-kToken mapping, (5) Grants minting privileges
to kMinter. The function automatically inherits decimals from the underlying asset for consistency.
Only callable by ADMIN_ROLE to maintain protocol security and prevent unauthorized token creation.</em></p>
<pre><code class="language-solidity">function registerAsset(
    string memory name_,
    string memory symbol_,
    address asset,
    bytes32 id
)
    external
    payable
    returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name_</code></td><td><code>string</code></td><td></td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td></td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset contract address to register</td></tr>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>The unique identifier for singleton asset storage (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The deployed kToken contract address</td></tr>
</tbody></table>
</div>
<h3 id="registervault-1"><a class="header" href="#registervault-1">registerVault</a></h3>
<p>Registers a new vault contract in the protocol's vault management system</p>
<p><em>This function integrates vaults into the protocol by: (1) Validating the vault isn't already registered,
(2) Verifying the asset is supported by the protocol, (3) Classifying the vault by type for routing,
(4) Establishing vault-asset relationships for both forward and reverse lookups, (5) Setting as primary
vault for the asset-type combination if it's the first registered. The vault type determines routing
logic and strategy selection (DN for institutional, ALPHA/BETA for different risk profiles).
Only callable by ADMIN_ROLE to ensure proper vault vetting and integration.</em></p>
<pre><code class="language-solidity">function registerVault(address vault, VaultType type_, address asset) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to register</td></tr>
<tr><td><code>type_</code></td><td><code>VaultType</code></td><td>The vault classification type (DN, ALPHA, BETA, etc.) determining its role</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address this vault will manage</td></tr>
</tbody></table>
</div>
<h3 id="removevault-1"><a class="header" href="#removevault-1">removeVault</a></h3>
<p>Removes a vault from the protocol registry</p>
<p><em>This function deregisters a vault, removing it from the active vault set. This operation should be
used carefully as it affects routing and asset management. Only callable by ADMIN_ROLE to ensure proper
decommissioning procedures are followed. Note that this doesn't clear all vault mappings for gas efficiency.</em></p>
<pre><code class="language-solidity">function removeVault(address vault) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to remove from the registry</td></tr>
</tbody></table>
</div>
<h3 id="settreasury-1"><a class="header" href="#settreasury-1">setTreasury</a></h3>
<p>Sets the treasury address</p>
<p><em>Treasury receives protocol fees and serves as emergency fund holder. Only callable by ADMIN_ROLE.</em></p>
<pre><code class="language-solidity">function setTreasury(address treasury_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>treasury_</code></td><td><code>address</code></td><td>The new treasury address</td></tr>
</tbody></table>
</div>
<h3 id="registeradapter-1"><a class="header" href="#registeradapter-1">registerAdapter</a></h3>
<p>Registers an external protocol adapter for a vault</p>
<p><em>Enables yield strategy integrations through external DeFi protocols. Only callable by ADMIN_ROLE.</em></p>
<pre><code class="language-solidity">function registerAdapter(address vault, address adapter) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="removeadapter-1"><a class="header" href="#removeadapter-1">removeAdapter</a></h3>
<p>Removes an adapter from a vault's registered adapter set</p>
<p><em>This disables a specific external protocol integration for the vault. Only callable by ADMIN_ROLE
to ensure proper risk assessment before removing yield strategies.</em></p>
<pre><code class="language-solidity">function removeAdapter(address vault, address adapter) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to remove the adapter from</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to remove</td></tr>
</tbody></table>
</div>
<h3 id="sethurdlerate-1"><a class="header" href="#sethurdlerate-1">setHurdleRate</a></h3>
<p>Sets the hurdle rate for a specific asset</p>
<p><em>Only relayer can set hurdle rates (performance thresholds). Ensures hurdle rate doesn't exceed 100%.
Asset must be registered before setting hurdle rate. Sets minimum performance threshold for yield distribution.</em></p>
<pre><code class="language-solidity">function setHurdleRate(address asset, uint16 hurdleRate) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to set hurdle rate for</td></tr>
<tr><td><code>hurdleRate</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points (100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="gethurdlerate-1"><a class="header" href="#gethurdlerate-1">getHurdleRate</a></h3>
<p>Gets the hurdle rate for a specific asset</p>
<p><em>Returns minimum performance threshold in basis points for yield distribution.
Asset must be registered to query hurdle rate.</em></p>
<pre><code class="language-solidity">function getHurdleRate(address asset) external view returns (uint16);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="getcontractbyid-1"><a class="header" href="#getcontractbyid-1">getContractById</a></h3>
<p>Retrieves a singleton contract address by identifier</p>
<p><em>Reverts if contract not registered. Used for protocol contract discovery.</em></p>
<pre><code class="language-solidity">function getContractById(bytes32 id) public view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address</td></tr>
</tbody></table>
</div>
<h3 id="getassetbyid-1"><a class="header" href="#getassetbyid-1">getAssetById</a></h3>
<p>Retrieves a singleton asset address by identifier</p>
<p><em>Reverts if asset not registered. Provides named access to common assets.</em></p>
<pre><code class="language-solidity">function getAssetById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Asset identifier (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<h3 id="getallassets-1"><a class="header" href="#getallassets-1">getAllAssets</a></h3>
<p>Gets all protocol-supported asset addresses</p>
<p><em>Returns the complete whitelist of supported underlying assets.</em></p>
<pre><code class="language-solidity">function getAllAssets() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of all supported asset addresses</td></tr>
</tbody></table>
</div>
<h3 id="getallvaults-1"><a class="header" href="#getallvaults-1">getAllVaults</a></h3>
<p>Gets all registered vaults in the protocol</p>
<p><em>Returns array of all vault addresses that have been registered through addVault().
Includes both active and inactive vaults. Used for protocol monitoring and management operations.</em></p>
<pre><code class="language-solidity">function getAllVaults() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of all registered vault addresses</td></tr>
</tbody></table>
</div>
<h3 id="gettreasury-1"><a class="header" href="#gettreasury-1">getTreasury</a></h3>
<p>Gets the protocol treasury address</p>
<p><em>Treasury receives protocol fees and serves as emergency fund holder.</em></p>
<pre><code class="language-solidity">function getTreasury() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The treasury address</td></tr>
</tbody></table>
</div>
<h3 id="getcorecontracts-1"><a class="header" href="#getcorecontracts-1">getCoreContracts</a></h3>
<p>Retrieves core protocol contract addresses in one call</p>
<p><em>Optimized getter for frequently accessed contracts. Reverts if either not set.</em></p>
<pre><code class="language-solidity">function getCoreContracts() external view returns (address, address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>kMinter The kMinter contract address</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>kAssetRouter The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="getvaultsbyasset-1"><a class="header" href="#getvaultsbyasset-1">getVaultsByAsset</a></h3>
<p>Gets all vaults that support a specific asset</p>
<p><em>Enables discovery of all vaults capable of handling an asset across different types.</em></p>
<pre><code class="language-solidity">function getVaultsByAsset(address asset) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of vault addresses supporting the asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultbyassetandtype-1"><a class="header" href="#getvaultbyassetandtype-1">getVaultByAssetAndType</a></h3>
<p>Retrieves the primary vault for an asset-type combination</p>
<p><em>Used for routing operations to the appropriate vault. Reverts if not found.</em></p>
<pre><code class="language-solidity">function getVaultByAssetAndType(address asset, uint8 vaultType) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>vaultType</code></td><td><code>uint8</code></td><td>The vault type classification</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The vault address for the asset-type pair</td></tr>
</tbody></table>
</div>
<h3 id="getvaulttype-1"><a class="header" href="#getvaulttype-1">getVaultType</a></h3>
<p>Gets the classification type of a vault</p>
<p><em>Returns the VaultType enum value for routing and strategy selection.</em></p>
<pre><code class="language-solidity">function getVaultType(address vault) external view returns (uint8);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The vault's type classification</td></tr>
</tbody></table>
</div>
<h3 id="isadmin-1"><a class="header" href="#isadmin-1">isAdmin</a></h3>
<p>Checks if an address has admin privileges</p>
<p><em>Admin role has broad protocol management capabilities.</em></p>
<pre><code class="language-solidity">function isAdmin(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isemergencyadmin-1"><a class="header" href="#isemergencyadmin-1">isEmergencyAdmin</a></h3>
<p>Checks if an address has emergency admin privileges</p>
<p><em>Emergency admin can perform critical safety operations.</em></p>
<pre><code class="language-solidity">function isEmergencyAdmin(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has EMERGENCY_ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isguardian-1"><a class="header" href="#isguardian-1">isGuardian</a></h3>
<p>Checks if an address has guardian privileges</p>
<p><em>Guardian acts as circuit breaker for settlement proposals.</em></p>
<pre><code class="language-solidity">function isGuardian(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has GUARDIAN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isrelayer-1"><a class="header" href="#isrelayer-1">isRelayer</a></h3>
<p>Checks if an address has relayer privileges</p>
<p><em>Relayer manages external vault operations and hurdle rates.</em></p>
<pre><code class="language-solidity">function isRelayer(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has RELAYER_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isinstitution-1"><a class="header" href="#isinstitution-1">isInstitution</a></h3>
<p>Checks if an address is a qualified institution</p>
<p><em>Institutions have access to privileged operations like kMinter.</em></p>
<pre><code class="language-solidity">function isInstitution(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has INSTITUTION_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isvendor-1"><a class="header" href="#isvendor-1">isVendor</a></h3>
<p>Checks if an address has vendor privileges</p>
<p><em>Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function isVendor(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has VENDOR_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isasset-1"><a class="header" href="#isasset-1">isAsset</a></h3>
<p>Checks if an asset is supported by the protocol</p>
<p><em>Used for validation before operations. Checks supportedAssets set membership.</em></p>
<pre><code class="language-solidity">function isAsset(address asset) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if asset is in the protocol whitelist</td></tr>
</tbody></table>
</div>
<h3 id="isvault-1"><a class="header" href="#isvault-1">isVault</a></h3>
<p>Checks if a vault is registered in the protocol</p>
<p><em>Used for validation before vault operations. Checks allVaults set membership.</em></p>
<pre><code class="language-solidity">function isVault(address vault) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if vault is registered</td></tr>
</tbody></table>
</div>
<h3 id="getadapters-1"><a class="header" href="#getadapters-1">getAdapters</a></h3>
<p>Gets all adapters registered for a specific vault</p>
<p><em>Returns external protocol integrations enabling yield strategies.</em></p>
<pre><code class="language-solidity">function getAdapters(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of adapter addresses for the vault</td></tr>
</tbody></table>
</div>
<h3 id="isadapterregistered-1"><a class="header" href="#isadapterregistered-1">isAdapterRegistered</a></h3>
<p>Checks if a specific adapter is registered for a vault</p>
<p><em>Used to validate adapter-vault relationships before operations.</em></p>
<pre><code class="language-solidity">function isAdapterRegistered(address vault, address adapter) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to check</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered for the vault</td></tr>
</tbody></table>
</div>
<h3 id="getvaultassets-1"><a class="header" href="#getvaultassets-1">getVaultAssets</a></h3>
<p>Gets all assets managed by a specific vault</p>
<p><em>Most vaults manage single asset, some (like kMinter) handle multiple.</em></p>
<pre><code class="language-solidity">function getVaultAssets(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of asset addresses the vault manages</td></tr>
</tbody></table>
</div>
<h3 id="assettoktoken-1"><a class="header" href="#assettoktoken-1">assetToKToken</a></h3>
<p>Gets the kToken address for a specific underlying asset</p>
<p><em>Critical for minting/redemption operations. Reverts if no kToken exists.</em></p>
<pre><code class="language-solidity">function assetToKToken(address asset) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="_hasrole"><a class="header" href="#_hasrole">_hasRole</a></h3>
<p>Internal helper to check if a user has a specific role</p>
<p><em>Wraps the OptimizedOwnableRoles hasAnyRole function for role verification</em></p>
<pre><code class="language-solidity">function _hasRole(address user, uint256 role_) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for role membership</td></tr>
<tr><td><code>role_</code></td><td><code>uint256</code></td><td>The role constant to check (e.g., ADMIN_ROLE, VENDOR_ROLE)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the user has the specified role, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-3"><a class="header" href="#_checkadmin-3">_checkAdmin</a></h3>
<p>Check if caller has admin role</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkvendor"><a class="header" href="#_checkvendor">_checkVendor</a></h3>
<p>Check if caller has vendor role</p>
<pre><code class="language-solidity">function _checkVendor(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkrelayer-1"><a class="header" href="#_checkrelayer-1">_checkRelayer</a></h3>
<p>Check if caller has relayer role</p>
<pre><code class="language-solidity">function _checkRelayer(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero-3"><a class="header" href="#_checkaddressnotzero-3">_checkAddressNotZero</a></h3>
<p>Check if address is not zero</p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkassetnotregistered"><a class="header" href="#_checkassetnotregistered">_checkAssetNotRegistered</a></h3>
<p>Validates that an asset is not already registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ALREADY_REGISTERED if the asset exists in supportedAssets set.
Used to prevent duplicate registrations and maintain protocol integrity.</em></p>
<pre><code class="language-solidity">function _checkAssetNotRegistered(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkassetregistered"><a class="header" href="#_checkassetregistered">_checkAssetRegistered</a></h3>
<p>Validates that an asset is registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ASSET_NOT_SUPPORTED if the asset doesn't exist in supportedAssets set.
Used to ensure operations only occur on whitelisted assets.</em></p>
<pre><code class="language-solidity">function _checkAssetRegistered(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkvaultregistered"><a class="header" href="#_checkvaultregistered">_checkVaultRegistered</a></h3>
<p>Validates that a vault is registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ASSET_NOT_SUPPORTED if the vault doesn't exist in allVaults set.
Used to ensure operations only occur on registered vaults. Note: error message could be improved.</em></p>
<pre><code class="language-solidity">function _checkVaultRegistered(address vault) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_trygetassetdecimals"><a class="header" href="#_trygetassetdecimals">_tryGetAssetDecimals</a></h3>
<p>*Helper function to get the decimals of the underlying asset.
Useful for setting the return value of <code>_underlyingDecimals</code> during initialization.
If the retrieval succeeds, <code>success</code> will be true, and <code>result</code> will hold the result.
Otherwise, <code>success</code> will be false, and <code>result</code> will be zero.
Example usage:</p>
<pre><code>(bool success, uint8 result) = _tryGetAssetDecimals(underlying);
_decimals = success ? result : _DEFAULT_UNDERLYING_DECIMALS;
```*


```solidity
function _tryGetAssetDecimals(address underlying) internal view returns (bool success, uint8 result);
</code></pre>
<h3 id="_authorizeupgrade-5"><a class="header" href="#_authorizeupgrade-5">_authorizeUpgrade</a></h3>
<p>Authorizes contract upgrades</p>
<p><em>Only callable by contract owner</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="receive-1"><a class="header" href="#receive-1">receive</a></h3>
<p>Fallback function to receive ETH transfers</p>
<p><em>Allows the contract to receive ETH for gas refunds, donations, or accidental transfers.
Received ETH can be rescued using the rescueAssets function with address(0).</em></p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="contractname-6"><a class="header" href="#contractname-6">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-6"><a class="header" href="#contractversion-6">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h2 id="structs-12"><a class="header" href="#structs-12">Structs</a></h2>
<h3 id="kregistrystorage"><a class="header" href="#kregistrystorage">kRegistryStorage</a></h3>
<p>Core storage structure for kRegistry using ERC-7201 namespaced storage pattern</p>
<p><em>This structure maintains all protocol configuration state including contracts, assets, vaults, and
permissions.
Uses the diamond storage pattern to prevent storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kRegistry</p>
<pre><code class="language-solidity">struct kRegistryStorage {
    OptimizedAddressEnumerableSetLib.AddressSet supportedAssets;
    OptimizedAddressEnumerableSetLib.AddressSet allVaults;
    address treasury;
    mapping(bytes32 =&gt; address) singletonContracts;
    mapping(address =&gt; uint8 vaultType) vaultType;
    mapping(address =&gt; mapping(uint8 vaultType =&gt; address)) assetToVault;
    mapping(address =&gt; OptimizedAddressEnumerableSetLib.AddressSet) vaultAsset;
    mapping(address =&gt; OptimizedAddressEnumerableSetLib.AddressSet) vaultsByAsset;
    mapping(bytes32 =&gt; address) singletonAssets;
    mapping(address =&gt; address) assetToKToken;
    mapping(address =&gt; OptimizedAddressEnumerableSetLib.AddressSet) vaultAdapters;
    mapping(address =&gt; bool) registeredAdapters;
    mapping(address =&gt; uint16) assetHurdleRate;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ktoken"><a class="header" href="#ktoken">kToken</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/kToken.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kToken.sol//src/vendor/ERC20.sol/abstract.ERC20.html">ERC20</a>, <a href="src/kToken.sol//src/libraries/OptimizedOwnableRoles.sol/abstract.OptimizedOwnableRoles.html">OptimizedOwnableRoles</a>, <a href="src/kToken.sol//src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a>, <a href="src/kToken.sol//src/vendor/Multicallable.sol/abstract.Multicallable.html">Multicallable</a></p>
<p>ERC20 representation of underlying assets with guaranteed 1:1 backing in the KAM protocol</p>
<p><em>This contract serves as the tokenized wrapper for protocol-supported underlying assets (USDC, WBTC, etc.).
Each kToken maintains a strict 1:1 relationship with its underlying asset through controlled minting and burning.
Key characteristics: (1) Authorized minters (kMinter for institutional deposits, kAssetRouter for yield
distribution)
can create/destroy tokens, (2) kMinter mints tokens 1:1 when assets are deposited and burns during redemptions,
(3) kAssetRouter mints tokens to distribute positive yield to vaults and burns tokens for negative yield/losses,
(4) Implements three-tier role system: ADMIN_ROLE for management, EMERGENCY_ADMIN_ROLE for emergency operations,
MINTER_ROLE for token creation/destruction, (5) Features emergency pause mechanism to halt all transfers during
protocol emergencies, (6) Supports emergency asset recovery for accidentally sent tokens. The contract ensures
protocol integrity by maintaining that kToken supply accurately reflects the underlying asset backing plus any
distributed yield, while enabling efficient yield distribution without physical asset transfers.</em></p>
<h2 id="state-variables-21"><a class="header" href="#state-variables-21">State Variables</a></h2>
<h3 id="admin_role-1"><a class="header" href="#admin_role-1">ADMIN_ROLE</a></h3>
<p>Role constants</p>
<pre><code class="language-solidity">uint256 public constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role-1"><a class="header" href="#emergency_admin_role-1">EMERGENCY_ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="minter_role"><a class="header" href="#minter_role">MINTER_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant MINTER_ROLE = _ROLE_2;
</code></pre>
<h3 id="_ispaused-1"><a class="header" href="#_ispaused-1">_isPaused</a></h3>
<p>Emergency pause state flag for halting all token operations during crises</p>
<p><em>When true, prevents all transfers, minting, and burning through _beforeTokenTransfer hook</em></p>
<pre><code class="language-solidity">bool _isPaused;
</code></pre>
<h3 id="_name"><a class="header" href="#_name">_name</a></h3>
<p>Human-readable name of the kToken (e.g., "KAM USDC")</p>
<p><em>Stored privately to override ERC20 default implementation with custom naming</em></p>
<pre><code class="language-solidity">string private _name;
</code></pre>
<h3 id="_symbol"><a class="header" href="#_symbol">_symbol</a></h3>
<p>Trading symbol of the kToken (e.g., "kUSDC")</p>
<p><em>Stored privately to provide consistent protocol naming convention</em></p>
<pre><code class="language-solidity">string private _symbol;
</code></pre>
<h3 id="_decimals"><a class="header" href="#_decimals">_decimals</a></h3>
<p>Number of decimal places for the kToken, matching the underlying asset</p>
<p><em>Critical for maintaining 1:1 exchange rates with underlying assets</em></p>
<pre><code class="language-solidity">uint8 private _decimals;
</code></pre>
<h2 id="functions-41"><a class="header" href="#functions-41">Functions</a></h2>
<h3 id="constructor-7"><a class="header" href="#constructor-7">constructor</a></h3>
<p>Deploys and initializes a new kToken with specified parameters and role assignments</p>
<p><em>This constructor is called by kRegistry during asset registration to create the kToken wrapper.
The process establishes: (1) ownership hierarchy with owner at the top, (2) role assignments for protocol
operations, (3) token metadata matching the underlying asset. The decimals parameter is particularly
important as it must match the underlying asset to maintain accurate 1:1 exchange rates.</em></p>
<pre><code class="language-solidity">constructor(
    address owner_,
    address admin_,
    address emergencyAdmin_,
    address minter_,
    string memory name_,
    string memory symbol_,
    uint8 decimals_
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>The contract owner (typically kRegistry or protocol governance)</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Address to receive ADMIN_ROLE for managing minters and emergency admins</td></tr>
<tr><td><code>emergencyAdmin_</code></td><td><code>address</code></td><td>Address to receive EMERGENCY_ADMIN_ROLE for pause/emergency operations</td></tr>
<tr><td><code>minter_</code></td><td><code>address</code></td><td>Address to receive initial MINTER_ROLE (typically kMinter contract)</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>Human-readable token name (e.g., "KAM USDC")</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>Token symbol for trading (e.g., "kUSDC")</td></tr>
<tr><td><code>decimals_</code></td><td><code>uint8</code></td><td>Decimal places matching the underlying asset for accurate conversions</td></tr>
</tbody></table>
</div>
<h3 id="mint-3"><a class="header" href="#mint-3">mint</a></h3>
<p>Creates new kTokens and assigns them to the specified address</p>
<p><em>This function serves two critical purposes in the KAM protocol: (1) kMinter calls this when institutional
users deposit underlying assets, minting kTokens 1:1 to maintain backing ratio, (2) kAssetRouter calls this
to distribute positive yield to vaults, increasing the kToken supply to reflect earned returns. The function
is restricted to MINTER_ROLE holders (kMinter, kAssetRouter) and requires the contract to not be paused.
All minting operations emit a Minted event for transparency and tracking.</em></p>
<pre><code class="language-solidity">function mint(address _to, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_to</code></td><td><code>address</code></td><td>The address that will receive the newly minted kTokens</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to create (matches asset amount for deposits, yield amount for distributions)</td></tr>
</tbody></table>
</div>
<h3 id="burn-1"><a class="header" href="#burn-1">burn</a></h3>
<p>Destroys kTokens from the specified address</p>
<p><em>This function handles token destruction for two main scenarios: (1) kMinter burns escrowed kTokens during
successful redemptions, reducing total supply to match the underlying assets being withdrawn, (2) kAssetRouter
burns kTokens from vaults when negative yield/losses occur, ensuring the kToken supply accurately reflects the
reduced underlying asset value. The burn operation is permanent and irreversible, requiring careful validation.
Only MINTER_ROLE holders can execute burns, and the contract must not be paused.</em></p>
<pre><code class="language-solidity">function burn(address _from, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_from</code></td><td><code>address</code></td><td>The address from which kTokens will be permanently destroyed</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to burn (matches redeemed assets or loss amounts)</td></tr>
</tbody></table>
</div>
<h3 id="burnfrom-1"><a class="header" href="#burnfrom-1">burnFrom</a></h3>
<p>Destroys kTokens from a specified address using the ERC20 allowance mechanism</p>
<p><em>This function enables more complex burning scenarios where the token holder has pre-approved the burn
operation. The process involves: (1) checking and consuming the allowance between token owner and the minter,
(2) burning the specified amount from the owner's balance. This is useful for automated systems or contracts
that need to burn tokens on behalf of users, such as complex redemption flows or third-party integrations.
The allowance model provides additional security by requiring explicit approval before token destruction.</em></p>
<pre><code class="language-solidity">function burnFrom(address _from, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_from</code></td><td><code>address</code></td><td>The address from which kTokens will be burned (must have approved the burn amount)</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to burn using the allowance mechanism</td></tr>
</tbody></table>
</div>
<h3 id="name-6"><a class="header" href="#name-6">name</a></h3>
<p>Retrieves the human-readable name of the token</p>
<p><em>Returns the name stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function name() public view virtual override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The token name as a string</td></tr>
</tbody></table>
</div>
<h3 id="symbol-4"><a class="header" href="#symbol-4">symbol</a></h3>
<p>Retrieves the abbreviated symbol of the token</p>
<p><em>Returns the symbol stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function symbol() public view virtual override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The token symbol as a string</td></tr>
</tbody></table>
</div>
<h3 id="decimals-4"><a class="header" href="#decimals-4">decimals</a></h3>
<p>Retrieves the number of decimal places for the token</p>
<p><em>Returns the decimals value stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function decimals() public view virtual override returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The number of decimal places as uint8</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-5"><a class="header" href="#ispaused-5">isPaused</a></h3>
<p>Checks whether the contract is currently in paused state</p>
<p><em>Reads the isPaused flag from contract storage</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Boolean indicating if contract operations are paused</td></tr>
</tbody></table>
</div>
<h3 id="grantadminrole-1"><a class="header" href="#grantadminrole-1">grantAdminRole</a></h3>
<p>Grants administrative privileges to a new address</p>
<p><em>Only the contract owner can grant admin roles, establishing the highest level of access control.
Admins can manage emergency admins and minter roles but cannot bypass owner-only functions.</em></p>
<pre><code class="language-solidity">function grantAdminRole(address admin) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to receive administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeadminrole-1"><a class="header" href="#revokeadminrole-1">revokeAdminRole</a></h3>
<p>Removes administrative privileges from an address</p>
<p><em>Only the contract owner can revoke admin roles, maintaining strict access control hierarchy.
Revoking admin status prevents the address from managing emergency admins and minter roles.</em></p>
<pre><code class="language-solidity">function revokeAdminRole(address admin) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to lose administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantemergencyrole-1"><a class="header" href="#grantemergencyrole-1">grantEmergencyRole</a></h3>
<p>Grants emergency administrative privileges for protocol safety operations</p>
<p><em>Emergency admins can pause/unpause the contract and execute emergency withdrawals during crises.
This role is critical for protocol security and should only be granted to trusted addresses with
operational procedures in place. Only existing admins can grant emergency roles.</em></p>
<pre><code class="language-solidity">function grantEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to receive emergency administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeemergencyrole-1"><a class="header" href="#revokeemergencyrole-1">revokeEmergencyRole</a></h3>
<p>Removes emergency administrative privileges from an address</p>
<p><em>Removes the ability to pause contracts and execute emergency operations. This should be done
carefully as it reduces the protocol's ability to respond to emergencies.</em></p>
<pre><code class="language-solidity">function revokeEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to lose emergency administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantminterrole-1"><a class="header" href="#grantminterrole-1">grantMinterRole</a></h3>
<p>Assigns minter role privileges to the specified address</p>
<p><em>Calls internal _grantRoles function to assign MINTER_ROLE</em></p>
<pre><code class="language-solidity">function grantMinterRole(address minter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address that will receive minter role privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeminterrole-1"><a class="header" href="#revokeminterrole-1">revokeMinterRole</a></h3>
<p>Removes minter role privileges from the specified address</p>
<p><em>Calls internal _removeRoles function to remove MINTER_ROLE</em></p>
<pre><code class="language-solidity">function revokeMinterRole(address minter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address that will lose minter role privileges</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-3"><a class="header" href="#setpaused-3">setPaused</a></h3>
<p>Activates or deactivates the emergency pause mechanism</p>
<p><em>When paused, all token transfers, minting, and burning operations are halted to protect the protocol
during security incidents or system maintenance. Only emergency admins can trigger pause/unpause to ensure
rapid response capability. The pause state affects all token operations through the _beforeTokenTransfer hook.</em></p>
<pre><code class="language-solidity">function setPaused(bool isPaused_) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>isPaused_</code></td><td><code>bool</code></td><td>True to pause all operations, false to resume normal operations</td></tr>
</tbody></table>
</div>
<h3 id="emergencywithdraw"><a class="header" href="#emergencywithdraw">emergencyWithdraw</a></h3>
<p>Emergency recovery function for accidentally sent assets</p>
<p><em>This function provides a safety mechanism to recover tokens or ETH accidentally sent to the kToken
contract.
It's designed for emergency situations where users mistakenly transfer assets to the wrong address.
The function can handle both ERC20 tokens and native ETH. Only emergency admins can execute withdrawals
to prevent unauthorized asset extraction. This should not be used for regular operations.</em></p>
<pre><code class="language-solidity">function emergencyWithdraw(address token, address to, uint256 amount) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>address</code></td><td>The token contract address to withdraw (use address(0) for native ETH)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address to receive the recovered assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens or ETH to recover</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused-2"><a class="header" href="#_checkpaused-2">_checkPaused</a></h3>
<p>Internal function to validate that the contract is not in emergency pause state</p>
<p><em>Called before all token operations (transfers, mints, burns) to enforce emergency stops.
Reverts with KTOKEN_IS_PAUSED if the contract is paused, effectively halting all token activity.</em></p>
<pre><code class="language-solidity">function _checkPaused() private view;
</code></pre>
<h3 id="_beforetokentransfer-1"><a class="header" href="#_beforetokentransfer-1">_beforeTokenTransfer</a></h3>
<p>Internal hook that executes before any token transfer, mint, or burn operation</p>
<p><em>This critical function enforces the pause mechanism across all token operations by checking the pause
state before allowing any balance changes. It intercepts transfers, mints (from=0), and burns (to=0) to
ensure protocol-wide emergency stops work correctly. The hook pattern allows centralized control over
all token movements while maintaining ERC20 compatibility.</em></p>
<pre><code class="language-solidity">function _beforeTokenTransfer(address from, address to, uint256 amount) internal virtual override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The source address (address(0) for minting operations)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address (address(0) for burning operations)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens being transferred/minted/burned</td></tr>
</tbody></table>
</div>
<h2 id="events-15"><a class="header" href="#events-15">Events</a></h2>
<h3 id="minted-1"><a class="header" href="#minted-1">Minted</a></h3>
<p>Emitted when tokens are minted</p>
<pre><code class="language-solidity">event Minted(address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to which the tokens are minted</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens minted</td></tr>
</tbody></table>
</div>
<h3 id="burned"><a class="header" href="#burned">Burned</a></h3>
<p>Emitted when tokens are burned</p>
<pre><code class="language-solidity">event Burned(address indexed from, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens are burned</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens burned</td></tr>
</tbody></table>
</div>
<h3 id="tokencreated"><a class="header" href="#tokencreated">TokenCreated</a></h3>
<p>Emitted when a new token is created</p>
<pre><code class="language-solidity">event TokenCreated(address indexed token, address owner, string name, string symbol, uint8 decimals);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>address</code></td><td>The address of the new token</td></tr>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The owner of the new token</td></tr>
<tr><td><code>name</code></td><td><code>string</code></td><td>The name of the new token</td></tr>
<tr><td><code>symbol</code></td><td><code>string</code></td><td>The symbol of the new token</td></tr>
<tr><td><code>decimals</code></td><td><code>uint8</code></td><td>The decimals of the new token</td></tr>
</tbody></table>
</div>
<h3 id="pausestate"><a class="header" href="#pausestate">PauseState</a></h3>
<p>Emitted when the pause state is changed</p>
<pre><code class="language-solidity">event PauseState(bool isPaused);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>isPaused</code></td><td><code>bool</code></td><td>The new pause state</td></tr>
</tbody></table>
</div>
<h3 id="authorizedcallerupdated"><a class="header" href="#authorizedcallerupdated">AuthorizedCallerUpdated</a></h3>
<p>Emitted when an authorized caller is updated</p>
<pre><code class="language-solidity">event AuthorizedCallerUpdated(address indexed caller, bool authorized);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>caller</code></td><td><code>address</code></td><td>The address of the caller</td></tr>
<tr><td><code>authorized</code></td><td><code>bool</code></td><td>Whether the caller is authorized</td></tr>
</tbody></table>
</div>
<h3 id="emergencywithdrawal"><a class="header" href="#emergencywithdrawal">EmergencyWithdrawal</a></h3>
<p>Emitted when an emergency withdrawal is requested</p>
<pre><code class="language-solidity">event EmergencyWithdrawal(address indexed token, address indexed to, uint256 amount, address indexed admin);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>address</code></td><td>The address of the token</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to which the tokens will be sent</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens to withdraw</td></tr>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address of the admin</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets-4"><a class="header" href="#rescuedassets-4">RescuedAssets</a></h3>
<p>Emitted when assets are rescued</p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address of the asset</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to which the assets will be sent</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of assets rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth-4"><a class="header" href="#rescuedeth-4">RescuedETH</a></h3>
<p>Emitted when ETH is rescued</p>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address of the asset</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of ETH rescued</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
