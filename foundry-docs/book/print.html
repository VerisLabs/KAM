<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>KAM Contracts Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">KAM Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/VerisLabs/KAM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="kam-protocol"><a class="header" href="#kam-protocol">KAM Protocol</a></h1>
<p>KAM is an institutional asset management protocol that implements a dual-track architecture for both institutional and retail access. The protocol creates kTokens (kUSD, kBTC) backed 1:1 by real assets (USDC, WBTC), providing institutions with direct minting and redemption capabilities while offering retail users yield opportunities through external strategy deployment. The system features batch processing with virtual balance accounting, two-phase settlement with timelock proposals, and modular vault architecture through diamond pattern implementation.</p>
<p>For more information, refer to the <a href="./docs/architecture.html">architecture documentation</a>.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>KAM comes with a comprehensive set of tests written in Solidity, which can be executed using Foundry.</p>
<p>To install Foundry:</p>
<pre><code class="language-sh">curl -L https://foundry.paradigm.xyz | bash
</code></pre>
<p>This will download foundryup. To start Foundry, run:</p>
<pre><code class="language-sh">foundryup
</code></pre>
<p>To clone the repo:</p>
<pre><code class="language-sh">git clone https://github.com/kam-protocol/kam.git &amp;&amp; cd kam
</code></pre>
<h3 id="installing-dependencies"><a class="header" href="#installing-dependencies">Installing Dependencies</a></h3>
<p>The project uses Soldeer for dependency management. To install all dependencies:</p>
<pre><code class="language-sh">forge soldeer install
</code></pre>
<p>This will install all dependencies specified in <code>soldeer.toml</code> and <code>soldeer.lock</code>.</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="in-default-mode"><a class="header" href="#in-default-mode">in <code>default</code> mode</a></h3>
<p>To run the tests in a <code>default</code> mode:</p>
<pre><code class="language-sh">forge test
</code></pre>
<h3 id="in-coverage-mode"><a class="header" href="#in-coverage-mode">in <code>coverage</code> mode</a></h3>
<pre><code class="language-sh">forge coverage
</code></pre>
<h3 id="using-solx-compiler-optional"><a class="header" href="#using-solx-compiler-optional">Using solx compiler (optional)</a></h3>
<p>For faster compilation with the LLVM-based Solidity compiler, you can install and use solx:</p>
<p>Install solx:</p>
<pre><code class="language-sh">curl -L https://raw.githubusercontent.com/matter-labs/solx/main/install-solx | bash
</code></pre>
<p>Use with forge:</p>
<pre><code class="language-sh">forge build --use $(which solx)
forge test --use $(which solx)
</code></pre>
<h2 id="smart-contracts-documentation"><a class="header" href="#smart-contracts-documentation">Smart Contracts Documentation</a></h2>
<p>Generate and view the Foundry documentation:</p>
<pre><code class="language-sh">forge doc --serve --port 4000
</code></pre>
<p>This will open the documentation at http://localhost:4000</p>
<h2 id="protocol-documentation"><a class="header" href="#protocol-documentation">Protocol Documentation</a></h2>
<ul>
<li><a href="./docs/architecture.html">Architecture</a> - Complete protocol architecture and operational flows</li>
<li><a href="./docs/interfaces.html">Interfaces</a> - Interface documentation for all protocol contracts</li>
<li><a href="./docs/audits/audit-scope.html">Audit Scope</a> - Comprehensive audit scope and security considerations</li>
</ul>
<h2 id="for-integrators"><a class="header" href="#for-integrators">For Integrators</a></h2>
<h3 id="institutional-operations"><a class="header" href="#institutional-operations">Institutional Operations</a></h3>
<p>Institutions can mint kTokens 1:1 with underlying assets and request redemptions through batch settlement:</p>
<ul>
<li><code>kMinter.mint()</code> - Creates new kTokens by accepting underlying asset deposits</li>
<li><code>kMinter.requestRedeem()</code> - Initiates redemption process through batch settlement</li>
<li><code>kMinter.redeem()</code> - Executes redemption for settled batch requests</li>
<li><code>kMinter.cancelRequest()</code> - Cancels redemption requests before settlement</li>
</ul>
<h3 id="retail-operations"><a class="header" href="#retail-operations">Retail Operations</a></h3>
<p>Retail users can stake kTokens to earn yield from external strategies:</p>
<ul>
<li><code>kStakingVault.requestStake()</code> - Request to stake kTokens for yield-bearing stkTokens</li>
<li><code>kStakingVault.requestUnstake()</code> - Request to unstake stkTokens back to kTokens</li>
<li>Claims processed through vault's VaultClaims after batch settlement</li>
</ul>
<h3 id="virtual-balance-system"><a class="header" href="#virtual-balance-system">Virtual Balance System</a></h3>
<p>The protocol uses virtual balance accounting to optimize gas efficiency:</p>
<ul>
<li><code>kAssetRouter</code> maintains virtual balances between vaults and strategies</li>
<li>Physical transfers minimized to settlement operations only</li>
<li>All inter-vault transfers are virtual until settlement execution</li>
</ul>
<h3 id="batch-processing"><a class="header" href="#batch-processing">Batch Processing</a></h3>
<p>Requests are grouped into time-based batches for gas-efficient settlement:</p>
<ul>
<li>Each vault manages independent batch cycles</li>
<li>Batch receivers deployed per batch for isolated asset distribution</li>
<li>Settlement coordinated through timelock proposals with correction mechanisms</li>
</ul>
<h2 id="role-hierarchy"><a class="header" href="#role-hierarchy">Role Hierarchy</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Role</th><th>Permissions</th><th>Contracts</th></tr></thead><tbody>
<tr><td>OWNER</td><td>Ultimate control, upgrades</td><td>All</td></tr>
<tr><td>ADMIN_ROLE</td><td>Operational management</td><td>All</td></tr>
<tr><td>EMERGENCY_ADMIN_ROLE</td><td>Emergency pause</td><td>All</td></tr>
<tr><td>MINTER_ROLE</td><td>Mint/burn tokens</td><td>kToken</td></tr>
<tr><td>INSTITUTION_ROLE</td><td>Mint/redeem kTokens</td><td>kMinter</td></tr>
<tr><td>RELAYER_ROLE</td><td>Settle batches</td><td>kAssetRouter, VaultBatches</td></tr>
<tr><td>VENDOR_ROLE</td><td>Adds Institutions</td><td>kRegistry</td></tr>
</tbody></table>
</div>
<h2 id="safety"><a class="header" href="#safety">Safety</a></h2>
<p>This software is experimental and is provided "as is" and "as available".</p>
<p>No warranties are provided and no liability will be accepted for any loss incurred through the use of this codebase.</p>
<p>Always include thorough tests when using KAM to ensure it interacts correctly with your code.</p>
<h2 id="known-limitations"><a class="header" href="#known-limitations">Known Limitations</a></h2>
<ul>
<li>Settlement proposals require timelock delays, potentially causing settlement delays if parameters need correction</li>
<li>Virtual balances must remain synchronized with actual adapter holdings</li>
<li>Redemption completion depends on successful batch settlement and adapter cooperation</li>
<li>Adapter integrations require careful validation of different DeFi protocol settlement patterns</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The code is currently in a closed development phase. This is a proprietary protocol with restricted access.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>(c) 2025 KAM Protocol Ltd.</p>
<p>All rights reserved. This project uses a proprietary license.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></li>
<li><a href="src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></li>
<li><a href="src/abstracts/Proxy.sol/abstract.Proxy.html">Proxy</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="extsload"><a class="header" href="#extsload">Extsload</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/abstracts/Extsload.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/abstracts/Extsload.sol//src/interfaces/IExtsload.sol/interface.IExtsload.html">IExtsload</a></p>
<p>Enables public storage access for efficient state retrieval by external contracts</p>
<p>This was taken from https://github.com/Uniswap/v4-core/blob/main/src/Extsload.sol</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="extsload-1"><a class="header" href="#extsload-1">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 slot) external view returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slot</code></td><td><code>bytes32</code></td><td>Storage slot to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-2"><a class="header" href="#extsload-2">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 startSlot, uint256 nSlots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startSlot</code></td><td><code>bytes32</code></td><td></td></tr>
<tr><td><code>nSlots</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-3"><a class="header" href="#extsload-3">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32[] calldata slots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slots</code></td><td><code>bytes32[]</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="proxy"><a class="header" href="#proxy">Proxy</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/abstracts/Proxy.sol">Git Source</a></p>
<p><em>This abstract contract provides a fallback function that delegates all calls to another contract using the EVM
instruction <code>delegatecall</code>. We refer to the second contract as the <em>implementation</em> behind the proxy, and it has to
be specified by overriding the virtual <a href="src/abstracts/Proxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html#_implementation">_implementation</a> function.
Additionally, delegation to the implementation can be triggered manually through the {_fallback} function, or to a
different contract through the {_delegate} function.
The success and return data of the delegated call will be returned back to the caller of the proxy.</em></p>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="_delegate"><a class="header" href="#_delegate">_delegate</a></h3>
<p><em>Delegates the current call to <code>implementation</code>.
This function does not return to its internal call site, it will return directly to the external caller.</em></p>
<pre><code class="language-solidity">function _delegate(address implementation) internal virtual;
</code></pre>
<h3 id="_implementation"><a class="header" href="#_implementation">_implementation</a></h3>
<p><em>This is a virtual function that should be overridden so it returns the address to which the fallback
function and <a href="src/abstracts/Proxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html#_fallback">_fallback</a> should delegate.</em></p>
<pre><code class="language-solidity">function _implementation() internal view virtual returns (address);
</code></pre>
<h3 id="_fallback"><a class="header" href="#_fallback">_fallback</a></h3>
<p><em>Delegates the current call to the address returned by <code>_implementation()</code>.
This function does not return to its internal call site, it will return directly to the external caller.</em></p>
<pre><code class="language-solidity">function _fallback() internal virtual;
</code></pre>
<h3 id="fallback"><a class="header" href="#fallback">fallback</a></h3>
<p><em>Fallback function that delegates calls to the address returned by <code>_implementation()</code>. Will run if no other
function in the contract matches the call data.</em></p>
<pre><code class="language-solidity">fallback() external payable virtual;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-1"><a class="header" href="#contents-1">Contents</a></h1>
<ul>
<li><a href="src/adapters/BaseAdapter.sol/contract.BaseAdapter.html">BaseAdapter</a></li>
<li><a href="src/adapters/CustodialAdapter.sol/contract.CustodialAdapter.html">CustodialAdapter</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="baseadapter"><a class="header" href="#baseadapter">BaseAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/adapters/BaseAdapter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
OwnableRoles, ReentrancyGuardTransient</p>
<p>Abstract base contract for all protocol adapters</p>
<p><em>Provides common functionality and virtual balance tracking for external strategy integrations</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="admin_role"><a class="header" href="#admin_role">ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role"><a class="header" href="#emergency_admin_role">EMERGENCY_ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="k_minter"><a class="header" href="#k_minter">K_MINTER</a></h3>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router"><a class="header" href="#k_asset_router">K_ASSET_ROUTER</a></h3>
<p>Registry lookup key for the kAssetRouter singleton contract</p>
<p><em>Used to retrieve and validate the kAssetRouter address from registry. Only kAssetRouter
can trigger adapter deposits/redemptions, ensuring centralized control over asset flows.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="base_adapter_storage_location"><a class="header" href="#base_adapter_storage_location">BASE_ADAPTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant BASE_ADAPTER_STORAGE_LOCATION =
    0x5547882c17743d50a538cd94a34f6308d65f7005fe26b376dcedda44d3aab800;
</code></pre>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="_getbaseadapterstorage"><a class="header" href="#_getbaseadapterstorage">_getBaseAdapterStorage</a></h3>
<p><em>Returns the base adapter storage pointer</em></p>
<pre><code class="language-solidity">function _getBaseAdapterStorage() internal pure returns (BaseAdapterStorage storage $);
</code></pre>
<h3 id="__baseadapter_init"><a class="header" href="#__baseadapter_init">__BaseAdapter_init</a></h3>
<p>Initializes the base adapter</p>
<pre><code class="language-solidity">function __BaseAdapter_init(
    address registry_,
    address owner_,
    address admin_,
    string memory name_,
    string memory version_
)
    internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Address of the owner</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Address of the admin</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>Human readable name for this adapter</td></tr>
<tr><td><code>version_</code></td><td><code>string</code></td><td>Version string for this adapter</td></tr>
</tbody></table>
</div>
<h3 id="_registry"><a class="header" href="#_registry">_registry</a></h3>
<p>Returns the registry contract interface</p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter"><a class="header" href="#_getkassetrouter">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getrelayer"><a class="header" href="#_getrelayer">_getRelayer</a></h3>
<p>Checks if an address is a relayer</p>
<pre><code class="language-solidity">function _getRelayer() internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is a relayer</td></tr>
</tbody></table>
</div>
<h3 id="_getktokenforasset"><a class="header" href="#_getktokenforasset">_getKTokenForAsset</a></h3>
<p>Gets the kToken address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getKTokenForAsset(address asset) internal view returns (address kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="_getvaultassets"><a class="header" href="#_getvaultassets">_getVaultAssets</a></h3>
<p>Gets the asset managed by a vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getVaultAssets(address vault) internal view returns (address[] memory assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>address[]</code></td><td>The asset address managed by the vault</td></tr>
</tbody></table>
</div>
<h3 id="registered"><a class="header" href="#registered">registered</a></h3>
<p>Returns whether this adapter is registered</p>
<pre><code class="language-solidity">function registered() public view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered and active</td></tr>
</tbody></table>
</div>
<h3 id="name"><a class="header" href="#name">name</a></h3>
<p>Returns the adapter's name</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Human readable adapter name</td></tr>
</tbody></table>
</div>
<h3 id="version"><a class="header" href="#version">version</a></h3>
<p>Returns the adapter's version</p>
<pre><code class="language-solidity">function version() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string</td></tr>
</tbody></table>
</div>
<h3 id="onlykassetrouter"><a class="header" href="#onlykassetrouter">onlyKAssetRouter</a></h3>
<p>Restricts function access to kAssetRouter only</p>
<pre><code class="language-solidity">modifier onlyKAssetRouter();
</code></pre>
<h3 id="onlyrelayer"><a class="header" href="#onlyrelayer">onlyRelayer</a></h3>
<p>Restricts function access to the relayer</p>
<pre><code class="language-solidity">modifier onlyRelayer();
</code></pre>
<h3 id="whenregistered"><a class="header" href="#whenregistered">whenRegistered</a></h3>
<p>Ensures the adapter is registered and active</p>
<pre><code class="language-solidity">modifier whenRegistered();
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="onlykassetrouter-1"><a class="header" href="#onlykassetrouter-1">OnlyKAssetRouter</a></h3>
<pre><code class="language-solidity">error OnlyKAssetRouter();
</code></pre>
<h3 id="contractnotfound"><a class="header" href="#contractnotfound">ContractNotFound</a></h3>
<pre><code class="language-solidity">error ContractNotFound(bytes32 identifier);
</code></pre>
<h3 id="zeroaddress"><a class="header" href="#zeroaddress">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="invalidregistry"><a class="header" href="#invalidregistry">InvalidRegistry</a></h3>
<pre><code class="language-solidity">error InvalidRegistry();
</code></pre>
<h3 id="assetnotsupported"><a class="header" href="#assetnotsupported">AssetNotSupported</a></h3>
<pre><code class="language-solidity">error AssetNotSupported(address asset);
</code></pre>
<h3 id="invalidamount"><a class="header" href="#invalidamount">InvalidAmount</a></h3>
<pre><code class="language-solidity">error InvalidAmount();
</code></pre>
<h3 id="invalidasset"><a class="header" href="#invalidasset">InvalidAsset</a></h3>
<pre><code class="language-solidity">error InvalidAsset();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="baseadapterstorage"><a class="header" href="#baseadapterstorage">BaseAdapterStorage</a></h3>
<p><em>Storage struct following ERC-7201 namespaced storage pattern for upgrade safety.
Prevents storage collisions when adapters inherit from multiple base contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.BaseAdapter</p>
<pre><code class="language-solidity">struct BaseAdapterStorage {
    address registry;
    bool initialized;
    string name;
    string version;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custodialadapter"><a class="header" href="#custodialadapter">CustodialAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/adapters/CustodialAdapter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/adapters/CustodialAdapter.sol//src/adapters/BaseAdapter.sol/contract.BaseAdapter.html">BaseAdapter</a>, <a href="src/adapters/CustodialAdapter.sol//src/vendor/Initializable.sol/abstract.Initializable.html">Initializable</a>, <a href="src/adapters/CustodialAdapter.sol//src/vendor/UUPSUpgradeable.sol/abstract.UUPSUpgradeable.html">UUPSUpgradeable</a></p>
<p>Specialized adapter enabling yield generation through custodial services like CEX staking and institutional
platforms</p>
<p><em>This adapter implements the bridge between KAM protocol vaults and external custodial yield sources
(centralized
exchanges, CEFFU, institutional staking providers). Key functionality includes: (1) Virtual balance tracking that
maintains on-chain accounting while assets are held off-chain, (2) Configurable custodial destinations per vault
allowing flexible routing to different providers, (3) Two-phase deposit/redemption flow where deposits are tracked
virtually and actual transfers happen through manual processes, (4) Total assets management for accurate yield
calculation during settlements, (5) Request ID system for tracking redemption operations. The adapter operates on
a trust-minimized model where admin-controlled totalAssets updates reflect off-chain yields, which are then
distributed
through the settlement process. This design enables institutional-grade yield opportunities while maintaining the
protocol's unified settlement and distribution mechanisms. The virtual balance system ensures accurate accounting
even when assets are temporarily off-chain for yield generation.</em></p>
<h2 id="state-variables-2"><a class="header" href="#state-variables-2">State Variables</a></h2>
<h3 id="custodial_adapter_storage_location"><a class="header" href="#custodial_adapter_storage_location">CUSTODIAL_ADAPTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant CUSTODIAL_ADAPTER_STORAGE_LOCATION =
    0x6096605776f37a069e5fb3b2282c592b4e41a8f7c82e8665fde33e5acbdbaf00;
</code></pre>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="_getcustodialadapterstorage"><a class="header" href="#_getcustodialadapterstorage">_getCustodialAdapterStorage</a></h3>
<p><em>Returns the custodial adapter storage pointer</em></p>
<pre><code class="language-solidity">function _getCustodialAdapterStorage() internal pure returns (CustodialAdapterStorage storage $);
</code></pre>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Empty constructor to ensure clean initialization state</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p>Initializes the MetaVault adapter</p>
<pre><code class="language-solidity">function initialize(address registry_, address owner_, address admin_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Address of the owner</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Address of the admin</td></tr>
</tbody></table>
</div>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<p>Deposits assets to external strategy</p>
<pre><code class="language-solidity">function deposit(
    address asset,
    uint256 amount,
    address onBehalfOf
)
    external
    nonReentrant
    onlyKAssetRouter
    whenRegistered;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being deposited (must be protocol-registered)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity being virtually deposited (must be non-zero)</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault that owns these assets for yield attribution</td></tr>
</tbody></table>
</div>
<h3 id="redeem"><a class="header" href="#redeem">redeem</a></h3>
<p>Redeems assets from external strategy</p>
<pre><code class="language-solidity">function redeem(
    address asset,
    uint256 amount,
    address onBehalfOf
)
    external
    virtual
    nonReentrant
    onlyKAssetRouter
    whenRegistered;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity to redeem (must not exceed virtual balance)</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault requesting redemption of its assets</td></tr>
</tbody></table>
</div>
<h3 id="totalestimatedassets"><a class="header" href="#totalestimatedassets">totalEstimatedAssets</a></h3>
<p>Returns the current total assets across all custodial addresses for this asset</p>
<pre><code class="language-solidity">function totalEstimatedAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault to query</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held across all custodial addresses managed by this adapter</td></tr>
</tbody></table>
</div>
<h3 id="totalvirtualassets"><a class="header" href="#totalvirtualassets">totalVirtualAssets</a></h3>
<p>Returns the total assets in storage for a given vault</p>
<pre><code class="language-solidity">function totalVirtualAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held in storage for this vault</td></tr>
</tbody></table>
</div>
<h3 id="totalassets"><a class="header" href="#totalassets">totalAssets</a></h3>
<p>Returns the total assets for a given vault and asset</p>
<pre><code class="language-solidity">function totalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently held for this vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="getlasttotalassets"><a class="header" href="#getlasttotalassets">getLastTotalAssets</a></h3>
<p>Returns the last total assets for a given vault and asset</p>
<pre><code class="language-solidity">function getLastTotalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The last total assets for the vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultdestination"><a class="header" href="#getvaultdestination">getVaultDestination</a></h3>
<p>Returns the custodial address for a given vault</p>
<pre><code class="language-solidity">function getVaultDestination(address vault) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The custodial address for the vault</td></tr>
</tbody></table>
</div>
<h3 id="setvaultdestination"><a class="header" href="#setvaultdestination">setVaultDestination</a></h3>
<p>Sets the custodial address for a vault</p>
<pre><code class="language-solidity">function setVaultDestination(address vault, address custodialAddress) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to configure custodial destination for</td></tr>
<tr><td><code>custodialAddress</code></td><td><code>address</code></td><td>The off-chain custodial address (CEX wallet, institutional account)</td></tr>
</tbody></table>
</div>
<h3 id="settotalassets"><a class="header" href="#settotalassets">setTotalAssets</a></h3>
<p>Sets the total assets for a given vault</p>
<pre><code class="language-solidity">function setTotalAssets(address vault, address asset, uint256 totalAssets_) external onlyKAssetRouter;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault whose assets are being updated</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The specific asset being updated</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td>The new total value including any yields or losses</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade"><a class="header" href="#_authorizeupgrade">_authorizeUpgrade</a></h3>
<p>Authorize contract upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>The new adapter implementation contract address</td></tr>
</tbody></table>
</div>
<h2 id="events-1"><a class="header" href="#events-1">Events</a></h2>
<h3 id="vaultdestinationupdated"><a class="header" href="#vaultdestinationupdated">VaultDestinationUpdated</a></h3>
<p>Emitted when a vault's custodial destination address is configured or updated</p>
<p><em>Custodial addresses represent off-chain destinations (CEX wallets, institutional accounts) where
assets are sent for yield generation. Each vault can have its own destination for segregation.</em></p>
<pre><code class="language-solidity">event VaultDestinationUpdated(address indexed vault, address indexed oldAddress, address indexed newAddress);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address whose custodial destination is being updated</td></tr>
<tr><td><code>oldAddress</code></td><td><code>address</code></td><td>The previous custodial address (address(0) if first configuration)</td></tr>
<tr><td><code>newAddress</code></td><td><code>address</code></td><td>The new custodial address for this vault's assets</td></tr>
</tbody></table>
</div>
<h3 id="totalassetsupdated"><a class="header" href="#totalassetsupdated">TotalAssetsUpdated</a></h3>
<p>Emitted when total assets are updated to reflect off-chain yields or losses</p>
<p><em>This update mechanism allows the protocol to account for yields generated in custodial accounts.
The kAssetRouter uses these values during settlement to calculate and distribute yields.</em></p>
<pre><code class="language-solidity">event TotalAssetsUpdated(address indexed vault, uint256 totalAssets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address whose total assets are being updated</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>The new total asset value including any yields or losses</td></tr>
</tbody></table>
</div>
<h3 id="deposited"><a class="header" href="#deposited">Deposited</a></h3>
<p>Emitted when assets are virtually deposited for custodial yield generation</p>
<p><em>Marks the virtual accounting update when kAssetRouter routes assets to this adapter.
Actual transfer to custodial address happens separately through manual processes.</em></p>
<pre><code class="language-solidity">event Deposited(address indexed asset, uint256 amount, address indexed onBehalfOf);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being deposited (USDC, WBTC, etc.)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being virtually deposited</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address that owns these deposited assets</td></tr>
</tbody></table>
</div>
<h3 id="redemptionrequested"><a class="header" href="#redemptionrequested">RedemptionRequested</a></h3>
<p>Emitted when redemption is requested from custodial holdings</p>
<p><em>Initiates the redemption process by updating virtual balances. Actual asset return
from custodial address happens through manual processes coordinated off-chain.</em></p>
<pre><code class="language-solidity">event RedemptionRequested(address indexed asset, uint256 amount, address indexed onBehalfOf);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity requested for redemption</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault requesting the redemption</td></tr>
</tbody></table>
</div>
<h3 id="redemptionprocessed"><a class="header" href="#redemptionprocessed">RedemptionProcessed</a></h3>
<p>Emitted when a redemption is processed</p>
<pre><code class="language-solidity">event RedemptionProcessed(uint256 indexed requestId, uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID</td></tr>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The amount of assets processed</td></tr>
</tbody></table>
</div>
<h3 id="adapterbalanceupdated"><a class="header" href="#adapterbalanceupdated">AdapterBalanceUpdated</a></h3>
<p>Emitted when the adapter balance is updated</p>
<pre><code class="language-solidity">event AdapterBalanceUpdated(address indexed vault, address indexed asset, uint256 newBalance);
</code></pre>
<h3 id="initialised"><a class="header" href="#initialised">Initialised</a></h3>
<pre><code class="language-solidity">event Initialised(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>newBalance</code></td><td><code>uint256</code></td><td>The new balance</td></tr>
</tbody></table>
</div>
<h3 id="initialised"><a class="header" href="#initialised">Initialised</a></h3>
<p>Emitted when the adapter is initialized</p>
<pre><code class="language-solidity">event Initialised(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The registry address</td></tr>
</tbody></table>
</div>
<h2 id="structs-1"><a class="header" href="#structs-1">Structs</a></h2>
<h3 id="custodialadapterstorage"><a class="header" href="#custodialadapterstorage">CustodialAdapterStorage</a></h3>
<p><em>Storage layout using ERC-7201 pattern for upgrade safety and collision prevention</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.CustodialAdapter</p>
<pre><code class="language-solidity">struct CustodialAdapterStorage {
    uint256 nextRequestId;
    mapping(address vault =&gt; mapping(address asset =&gt; uint256 balance)) balanceOf;
    mapping(address vault =&gt; mapping(address asset =&gt; uint256 totalAssets)) totalAssets;
    mapping(address vault =&gt; address custodialAddress) vaultDestinations;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-2"><a class="header" href="#contents-2">Contents</a></h1>
<ul>
<li><a href="src/base/MultiFacetProxy.sol/abstract.MultiFacetProxy.html">MultiFacetProxy</a></li>
<li><a href="src/base/kBase.sol/contract.kBase.html">kBase</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multifacetproxy"><a class="header" href="#multifacetproxy">MultiFacetProxy</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/base/MultiFacetProxy.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/base/MultiFacetProxy.sol//src/abstracts/Proxy.sol/abstract.Proxy.html">Proxy</a></p>
<p>A proxy contract that can route function calls to different implementation contracts</p>
<p><em>Inherits from Base and OpenZeppelin's Proxy contract</em></p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="multifacet_proxy_storage_location"><a class="header" href="#multifacet_proxy_storage_location">MULTIFACET_PROXY_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 internal constant MULTIFACET_PROXY_STORAGE_LOCATION =
    0xfeaf205b5229ea10e902c7b89e4768733c756362b2becb0bfd65a97f71b02d00;
</code></pre>
<h2 id="functions-5"><a class="header" href="#functions-5">Functions</a></h2>
<h3 id="_getmultifacetproxystorage"><a class="header" href="#_getmultifacetproxystorage">_getMultiFacetProxyStorage</a></h3>
<p><em>Returns the MultiFacetProxy storage pointer</em></p>
<pre><code class="language-solidity">function _getMultiFacetProxyStorage() internal pure returns (MultiFacetProxyStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>MultiFacetProxyStorage</code></td><td>Storage reference for MultiFacetProxy state variables</td></tr>
</tbody></table>
</div>
<h3 id="__multifacetproxy__init"><a class="header" href="#__multifacetproxy__init">__MultiFacetProxy__init</a></h3>
<p>Initializes the proxy contract</p>
<p><em>Can only be called once during initialization</em></p>
<pre><code class="language-solidity">function __MultiFacetProxy__init(uint256 _proxyAdminRole_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_proxyAdminRole_</code></td><td><code>uint256</code></td><td>The proxy admin role</td></tr>
</tbody></table>
</div>
<h3 id="_proxyadminrole"><a class="header" href="#_proxyadminrole">_proxyAdminRole</a></h3>
<p>Returns the proxy admin role</p>
<pre><code class="language-solidity">function _proxyAdminRole() internal view returns (uint256 role);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>role</code></td><td><code>uint256</code></td><td>The proxy admin role</td></tr>
</tbody></table>
</div>
<h3 id="addfunction"><a class="header" href="#addfunction">addFunction</a></h3>
<p>Adds a function selector mapping to an implementation address</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function addFunction(bytes4 selector, address implementation, bool forceOverride) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selector</code></td><td><code>bytes4</code></td><td>The function selector to add</td></tr>
<tr><td><code>implementation</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
<tr><td><code>forceOverride</code></td><td><code>bool</code></td><td>If true, allows overwriting existing mappings</td></tr>
</tbody></table>
</div>
<h3 id="addfunctions"><a class="header" href="#addfunctions">addFunctions</a></h3>
<p>Adds multiple function selector mappings to an implementation</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function addFunctions(bytes4[] calldata selectors, address implementation, bool forceOverride) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selectors</code></td><td><code>bytes4[]</code></td><td>Array of function selectors to add</td></tr>
<tr><td><code>implementation</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
<tr><td><code>forceOverride</code></td><td><code>bool</code></td><td>If true, allows overwriting existing mappings</td></tr>
</tbody></table>
</div>
<h3 id="removefunction"><a class="header" href="#removefunction">removeFunction</a></h3>
<p>Removes a function selector mapping</p>
<p><em>Only callable by admin role</em></p>
<pre><code class="language-solidity">function removeFunction(bytes4 selector) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selector</code></td><td><code>bytes4</code></td><td>The function selector to remove</td></tr>
</tbody></table>
</div>
<h3 id="removefunctions"><a class="header" href="#removefunctions">removeFunctions</a></h3>
<p>Removes multiple function selector mappings</p>
<pre><code class="language-solidity">function removeFunctions(bytes4[] calldata selectors) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>selectors</code></td><td><code>bytes4[]</code></td><td>Array of function selectors to remove</td></tr>
</tbody></table>
</div>
<h3 id="_authorizemodifyfunctions"><a class="header" href="#_authorizemodifyfunctions">_authorizeModifyFunctions</a></h3>
<p><em>Authorize the sender to modify functions</em></p>
<pre><code class="language-solidity">function _authorizeModifyFunctions(address sender) internal virtual;
</code></pre>
<h3 id="_implementation-1"><a class="header" href="#_implementation-1">_implementation</a></h3>
<p>Returns the implementation address for a function selector</p>
<p><em>Required override from OpenZeppelin Proxy contract</em></p>
<pre><code class="language-solidity">function _implementation() internal view override returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The implementation contract address</td></tr>
</tbody></table>
</div>
<h2 id="structs-2"><a class="header" href="#structs-2">Structs</a></h2>
<h3 id="multifacetproxystorage"><a class="header" href="#multifacetproxystorage">MultiFacetProxyStorage</a></h3>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.MultiFacetProxy</p>
<pre><code class="language-solidity">struct MultiFacetProxyStorage {
    mapping(bytes4 =&gt; address) selectorToImplementation;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kbase"><a class="header" href="#kbase">kBase</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/base/kBase.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
OwnableRoles, ReentrancyGuardTransient</p>
<p>Base contract providing common functionality for all KAM protocol contracts</p>
<p><em>Includes registry integration, role management, pause functionality, and helper methods</em></p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="admin_role-1"><a class="header" href="#admin_role-1">ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role-1"><a class="header" href="#emergency_admin_role-1">EMERGENCY_ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="k_minter-1"><a class="header" href="#k_minter-1">K_MINTER</a></h3>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router-1"><a class="header" href="#k_asset_router-1">K_ASSET_ROUTER</a></h3>
<p>Registry lookup key for the kAssetRouter singleton contract</p>
<p><em>This hash is used to retrieve the kAssetRouter address from the registry's contract mapping.
kAssetRouter coordinates all asset movements and settlements, making it a critical dependency
for vaults and other protocol components. The hash-based lookup enables dynamic upgrades.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="kbase_storage_location"><a class="header" href="#kbase_storage_location">KBASE_STORAGE_LOCATION</a></h3>
<p><em>ERC-7201 storage location calculated as: keccak256(abi.encode(uint256(keccak256("kam.storage.kBase")) - 1))
&amp; ~bytes32(uint256(0xff))
This specific slot is chosen to avoid any possible collision with standard storage layouts while maintaining
deterministic addressing. The calculation ensures the storage location is unique to this namespace and won't
conflict with other inherited contracts or future upgrades. The 0xff mask ensures proper alignment.</em></p>
<pre><code class="language-solidity">bytes32 private constant KBASE_STORAGE_LOCATION = 0xe91688684975c4d7d54a65dd96da5d4dcbb54b8971c046d5351d3c111e43a800;
</code></pre>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="_getbasestorage"><a class="header" href="#_getbasestorage">_getBaseStorage</a></h3>
<p><em>Returns the kBase storage pointer using ERC-7201 namespaced storage pattern</em></p>
<pre><code class="language-solidity">function _getBaseStorage() internal pure returns (kBaseStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kBaseStorage</code></td><td>Storage pointer to the kBaseStorage struct at the designated storage location This function uses inline assembly to directly set the storage pointer to our namespaced location, ensuring efficient access to storage variables while maintaining upgrade safety. The pure modifier is used because we're only returning a storage pointer, not reading storage values.</td></tr>
</tbody></table>
</div>
<h3 id="__kbase_init"><a class="header" href="#__kbase_init">__kBase_init</a></h3>
<p>Initializes the base contract with registry and pause state</p>
<p><em>Can only be called once during initialization</em></p>
<pre><code class="language-solidity">function __kBase_init(address registry_, address owner_, address admin_, bool paused_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial pause state</td></tr>
</tbody></table>
</div>
<h3 id="registry"><a class="header" href="#registry">registry</a></h3>
<p>Returns the registry contract address</p>
<p><em>Reverts if contract not initialized</em></p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The kRegistry contract address</td></tr>
</tbody></table>
</div>
<h3 id="_registry-1"><a class="header" href="#_registry-1">_registry</a></h3>
<p>Returns the registry contract interface</p>
<p><em>Internal helper for typed registry access</em></p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchid"><a class="header" href="#_getbatchid">_getBatchId</a></h3>
<p>Gets the current batch ID for a given vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchId(address vault) internal view returns (bytes32 batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch ID</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchreceiver"><a class="header" href="#_getbatchreceiver">_getBatchReceiver</a></h3>
<p>Gets the current batch receiver for a given batchId</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchReceiver(address vault_, bytes32 batchId_) internal view returns (address batchReceiver);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault_</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>batchId_</code></td><td><code>bytes32</code></td><td>The batch ID</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The address of the batchReceiver where tokens will be sent</td></tr>
</tbody></table>
</div>
<h3 id="_getkminter"><a class="header" href="#_getkminter">_getKMinter</a></h3>
<p>Gets the kMinter singleton contract address</p>
<p><em>Reverts if kMinter not set in registry</em></p>
<pre><code class="language-solidity">function _getKMinter() internal view returns (address minter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter"><a class="header" href="#_getkassetrouter">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<p><em>Reverts if kAssetRouter not set in registry</em></p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getktokenforasset"><a class="header" href="#_getktokenforasset">_getKTokenForAsset</a></h3>
<p>Gets the kToken address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getKTokenForAsset(address asset) internal view returns (address kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="_getvaultassets"><a class="header" href="#_getvaultassets">_getVaultAssets</a></h3>
<p>Gets the asset managed by a vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getVaultAssets(address vault) internal view returns (address[] memory assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>address[]</code></td><td>The asset address managed by the vault</td></tr>
</tbody></table>
</div>
<h3 id="_getdnvaultbyasset"><a class="header" href="#_getdnvaultbyasset">_getDNVaultByAsset</a></h3>
<p>Gets the DN vault address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getDNVaultByAsset(address asset) internal view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The corresponding DN vault address</td></tr>
</tbody></table>
</div>
<h3 id="_isassetregistered"><a class="header" href="#_isassetregistered">_isAssetRegistered</a></h3>
<p>Checks if an asset is supported by the protocol</p>
<pre><code class="language-solidity">function _isAssetRegistered(address asset) internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to check</td></tr>
</tbody></table>
</div>
<h3 id="_isemergencyadmin"><a class="header" href="#_isemergencyadmin">_isEmergencyAdmin</a></h3>
<p>Checks if an address is a emergencyAdmin</p>
<pre><code class="language-solidity">function _isEmergencyAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the asset is supported</td></tr>
</tbody></table>
</div>
<h3 id="_getvaultassets-1"><a class="header" href="#_getvaultassets-1">_getVaultAssets</a></h3>
<p>Gets the asset managed by a vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getVaultAssets(address vault) internal view returns (address[] memory assets);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<h3 id="_isrelayer"><a class="header" href="#_isrelayer">_isRelayer</a></h3>
<p>Checks if an address is a relayer</p>
<pre><code class="language-solidity">function _isRelayer(address user) internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>address[]</code></td><td>The asset address managed by the vault</td></tr>
</tbody></table>
</div>
<h3 id="_getdnvaultbyasset"><a class="header" href="#_getdnvaultbyasset">_getDNVaultByAsset</a></h3>
<p>Gets the DN vault address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getDNVaultByAsset(address asset) internal view returns (address vault);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<h3 id="_ispaused"><a class="header" href="#_ispaused">_isPaused</a></h3>
<p>Checks if an address is a institution</p>
<pre><code class="language-solidity">function _isPaused() internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The corresponding DN vault address</td></tr>
</tbody></table>
</div>
<h3 id="_isvault"><a class="header" href="#_isvault">_isVault</a></h3>
<p>Checks if an address is a registered vault</p>
<pre><code class="language-solidity">function _isVault(address vault) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is a registered vault</td></tr>
</tbody></table>
</div>
<h3 id="_isasset-1"><a class="header" href="#_isasset-1">_isAsset</a></h3>
<p>Checks if an asset is registered</p>
<pre><code class="language-solidity">function _isAsset(address asset) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the asset is registered</td></tr>
</tbody></table>
</div>
<h3 id="_setpaused"><a class="header" href="#_setpaused">_setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">function _setPaused(bool paused_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>New pause state</td></tr>
</tbody></table>
</div>
<h3 id="onlykminter"><a class="header" href="#onlykminter">onlyKMinter</a></h3>
<p>Restricts function access to the kMinter contract</p>
<pre><code class="language-solidity">modifier onlyKMinter();
</code></pre>
<h3 id="onlyrelayer-1"><a class="header" href="#onlyrelayer-1">onlyRelayer</a></h3>
<p>Restricts function access to the relayer</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">modifier onlyRelayer();
</code></pre>
<h3 id="onlyguardian"><a class="header" href="#onlyguardian">onlyGuardian</a></h3>
<p>Restricts function access to the guardian</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">modifier onlyGuardian();
</code></pre>
<h3 id="onlyregisteredasset"><a class="header" href="#onlyregisteredasset">onlyRegisteredAsset</a></h3>
<p>Ensures the asset is supported by the protocol</p>
<pre><code class="language-solidity">modifier onlyRegisteredAsset(address asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to validate</td></tr>
</tbody></table>
</div>
<h2 id="events-1"><a class="header" href="#events-1">Events</a></h2>
<h3 id="paused"><a class="header" href="#paused">Paused</a></h3>
<pre><code class="language-solidity">event Paused(bool paused);
</code></pre>
<h2 id="errors-2"><a class="header" href="#errors-2">Errors</a></h2>
<h3 id="zeroaddress-1"><a class="header" href="#zeroaddress-1">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="invalidregistry-1"><a class="header" href="#invalidregistry-1">InvalidRegistry</a></h3>
<pre><code class="language-solidity">error InvalidRegistry();
</code></pre>
<h3 id="notinitialized"><a class="header" href="#notinitialized">NotInitialized</a></h3>
<pre><code class="language-solidity">error NotInitialized();
</code></pre>
<h3 id="contractnotfound-1"><a class="header" href="#contractnotfound-1">ContractNotFound</a></h3>
<pre><code class="language-solidity">error ContractNotFound(bytes32 identifier);
</code></pre>
<h3 id="assetnotsupported-1"><a class="header" href="#assetnotsupported-1">AssetNotSupported</a></h3>
<pre><code class="language-solidity">error AssetNotSupported(address asset);
</code></pre>
<h3 id="invalidvault"><a class="header" href="#invalidvault">InvalidVault</a></h3>
<pre><code class="language-solidity">error InvalidVault(address vault);
</code></pre>
<h3 id="onlykminter-1"><a class="header" href="#onlykminter-1">OnlyKMinter</a></h3>
<pre><code class="language-solidity">error OnlyKMinter();
</code></pre>
<h3 id="onlyguardian-1"><a class="header" href="#onlyguardian-1">OnlyGuardian</a></h3>
<pre><code class="language-solidity">error OnlyGuardian();
</code></pre>
<h3 id="onlyrelayer-2"><a class="header" href="#onlyrelayer-2">OnlyRelayer</a></h3>
<pre><code class="language-solidity">error OnlyRelayer();
</code></pre>
<h2 id="structs-3"><a class="header" href="#structs-3">Structs</a></h2>
<h3 id="kbasestorage"><a class="header" href="#kbasestorage">kBaseStorage</a></h3>
<p><em>Storage struct following ERC-7201 namespaced storage pattern to prevent collisions during upgrades.
This pattern ensures that storage layout remains consistent across proxy upgrades and prevents
accidental overwriting when contracts inherit from multiple base contracts. The namespace
"kam.storage.kBase" uniquely identifies this storage area within the contract's storage space.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kBase</p>
<pre><code class="language-solidity">struct kBaseStorage {
    address registry;
    bool initialized;
    bool paused;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-3"><a class="header" href="#contents-3">Contents</a></h1>
<ul>
<li><a href="src/errors/Errors.sol/constants.Errors.html">Errors constants</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constants"><a class="header" href="#constants">Constants</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/errors/Errors.sol">Git Source</a></p>
<h3 id="kassetrouter_already_registered"><a class="header" href="#kassetrouter_already_registered">KASSETROUTER_ALREADY_REGISTERED</a></h3>
<p>*All error codes use contract-specific prefixes for easier debugging:</p>
<ul>
<li>A*: kAssetRouter errors</li>
<li>BA*: BaseAdapter errors</li>
<li>BV*: BaseVault errors</li>
<li>B*: kBatchReceiver errors</li>
<li>C*: Custodial adapter errors</li>
<li>K*: kBase errors</li>
<li>M*: kMinter errors</li>
<li>R*: kRegistry errors</li>
<li>SV*: kStakingVault errors</li>
<li>T*: kToken errors</li>
<li>VB*: VaultBatches errors</li>
<li>VC*: VaultClaims errors</li>
<li>VF*: VaultFees errors*</li>
</ul>
<pre><code class="language-solidity">string constant KASSETROUTER_ALREADY_REGISTERED = "A1";
</code></pre>
<h3 id="kassetrouter_batch_closed"><a class="header" href="#kassetrouter_batch_closed">KASSETROUTER_BATCH_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_CLOSED = "A2";
</code></pre>
<h3 id="kassetrouter_batch_id_proposed"><a class="header" href="#kassetrouter_batch_id_proposed">KASSETROUTER_BATCH_ID_PROPOSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_ID_PROPOSED = "A3";
</code></pre>
<h3 id="kassetrouter_batch_settled"><a class="header" href="#kassetrouter_batch_settled">KASSETROUTER_BATCH_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_BATCH_SETTLED = "A4";
</code></pre>
<h3 id="kassetrouter_cooldoown_is_up"><a class="header" href="#kassetrouter_cooldoown_is_up">KASSETROUTER_COOLDOOWN_IS_UP</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_COOLDOOWN_IS_UP = "A5";
</code></pre>
<h3 id="kassetrouter_insufficient_virtual_balance"><a class="header" href="#kassetrouter_insufficient_virtual_balance">KASSETROUTER_INSUFFICIENT_VIRTUAL_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INSUFFICIENT_VIRTUAL_BALANCE = "A6";
</code></pre>
<h3 id="kassetrouter_invalid_cooldown"><a class="header" href="#kassetrouter_invalid_cooldown">KASSETROUTER_INVALID_COOLDOWN</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INVALID_COOLDOWN = "A7";
</code></pre>
<h3 id="kassetrouter_invalid_vault"><a class="header" href="#kassetrouter_invalid_vault">KASSETROUTER_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_INVALID_VAULT = "A8";
</code></pre>
<h3 id="kassetrouter_is_paused"><a class="header" href="#kassetrouter_is_paused">KASSETROUTER_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_IS_PAUSED = "A9";
</code></pre>
<h3 id="kassetrouter_no_proposal"><a class="header" href="#kassetrouter_no_proposal">KASSETROUTER_NO_PROPOSAL</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_NO_PROPOSAL = "A10";
</code></pre>
<h3 id="kassetrouter_only_kminter"><a class="header" href="#kassetrouter_only_kminter">KASSETROUTER_ONLY_KMINTER</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ONLY_KMINTER = "A11";
</code></pre>
<h3 id="kassetrouter_only_kstaking_vault"><a class="header" href="#kassetrouter_only_kstaking_vault">KASSETROUTER_ONLY_KSTAKING_VAULT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ONLY_KSTAKING_VAULT = "A12";
</code></pre>
<h3 id="kassetrouter_proposal_executed"><a class="header" href="#kassetrouter_proposal_executed">KASSETROUTER_PROPOSAL_EXECUTED</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_EXECUTED = "A13";
</code></pre>
<h3 id="kassetrouter_proposal_exists"><a class="header" href="#kassetrouter_proposal_exists">KASSETROUTER_PROPOSAL_EXISTS</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_EXISTS = "A14";
</code></pre>
<h3 id="kassetrouter_proposal_not_found"><a class="header" href="#kassetrouter_proposal_not_found">KASSETROUTER_PROPOSAL_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_PROPOSAL_NOT_FOUND = "A15";
</code></pre>
<h3 id="kassetrouter_wrong_role"><a class="header" href="#kassetrouter_wrong_role">KASSETROUTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_WRONG_ROLE = "A16";
</code></pre>
<h3 id="kassetrouter_zero_address"><a class="header" href="#kassetrouter_zero_address">KASSETROUTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ZERO_ADDRESS = "A17";
</code></pre>
<h3 id="kassetrouter_zero_amount"><a class="header" href="#kassetrouter_zero_amount">KASSETROUTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KASSETROUTER_ZERO_AMOUNT = "A18";
</code></pre>
<h3 id="adapter_already_initialized"><a class="header" href="#adapter_already_initialized">ADAPTER_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ALREADY_INITIALIZED = "BA1";
</code></pre>
<h3 id="adapter_invalid_registry"><a class="header" href="#adapter_invalid_registry">ADAPTER_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_INVALID_REGISTRY = "BA2";
</code></pre>
<h3 id="adapter_transfer_failed"><a class="header" href="#adapter_transfer_failed">ADAPTER_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_TRANSFER_FAILED = "BA3";
</code></pre>
<h3 id="adapter_wrong_asset"><a class="header" href="#adapter_wrong_asset">ADAPTER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_WRONG_ASSET = "BA4";
</code></pre>
<h3 id="adapter_wrong_role"><a class="header" href="#adapter_wrong_role">ADAPTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_WRONG_ROLE = "BA5";
</code></pre>
<h3 id="adapter_zero_address"><a class="header" href="#adapter_zero_address">ADAPTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ZERO_ADDRESS = "BA6";
</code></pre>
<h3 id="adapter_zero_amount"><a class="header" href="#adapter_zero_amount">ADAPTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_ZERO_AMOUNT = "BA7";
</code></pre>
<h3 id="adapter_insufficient_balance"><a class="header" href="#adapter_insufficient_balance">ADAPTER_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant ADAPTER_INSUFFICIENT_BALANCE = "BA8";
</code></pre>
<h3 id="basevault_already_initialized"><a class="header" href="#basevault_already_initialized">BASEVAULT_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_ALREADY_INITIALIZED = "BV1";
</code></pre>
<h3 id="basevault_contract_not_found"><a class="header" href="#basevault_contract_not_found">BASEVAULT_CONTRACT_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_CONTRACT_NOT_FOUND = "BV2";
</code></pre>
<h3 id="basevault_invalid_registry"><a class="header" href="#basevault_invalid_registry">BASEVAULT_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_INVALID_REGISTRY = "BV3";
</code></pre>
<h3 id="basevault_invalid_vault"><a class="header" href="#basevault_invalid_vault">BASEVAULT_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_INVALID_VAULT = "BV4";
</code></pre>
<h3 id="basevault_not_initialized"><a class="header" href="#basevault_not_initialized">BASEVAULT_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant BASEVAULT_NOT_INITIALIZED = "BV5";
</code></pre>
<h3 id="kbatchreceiver_already_initialized"><a class="header" href="#kbatchreceiver_already_initialized">KBATCHRECEIVER_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ALREADY_INITIALIZED = "B1";
</code></pre>
<h3 id="kbatchreceiver_invalid_batch_id"><a class="header" href="#kbatchreceiver_invalid_batch_id">KBATCHRECEIVER_INVALID_BATCH_ID</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_INVALID_BATCH_ID = "B2";
</code></pre>
<h3 id="kbatchreceiver_only_kminter"><a class="header" href="#kbatchreceiver_only_kminter">KBATCHRECEIVER_ONLY_KMINTER</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ONLY_KMINTER = "B3";
</code></pre>
<h3 id="kbatchreceiver_transfer_failed"><a class="header" href="#kbatchreceiver_transfer_failed">KBATCHRECEIVER_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_TRANSFER_FAILED = "B4";
</code></pre>
<h3 id="kbatchreceiver_wrong_asset"><a class="header" href="#kbatchreceiver_wrong_asset">KBATCHRECEIVER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_WRONG_ASSET = "B5";
</code></pre>
<h3 id="kbatchreceiver_zero_address"><a class="header" href="#kbatchreceiver_zero_address">KBATCHRECEIVER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ZERO_ADDRESS = "B6";
</code></pre>
<h3 id="kbatchreceiver_zero_amount"><a class="header" href="#kbatchreceiver_zero_amount">KBATCHRECEIVER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KBATCHRECEIVER_ZERO_AMOUNT = "B7";
</code></pre>
<h3 id="custodial_invalid_custodial_address"><a class="header" href="#custodial_invalid_custodial_address">CUSTODIAL_INVALID_CUSTODIAL_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_INVALID_CUSTODIAL_ADDRESS = "C1";
</code></pre>
<h3 id="custodial_transfer_failed"><a class="header" href="#custodial_transfer_failed">CUSTODIAL_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_TRANSFER_FAILED = "C2";
</code></pre>
<h3 id="custodial_vault_destination_not_set"><a class="header" href="#custodial_vault_destination_not_set">CUSTODIAL_VAULT_DESTINATION_NOT_SET</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_VAULT_DESTINATION_NOT_SET = "C3";
</code></pre>
<h3 id="custodial_wrong_asset"><a class="header" href="#custodial_wrong_asset">CUSTODIAL_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_WRONG_ASSET = "C4";
</code></pre>
<h3 id="custodial_wrong_role"><a class="header" href="#custodial_wrong_role">CUSTODIAL_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_WRONG_ROLE = "C5";
</code></pre>
<h3 id="custodial_zero_address"><a class="header" href="#custodial_zero_address">CUSTODIAL_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_ZERO_ADDRESS = "C6";
</code></pre>
<h3 id="custodial_zero_amount"><a class="header" href="#custodial_zero_amount">CUSTODIAL_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant CUSTODIAL_ZERO_AMOUNT = "C7";
</code></pre>
<h3 id="kbase_already_initialized"><a class="header" href="#kbase_already_initialized">KBASE_ALREADY_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBASE_ALREADY_INITIALIZED = "K1";
</code></pre>
<h3 id="kbase_invalid_registry"><a class="header" href="#kbase_invalid_registry">KBASE_INVALID_REGISTRY</a></h3>
<pre><code class="language-solidity">string constant KBASE_INVALID_REGISTRY = "K2";
</code></pre>
<h3 id="kbase_not_initialized"><a class="header" href="#kbase_not_initialized">KBASE_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KBASE_NOT_INITIALIZED = "K3";
</code></pre>
<h3 id="kbase_wrong_role"><a class="header" href="#kbase_wrong_role">KBASE_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KBASE_WRONG_ROLE = "K4";
</code></pre>
<h3 id="kbase_zero_address"><a class="header" href="#kbase_zero_address">KBASE_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KBASE_ZERO_ADDRESS = "K5";
</code></pre>
<h3 id="kbase_zero_amount"><a class="header" href="#kbase_zero_amount">KBASE_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KBASE_ZERO_AMOUNT = "K6";
</code></pre>
<h3 id="kbase_transfer_failed"><a class="header" href="#kbase_transfer_failed">KBASE_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KBASE_TRANSFER_FAILED = "K7";
</code></pre>
<h3 id="kbase_wrong_asset"><a class="header" href="#kbase_wrong_asset">KBASE_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KBASE_WRONG_ASSET = "K8";
</code></pre>
<h3 id="kbase_contract_not_found"><a class="header" href="#kbase_contract_not_found">KBASE_CONTRACT_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KBASE_CONTRACT_NOT_FOUND = "K9";
</code></pre>
<h3 id="kbase_asset_not_supported"><a class="header" href="#kbase_asset_not_supported">KBASE_ASSET_NOT_SUPPORTED</a></h3>
<pre><code class="language-solidity">string constant KBASE_ASSET_NOT_SUPPORTED = "K10";
</code></pre>
<h3 id="kbase_invalid_vault"><a class="header" href="#kbase_invalid_vault">KBASE_INVALID_VAULT</a></h3>
<pre><code class="language-solidity">string constant KBASE_INVALID_VAULT = "K11";
</code></pre>
<h3 id="kminter_batch_closed"><a class="header" href="#kminter_batch_closed">KMINTER_BATCH_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_BATCH_CLOSED = "M1";
</code></pre>
<h3 id="kminter_batch_settled"><a class="header" href="#kminter_batch_settled">KMINTER_BATCH_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_BATCH_SETTLED = "M2";
</code></pre>
<h3 id="kminter_insufficient_balance"><a class="header" href="#kminter_insufficient_balance">KMINTER_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_INSUFFICIENT_BALANCE = "M3";
</code></pre>
<h3 id="kminter_is_paused"><a class="header" href="#kminter_is_paused">KMINTER_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_IS_PAUSED = "M4";
</code></pre>
<h3 id="kminter_request_not_eligible"><a class="header" href="#kminter_request_not_eligible">KMINTER_REQUEST_NOT_ELIGIBLE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_NOT_ELIGIBLE = "M5";
</code></pre>
<h3 id="kminter_request_not_found"><a class="header" href="#kminter_request_not_found">KMINTER_REQUEST_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_NOT_FOUND = "M6";
</code></pre>
<h3 id="kminter_request_processed"><a class="header" href="#kminter_request_processed">KMINTER_REQUEST_PROCESSED</a></h3>
<pre><code class="language-solidity">string constant KMINTER_REQUEST_PROCESSED = "M7";
</code></pre>
<h3 id="kminter_wrong_asset"><a class="header" href="#kminter_wrong_asset">KMINTER_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KMINTER_WRONG_ASSET = "M8";
</code></pre>
<h3 id="kminter_wrong_role"><a class="header" href="#kminter_wrong_role">KMINTER_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KMINTER_WRONG_ROLE = "M9";
</code></pre>
<h3 id="kminter_zero_address"><a class="header" href="#kminter_zero_address">KMINTER_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KMINTER_ZERO_ADDRESS = "M10";
</code></pre>
<h3 id="kminter_zero_amount"><a class="header" href="#kminter_zero_amount">KMINTER_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KMINTER_ZERO_AMOUNT = "M11";
</code></pre>
<h3 id="kregistry_adapter_already_set"><a class="header" href="#kregistry_adapter_already_set">KREGISTRY_ADAPTER_ALREADY_SET</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ADAPTER_ALREADY_SET = "R1";
</code></pre>
<h3 id="kregistry_already_registered"><a class="header" href="#kregistry_already_registered">KREGISTRY_ALREADY_REGISTERED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ALREADY_REGISTERED = "R2";
</code></pre>
<h3 id="kregistry_asset_not_supported"><a class="header" href="#kregistry_asset_not_supported">KREGISTRY_ASSET_NOT_SUPPORTED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ASSET_NOT_SUPPORTED = "R3";
</code></pre>
<h3 id="kregistry_invalid_adapter"><a class="header" href="#kregistry_invalid_adapter">KREGISTRY_INVALID_ADAPTER</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_INVALID_ADAPTER = "R4";
</code></pre>
<h3 id="kregistry_transfer_failed"><a class="header" href="#kregistry_transfer_failed">KREGISTRY_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_TRANSFER_FAILED = "R5";
</code></pre>
<h3 id="kregistry_wrong_asset"><a class="header" href="#kregistry_wrong_asset">KREGISTRY_WRONG_ASSET</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_WRONG_ASSET = "R6";
</code></pre>
<h3 id="kregistry_wrong_role"><a class="header" href="#kregistry_wrong_role">KREGISTRY_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_WRONG_ROLE = "R7";
</code></pre>
<h3 id="kregistry_zero_address"><a class="header" href="#kregistry_zero_address">KREGISTRY_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ZERO_ADDRESS = "R8";
</code></pre>
<h3 id="kregistry_zero_amount"><a class="header" href="#kregistry_zero_amount">KREGISTRY_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_ZERO_AMOUNT = "R9";
</code></pre>
<h3 id="kregistry_fee_exceeds_maximum"><a class="header" href="#kregistry_fee_exceeds_maximum">KREGISTRY_FEE_EXCEEDS_MAXIMUM</a></h3>
<pre><code class="language-solidity">string constant KREGISTRY_FEE_EXCEEDS_MAXIMUM = "R10";
</code></pre>
<h3 id="kstakingvault_insufficient_balance"><a class="header" href="#kstakingvault_insufficient_balance">KSTAKINGVAULT_INSUFFICIENT_BALANCE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_INSUFFICIENT_BALANCE = "SV1";
</code></pre>
<h3 id="kstakingvault_is_paused"><a class="header" href="#kstakingvault_is_paused">KSTAKINGVAULT_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_IS_PAUSED = "SV2";
</code></pre>
<h3 id="kstakingvault_not_initialized"><a class="header" href="#kstakingvault_not_initialized">KSTAKINGVAULT_NOT_INITIALIZED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_NOT_INITIALIZED = "SV3";
</code></pre>
<h3 id="kstakingvault_request_not_eligible"><a class="header" href="#kstakingvault_request_not_eligible">KSTAKINGVAULT_REQUEST_NOT_ELIGIBLE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_REQUEST_NOT_ELIGIBLE = "SV4";
</code></pre>
<h3 id="kstakingvault_request_not_found"><a class="header" href="#kstakingvault_request_not_found">KSTAKINGVAULT_REQUEST_NOT_FOUND</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_REQUEST_NOT_FOUND = "SV5";
</code></pre>
<h3 id="kstakingvault_unauthorized"><a class="header" href="#kstakingvault_unauthorized">KSTAKINGVAULT_UNAUTHORIZED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_UNAUTHORIZED = "SV6";
</code></pre>
<h3 id="kstakingvault_vault_closed"><a class="header" href="#kstakingvault_vault_closed">KSTAKINGVAULT_VAULT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_VAULT_CLOSED = "SV7";
</code></pre>
<h3 id="kstakingvault_vault_settled"><a class="header" href="#kstakingvault_vault_settled">KSTAKINGVAULT_VAULT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_VAULT_SETTLED = "SV8";
</code></pre>
<h3 id="kstakingvault_wrong_role"><a class="header" href="#kstakingvault_wrong_role">KSTAKINGVAULT_WRONG_ROLE</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_WRONG_ROLE = "SV9";
</code></pre>
<h3 id="kstakingvault_zero_address"><a class="header" href="#kstakingvault_zero_address">KSTAKINGVAULT_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_ZERO_ADDRESS = "SV10";
</code></pre>
<h3 id="kstakingvault_zero_amount"><a class="header" href="#kstakingvault_zero_amount">KSTAKINGVAULT_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KSTAKINGVAULT_ZERO_AMOUNT = "SV11";
</code></pre>
<h3 id="ktoken_is_paused"><a class="header" href="#ktoken_is_paused">KTOKEN_IS_PAUSED</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_IS_PAUSED = "T1";
</code></pre>
<h3 id="ktoken_transfer_failed"><a class="header" href="#ktoken_transfer_failed">KTOKEN_TRANSFER_FAILED</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_TRANSFER_FAILED = "T2";
</code></pre>
<h3 id="ktoken_zero_address"><a class="header" href="#ktoken_zero_address">KTOKEN_ZERO_ADDRESS</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_ZERO_ADDRESS = "T3";
</code></pre>
<h3 id="ktoken_zero_amount"><a class="header" href="#ktoken_zero_amount">KTOKEN_ZERO_AMOUNT</a></h3>
<pre><code class="language-solidity">string constant KTOKEN_ZERO_AMOUNT = "T4";
</code></pre>
<h3 id="vaultbatches_not_closed"><a class="header" href="#vaultbatches_not_closed">VAULTBATCHES_NOT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_NOT_CLOSED = "VB1";
</code></pre>
<h3 id="vaultbatches_vault_closed"><a class="header" href="#vaultbatches_vault_closed">VAULTBATCHES_VAULT_CLOSED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_VAULT_CLOSED = "VB2";
</code></pre>
<h3 id="vaultbatches_vault_settled"><a class="header" href="#vaultbatches_vault_settled">VAULTBATCHES_VAULT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant VAULTBATCHES_VAULT_SETTLED = "VB3";
</code></pre>
<h3 id="vaultclaims_batch_not_settled"><a class="header" href="#vaultclaims_batch_not_settled">VAULTCLAIMS_BATCH_NOT_SETTLED</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_BATCH_NOT_SETTLED = "VC1";
</code></pre>
<h3 id="vaultclaims_invalid_batch_id"><a class="header" href="#vaultclaims_invalid_batch_id">VAULTCLAIMS_INVALID_BATCH_ID</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_INVALID_BATCH_ID = "VC2";
</code></pre>
<h3 id="vaultclaims_not_beneficiary"><a class="header" href="#vaultclaims_not_beneficiary">VAULTCLAIMS_NOT_BENEFICIARY</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_NOT_BENEFICIARY = "VC4";
</code></pre>
<h3 id="vaultclaims_request_not_pending"><a class="header" href="#vaultclaims_request_not_pending">VAULTCLAIMS_REQUEST_NOT_PENDING</a></h3>
<pre><code class="language-solidity">string constant VAULTCLAIMS_REQUEST_NOT_PENDING = "VC5";
</code></pre>
<h3 id="vaultfees_fee_exceeds_maximum"><a class="header" href="#vaultfees_fee_exceeds_maximum">VAULTFEES_FEE_EXCEEDS_MAXIMUM</a></h3>
<pre><code class="language-solidity">string constant VAULTFEES_FEE_EXCEEDS_MAXIMUM = "VF1";
</code></pre>
<h3 id="vaultfees_invalid_timestamp"><a class="header" href="#vaultfees_invalid_timestamp">VAULTFEES_INVALID_TIMESTAMP</a></h3>
<pre><code class="language-solidity">string constant VAULTFEES_INVALID_TIMESTAMP = "VF2";
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-4"><a class="header" href="#contents-4">Contents</a></h1>
<ul>
<li><a href="src/interfaces//src/interfaces/modules">modules</a></li>
<li><a href="src/interfaces/IAdapter.sol/interface.IAdapter.html">IAdapter</a></li>
<li><a href="src/interfaces/IExtsload.sol/interface.IExtsload.html">IExtsload</a></li>
<li><a href="src/interfaces/IVault.sol/interface.IVault.html">IVault</a></li>
<li><a href="src/interfaces/IVaultBatch.sol/interface.IVaultBatch.html">IVaultBatch</a></li>
<li><a href="src/interfaces/IVaultClaim.sol/interface.IVaultClaim.html">IVaultClaim</a></li>
<li><a href="src/interfaces/IVaultFees.sol/interface.IVaultFees.html">IVaultFees</a></li>
<li><a href="src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html">IkAssetRouter</a></li>
<li><a href="src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html">IkBatchReceiver</a></li>
<li><a href="src/interfaces/IkMinter.sol/interface.IkMinter.html">IkMinter</a></li>
<li><a href="src/interfaces/IkRegistry.sol/interface.IkRegistry.html">IkRegistry</a></li>
<li><a href="src/interfaces/IkStakingVault.sol/interface.IkStakingVault.html">IkStakingVault</a></li>
<li><a href="src/interfaces/IkToken.sol/interface.IkToken.html">IkToken</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-5"><a class="header" href="#contents-5">Contents</a></h1>
<ul>
<li><a href="src/interfaces/modules/IVaultReader.sol/interface.IVaultReader.html">IVaultReader</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultbatch"><a class="header" href="#ivaultbatch">IVaultBatch</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/modules/IVaultBatch.sol">Git Source</a></p>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="createnewbatch"><a class="header" href="#createnewbatch">createNewBatch</a></h3>
<p>Creates a new batch for processing requests</p>
<p><em>Only callable by RELAYER_ROLE, typically called at batch intervals</em></p>
<pre><code class="language-solidity">function createNewBatch() external;
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the kRegistry contract managing protocol-wide settings</td></tr>
</tbody></table>
</div>
<h3 id="asset"><a class="header" href="#asset">asset</a></h3>
<p>Returns the vault's share token (stkToken) address for ERC20 operations</p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of this vault's stkToken contract representing user shares</td></tr>
</tbody></table>
</div>
<h3 id="underlyingasset"><a class="header" href="#underlyingasset">underlyingAsset</a></h3>
<p>Returns the underlying asset address that this vault generates yield on</p>
<pre><code class="language-solidity">function underlyingAsset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the base asset (USDC, WBTC, etc.) managed by this vault</td></tr>
</tbody></table>
</div>
<h3 id="computelastbatchfees"><a class="header" href="#computelastbatchfees">computeLastBatchFees</a></h3>
<p>Calculates accumulated fees for the current period including management and performance components</p>
<p><em>Computes real-time fee accruals based on time elapsed and vault performance since last fee charge.
Management fees accrue continuously based on assets under management and time passed. Performance fees
are calculated on share price appreciation above watermarks and hurdle rates. This function provides
accurate fee projections for settlement planning and user transparency without modifying state.</em></p>
<pre><code class="language-solidity">function computeLastBatchFees()
    external
    view
    returns (uint256 managementFees, uint256 performanceFees, uint256 totalFees);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>managementFees</code></td><td><code>uint256</code></td><td>Accrued management fees in underlying asset terms</td></tr>
<tr><td><code>performanceFees</code></td><td><code>uint256</code></td><td>Accrued performance fees in underlying asset terms</td></tr>
<tr><td><code>totalFees</code></td><td><code>uint256</code></td><td>Combined management and performance fees for total fee burden</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultclaim"><a class="header" href="#ivaultclaim">IVaultClaim</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/modules/IVaultClaim.sol">Git Source</a></p>
<h2 id="functions-7"><a class="header" href="#functions-7">Functions</a></h2>
<h3 id="claimstakedshares"><a class="header" href="#claimstakedshares">claimStakedShares</a></h3>
<p>Claims stkTokens from a settled staking batch</p>
<pre><code class="language-solidity">function claimStakedShares(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Timestamp of last management fee charge for accrual calculations</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedperformance"><a class="header" href="#lastfeeschargedperformance">lastFeesChargedPerformance</a></h3>
<p>Returns the timestamp when performance fees were last processed</p>
<pre><code class="language-solidity">function lastFeesChargedPerformance() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Timestamp of last performance fee charge for watermark tracking</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultfees"><a class="header" href="#ivaultfees">IVaultFees</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/modules/IVaultFees.sol">Git Source</a></p>
<h2 id="functions-8"><a class="header" href="#functions-8">Functions</a></h2>
<h3 id="sethurdlerate"><a class="header" href="#sethurdlerate">setHurdleRate</a></h3>
<p>Sets the yearly hurdle rate for the underlying asset</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setHurdleRate(uint16 _hurdleRate) external;
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Hurdle rate in basis points that vault performance must exceed</td></tr>
</tbody></table>
</div>
<h3 id="performancefee"><a class="header" href="#performancefee">performanceFee</a></h3>
<p>Returns the current performance fee rate charged on excess returns</p>
<pre><code class="language-solidity">function performanceFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Performance fee rate in basis points (1% = 100)</td></tr>
</tbody></table>
</div>
<h3 id="nextperformancefeetimestamp"><a class="header" href="#nextperformancefeetimestamp">nextPerformanceFeeTimestamp</a></h3>
<p>Calculates the next timestamp when performance fees can be charged</p>
<pre><code class="language-solidity">function nextPerformanceFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Projected timestamp for next performance fee evaluation</td></tr>
</tbody></table>
</div>
<h3 id="nextmanagementfeetimestamp"><a class="header" href="#nextmanagementfeetimestamp">nextManagementFeeTimestamp</a></h3>
<p>Calculates the next timestamp when management fees can be charged</p>
<pre><code class="language-solidity">function nextManagementFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Projected timestamp for next management fee evaluation</td></tr>
</tbody></table>
</div>
<h3 id="managementfee"><a class="header" href="#managementfee">managementFee</a></h3>
<p>Returns the current management fee rate charged on assets under management</p>
<pre><code class="language-solidity">function managementFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>Management fee rate in basis points (1% = 100)</td></tr>
</tbody></table>
</div>
<h3 id="sharepricewatermark"><a class="header" href="#sharepricewatermark">sharePriceWatermark</a></h3>
<p>Returns the high watermark used for performance fee calculations</p>
<p><em>The watermark tracks the highest share price achieved, ensuring performance fees are only
charged on new highs and preventing double-charging on recovered losses. Reset occurs when new
high watermarks are achieved, establishing a new baseline for future performance fee calculations.</em></p>
<pre><code class="language-solidity">function sharePriceWatermark() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Current high watermark share price in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="isbatchclosed"><a class="header" href="#isbatchclosed">isBatchClosed</a></h3>
<p>Checks if the current batch is closed to new requests</p>
<pre><code class="language-solidity">function isBatchClosed() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if current batch is closed and awaiting settlement</td></tr>
</tbody></table>
</div>
<h3 id="isbatchsettled"><a class="header" href="#isbatchsettled">isBatchSettled</a></h3>
<p>Checks if the current batch has been settled with finalized prices</p>
<pre><code class="language-solidity">function isBatchSettled() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if current batch is settled and ready for claims</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidinfo"><a class="header" href="#getbatchidinfo">getBatchIdInfo</a></h3>
<p>Returns comprehensive information about the current batch</p>
<pre><code class="language-solidity">function getBatchIdInfo()
    external
    view
    returns (bytes32 batchId, address batchReceiver, bool isClosed, bool isSettled);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Current batch identifier</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>Address of batch receiver contract (may be zero if not created)</td></tr>
<tr><td><code>isClosed</code></td><td><code>bool</code></td><td>Whether the batch is closed to new requests</td></tr>
<tr><td><code>isSettled</code></td><td><code>bool</code></td><td>Whether the batch has been settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchreceiver"><a class="header" href="#getbatchreceiver">getBatchReceiver</a></h3>
<p>Returns the batch receiver address for a specific batch ID</p>
<pre><code class="language-solidity">function getBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the batch receiver (may be zero if not deployed)</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchreceiver"><a class="header" href="#getsafebatchreceiver">getSafeBatchReceiver</a></h3>
<p>Returns batch receiver address with validation, creating if necessary</p>
<pre><code class="language-solidity">function getSafeBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Address of the batch receiver (guaranteed non-zero)</td></tr>
</tbody></table>
</div>
<h3 id="shareprice"><a class="header" href="#shareprice">sharePrice</a></h3>
<p>Calculates current share price including all accrued yields</p>
<p><em>Returns gross share price before fee deductions, reflecting total vault performance.
Used for settlement calculations and performance tracking.</em></p>
<pre><code class="language-solidity">function sharePrice() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Share price per stkToken in underlying asset terms (scaled to token decimals)</td></tr>
</tbody></table>
</div>
<h3 id="totalassets-1"><a class="header" href="#totalassets-1">totalAssets</a></h3>
<p>Returns total assets under management including pending fees</p>
<pre><code class="language-solidity">function totalAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total asset value managed by the vault in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="totalnetassets"><a class="header" href="#totalnetassets">totalNetAssets</a></h3>
<p>Returns net assets after deducting accumulated fees</p>
<p><em>Provides user-facing asset value after management and performance fee deductions.
Used for accurate user balance calculations and net yield reporting.</em></p>
<pre><code class="language-solidity">function totalNetAssets() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net asset value available to users after fee deductions</td></tr>
</tbody></table>
</div>
<h3 id="getbatchid"><a class="header" href="#getbatchid">getBatchId</a></h3>
<p>Returns the current active batch identifier</p>
<pre><code class="language-solidity">function getBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Current batch ID for new requests</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchid"><a class="header" href="#getsafebatchid">getSafeBatchId</a></h3>
<p>Returns current batch ID with safety validation</p>
<pre><code class="language-solidity">function getSafeBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The management fee in basis points (e.g., 100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="feereceiver"><a class="header" href="#feereceiver">feeReceiver</a></h3>
<p>Returns the address that receives collected fees</p>
<pre><code class="language-solidity">function feeReceiver() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The fee receiver address</td></tr>
</tbody></table>
</div>
<h3 id="contractversion"><a class="header" href="#contractversion">contractVersion</a></h3>
<p>Returns the contract version for upgrade tracking and compatibility</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string indicating current implementation version</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="iadapter"><a class="header" href="#iadapter">IAdapter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IAdapter.sol">Git Source</a></p>
<p>Interface for protocol adapters that manage external strategy integrations</p>
<p><em>All adapters must implement this interface for kAssetRouter integration</em></p>
<h2 id="functions-8"><a class="header" href="#functions-8">Functions</a></h2>
<h3 id="deposit-1"><a class="header" href="#deposit-1">deposit</a></h3>
<p>Deposits assets to external strategy on behalf of a vault</p>
<pre><code class="language-solidity">function deposit(address asset, uint256 amount, address onBehalfOf) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to deposit</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to deposit</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address this deposit is for</td></tr>
</tbody></table>
</div>
<h3 id="redeem-1"><a class="header" href="#redeem-1">redeem</a></h3>
<p>Redeems assets from external strategy on behalf of a vault</p>
<pre><code class="language-solidity">function redeem(address asset, uint256 amount, address onBehalfOf) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to redeem</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount to redeem</td></tr>
<tr><td><code>onBehalfOf</code></td><td><code>address</code></td><td>The vault address this redemption is for</td></tr>
</tbody></table>
</div>
<h3 id="processredemption"><a class="header" href="#processredemption">processRedemption</a></h3>
<p>Processes a pending redemption</p>
<pre><code class="language-solidity">function processRedemption(uint256 requestId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID to process</td></tr>
</tbody></table>
</div>
<h3 id="settotalassets-1"><a class="header" href="#settotalassets-1">setTotalAssets</a></h3>
<p>Sets the total assets for a given vault</p>
<pre><code class="language-solidity">function setTotalAssets(address vault, address asset, uint256 totalAssets_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td>The total assets to set</td></tr>
</tbody></table>
</div>
<h3 id="getlasttotalassets-1"><a class="header" href="#getlasttotalassets-1">getLastTotalAssets</a></h3>
<p>Returns the last total assets for a given vault and asset</p>
<pre><code class="language-solidity">function getLastTotalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The last total assets for the vault and asset</td></tr>
</tbody></table>
</div>
<h3 id="converttoassets"><a class="header" href="#converttoassets">convertToAssets</a></h3>
<p>Converts shares to assets</p>
<pre><code class="language-solidity">function convertToAssets(address vault, uint256 shares) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares to convert</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The number of assets converted from shares</td></tr>
</tbody></table>
</div>
<h3 id="totalassets-2"><a class="header" href="#totalassets-2">totalAssets</a></h3>
<p>Returns the current total assets in the external strategy</p>
<pre><code class="language-solidity">function totalAssets(address vault, address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault to query</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total assets currently deployed in strategy</td></tr>
</tbody></table>
</div>
<h3 id="getpendingredemption"><a class="header" href="#getpendingredemption">getPendingRedemption</a></h3>
<p>Returns the pending redemption for a request ID</p>
<pre><code class="language-solidity">function getPendingRedemption(uint256 requestId)
    external
    view
    returns (address vault, address asset, uint256 shares, bool processed);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>uint256</code></td><td>The request ID to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The number of shares being redeemed</td></tr>
<tr><td><code>processed</code></td><td><code>bool</code></td><td>Whether the redemption has been processed</td></tr>
</tbody></table>
</div>
<h3 id="getpendingredemptions"><a class="header" href="#getpendingredemptions">getPendingRedemptions</a></h3>
<p>Returns the pending redemptions for a vault</p>
<pre><code class="language-solidity">function getPendingRedemptions(address vault) external view returns (uint256[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256[]</code></td><td>Pending redemptions for the vault</td></tr>
</tbody></table>
</div>
<h3 id="registered"><a class="header" href="#registered">registered</a></h3>
<p>Returns whether this adapter is registered</p>
<pre><code class="language-solidity">function registered() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered and active</td></tr>
</tbody></table>
</div>
<h3 id="name-1"><a class="header" href="#name-1">name</a></h3>
<p>Returns the adapter's name for identification</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Human readable adapter name</td></tr>
</tbody></table>
</div>
<h3 id="version-1"><a class="header" href="#version-1">version</a></h3>
<p>Returns the adapter's version</p>
<pre><code class="language-solidity">function version() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Version string</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="iextsload"><a class="header" href="#iextsload">IExtsload</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IExtsload.sol">Git Source</a></p>
<p>Interface for external storage access</p>
<h2 id="functions-9"><a class="header" href="#functions-9">Functions</a></h2>
<h3 id="extsload-4"><a class="header" href="#extsload-4">extsload</a></h3>
<p>Reads a single storage slot</p>
<pre><code class="language-solidity">function extsload(bytes32 slot) external view returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slot</code></td><td><code>bytes32</code></td><td>Storage slot to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Value at the storage slot</td></tr>
</tbody></table>
</div>
<h3 id="extsload-5"><a class="header" href="#extsload-5">extsload</a></h3>
<p>Reads multiple consecutive storage slots</p>
<pre><code class="language-solidity">function extsload(bytes32 startSlot, uint256 nSlots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>startSlot</code></td><td><code>bytes32</code></td><td>Starting storage slot</td></tr>
<tr><td><code>nSlots</code></td><td><code>uint256</code></td><td>Number of slots to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of values from the storage slots</td></tr>
</tbody></table>
</div>
<h3 id="extsload-6"><a class="header" href="#extsload-6">extsload</a></h3>
<p>Reads multiple arbitrary storage slots</p>
<pre><code class="language-solidity">function extsload(bytes32[] calldata slots) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>slots</code></td><td><code>bytes32[]</code></td><td>Array of storage slots to read</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of values from the storage slots</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ikassetrouter"><a class="header" href="#ikassetrouter">IkAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkAssetRouter.sol">Git Source</a></p>
<p>Interface for kAssetRouter for asset routing and settlement</p>
<h2 id="functions-11"><a class="header" href="#functions-11">Functions</a></h2>
<h3 id="createnewbatch"><a class="header" href="#createnewbatch">createNewBatch</a></h3>
<p>Creates a new batch to begin aggregating user requests for the next settlement period</p>
<p><em>This function initializes a fresh batch period for collecting staking and unstaking requests. Process:
(1) Increments internal batch counter for unique identification, (2) Generates deterministic batch ID using
chain-specific parameters (vault address, batch number, chainid, timestamp, asset) for collision resistance,
(3) Initializes batch storage with open state enabling new request acceptance, (4) Updates vault's current
batch tracking for request routing. Only relayers can call this function as part of the automated settlement
schedule. The timing is typically coordinated with institutional settlement cycles to optimize capital
efficiency
across the protocol. Each batch remains open until explicitly closed by relayers or governance.</em></p>
<pre><code class="language-solidity">function createNewBatch() external returns (bytes32 batchId);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Unique deterministic identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="closebatch"><a class="header" href="#closebatch">closeBatch</a></h3>
<p>Closes a batch to prevent new requests and prepare for settlement processing</p>
<p><em>This function transitions a batch from open to closed state, finalizing the request set for settlement.
Process: (1) Validates batch exists and is currently open to prevent double-closing, (2) Marks batch as closed
preventing new stake/unstake requests from joining, (3) Optionally creates new batch for continued operations
if _create flag is true, enabling seamless transitions. Once closed, the batch awaits settlement by kAssetRouter
which will calculate final share prices and distribute yields. Only relayers can execute batch closure as part
of the coordinated settlement schedule across all protocol vaults. The timing typically aligns with DN vault
yield calculations to ensure accurate price discovery.</em></p>
<pre><code class="language-solidity">function closeBatch(bytes32 _batchId, bool _create) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The specific batch identifier to close (must be currently open)</td></tr>
<tr><td><code>_create</code></td><td><code>bool</code></td><td>Whether to immediately create a new batch after closing for continued operations</td></tr>
</tbody></table>
</div>
<h3 id="settlebatch"><a class="header" href="#settlebatch">settleBatch</a></h3>
<p>Marks a batch as settled after yield distribution and enables user claiming</p>
<p><em>This function finalizes batch settlement by recording final asset values and enabling claims. Process:
(1) Validates batch is closed and not already settled to prevent duplicate processing, (2) Snapshots both
gross and net share prices at settlement time for accurate reward calculations, (3) Marks batch as settled
enabling users to claim their staked shares or unstaked assets, (4) Completes the batch lifecycle allowing
reward distribution through the claiming mechanism. Only kAssetRouter can settle batches as it coordinates
yield calculations across DN vaults and manages cross-vault asset flows. Settlement triggers share price
finalization based on vault performance during the batch period.</em></p>
<pre><code class="language-solidity">function settleBatch(bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to mark as settled (must be closed, not previously settled)</td></tr>
</tbody></table>
</div>
<h3 id="createbatchreceiver"><a class="header" href="#createbatchreceiver">createBatchReceiver</a></h3>
<p>Deploys a minimal proxy BatchReceiver for isolated asset distribution to unstaking users</p>
<p><em>This function creates batch-specific receivers for secure unstaking asset distribution. Process:
(1) Checks if receiver already exists for batch to prevent duplicate deployments, (2) Clones minimal proxy
from receiver implementation to minimize gas costs while maintaining isolation, (3) Initializes receiver with
batch ID and asset type for proper operation, (4) Stores receiver address in batch info for claiming access.
The receiver pattern provides several benefits: asset isolation between batches preventing cross-contamination,
gas-efficient deployment through EIP-1167 minimal proxies, security through single-batch operation scope,
and simplified distribution logic for unstaking claims. Only kAssetRouter can create receivers as part of
settlement coordination.</em></p>
<pre><code class="language-solidity">function createBatchReceiver(bytes32 _batchId) external returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier requiring a receiver for asset distribution</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the deployed BatchReceiver contract for this specific batch</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultclaim"><a class="header" href="#ivaultclaim">IVaultClaim</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVaultClaim.sol">Git Source</a></p>
<p>Interface for claiming settled staking rewards and unstaking assets after batch processing completion</p>
<p><em>This interface defines the final phase of the two-phase staking/unstaking system where users collect
their rewards after batch settlement. The claiming mechanism operates after batches have been settled by
kAssetRouter with finalized share prices and yield calculations. Key features include: (1) Share Distribution:
For staking claims, users receive stkTokens at the settled share price reflecting vault performance during
the batch period, (2) Asset Distribution: For unstaking claims, users receive kTokens (including accrued yield)
distributed through batch-specific receiver contracts, (3) Request Validation: Claims are validated against
original requests to ensure only authorized recipients can claim, (4) State Management: Claimed requests are
marked to prevent double-claiming while maintaining audit trails. The two-phase approach (request → claim)
provides several advantages: fair pricing through synchronized settlement, gas efficiency by separating request
processing from asset distribution, security through settled price finalization, and operational flexibility
for users to claim rewards at their convenience after settlement.</em></p>
<h2 id="functions-12"><a class="header" href="#functions-12">Functions</a></h2>
<h3 id="claimstakedshares"><a class="header" href="#claimstakedshares">claimStakedShares</a></h3>
<p>Claims stkTokens from a settled staking batch at the finalized share price</p>
<p><em>This function completes the staking process by distributing stkTokens to users after batch settlement.
Process: (1) Validates batch has been settled and share prices are finalized to ensure accurate distribution,
(2) Verifies request ownership and pending status to prevent unauthorized or duplicate claims, (3) Calculates
stkToken amount based on original kToken deposit and settled net share price (after fees), (4) Mints stkTokens
to specified recipient reflecting their proportional vault ownership, (5) Marks request as claimed to prevent
future reprocessing. The net share price accounts for management and performance fees, ensuring users receive
their accurate yield-adjusted position. stkTokens are ERC20-compatible shares that continue accruing yield
through share price appreciation until unstaking.</em></p>
<pre><code class="language-solidity">function claimStakedShares(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The settled batch identifier containing this staking request</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The specific staking request identifier to claim rewards for</td></tr>
</tbody></table>
</div>
<h3 id="claimunstakedassets"><a class="header" href="#claimunstakedassets">claimUnstakedAssets</a></h3>
<p>Claims kTokens plus accrued yield from a settled unstaking batch through batch receiver distribution</p>
<p><em>This function completes the unstaking process by distributing redeemed assets to users after settlement.
Process: (1) Validates batch settlement and asset distribution readiness through batch receiver verification,
(2) Confirms request ownership and pending status to ensure authorized claiming, (3) Calculates kToken amount
based on original stkToken redemption and settled share price including yield, (4) Burns locked stkTokens
that were held during settlement period, (5) Triggers batch receiver to transfer calculated kTokens to
recipient,
(6) Marks request as claimed completing the unstaking cycle. The batch receiver pattern ensures asset isolation
between settlement periods while enabling efficient distribution. Users receive their original investment plus
proportional share of vault yields earned during their staking period.</em></p>
<pre><code class="language-solidity">function claimUnstakedAssets(bytes32 batchId, bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The settled batch identifier containing this unstaking request</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The specific unstaking request identifier to claim assets for</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ivaultfees"><a class="header" href="#ivaultfees">IVaultFees</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IVaultFees.sol">Git Source</a></p>
<p>Interface for vault fee management including performance and management fees with hurdle rate mechanisms</p>
<p><em>This interface defines the fee structure for staking vaults, implementing traditional fund management fee
models adapted for DeFi yield generation. The system supports two primary fee types: (1) Management Fees: Charged
periodically on assets under management regardless of performance, compensating vault operators for operational
costs and risk management, (2) Performance Fees: Charged on excess returns above hurdle rates, aligning operator
incentives with user returns. The hurdle rate mechanism can operate in two modes: soft hurdle (fees on all profits)
or hard hurdle (fees only on excess above hurdle). Fee calculations integrate with the batch settlement system,
ensuring accurate deductions from user returns during share price calculations. Backend coordination allows for
off-chain fee processing with on-chain validation and tracking. All fees are expressed in basis points (1% = 100 bp)
for precision and standard financial terminology alignment.</em></p>
<h2 id="functions-13"><a class="header" href="#functions-13">Functions</a></h2>
<h3 id="sethardhurdlerate"><a class="header" href="#sethardhurdlerate">setHardHurdleRate</a></h3>
<p>Configures the hurdle rate fee calculation mechanism for performance fee determination</p>
<p><em>This function switches between soft and hard hurdle rate modes affecting performance fee calculations.
Hurdle Rate Modes: (1) Soft Hurdle (_isHard = false): Performance fees are charged on all profits when returns
exceed the hurdle rate threshold, providing simpler fee calculation while maintaining performance incentives,
(2) Hard Hurdle (_isHard = true): Performance fees are only charged on the excess return above the hurdle rate,
ensuring users keep the full hurdle rate return before any performance fees. The hurdle rate itself is set
globally in the registry per asset, providing consistent benchmarks across vaults. This mechanism ensures
vault operators are only rewarded for generating returns above market expectations, protecting user interests
while incentivizing superior performance.</em></p>
<pre><code class="language-solidity">function setHardHurdleRate(bool _isHard) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isHard</code></td><td><code>bool</code></td><td>True for hard hurdle (fees only on excess), false for soft hurdle (fees on all profits)</td></tr>
</tbody></table>
</div>
<h3 id="setmanagementfee"><a class="header" href="#setmanagementfee">setManagementFee</a></h3>
<p>Sets the annual management fee rate charged on assets under management</p>
<p><em>This function configures the periodic fee charged regardless of vault performance, compensating operators
for ongoing vault management, risk monitoring, and operational costs. Management fees are calculated based on
time elapsed since last fee charge and total assets under management. Process: (1) Validates fee rate does not
exceed maximum allowed to protect users from excessive fees, (2) Updates stored management fee rate for future
calculations, (3) Emits event for transparency and off-chain tracking. The fee accrues continuously and is
realized during batch settlements, ensuring users see accurate net returns. Management fees are deducted from
vault assets before performance fee calculations, following traditional fund management practices.</em></p>
<pre><code class="language-solidity">function setManagementFee(uint16 _managementFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_managementFee</code></td><td><code>uint16</code></td><td>Annual management fee rate in basis points (1% = 100 bp, max 10000 bp)</td></tr>
</tbody></table>
</div>
<h3 id="setperformancefee"><a class="header" href="#setperformancefee">setPerformanceFee</a></h3>
<p>Sets the performance fee rate charged on vault returns above hurdle rates</p>
<p><em>This function configures the success fee charged when vault performance exceeds benchmark hurdle rates,
aligning operator incentives with user returns. Performance fees are calculated during settlement based on
share price appreciation above the watermark (highest previous share price) and hurdle rate requirements.
Process: (1) Validates fee rate is within acceptable bounds for user protection, (2) Updates performance fee
rate for future calculations, (3) Emits tracking event for transparency. The fee applies only to new high
watermarks, preventing double-charging on recovered losses. Combined with hurdle rates, this ensures operators
are rewarded for generating superior risk-adjusted returns while protecting users from excessive fee extraction.</em></p>
<pre><code class="language-solidity">function setPerformanceFee(uint16 _performanceFee) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_performanceFee</code></td><td><code>uint16</code></td><td>Performance fee rate in basis points charged on excess returns (max 10000 bp)</td></tr>
</tbody></table>
</div>
<h3 id="notifymanagementfeescharged"><a class="header" href="#notifymanagementfeescharged">notifyManagementFeesCharged</a></h3>
<p>Updates the timestamp tracking for management fee calculations after backend fee processing</p>
<p><em>This function maintains accurate management fee accrual by recording when fees were last processed.
Backend Coordination: (1) Off-chain systems calculate and process management fees based on time elapsed and
assets under management, (2) Fees are deducted from vault assets through settlement mechanisms, (3) This
function
updates the tracking timestamp to prevent double-charging in future calculations. The timestamp validation
ensures logical progression and prevents manipulation. Management fees accrue continuously, and proper timestamp
tracking is essential for accurate pro-rata fee calculations across all vault participants.</em></p>
<pre><code class="language-solidity">function notifyManagementFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp when management fees were processed (must be &gt;= last timestamp, &lt;= current time)</td></tr>
</tbody></table>
</div>
<h3 id="notifyperformancefeescharged"><a class="header" href="#notifyperformancefeescharged">notifyPerformanceFeesCharged</a></h3>
<p>Updates the timestamp tracking for performance fee calculations after backend fee processing</p>
<p><em>This function maintains accurate performance fee tracking by recording when performance fees were last
calculated and charged. Backend Processing: (1) Off-chain systems evaluate vault performance against watermarks
and hurdle rates, (2) Performance fees are calculated on excess returns and deducted during settlement,
(3) This notification updates tracking timestamp and potentially adjusts watermark levels. The timestamp ensures
proper sequencing of performance evaluations and prevents fee calculation errors. Performance fees are
event-driven
based on new high watermarks, making accurate timestamp tracking crucial for fair fee assessment across all
users.</em></p>
<pre><code class="language-solidity">function notifyPerformanceFeesCharged(uint64 _timestamp) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp when performance fees were processed (must be &gt;= last timestamp, &lt;= current time)</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ikassetrouter"><a class="header" href="#ikassetrouter">IkAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkAssetRouter.sol">Git Source</a></p>
<p>Central money flow coordinator for the KAM protocol managing all asset movements and settlements</p>
<p><em>This interface defines the core functionality for kAssetRouter, which serves as the primary coordinator
for all asset movements within the KAM protocol ecosystem. Key responsibilities include: (1) Managing asset
flows from kMinter institutional deposits to DN vaults for yield generation, (2) Coordinating asset transfers
between kStakingVaults for optimal allocation, (3) Processing batch settlements with yield distribution through
kToken minting/burning, (4) Maintaining virtual balance tracking across all vaults, (5) Implementing settlement
cooldown periods for security, (6) Executing peg protection mechanisms during market stress. The router acts as
the central hub that enables efficient capital allocation while maintaining the 1:1 backing guarantee of kTokens
through precise yield distribution and loss management across the protocol's vault network.</em></p>
<h2 id="functions-14"><a class="header" href="#functions-14">Functions</a></h2>
<h3 id="kassetpush"><a class="header" href="#kassetpush">kAssetPush</a></h3>
<p>Pushes assets from kMinter institutional deposits to the designated DN vault for yield generation</p>
<p><em>This function is called by kMinter when institutional users deposit underlying assets. The process
involves: (1) receiving assets already transferred from kMinter, (2) forwarding them to the appropriate
DN vault for the asset type, (3) updating virtual balance tracking for accurate accounting. This enables
immediate kToken minting (1:1 with deposits) while assets begin generating yield in the vault system.
The assets enter the current batch for eventual settlement and yield distribution back to kToken holders.</em></p>
<pre><code class="language-solidity">function kAssetPush(address _asset, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited (must be registered in protocol)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault for yield generation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch identifier from the DN vault for tracking and settlement</td></tr>
</tbody></table>
</div>
<h3 id="kassetrequestpull"><a class="header" href="#kassetrequestpull">kAssetRequestPull</a></h3>
<p>Requests asset withdrawal from vault to fulfill institutional redemption through kMinter</p>
<p><em>This function initiates the first phase of the institutional redemption process. The workflow
involves: (1) registering the redemption request with the vault, (2) creating a kBatchReceiver minimal
proxy to hold assets for distribution, (3) updating virtual balance accounting, (4) preparing for
batch settlement. The actual asset transfer occurs later during batch settlement when the vault
processes all pending requests together. This two-phase approach optimizes gas costs and ensures
fair settlement across all institutional redemption requests in the batch.</em></p>
<pre><code class="language-solidity">function kAssetRequestPull(address _asset, address _vault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being redeemed</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The DN vault address from which assets will be withdrawn</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this redemption with other requests</td></tr>
</tbody></table>
</div>
<h3 id="kassettransfer"><a class="header" href="#kassettransfer">kAssetTransfer</a></h3>
<p>Transfers assets between kStakingVaults for optimal capital allocation and yield optimization</p>
<p><em>This function enables dynamic rebalancing of assets across the vault network to optimize yields
and manage capacity. The transfer is virtual in nature - actual underlying assets may remain in the
same physical vault while accounting balances are updated. This mechanism allows for: (1) moving
assets from lower-yield to higher-yield opportunities, (2) rebalancing vault capacity during high
demand periods, (3) optimizing capital efficiency across the protocol. The batch system ensures
all transfers are processed fairly during settlement periods.</em></p>
<pre><code class="language-solidity">function kAssetTransfer(
    address sourceVault,
    address targetVault,
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address transferring assets (will lose virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The kStakingVault address receiving assets (will gain virtual balance)</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred between vaults</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer for rebalancing</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this transfer with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpush"><a class="header" href="#ksharesrequestpush">kSharesRequestPush</a></h3>
<p>Requests shares to be pushed for kStakingVault staking operations and batch processing</p>
<p><em>This function is part of the share-based accounting system for retail users in kStakingVaults.
When users stake kTokens, the vault requests shares to be pushed to track their ownership. The
process coordinates: (1) conversion of kTokens to vault shares at current share price, (2) updating
user balances in the vault system, (3) preparing for batch settlement. Share requests are batched
to optimize gas costs and ensure fair pricing across all users in the same settlement period.</em></p>
<pre><code class="language-solidity">function kSharesRequestPush(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share push operations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for push to users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share operations with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpull"><a class="header" href="#ksharesrequestpull">kSharesRequestPull</a></h3>
<p>Requests shares to be pulled for kStakingVault redemption operations</p>
<p><em>This function handles the share-based redemption process for retail users withdrawing from
kStakingVaults. The process involves: (1) calculating share amounts to redeem based on user
requests, (2) preparing for conversion back to kTokens at settlement time, (3) coordinating
with the batch settlement system for fair pricing. Unlike institutional redemptions through
kMinter, this uses share-based accounting to handle smaller, more frequent retail operations
efficiently through the vault's batch processing system.</em></p>
<pre><code class="language-solidity">function kSharesRequestPull(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share pull for redemptions</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for pull from users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share redemptions with settlement</td></tr>
</tbody></table>
</div>
<h3 id="proposesettlebatch"><a class="header" href="#proposesettlebatch">proposeSettleBatch</a></h3>
<p>Proposes a batch settlement for a vault with yield distribution through kToken minting/burning</p>
<p><em>This is the core function that initiates yield distribution in the KAM protocol. The settlement
process involves: (1) calculating final yields after a batch period, (2) determining net new deposits/
redemptions, (3) creating a proposal with cooldown period for security verification, (4) preparing for
kToken supply adjustment to maintain 1:1 backing. Positive yields result in kToken minting (distributing
gains to all holders), while losses result in kToken burning (socializing losses). The cooldown period
allows guardians to verify calculations before execution, ensuring protocol integrity.</em></p>
<pre><code class="language-solidity">function proposeSettleBatch(
    address asset,
    address vault,
    bytes32 batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    payable
    returns (bytes32 proposalId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being settled (USDC, WBTC, etc.)</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address where yield was generated</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation/loss</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits minus redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute amount of yield generated (positive) or lost (negative)</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive (will mint kTokens), false if negative (will burn kTokens)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>Unique identifier for this settlement proposal for tracking and execution</td></tr>
</tbody></table>
</div>
<h3 id="executesettlebatch"><a class="header" href="#executesettlebatch">executeSettleBatch</a></h3>
<p>Execute a settlement proposal after cooldown period</p>
<pre><code class="language-solidity">function executeSettleBatch(bytes32 proposalId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to execute</td></tr>
</tbody></table>
</div>
<h3 id="cancelproposal"><a class="header" href="#cancelproposal">cancelProposal</a></h3>
<p>Cancels a settlement proposal before execution if errors are detected</p>
<p><em>Provides a safety mechanism for guardians to cancel potentially incorrect settlement proposals.
This can be used when: (1) yield calculations appear incorrect, (2) system errors are detected,
(3) market conditions require recalculation. Cancellation allows for proposal correction and
resubmission with accurate data, preventing incorrect yield distribution that could affect the
protocol's 1:1 backing guarantee. Only callable before the proposal execution.</em></p>
<pre><code class="language-solidity">function cancelProposal(bytes32 proposalId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The proposal ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="updateproposal"><a class="header" href="#updateproposal">updateProposal</a></h3>
<p>Update a settlement proposal before execution</p>
<pre><code class="language-solidity">function updateProposal(bytes32 proposalId, uint256 totalAssets, uint256 netted, uint256 yield, bool profit) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The proposal ID to update</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>New total assets value</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>New netted amount</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>New yield amount</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>New profit status</td></tr>
</tbody></table>
</div>
<h3 id="setpaused"><a class="header" href="#setpaused">setPaused</a></h3>
<p>Set contract pause state</p>
<pre><code class="language-solidity">function setPaused(bool paused) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused</code></td><td><code>bool</code></td><td>New pause state</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>New cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="getdnvaultbyasset"><a class="header" href="#getdnvaultbyasset">getDNVaultByAsset</a></h3>
<p>Gets the DN vault address responsible for yield generation for a specific asset</p>
<p><em>Each supported asset (USDC, WBTC, etc.) has a designated DN vault that handles
yield farming strategies. This mapping is critical for routing institutional deposits
and coordinating settlement processes across the protocol's vault network.</em></p>
<pre><code class="language-solidity">function getDNVaultByAsset(address asset) external view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address that generates yield for this asset</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidbalances"><a class="header" href="#getbatchidbalances">getBatchIdBalances</a></h3>
<p>Retrieves the virtual balance accounting for a specific batch in a vault</p>
<p><em>Returns the deposited and requested amounts that are tracked virtually for batch
processing. These balances coordinate institutional flows (kMinter) and retail flows
(kStakingVault) within the same settlement period, ensuring fair processing and accurate
yield distribution across all participants in the batch.</em></p>
<pre><code class="language-solidity">function getBatchIdBalances(
    address vault,
    bytes32 batchId
)
    external
    view
    returns (uint256 deposited, uint256 requested);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query batch balances for</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to retrieve balance information</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deposited</code></td><td><code>uint256</code></td><td>Total amount of assets deposited into this batch</td></tr>
<tr><td><code>requested</code></td><td><code>uint256</code></td><td>Total amount of assets requested for redemption from this batch</td></tr>
</tbody></table>
</div>
<h3 id="getrequestedshares"><a class="header" href="#getrequestedshares">getRequestedShares</a></h3>
<p>Retrieves the total shares requested for redemption in a specific vault batch</p>
<p><em>Tracks share-based redemption requests from retail users in kStakingVaults.
This is separate from asset-based tracking and enables the protocol to coordinate
both institutional (asset-based) and retail (share-based) operations within the
same batch settlement process, ensuring consistent share price calculations.</em></p>
<pre><code class="language-solidity">function getRequestedShares(address vault, bytes32 batchId) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault address to query</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for the redemption period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of shares requested for redemption in this batch</td></tr>
</tbody></table>
</div>
<h3 id="ispaused"><a class="header" href="#ispaused">isPaused</a></h3>
<p>Check if contract is paused</p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused and operations are halted</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementproposal"><a class="header" href="#getsettlementproposal">getSettlementProposal</a></h3>
<p>Retrieves complete details of a specific settlement proposal</p>
<p><em>Returns the full VaultSettlementProposal struct containing all parameters needed
for yield distribution verification. Essential for guardians to review proposal accuracy
during the cooldown period before execution. Contains asset amounts, yield calculations,
and timing information for comprehensive proposal analysis.</em></p>
<pre><code class="language-solidity">function getSettlementProposal(bytes32 proposalId) external view returns (VaultSettlementProposal memory proposal);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The complete settlement proposal struct with all details</td></tr>
</tbody></table>
</div>
<h3 id="canexecuteproposal"><a class="header" href="#canexecuteproposal">canExecuteProposal</a></h3>
<p>Checks if a settlement proposal is ready for execution with detailed status</p>
<p><em>Validates all execution requirements: (1) proposal exists and is pending, (2) cooldown
period has elapsed, (3) proposal hasn't been cancelled. Returns both boolean result and
human-readable reason for failures, enabling better error handling and user feedback.</em></p>
<pre><code class="language-solidity">function canExecuteProposal(bytes32 proposalId) external view returns (bool canExecute, string memory reason);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the proposal to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>canExecute</code></td><td><code>bool</code></td><td>True if the proposal can be executed immediately</td></tr>
<tr><td><code>reason</code></td><td><code>string</code></td><td>Descriptive message explaining why execution is blocked (if applicable)</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementcooldown"><a class="header" href="#getsettlementcooldown">getSettlementCooldown</a></h3>
<p>Gets the current security cooldown period for settlement proposals</p>
<p><em>The cooldown period determines how long proposals must wait before execution.
This security mechanism allows guardians to verify yield calculations and prevents
immediate execution of potentially malicious or incorrect proposals. Critical for
maintaining protocol integrity during yield distribution processes.</em></p>
<pre><code class="language-solidity">function getSettlementCooldown() external view returns (uint256 cooldown);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The current cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="contractname-1"><a class="header" href="#contractname-1">contractName</a></h3>
<p>Returns the standard name identifier for this contract type within the KAM protocol</p>
<p><em>Used for protocol identification and registry management. Provides a consistent way
to identify kAssetRouter contracts across the protocol ecosystem, enabling automated
contract discovery and validation by other protocol components.</em></p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string (typically "kAssetRouter")</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-1"><a class="header" href="#contractversion-1">contractVersion</a></h3>
<p>Returns the version identifier for this contract implementation</p>
<p><em>Used for upgrade management and compatibility checking within the protocol. Enables
the system to verify contract versions during upgrades and ensure compatibility between
protocol components. Critical for protocol governance and maintenance procedures.</em></p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h2 id="events-2"><a class="header" href="#events-2">Events</a></h2>
<h3 id="initialized"><a class="header" href="#initialized">Initialized</a></h3>
<pre><code class="language-solidity">event Initialized(address indexed registry, address indexed owner, address admin, bool paused);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The address of the kRegistry contract that manages protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="assetspushed"><a class="header" href="#assetspushed">AssetsPushed</a></h3>
<p>Emitted when assets are pushed from kMinter to a DN vault for yield generation</p>
<p><em>This occurs when institutional users deposit assets through kMinter, and the router
forwards these assets to the appropriate DN vault for yield farming strategies</em></p>
<pre><code class="language-solidity">event AssetsPushed(address indexed from, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address initiating the asset push (typically kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault</td></tr>
</tbody></table>
</div>
<h3 id="assetsrequestpulled"><a class="header" href="#assetsrequestpulled">AssetsRequestPulled</a></h3>
<p>Emitted when assets are requested for pull from a vault to fulfill kMinter redemptions</p>
<p><em>Part of the two-phase redemption process - assets are first requested, then later pulled
after batch settlement. The batchReceiver is deployed to hold assets for distribution.</em></p>
<pre><code class="language-solidity">event AssetsRequestPulled(address indexed vault, address indexed asset, address indexed batchReceiver, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address from which assets are being requested</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being requested for redemption</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The minimal proxy contract that will receive and distribute assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
</tbody></table>
</div>
<h3 id="assetstransfered"><a class="header" href="#assetstransfered">AssetsTransfered</a></h3>
<p>Emitted when assets are transferred between kStakingVaults for optimal allocation</p>
<p><em>This is a virtual transfer for accounting purposes - actual assets may remain in the same
physical location while vault balances are updated to reflect the new allocation</em></p>
<pre><code class="language-solidity">event AssetsTransfered(address indexed sourceVault, address indexed targetVault, address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault transferring assets (losing virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets (gaining virtual balance)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being transferred between vaults</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpushed"><a class="header" href="#sharesrequestedpushed">SharesRequestedPushed</a></h3>
<p>Emitted when shares are requested for push operations in kStakingVault flows</p>
<p><em>Part of the share-based accounting system for retail users in kStakingVaults</em></p>
<pre><code class="language-solidity">event SharesRequestedPushed(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share push operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this operation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pushed</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpulled"><a class="header" href="#sharesrequestedpulled">SharesRequestedPulled</a></h3>
<p>Emitted when shares are requested for pull operations in kStakingVault redemptions</p>
<p><em>Coordinates share-based redemptions for retail users through the batch system</em></p>
<pre><code class="language-solidity">event SharesRequestedPulled(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share pull operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this redemption batch</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pulled for redemption</td></tr>
</tbody></table>
</div>
<h3 id="sharessettled"><a class="header" href="#sharessettled">SharesSettled</a></h3>
<p>Emitted when shares are settled across multiple vaults with calculated share prices</p>
<p><em>Marks the completion of a cross-vault settlement with final share price determination</em></p>
<pre><code class="language-solidity">event SharesSettled(
    address[] vaults, bytes32 indexed batchId, uint256 totalRequestedShares, uint256[] totalAssets, uint256 sharePrice
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vaults</code></td><td><code>address[]</code></td><td>Array of vault addresses participating in the settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalRequestedShares</code></td><td><code>uint256</code></td><td>Total shares requested across all vaults in this settlement</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256[]</code></td><td>Array of total assets for each vault after settlement</td></tr>
<tr><td><code>sharePrice</code></td><td><code>uint256</code></td><td>The final calculated share price for this settlement period</td></tr>
</tbody></table>
</div>
<h3 id="batchsettled"><a class="header" href="#batchsettled">BatchSettled</a></h3>
<p>Emitted when a vault batch is settled with final asset accounting</p>
<p><em>Indicates completion of yield distribution and final asset allocation for a batch</em></p>
<pre><code class="language-solidity">event BatchSettled(address indexed vault, bytes32 indexed batchId, uint256 totalAssets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that completed batch settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>The final total asset value in the vault after settlement</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionactivated"><a class="header" href="#pegprotectionactivated">PegProtectionActivated</a></h3>
<p>Emitted when peg protection mechanism is activated due to vault shortfall</p>
<p><em>Triggered when a vault cannot fulfill redemption requests, requiring asset transfers
from other vaults to maintain the protocol's 1:1 backing guarantee</em></p>
<pre><code class="language-solidity">event PegProtectionActivated(address indexed vault, uint256 shortfall);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault experiencing shortfall that triggered peg protection</td></tr>
<tr><td><code>shortfall</code></td><td><code>uint256</code></td><td>The amount of assets needed to fulfill pending redemption requests</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionexecuted"><a class="header" href="#pegprotectionexecuted">PegProtectionExecuted</a></h3>
<p>Emitted when peg protection transfers assets between vaults to cover shortfalls</p>
<p><em>Maintains protocol solvency by redistributing assets from surplus to deficit vaults</em></p>
<pre><code class="language-solidity">event PegProtectionExecuted(address indexed sourceVault, address indexed targetVault, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault providing assets to cover the shortfall</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets to fulfill its redemption obligations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets transferred for peg protection</td></tr>
</tbody></table>
</div>
<h3 id="yielddistributed"><a class="header" href="#yielddistributed">YieldDistributed</a></h3>
<p>Emitted when yield is distributed through kToken minting/burning operations</p>
<p><em>This is the core mechanism for maintaining 1:1 backing while distributing yield.
Positive yield increases kToken supply, negative yield (losses) decreases supply.</em></p>
<pre><code class="language-solidity">event YieldDistributed(address indexed vault, uint256 yield, bool isProfit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault that generated the yield being distributed</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>The absolute amount of yield (positive or negative) being distributed</td></tr>
<tr><td><code>isProfit</code></td><td><code>bool</code></td><td>True if yield is positive (minting kTokens), false if negative (burning kTokens)</td></tr>
</tbody></table>
</div>
<h3 id="deposited-1"><a class="header" href="#deposited-1">Deposited</a></h3>
<p>Emitted when assets are deposited into a vault through various protocol mechanisms</p>
<p><em>Tracks all asset deposits whether from kMinter institutional flows or other sources</em></p>
<pre><code class="language-solidity">event Deposited(address indexed vault, address indexed asset, uint256 amount, bool isKMinter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the deposit</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets deposited</td></tr>
<tr><td><code>isKMinter</code></td><td><code>bool</code></td><td>True if deposit originated from kMinter, false for other sources</td></tr>
</tbody></table>
</div>
<h3 id="settlementproposed"><a class="header" href="#settlementproposed">SettlementProposed</a></h3>
<p>Emitted when a new settlement proposal is created with cooldown period</p>
<p><em>Begins the settlement process with a security cooldown to allow verification</em></p>
<pre><code class="language-solidity">event SettlementProposed(
    bytes32 indexed proposalId,
    address indexed vault,
    bytes32 indexed batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit,
    uint256 executeAfter
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier for this settlement proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement is proposed</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier being settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits/redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute yield amount generated in this batch</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive, false if negative</td></tr>
<tr><td><code>executeAfter</code></td><td><code>uint256</code></td><td>Timestamp after which the proposal can be executed</td></tr>
</tbody></table>
</div>
<h3 id="settlementexecuted"><a class="header" href="#settlementexecuted">SettlementExecuted</a></h3>
<p>Emitted when a settlement proposal is successfully executed</p>
<p><em>Marks completion of the settlement process with yield distribution</em></p>
<pre><code class="language-solidity">event SettlementExecuted(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId, address executor);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the executed proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that was settled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>executor</code></td><td><code>address</code></td><td>The address that executed the settlement (guardian or admin)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcancelled"><a class="header" href="#settlementcancelled">SettlementCancelled</a></h3>
<p>Emitted when a settlement proposal is cancelled before execution</p>
<p><em>Allows guardians to cancel potentially incorrect settlement proposals</em></p>
<pre><code class="language-solidity">event SettlementCancelled(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the cancelled proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement was cancelled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for which settlement was cancelled</td></tr>
</tbody></table>
</div>
<h3 id="settlementupdated"><a class="header" href="#settlementupdated">SettlementUpdated</a></h3>
<p>Emitted when a settlement proposal is updated with new yield calculation data</p>
<p><em>Allows for correction of settlement proposals before execution if needed</em></p>
<pre><code class="language-solidity">event SettlementUpdated(bytes32 indexed proposalId, uint256 totalAssets, uint256 netted, uint256 yield, bool profit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the updated proposal</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Updated total asset value in the vault</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Updated net amount of deposits/redemptions</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Updated yield amount for distribution</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>Updated profit flag (true for gains, false for losses)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcooldownupdated"><a class="header" href="#settlementcooldownupdated">SettlementCooldownUpdated</a></h3>
<p>Emitted when the settlement cooldown period is updated by protocol governance</p>
<p><em>Cooldown provides security by allowing time to verify settlement proposals before execution</em></p>
<pre><code class="language-solidity">event SettlementCooldownUpdated(uint256 oldCooldown, uint256 newCooldown);
</code></pre>
<h2 id="errors-3"><a class="header" href="#errors-3">Errors</a></h2>
<h3 id="zeroamount"><a class="header" href="#zeroamount">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="insufficientvirtualbalance"><a class="header" href="#insufficientvirtualbalance">InsufficientVirtualBalance</a></h3>
<pre><code class="language-solidity">error InsufficientVirtualBalance();
</code></pre>
<h3 id="contractpaused"><a class="header" href="#contractpaused">ContractPaused</a></h3>
<pre><code class="language-solidity">error ContractPaused();
</code></pre>
<h3 id="onlystakingvault"><a class="header" href="#onlystakingvault">OnlyStakingVault</a></h3>
<pre><code class="language-solidity">error OnlyStakingVault();
</code></pre>
<h3 id="proposalnotfound"><a class="header" href="#proposalnotfound">ProposalNotFound</a></h3>
<pre><code class="language-solidity">error ProposalNotFound();
</code></pre>
<h3 id="proposalalreadyexecuted"><a class="header" href="#proposalalreadyexecuted">ProposalAlreadyExecuted</a></h3>
<pre><code class="language-solidity">error ProposalAlreadyExecuted();
</code></pre>
<h3 id="proposalcancelled"><a class="header" href="#proposalcancelled">ProposalCancelled</a></h3>
<pre><code class="language-solidity">error ProposalCancelled();
</code></pre>
<h3 id="cooldownnotpassed"><a class="header" href="#cooldownnotpassed">CooldownNotPassed</a></h3>
<pre><code class="language-solidity">error CooldownNotPassed();
</code></pre>
<h3 id="invalidcooldown"><a class="header" href="#invalidcooldown">InvalidCooldown</a></h3>
<pre><code class="language-solidity">error InvalidCooldown();
</code></pre>
<h2 id="structs-4"><a class="header" href="#structs-4">Structs</a></h2>
<h3 id="balances"><a class="header" href="#balances">Balances</a></h3>
<p>Tracks requested and deposited asset amounts for batch processing coordination</p>
<p><em>Used by kAssetRouter to maintain virtual balance accounting across vaults and coordinate
asset flows between kMinter redemption requests and vault settlements. Enables efficient
batch processing by tracking pending operations before physical asset movement occurs.</em></p>
<pre><code class="language-solidity">struct Balances {
    uint128 requested;
    uint128 deposited;
}
</code></pre>
<h3 id="vaultsettlementproposal"><a class="header" href="#vaultsettlementproposal">VaultSettlementProposal</a></h3>
<p>Contains all parameters for a batch settlement proposal in the yield distribution system</p>
<p><em>Settlement proposals implement a cooldown mechanism for security, allowing guardians to verify
yield calculations before execution. Once executed, the proposal triggers kToken minting/burning to
distribute yield or account for losses, maintaining the 1:1 backing ratio across all kTokens.</em></p>
<pre><code class="language-solidity">struct VaultSettlementProposal {
    address asset;
    address vault;
    bytes32 batchId;
    uint256 totalAssets;
    uint256 netted;
    uint256 yield;
    bool profit;
    uint256 executeAfter;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikbatchreceiver"><a class="header" href="#ikbatchreceiver">IkBatchReceiver</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkBatchReceiver.sol">Git Source</a></p>
<p>Interface for kBatchReceiver</p>
<h2 id="functions-12"><a class="header" href="#functions-12">Functions</a></h2>
<h3 id="kminter"><a class="header" href="#kminter">kMinter</a></h3>
<p>Retrieves the address of the kMinter contract authorized to interact with this receiver</p>
<p><em>Returns the immutable kMinter address set during receiver deployment. This address has
exclusive permission to call pullAssets() and rescueAssets(), ensuring only the originating
kMinter can manage asset distribution for this batch. Critical for maintaining access control
and preventing unauthorized asset movements during the redemption settlement process.</em></p>
<pre><code class="language-solidity">function kMinter() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the kMinter contract with administrative permissions over this receiver</td></tr>
</tbody></table>
</div>
<h3 id="asset-1"><a class="header" href="#asset-1">asset</a></h3>
<p>Retrieves the underlying asset contract address managed by this receiver</p>
<p><em>Returns the asset address configured during initialization (e.g., USDC, WBTC). This
determines which token type the receiver will distribute to redemption users. The asset type
must match the asset that was originally deposited and requested for redemption in the batch.</em></p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address of the underlying asset this receiver distributes</td></tr>
</tbody></table>
</div>
<h3 id="batchid"><a class="header" href="#batchid">batchId</a></h3>
<p>Retrieves the unique batch identifier this receiver serves</p>
<p><em>Returns the batch ID set during initialization, which links this receiver to a specific
batch of redemption requests. Used for validation when pulling assets to ensure operations
are performed on the correct batch. Essential for maintaining batch isolation and preventing
cross-contamination between different settlement periods.</em></p>
<pre><code class="language-solidity">function batchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>The unique batch identifier as a bytes32 hash</td></tr>
</tbody></table>
</div>
<h3 id="pullassets"><a class="header" href="#pullassets">pullAssets</a></h3>
<p>Transfers settled assets from the receiver to a redemption user completing their withdrawal</p>
<p><em>This is the core asset distribution function that fulfills redemption requests after batch settlement.
The process works as follows: (1) kMinter calls this function with user's proportional share, (2) receiver
validates the batch ID matches to prevent cross-batch contamination, (3) assets are transferred directly
to the user completing their redemption. Only callable by the authorized kMinter contract to maintain strict
access control. This function is typically called multiple times per batch as individual users claim their
settled redemptions, ensuring fair and orderly asset distribution.</em></p>
<pre><code class="language-solidity">function pullAssets(address receiver, uint256 amount, bytes32 _batchId) external;
</code></pre>
<h2 id="events-3"><a class="header" href="#events-3">Events</a></h2>
<h3 id="batchreceiverinitialized"><a class="header" href="#batchreceiverinitialized">BatchReceiverInitialized</a></h3>
<p>Emitted when a new batch receiver is initialized and ready for asset distribution</p>
<p><em>This event marks the successful deployment and configuration of a minimal proxy receiver
for a specific batch. Essential for tracking the lifecycle of batch settlement processes and
enabling off-chain systems to monitor when settlement assets can begin flowing to receivers.</em></p>
<pre><code class="language-solidity">event BatchReceiverInitialized(address indexed kMinter, bytes32 indexed batchId, address asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kMinter</code></td><td><code>address</code></td><td>The address of the kMinter contract authorized to interact with this receiver</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The unique identifier of the batch this receiver will serve</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address (USDC, WBTC, etc.) this receiver will distribute</td></tr>
</tbody></table>
</div>
<h3 id="pulledassets"><a class="header" href="#pulledassets">PulledAssets</a></h3>
<p>Emitted when assets are successfully distributed from the receiver to a redemption user</p>
<p><em>This event tracks the actual fulfillment of redemption requests, recording when users
receive their settled assets. Critical for reconciliation and ensuring all batch participants
receive their proportional share during the distribution phase.</em></p>
<pre><code class="language-solidity">event PulledAssets(address indexed receiver, address indexed asset, uint256 amount);
</code></pre>
<h3 id="rescuedassets-2"><a class="header" href="#rescuedassets-2">RescuedAssets</a></h3>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<h3 id="rescuedeth-2"><a class="header" href="#rescuedeth-2">RescuedETH</a></h3>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that received the distributed assets (the redeeming user)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset contract address that was transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets successfully distributed to the receiver</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets-2"><a class="header" href="#rescuedassets-2">RescuedAssets</a></h3>
<p>Emitted when accidentally sent ERC20 tokens are rescued from the receiver contract</p>
<p><em>Provides a safety mechanism for recovering tokens that were mistakenly sent to the receiver
outside of normal operations. This prevents permanent loss of assets while maintaining security.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<h3 id="onlykminter-2"><a class="header" href="#onlykminter-2">OnlyKMinter</a></h3>
<pre><code class="language-solidity">error OnlyKMinter();
</code></pre>
<h3 id="invalidbatchid"><a class="header" href="#invalidbatchid">InvalidBatchId</a></h3>
<pre><code class="language-solidity">error InvalidBatchId();
</code></pre>
<h3 id="zeroamount-1"><a class="header" href="#zeroamount-1">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikminter"><a class="header" href="#ikminter">IkMinter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkMinter.sol">Git Source</a></p>
<p>Interface for kMinter</p>
<h2 id="functions-13"><a class="header" href="#functions-13">Functions</a></h2>
<h3 id="mint"><a class="header" href="#mint">mint</a></h3>
<p>Executes institutional minting of kTokens through immediate 1:1 issuance against deposited assets</p>
<p><em>This function enables qualified institutions to mint kTokens by depositing underlying assets. The process
involves: (1) transferring assets from the caller to kAssetRouter, (2) pushing assets into the current batch
of the designated DN vault for yield generation, and (3) immediately minting an equivalent amount of kTokens
to the recipient. Unlike retail operations, institutional mints bypass share-based accounting and provide
immediate token issuance without waiting for batch settlement. The deposited assets are tracked separately
to maintain the 1:1 backing ratio and will participate in vault yield strategies through the batch system.</em></p>
<pre><code class="language-solidity">function mint(address asset, address to, uint256 amount) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to deposit (must be registered in the protocol)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the newly minted kTokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of underlying asset to deposit and kTokens to mint (1:1 ratio)</td></tr>
</tbody></table>
</div>
<h3 id="requestredeem"><a class="header" href="#requestredeem">requestRedeem</a></h3>
<p>Initiates a two-phase institutional redemption by creating a batch request for underlying asset
withdrawal</p>
<p><em>This function implements the first phase of the redemption process for qualified institutions. The workflow
consists of: (1) transferring kTokens from the caller to this contract for escrow (not burned yet), (2)
generating
a unique request ID for tracking, (3) creating a RedeemRequest struct with PENDING status, (4) registering the
request with kAssetRouter for batch processing. The kTokens remain in escrow until the batch is settled and the
user calls redeem() to complete the process. This two-phase approach is necessary because redemptions are
processed
in batches through the DN vault system, which requires waiting for batch settlement to ensure proper asset
availability and yield distribution. The request can be cancelled before batch closure/settlement.</em></p>
<pre><code class="language-solidity">function requestRedeem(address asset, address to, uint256 amount) external payable returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to redeem (must match the kToken's underlying asset)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the underlying assets after batch settlement</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens to redeem (will receive equivalent underlying assets)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>A unique bytes32 identifier for tracking and executing this redemption request</td></tr>
</tbody></table>
</div>
<h3 id="redeem-2"><a class="header" href="#redeem-2">redeem</a></h3>
<p>Completes the second phase of institutional redemption by executing a settled batch request</p>
<p><em>This function finalizes the redemption process initiated by requestRedeem(). It can only be called after
the batch containing this request has been settled through the kAssetRouter settlement process. The execution
involves: (1) validating the request exists and is in PENDING status, (2) updating the request status to
REDEEMED,
(3) removing the request from tracking, (4) burning the escrowed kTokens permanently, (5) instructing the
kBatchReceiver contract to transfer the underlying assets to the recipient. The kBatchReceiver is a minimal
proxy
deployed per batch that holds the settled assets and ensures isolated distribution. This function will revert if
the batch is not yet settled, ensuring assets are only distributed when available. The separation between
request
and redemption phases allows for efficient batch processing of multiple redemptions while maintaining asset
safety.</em></p>
<pre><code class="language-solidity">function redeem(bytes32 requestId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to execute (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="cancelrequest"><a class="header" href="#cancelrequest">cancelRequest</a></h3>
<p>Cancels a pending redemption request and returns the escrowed kTokens to the user</p>
<p><em>This function allows institutions to cancel their redemption requests before the batch is closed or
settled.
The cancellation process involves: (1) validating the request exists and is in PENDING status, (2) checking that
the batch is neither closed nor settled (once closed, cancellation is not possible as the batch is being
processed),
(3) updating the request status to CANCELLED, (4) removing the request from tracking, (5) returning the escrowed
kTokens back to the original requester. This mechanism provides flexibility for institutions to manage their
liquidity needs, allowing them to reverse redemption decisions if market conditions change or if they need
immediate
access to their kTokens. The function enforces strict timing constraints - cancellation is only permitted while
the
batch remains open, ensuring batch integrity and preventing manipulation of settled redemptions.</em></p>
<pre><code class="language-solidity">function cancelRequest(bytes32 requestId) external payable;
</code></pre>
<h3 id="setpaused-1"><a class="header" href="#setpaused-1">setPaused</a></h3>
<pre><code class="language-solidity">function setPaused(bool paused) external;
</code></pre>
<h3 id="ispaused-1"><a class="header" href="#ispaused-1">isPaused</a></h3>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="getredeemrequest"><a class="header" href="#getredeemrequest">getRedeemRequest</a></h3>
<p>Retrieves details of a specific redemption request</p>
<p><em>Returns the complete RedeemRequest struct containing all request information</em></p>
<pre><code class="language-solidity">function getRedeemRequest(bytes32 requestId) external view returns (RedeemRequest memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>RedeemRequest</code></td><td>The complete RedeemRequest struct with status, amounts, and batch information</td></tr>
</tbody></table>
</div>
<h3 id="getuserrequests"><a class="header" href="#getuserrequests">getUserRequests</a></h3>
<p>Gets all redemption request IDs for a specific user</p>
<p><em>Returns request IDs from the user's enumerable set for efficient tracking</em></p>
<pre><code class="language-solidity">function getUserRequests(address user) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The user address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of request IDs belonging to the user</td></tr>
</tbody></table>
</div>
<h3 id="getrequestcounter"><a class="header" href="#getrequestcounter">getRequestCounter</a></h3>
<p>Gets the current request counter value</p>
<p><em>Returns the monotonically increasing counter used for generating unique request IDs</em></p>
<pre><code class="language-solidity">function getRequestCounter() external view returns (uint256);
</code></pre>
<h2 id="events-4"><a class="header" href="#events-4">Events</a></h2>
<h3 id="initialized-1"><a class="header" href="#initialized-1">Initialized</a></h3>
<pre><code class="language-solidity">event Initialized(address indexed registry, address indexed owner, address admin, address emergencyAdmin);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of assets locked in the protocol</td></tr>
</tbody></table>
</div>
<h2 id="events-5"><a class="header" href="#events-5">Events</a></h2>
<h3 id="contractinitialized-1"><a class="header" href="#contractinitialized-1">ContractInitialized</a></h3>
<p>Emitted when the kMinter contract is initialized</p>
<pre><code class="language-solidity">event ContractInitialized(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The address of the registry contract used for protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="minted"><a class="header" href="#minted">Minted</a></h3>
<p>Emitted when kTokens are successfully minted for an institution</p>
<pre><code class="language-solidity">event Minted(address indexed to, uint256 amount, bytes32 batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that received the minted kTokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens minted (matches deposited asset amount)</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier where the deposited assets were allocated</td></tr>
</tbody></table>
</div>
<h3 id="redeemrequestcreated"><a class="header" href="#redeemrequestcreated">RedeemRequestCreated</a></h3>
<p>Emitted when a new redemption request is created and enters the batch queue</p>
<pre><code class="language-solidity">event RedeemRequestCreated(
    bytes32 indexed requestId,
    address indexed user,
    address indexed kToken,
    uint256 amount,
    address recipient,
    bytes32 batchId
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier assigned to this redemption request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address that initiated the redemption request</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The kToken contract address being redeemed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens being redeemed</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address that will receive the underlying assets</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier this request is associated with</td></tr>
</tbody></table>
</div>
<h3 id="redeemed"><a class="header" href="#redeemed">Redeemed</a></h3>
<p>Emitted when a redemption request is successfully executed after batch settlement</p>
<pre><code class="language-solidity">event Redeemed(bytes32 indexed requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the executed redemption request</td></tr>
</tbody></table>
</div>
<h3 id="cancelled"><a class="header" href="#cancelled">Cancelled</a></h3>
<p>Emitted when a pending redemption request is cancelled before batch closure</p>
<pre><code class="language-solidity">event Cancelled(bytes32 indexed requestId);
</code></pre>
<h2 id="errors-5"><a class="header" href="#errors-5">Errors</a></h2>
<h3 id="zeroamount-2"><a class="header" href="#zeroamount-2">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="batchnotsettled"><a class="header" href="#batchnotsettled">BatchNotSettled</a></h3>
<pre><code class="language-solidity">error BatchNotSettled();
</code></pre>
<h3 id="insufficientbalance"><a class="header" href="#insufficientbalance">InsufficientBalance</a></h3>
<pre><code class="language-solidity">error InsufficientBalance();
</code></pre>
<h3 id="requestnotfound"><a class="header" href="#requestnotfound">RequestNotFound</a></h3>
<pre><code class="language-solidity">error RequestNotFound();
</code></pre>
<h3 id="requestnoteligible"><a class="header" href="#requestnoteligible">RequestNotEligible</a></h3>
<pre><code class="language-solidity">error RequestNotEligible();
</code></pre>
<h3 id="requestalreadyprocessed"><a class="header" href="#requestalreadyprocessed">RequestAlreadyProcessed</a></h3>
<pre><code class="language-solidity">error RequestAlreadyProcessed();
</code></pre>
<h3 id="onlyinstitution"><a class="header" href="#onlyinstitution">OnlyInstitution</a></h3>
<pre><code class="language-solidity">error OnlyInstitution();
</code></pre>
<h3 id="batchclosed"><a class="header" href="#batchclosed">BatchClosed</a></h3>
<pre><code class="language-solidity">error BatchClosed();
</code></pre>
<h3 id="batchsettled-1"><a class="header" href="#batchsettled-1">BatchSettled</a></h3>
<pre><code class="language-solidity">error BatchSettled();
</code></pre>
<h3 id="contractpaused-1"><a class="header" href="#contractpaused-1">ContractPaused</a></h3>
<pre><code class="language-solidity">error ContractPaused();
</code></pre>
<h3 id="invalidasset-1"><a class="header" href="#invalidasset-1">InvalidAsset</a></h3>
<pre><code class="language-solidity">error InvalidAsset();
</code></pre>
<h2 id="structs-5"><a class="header" href="#structs-5">Structs</a></h2>
<h3 id="redeemrequest"><a class="header" href="#redeemrequest">RedeemRequest</a></h3>
<p>Contains all information related to a redemption request</p>
<p><em>Stored on-chain to track redemption lifecycle and enable proper asset distribution</em></p>
<pre><code class="language-solidity">struct RedeemRequest {
    address user;
    uint256 amount;
    address asset;
    uint64 requestTimestamp;
    RequestStatus status;
    bytes32 batchId;
    address recipient;
}
</code></pre>
<h2 id="enums"><a class="header" href="#enums">Enums</a></h2>
<h3 id="requeststatus"><a class="header" href="#requeststatus">RequestStatus</a></h3>
<p>Represents the lifecycle status of a redemption request</p>
<p><em>Used to track the progression of redemption requests through the batch system</em></p>
<pre><code class="language-solidity">enum RequestStatus {
    PENDING,
    REDEEMED,
    CANCELLED
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikregistry"><a class="header" href="#ikregistry">IkRegistry</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkRegistry.sol">Git Source</a></p>
<h2 id="functions-14"><a class="header" href="#functions-14">Functions</a></h2>
<h3 id="setsingletoncontract"><a class="header" href="#setsingletoncontract">setSingletonContract</a></h3>
<pre><code class="language-solidity">function setSingletonContract(bytes32 id, address contractAddress) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Unique contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>Address of the singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="registerasset"><a class="header" href="#registerasset">registerAsset</a></h3>
<pre><code class="language-solidity">function registerAsset(address asset, bytes32 id) external returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td><code>string</code></td><td>The name for the kToken (e.g., "KAM USDC")</td></tr>
<tr><td><code>symbol</code></td><td><code>string</code></td><td>The symbol for the kToken (e.g., "kUSDC")</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset contract address to register</td></tr>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>The unique identifier for singleton asset storage (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The deployed kToken contract address</td></tr>
</tbody></table>
</div>
<h3 id="registervault"><a class="header" href="#registervault">registerVault</a></h3>
<pre><code class="language-solidity">function registerVault(address vault, VaultType type_, address asset) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to register</td></tr>
<tr><td><code>type_</code></td><td><code>VaultType</code></td><td>The vault classification type (DN, ALPHA, BETA, etc.) determining its role</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address this vault will manage</td></tr>
</tbody></table>
</div>
<h3 id="registeradapter"><a class="header" href="#registeradapter">registerAdapter</a></h3>
<pre><code class="language-solidity">function registerAdapter(address vault, address adapter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="removeadapter"><a class="header" href="#removeadapter">removeAdapter</a></h3>
<pre><code class="language-solidity">function removeAdapter(address vault, address adapter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to remove the adapter from</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to remove</td></tr>
</tbody></table>
</div>
<h3 id="grantinstitutionrole"><a class="header" href="#grantinstitutionrole">grantInstitutionRole</a></h3>
<p>Grants institution role to enable privileged protocol access</p>
<p><em>Only callable by VENDOR_ROLE. Institutions gain access to kMinter and other premium features.</em></p>
<pre><code class="language-solidity">function grantInstitutionRole(address institution_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>institution_</code></td><td><code>address</code></td><td>The address to grant institution privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantvendorrole"><a class="header" href="#grantvendorrole">grantVendorRole</a></h3>
<p>Grants vendor role for vendor management capabilities</p>
<p><em>Only callable by ADMIN_ROLE. Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function grantVendorRole(address vendor_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vendor_</code></td><td><code>address</code></td><td>The address to grant vendor privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantrelayerrole"><a class="header" href="#grantrelayerrole">grantRelayerRole</a></h3>
<p>Grants relayer role for external vault operations</p>
<p><em>Only callable by ADMIN_ROLE. Relayers manage external vaults and set hurdle rates.</em></p>
<pre><code class="language-solidity">function grantRelayerRole(address relayer_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>relayer_</code></td><td><code>address</code></td><td>The address to grant relayer privileges</td></tr>
</tbody></table>
</div>
<h3 id="getcontractbyid"><a class="header" href="#getcontractbyid">getContractById</a></h3>
<p>Retrieves a singleton contract address by identifier</p>
<p><em>Reverts if contract not registered. Used for protocol contract discovery.</em></p>
<pre><code class="language-solidity">function getContractById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address</td></tr>
</tbody></table>
</div>
<h3 id="getassetbyid"><a class="header" href="#getassetbyid">getAssetById</a></h3>
<p>Retrieves a singleton asset address by identifier</p>
<p><em>Reverts if asset not registered. Provides named access to common assets.</em></p>
<pre><code class="language-solidity">function getAssetById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Asset identifier (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<h3 id="getallassets"><a class="header" href="#getallassets">getAllAssets</a></h3>
<p>Gets all protocol-supported asset addresses</p>
<p><em>Returns the complete whitelist of supported underlying assets.</em></p>
<pre><code class="language-solidity">function getAllAssets() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of all supported asset addresses</td></tr>
</tbody></table>
</div>
<h3 id="getcorecontracts"><a class="header" href="#getcorecontracts">getCoreContracts</a></h3>
<p>Retrieves core protocol contract addresses in one call</p>
<p><em>Optimized getter for frequently accessed contracts. Reverts if either not set.</em></p>
<pre><code class="language-solidity">function getCoreContracts() external view returns (address kMinter, address kAssetRouter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kMinter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
<tr><td><code>kAssetRouter</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="getvaultsbyasset"><a class="header" href="#getvaultsbyasset">getVaultsByAsset</a></h3>
<p>Gets all vaults that support a specific asset</p>
<p><em>Enables discovery of all vaults capable of handling an asset across different types.</em></p>
<pre><code class="language-solidity">function getVaultsByAsset(address asset) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of vault addresses supporting the asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultbyassetandtype"><a class="header" href="#getvaultbyassetandtype">getVaultByAssetAndType</a></h3>
<p>Retrieves the primary vault for an asset-type combination</p>
<p><em>Used for routing operations to the appropriate vault. Reverts if not found.</em></p>
<pre><code class="language-solidity">function getVaultByAssetAndType(address asset, uint8 vaultType) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>vaultType</code></td><td><code>uint8</code></td><td>The vault type classification</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The vault address for the asset-type pair</td></tr>
</tbody></table>
</div>
<h3 id="getvaulttype"><a class="header" href="#getvaulttype">getVaultType</a></h3>
<p>Gets the classification type of a vault</p>
<p><em>Returns the VaultType enum value for routing and strategy selection.</em></p>
<pre><code class="language-solidity">function getVaultType(address vault) external view returns (uint8);
</code></pre>
<h3 id="isrelayer"><a class="header" href="#isrelayer">isRelayer</a></h3>
<pre><code class="language-solidity">function isRelayer(address account) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isemergencyadmin"><a class="header" href="#isemergencyadmin">isEmergencyAdmin</a></h3>
<p>Checks if an address has emergency admin privileges</p>
<p><em>Emergency admin can perform critical safety operations.</em></p>
<pre><code class="language-solidity">function isEmergencyAdmin(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has EMERGENCY_ADMIN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isguardian"><a class="header" href="#isguardian">isGuardian</a></h3>
<pre><code class="language-solidity">function isGuardian(address account) external view returns (bool);
</code></pre>
<h3 id="isregisteredasset"><a class="header" href="#isregisteredasset">isRegisteredAsset</a></h3>
<pre><code class="language-solidity">function isRegisteredAsset(address asset) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has RELAYER_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isinstitution"><a class="header" href="#isinstitution">isInstitution</a></h3>
<p>Checks if an address is a qualified institution</p>
<p><em>Institutions have access to privileged operations like kMinter.</em></p>
<pre><code class="language-solidity">function isInstitution(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has INSTITUTION_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isvendor"><a class="header" href="#isvendor">isVendor</a></h3>
<p>Checks if an address has vendor privileges</p>
<p><em>Vendors can grant institution roles and manage vendor vaults.</em></p>
<pre><code class="language-solidity">function isVendor(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has VENDOR_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isasset"><a class="header" href="#isasset">isAsset</a></h3>
<p>Checks if an asset is supported by the protocol</p>
<p><em>Used for validation before operations. Checks supportedAssets set membership.</em></p>
<pre><code class="language-solidity">function isAsset(address asset) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if asset is in the protocol whitelist</td></tr>
</tbody></table>
</div>
<h3 id="isvault"><a class="header" href="#isvault">isVault</a></h3>
<p>Checks if a vault is registered in the protocol</p>
<p><em>Used for validation before vault operations. Checks allVaults set membership.</em></p>
<pre><code class="language-solidity">function isVault(address vault) external view returns (bool);
</code></pre>
<h3 id="issingletoncontract"><a class="header" href="#issingletoncontract">isSingletonContract</a></h3>
<pre><code class="language-solidity">function isSingletonContract(address contractAddress) external view returns (bool);
</code></pre>
<h3 id="getadapters"><a class="header" href="#getadapters">getAdapters</a></h3>
<p>Gets all adapters registered for a specific vault</p>
<p><em>Returns external protocol integrations enabling yield strategies.</em></p>
<pre><code class="language-solidity">function getAdapters(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of adapter addresses for the vault</td></tr>
</tbody></table>
</div>
<h3 id="isadapterregistered"><a class="header" href="#isadapterregistered">isAdapterRegistered</a></h3>
<pre><code class="language-solidity">function isAdapterRegistered(address adapter) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to check</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered for the vault</td></tr>
</tbody></table>
</div>
<h3 id="getvaultassets"><a class="header" href="#getvaultassets">getVaultAssets</a></h3>
<p>Gets all assets managed by a specific vault</p>
<p><em>Most vaults manage single asset, some (like kMinter) handle multiple.</em></p>
<pre><code class="language-solidity">function getVaultAssets(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of asset addresses the vault manages</td></tr>
</tbody></table>
</div>
<h3 id="assettoktoken"><a class="header" href="#assettoktoken">assetToKToken</a></h3>
<p>Gets the kToken address for a specific underlying asset</p>
<p><em>Critical for minting/redemption operations. Reverts if no kToken exists.</em></p>
<pre><code class="language-solidity">function assetToKToken(address asset) external view returns (address);
</code></pre>
<h2 id="events-5"><a class="header" href="#events-5">Events</a></h2>
<h3 id="singletoncontractset"><a class="header" href="#singletoncontractset">SingletonContractSet</a></h3>
<p>Emitted when a singleton contract is registered in the protocol</p>
<pre><code class="language-solidity">event SingletonContractSet(bytes32 indexed id, address indexed contractAddress);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>The unique identifier for the contract (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>The address of the registered singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="vaultregistered"><a class="header" href="#vaultregistered">VaultRegistered</a></h3>
<p>Emitted when a new vault is registered in the protocol</p>
<pre><code class="language-solidity">event VaultRegistered(address indexed vault, address indexed asset, VaultType indexed vaultType);
</code></pre>
<h3 id="vaultremoved"><a class="header" href="#vaultremoved">VaultRemoved</a></h3>
<pre><code class="language-solidity">event VaultRemoved(address indexed vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset the vault manages</td></tr>
<tr><td><code>vaultType</code></td><td><code>VaultType</code></td><td>The classification type of the vault</td></tr>
</tbody></table>
</div>
<h3 id="vaultremoved"><a class="header" href="#vaultremoved">VaultRemoved</a></h3>
<p>Emitted when a vault is removed from the protocol</p>
<pre><code class="language-solidity">event VaultRemoved(address indexed vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address being removed</td></tr>
</tbody></table>
</div>
<h3 id="assetregistered"><a class="header" href="#assetregistered">AssetRegistered</a></h3>
<p>Emitted when an asset and its kToken are registered</p>
<pre><code class="language-solidity">event AssetRegistered(address indexed asset, address indexed kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="assetsupported"><a class="header" href="#assetsupported">AssetSupported</a></h3>
<p>Emitted when an asset is added to the supported set</p>
<pre><code class="language-solidity">event AssetSupported(address indexed asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The newly supported asset address</td></tr>
</tbody></table>
</div>
<h3 id="adapterregistered"><a class="header" href="#adapterregistered">AdapterRegistered</a></h3>
<p>Emitted when an adapter is registered for a vault</p>
<pre><code class="language-solidity">event AdapterRegistered(address indexed vault, address indexed adapter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="adapterremoved"><a class="header" href="#adapterremoved">AdapterRemoved</a></h3>
<p>Emitted when an adapter is removed from a vault</p>
<pre><code class="language-solidity">event AdapterRemoved(address indexed vault, address indexed adapter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault losing the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter being removed</td></tr>
</tbody></table>
</div>
<h3 id="ktokendeployed"><a class="header" href="#ktokendeployed">KTokenDeployed</a></h3>
<pre><code class="language-solidity">event KTokenDeployed(address indexed kTokenContract);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kTokenContract</code></td><td><code>address</code></td><td>The deployed kToken address</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>The kToken name</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>The kToken symbol</td></tr>
<tr><td><code>decimals_</code></td><td><code>uint8</code></td><td>The kToken decimals (matches underlying)</td></tr>
</tbody></table>
</div>
<h3 id="ktokenimplementationset"><a class="header" href="#ktokenimplementationset">KTokenImplementationSet</a></h3>
<p>Emitted when the kToken implementation is updated</p>
<pre><code class="language-solidity">event KTokenImplementationSet(address indexed implementation);
</code></pre>
<h3 id="rescuedassets-3"><a class="header" href="#rescuedassets-3">RescuedAssets</a></h3>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<h3 id="rescuedeth-3"><a class="header" href="#rescuedeth-3">RescuedETH</a></h3>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<h2 id="errors-6"><a class="header" href="#errors-6">Errors</a></h2>
<h3 id="zeroaddress-3"><a class="header" href="#zeroaddress-3">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The rescued asset address</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth-3"><a class="header" href="#rescuedeth-3">RescuedETH</a></h3>
<p>Emitted when ETH is rescued from the contract</p>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<h3 id="assetnotsupported-2"><a class="header" href="#assetnotsupported-2">AssetNotSupported</a></h3>
<pre><code class="language-solidity">error AssetNotSupported();
</code></pre>
<h3 id="contractnotset"><a class="header" href="#contractnotset">ContractNotSet</a></h3>
<pre><code class="language-solidity">error ContractNotSet();
</code></pre>
<h3 id="adapternotregistered"><a class="header" href="#adapternotregistered">AdapterNotRegistered</a></h3>
<pre><code class="language-solidity">error AdapterNotRegistered();
</code></pre>
<h3 id="invalidadapter"><a class="header" href="#invalidadapter">InvalidAdapter</a></h3>
<pre><code class="language-solidity">error InvalidAdapter();
</code></pre>
<h3 id="adapteralreadyset"><a class="header" href="#adapteralreadyset">AdapterAlreadySet</a></h3>
<pre><code class="language-solidity">error AdapterAlreadySet();
</code></pre>
<h3 id="saltalreadyused"><a class="header" href="#saltalreadyused">SaltAlreadyUsed</a></h3>
<pre><code class="language-solidity">error SaltAlreadyUsed();
</code></pre>
<h3 id="tokeninitializationfailed"><a class="header" href="#tokeninitializationfailed">TokenInitializationFailed</a></h3>
<pre><code class="language-solidity">error TokenInitializationFailed();
</code></pre>
<h3 id="ktokennotregistered"><a class="header" href="#ktokennotregistered">KTokenNotRegistered</a></h3>
<pre><code class="language-solidity">error KTokenNotRegistered();
</code></pre>
<h3 id="invalidparameter"><a class="header" href="#invalidparameter">InvalidParameter</a></h3>
<pre><code class="language-solidity">error InvalidParameter();
</code></pre>
<h3 id="ktokenimplementationnotset"><a class="header" href="#ktokenimplementationnotset">KTokenImplementationNotSet</a></h3>
<pre><code class="language-solidity">error KTokenImplementationNotSet();
</code></pre>
<h3 id="minternotset"><a class="header" href="#minternotset">MinterNotSet</a></h3>
<pre><code class="language-solidity">error MinterNotSet();
</code></pre>
<h2 id="enums-1"><a class="header" href="#enums-1">Enums</a></h2>
<h3 id="vaulttype"><a class="header" href="#vaulttype">VaultType</a></h3>
<pre><code class="language-solidity">enum VaultType {
    MINTER,
    DN,
    ALPHA,
    BETA,
    GAMMA,
    DELTA,
    EPSILON,
    ZETA,
    ETA,
    THETA,
    IOTA,
    KAPPA,
    LAMBDA,
    MU,
    NU,
    XI,
    OMICRON,
    PI,
    RHO,
    SIGMA,
    TAU,
    UPSILON,
    PHI,
    CHI,
    PSI,
    OMEGA,
    VAULT_27,
    VAULT_28,
    VAULT_29,
    VAULT_30,
    VAULT_31,
    VAULT_32,
    VAULT_33,
    VAULT_34,
    VAULT_35,
    VAULT_36,
    VAULT_37,
    VAULT_38,
    VAULT_39,
    VAULT_40,
    VAULT_41,
    VAULT_42,
    VAULT_43,
    VAULT_44,
    VAULT_45,
    VAULT_46,
    VAULT_47,
    VAULT_48,
    VAULT_49,
    VAULT_50,
    VAULT_51,
    VAULT_52,
    VAULT_53,
    VAULT_54,
    VAULT_55,
    VAULT_56,
    VAULT_57,
    VAULT_58,
    VAULT_59,
    VAULT_60,
    VAULT_61,
    VAULT_62,
    VAULT_63,
    VAULT_64,
    VAULT_65,
    VAULT_66,
    VAULT_67,
    VAULT_68,
    VAULT_69,
    VAULT_70,
    VAULT_71,
    VAULT_72,
    VAULT_73,
    VAULT_74,
    VAULT_75,
    VAULT_76,
    VAULT_77,
    VAULT_78,
    VAULT_79,
    VAULT_80,
    VAULT_81,
    VAULT_82,
    VAULT_83,
    VAULT_84,
    VAULT_85,
    VAULT_86,
    VAULT_87,
    VAULT_88,
    VAULT_89,
    VAULT_90,
    VAULT_91,
    VAULT_92,
    VAULT_93,
    VAULT_94,
    VAULT_95,
    VAULT_96,
    VAULT_97,
    VAULT_98,
    VAULT_99,
    VAULT_100,
    VAULT_101,
    VAULT_102,
    VAULT_103,
    VAULT_104,
    VAULT_105,
    VAULT_106,
    VAULT_107,
    VAULT_108,
    VAULT_109,
    VAULT_110,
    VAULT_111,
    VAULT_112,
    VAULT_113,
    VAULT_114,
    VAULT_115,
    VAULT_116,
    VAULT_117,
    VAULT_118,
    VAULT_119,
    VAULT_120,
    VAULT_121,
    VAULT_122,
    VAULT_123,
    VAULT_124,
    VAULT_125,
    VAULT_126,
    VAULT_127,
    VAULT_128,
    VAULT_129,
    VAULT_130,
    VAULT_131,
    VAULT_132,
    VAULT_133,
    VAULT_134,
    VAULT_135,
    VAULT_136,
    VAULT_137,
    VAULT_138,
    VAULT_139,
    VAULT_140,
    VAULT_141,
    VAULT_142,
    VAULT_143,
    VAULT_144,
    VAULT_145,
    VAULT_146,
    VAULT_147,
    VAULT_148,
    VAULT_149,
    VAULT_150,
    VAULT_151,
    VAULT_152,
    VAULT_153,
    VAULT_154,
    VAULT_155,
    VAULT_156,
    VAULT_157,
    VAULT_158,
    VAULT_159,
    VAULT_160,
    VAULT_161,
    VAULT_162,
    VAULT_163,
    VAULT_164,
    VAULT_165,
    VAULT_166,
    VAULT_167,
    VAULT_168,
    VAULT_169,
    VAULT_170,
    VAULT_171,
    VAULT_172,
    VAULT_173,
    VAULT_174,
    VAULT_175,
    VAULT_176,
    VAULT_177,
    VAULT_178,
    VAULT_179,
    VAULT_180,
    VAULT_181,
    VAULT_182,
    VAULT_183,
    VAULT_184,
    VAULT_185,
    VAULT_186,
    VAULT_187,
    VAULT_188,
    VAULT_189,
    VAULT_190,
    VAULT_191,
    VAULT_192,
    VAULT_193,
    VAULT_194,
    VAULT_195,
    VAULT_196,
    VAULT_197,
    VAULT_198,
    VAULT_199,
    VAULT_200,
    VAULT_201,
    VAULT_202,
    VAULT_203,
    VAULT_204,
    VAULT_205,
    VAULT_206,
    VAULT_207,
    VAULT_208,
    VAULT_209,
    VAULT_210,
    VAULT_211,
    VAULT_212,
    VAULT_213,
    VAULT_214,
    VAULT_215,
    VAULT_216,
    VAULT_217,
    VAULT_218,
    VAULT_219,
    VAULT_220,
    VAULT_221,
    VAULT_222,
    VAULT_223,
    VAULT_224,
    VAULT_225,
    VAULT_226,
    VAULT_227,
    VAULT_228,
    VAULT_229,
    VAULT_230,
    VAULT_231,
    VAULT_232,
    VAULT_233,
    VAULT_234,
    VAULT_235,
    VAULT_236,
    VAULT_237,
    VAULT_238,
    VAULT_239,
    VAULT_240,
    VAULT_241,
    VAULT_242,
    VAULT_243,
    VAULT_244,
    VAULT_245,
    VAULT_246,
    VAULT_247,
    VAULT_248,
    VAULT_249,
    VAULT_250,
    VAULT_251,
    VAULT_252,
    VAULT_253,
    VAULT_254,
    VAULT_255
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikstakingvault"><a class="header" href="#ikstakingvault">IkStakingVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkStakingVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/interfaces/IkStakingVault.sol//src/interfaces/IVault.sol/interface.IVault.html">IVault</a>, <a href="src/interfaces/IkStakingVault.sol//src/interfaces/modules/IVaultReader.sol/interface.IVaultReader.html">IVaultReader</a></p>
<p>Comprehensive interface combining retail staking operations with ERC20 share tokens and vault state reading</p>
<p><em>This interface aggregates all kStakingVault functionality by extending IVault (staking/batch/claims/fees) and
IVaultReader (state queries) while adding standard ERC20 operations for stkToken management. The interface provides
a complete view of vault capabilities: (1) Staking Operations: Full request/claim lifecycle for retail users,
(2) Batch Management: Lifecycle control for settlement periods, (3) Share Tokens: Standard ERC20 functionality for
stkTokens that accrue yield, (4) State Reading: Comprehensive vault metrics and calculations, (5) Fee Management:
Performance and management fee configuration. This unified interface enables complete vault interaction through a
single contract, simplifying integration for front-ends and external protocols while maintaining modularity through
interface composition. The combination of vault-specific operations with standard ERC20 compatibility ensures
stkTokens work seamlessly with existing DeFi infrastructure while providing specialized staking functionality.</em></p>
<h2 id="functions-18"><a class="header" href="#functions-18">Functions</a></h2>
<h3 id="owner"><a class="header" href="#owner">owner</a></h3>
<p>Returns the owner of the contract</p>
<pre><code class="language-solidity">function owner() external view returns (address);
</code></pre>
<h3 id="name-2"><a class="header" href="#name-2">name</a></h3>
<p>Returns the name of the token</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<h3 id="symbol"><a class="header" href="#symbol">symbol</a></h3>
<p>Returns the symbol of the token</p>
<pre><code class="language-solidity">function symbol() external view returns (string memory);
</code></pre>
<h3 id="decimals"><a class="header" href="#decimals">decimals</a></h3>
<p>Returns the decimals of the token</p>
<pre><code class="language-solidity">function decimals() external view returns (uint8);
</code></pre>
<h3 id="totalsupply"><a class="header" href="#totalsupply">totalSupply</a></h3>
<p>Returns the total supply of the token</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<h3 id="balanceof"><a class="header" href="#balanceof">balanceOf</a></h3>
<p>Returns the balance of the specified account</p>
<pre><code class="language-solidity">function balanceOf(address account) external view returns (uint256);
</code></pre>
<h3 id="transfer"><a class="header" href="#transfer">transfer</a></h3>
<p>Transfers tokens to the specified recipient</p>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) external returns (bool);
</code></pre>
<h3 id="allowance"><a class="header" href="#allowance">allowance</a></h3>
<p>Returns the remaining allowance that spender has to spend on behalf of owner</p>
<pre><code class="language-solidity">function allowance(address owner, address spender) external view returns (uint256);
</code></pre>
<h3 id="approve"><a class="header" href="#approve">approve</a></h3>
<p>Sets amount as the allowance of spender over the caller's tokens</p>
<pre><code class="language-solidity">function approve(address spender, uint256 amount) external returns (bool);
</code></pre>
<h3 id="transferfrom"><a class="header" href="#transferfrom">transferFrom</a></h3>
<p>Transfers tokens from sender to recipient using the allowance mechanism</p>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) external returns (bool);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="iktoken"><a class="header" href="#iktoken">IkToken</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/interfaces/IkToken.sol">Git Source</a></p>
<p>Interface for kToken with role-based minting and burning capabilities</p>
<p><em>Defines the standard interface for kToken implementations with ERC20 compatibility</em></p>
<h2 id="functions-19"><a class="header" href="#functions-19">Functions</a></h2>
<h3 id="mint-1"><a class="header" href="#mint-1">mint</a></h3>
<p>Creates new tokens and assigns them to the specified address</p>
<p><em>Only callable by addresses with MINTER_ROLE, emits Minted event</em></p>
<pre><code class="language-solidity">function mint(address to, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address that will receive the newly minted tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to create and assign</td></tr>
</tbody></table>
</div>
<h3 id="burn"><a class="header" href="#burn">burn</a></h3>
<p>Destroys tokens from the specified address</p>
<p><em>Only callable by addresses with MINTER_ROLE, emits Burned event</em></p>
<pre><code class="language-solidity">function burn(address from, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens will be destroyed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to destroy</td></tr>
</tbody></table>
</div>
<h3 id="burnfrom"><a class="header" href="#burnfrom">burnFrom</a></h3>
<p>Destroys tokens from an address using allowance mechanism</p>
<p><em>Reduces allowance and burns tokens, only callable by addresses with MINTER_ROLE</em></p>
<pre><code class="language-solidity">function burnFrom(address from, uint256 amount) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens will be destroyed</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens to destroy</td></tr>
</tbody></table>
</div>
<h3 id="name-3"><a class="header" href="#name-3">name</a></h3>
<p>Returns the name of the token</p>
<pre><code class="language-solidity">function name() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The name of the token as a string</td></tr>
</tbody></table>
</div>
<h3 id="symbol-1"><a class="header" href="#symbol-1">symbol</a></h3>
<p>Returns the symbol of the token</p>
<pre><code class="language-solidity">function symbol() external view returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The symbol of the token as a string</td></tr>
</tbody></table>
</div>
<h3 id="decimals-1"><a class="header" href="#decimals-1">decimals</a></h3>
<p>Returns the number of decimal places for the token</p>
<pre><code class="language-solidity">function decimals() external view returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The number of decimal places as uint8</td></tr>
</tbody></table>
</div>
<h3 id="totalsupply-1"><a class="header" href="#totalsupply-1">totalSupply</a></h3>
<p>Returns the total amount of tokens in existence</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total supply of tokens</td></tr>
</tbody></table>
</div>
<h3 id="balanceof-1"><a class="header" href="#balanceof-1">balanceOf</a></h3>
<p>Returns the token balance of a specific account</p>
<pre><code class="language-solidity">function balanceOf(address account) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account</code></td><td><code>address</code></td><td>The address to query the balance for</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The token balance of the specified account</td></tr>
</tbody></table>
</div>
<h3 id="transfer-1"><a class="header" href="#transfer-1">transfer</a></h3>
<p>Transfers tokens from the caller to another address</p>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to transfer tokens to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens to transfer</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the transfer succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="allowance-1"><a class="header" href="#allowance-1">allowance</a></h3>
<p>Returns the amount of tokens that spender is allowed to spend on behalf of owner</p>
<pre><code class="language-solidity">function allowance(address owner, address spender) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The address that owns the tokens</td></tr>
<tr><td><code>spender</code></td><td><code>address</code></td><td>The address that is approved to spend the tokens</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The amount of tokens the spender is allowed to spend</td></tr>
</tbody></table>
</div>
<h3 id="approve-1"><a class="header" href="#approve-1">approve</a></h3>
<p>Sets approval for another address to spend tokens on behalf of the caller</p>
<pre><code class="language-solidity">function approve(address spender, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>spender</code></td><td><code>address</code></td><td>The address that is approved to spend the tokens</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens the spender is approved to spend</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the approval succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="transferfrom-1"><a class="header" href="#transferfrom-1">transferFrom</a></h3>
<p>Transfers tokens from one address to another using allowance mechanism</p>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) external returns (bool success);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address to transfer tokens from</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address to transfer tokens to</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of tokens to transfer</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>success</code></td><td><code>bool</code></td><td>True if the transfer succeeded, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-3"><a class="header" href="#ispaused-3">isPaused</a></h3>
<p>Returns the current pause state of the contract</p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-1"><a class="header" href="#setpaused-1">setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Only callable by addresses with EMERGENCY_ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function setPaused(bool _isPaused) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_isPaused</code></td><td><code>bool</code></td><td>True to pause the contract, false to unpause</td></tr>
</tbody></table>
</div>
<h3 id="grantadminrole"><a class="header" href="#grantadminrole">grantAdminRole</a></h3>
<p>Grants administrative privileges to an address</p>
<p><em>Only callable by the contract owner</em></p>
<pre><code class="language-solidity">function grantAdminRole(address admin) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to grant admin role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeadminrole"><a class="header" href="#revokeadminrole">revokeAdminRole</a></h3>
<p>Revokes administrative privileges from an address</p>
<p><em>Only callable by the contract owner</em></p>
<pre><code class="language-solidity">function revokeAdminRole(address admin) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to revoke admin role from</td></tr>
</tbody></table>
</div>
<h3 id="grantemergencyrole"><a class="header" href="#grantemergencyrole">grantEmergencyRole</a></h3>
<p>Grants emergency administrative privileges to an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function grantEmergencyRole(address emergency) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to grant emergency admin role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeemergencyrole"><a class="header" href="#revokeemergencyrole">revokeEmergencyRole</a></h3>
<p>Revokes emergency administrative privileges from an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function revokeEmergencyRole(address emergency) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to revoke emergency admin role from</td></tr>
</tbody></table>
</div>
<h3 id="grantminterrole"><a class="header" href="#grantminterrole">grantMinterRole</a></h3>
<p>Grants minting privileges to an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function grantMinterRole(address minter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address to grant minter role to</td></tr>
</tbody></table>
</div>
<h3 id="revokeminterrole"><a class="header" href="#revokeminterrole">revokeMinterRole</a></h3>
<p>Revokes minting privileges from an address</p>
<p><em>Only callable by addresses with ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function revokeMinterRole(address minter) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address to revoke minter role from</td></tr>
</tbody></table>
</div>
<h3 id="contractname-2"><a class="header" href="#contractname-2">contractName</a></h3>
<p>Returns the name identifier for this contract type</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-2"><a class="header" href="#contractversion-2">contractVersion</a></h3>
<p>Returns the version identifier for this contract</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string</td></tr>
</tbody></table>
</div>
<h2 id="events-6"><a class="header" href="#events-6">Events</a></h2>
<h3 id="minted-1"><a class="header" href="#minted-1">Minted</a></h3>
<pre><code class="language-solidity">event Minted(address indexed to, uint256 amount);
</code></pre>
<h3 id="burned"><a class="header" href="#burned">Burned</a></h3>
<pre><code class="language-solidity">event Burned(address indexed from, uint256 amount);
</code></pre>
<h3 id="upgradeauthorized"><a class="header" href="#upgradeauthorized">UpgradeAuthorized</a></h3>
<pre><code class="language-solidity">event UpgradeAuthorized(address indexed newImplementation, address indexed sender);
</code></pre>
<h3 id="tokeninitialized"><a class="header" href="#tokeninitialized">TokenInitialized</a></h3>
<pre><code class="language-solidity">event TokenInitialized(string name, string symbol, uint8 decimals);
</code></pre>
<h3 id="pausestate"><a class="header" href="#pausestate">PauseState</a></h3>
<pre><code class="language-solidity">event PauseState(bool isPaused);
</code></pre>
<h3 id="authorizedcallerupdated"><a class="header" href="#authorizedcallerupdated">AuthorizedCallerUpdated</a></h3>
<pre><code class="language-solidity">event AuthorizedCallerUpdated(address indexed caller, bool authorized);
</code></pre>
<h3 id="emergencywithdrawal"><a class="header" href="#emergencywithdrawal">EmergencyWithdrawal</a></h3>
<pre><code class="language-solidity">event EmergencyWithdrawal(address indexed token, address indexed to, uint256 amount, address indexed admin);
</code></pre>
<h2 id="errors-7"><a class="header" href="#errors-7">Errors</a></h2>
<h3 id="paused-1"><a class="header" href="#paused-1">Paused</a></h3>
<pre><code class="language-solidity">error Paused();
</code></pre>
<h3 id="zeroaddress-4"><a class="header" href="#zeroaddress-4">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="zeroamount-3"><a class="header" href="#zeroamount-3">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="contractnotpaused"><a class="header" href="#contractnotpaused">ContractNotPaused</a></h3>
<pre><code class="language-solidity">error ContractNotPaused();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-5"><a class="header" href="#contents-5">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault//src/kStakingVault/base">base</a></li>
<li><a href="src/kStakingVault//src/kStakingVault/modules">modules</a></li>
<li><a href="src/kStakingVault//src/kStakingVault/types">types</a></li>
<li><a href="src/kStakingVault/kStakingVault.sol/contract.kStakingVault.html">kStakingVault</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-6"><a class="header" href="#contents-6">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/base/BaseVaultModule.sol/interface.IFeesModule.html">IFeesModule</a></li>
<li><a href="src/kStakingVault/base/BaseVaultModule.sol/abstract.BaseVaultModule.html">BaseVaultModule</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ifeesmodule"><a class="header" href="#ifeesmodule">IFeesModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/base/BaseVaultModule.sol">Git Source</a></p>
<h2 id="functions-17"><a class="header" href="#functions-17">Functions</a></h2>
<h3 id="computelastbatchfees-1"><a class="header" href="#computelastbatchfees-1">computeLastBatchFees</a></h3>
<pre><code class="language-solidity">function computeLastBatchFees()
    external
    view
    returns (uint256 managementFees, uint256 performanceFees, uint256 totalFees);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basevaultmodule"><a class="header" href="#basevaultmodule">BaseVaultModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/base/BaseVaultModule.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
OwnableRoles, ERC20, ReentrancyGuardTransient, <a href="src/kStakingVault/base/BaseVaultModule.sol//src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></p>
<p>Base contract for all modules</p>
<p><em>Provides shared storage, roles, and common functionality</em></p>
<h2 id="state-variables-4"><a class="header" href="#state-variables-4">State Variables</a></h2>
<h3 id="admin_role-2"><a class="header" href="#admin_role-2">ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role-2"><a class="header" href="#emergency_admin_role-2">EMERGENCY_ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="one_hundred_percent"><a class="header" href="#one_hundred_percent">ONE_HUNDRED_PERCENT</a></h3>
<pre><code class="language-solidity">uint256 public constant ONE_HUNDRED_PERCENT = 10_000;
</code></pre>
<h3 id="k_asset_router-2"><a class="header" href="#k_asset_router-2">K_ASSET_ROUTER</a></h3>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="k_minter-2"><a class="header" href="#k_minter-2">K_MINTER</a></h3>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="module_base_storage_location"><a class="header" href="#module_base_storage_location">MODULE_BASE_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 internal constant MODULE_BASE_STORAGE_LOCATION =
    0x50bc60b877273d55cac3903fd4818902e5fd7aa256278ee2dc6b212f256c0b00;
</code></pre>
<h2 id="functions-18"><a class="header" href="#functions-18">Functions</a></h2>
<h3 id="_getbasevaultmodulestorage"><a class="header" href="#_getbasevaultmodulestorage">_getBaseVaultModuleStorage</a></h3>
<p>Returns the base vault storage struct using ERC-7201 pattern</p>
<pre><code class="language-solidity">function _getBaseVaultStorage() internal pure returns (BaseVaultStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>BaseVaultStorage</code></td><td>Storage reference for base vault state variables</td></tr>
</tbody></table>
</div>
<h3 id="__basevaultmodule_init"><a class="header" href="#__basevaultmodule_init">__BaseVaultModule_init</a></h3>
<p>Initializes the base contract with registry and pause state</p>
<p><em>Can only be called once during initialization</em></p>
<pre><code class="language-solidity">function __BaseVaultModule_init(
    address registry_,
    address owner_,
    address admin_,
    address feeReceiver_,
    bool paused_
)
    internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>feeReceiver_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial pause state</td></tr>
</tbody></table>
</div>
<h3 id="registry-1"><a class="header" href="#registry-1">registry</a></h3>
<p>Returns the registry contract address</p>
<p><em>Reverts if contract not initialized</em></p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The kRegistry contract address</td></tr>
</tbody></table>
</div>
<h3 id="_registry-2"><a class="header" href="#_registry-2">_registry</a></h3>
<p>Returns the registry contract interface</p>
<p><em>Internal helper for typed registry access</em></p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getkminter-1"><a class="header" href="#_getkminter-1">_getKMinter</a></h3>
<p>Gets the kMinter singleton contract address</p>
<p><em>Reverts if kMinter not set in registry</em></p>
<pre><code class="language-solidity">function _getKMinter() internal view returns (address minter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter-1"><a class="header" href="#_getkassetrouter-1">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<p><em>Reverts if kAssetRouter not set in registry</em></p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getdnvaultbyasset-1"><a class="header" href="#_getdnvaultbyasset-1">_getDNVaultByAsset</a></h3>
<p>Gets the DN vault address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getDNVaultByAsset(address asset_) internal view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The corresponding DN vault address</td></tr>
</tbody></table>
</div>
<h3 id="_getrelayer-2"><a class="header" href="#_getrelayer-2">_getRelayer</a></h3>
<p>Checks if an account has relayer role</p>
<pre><code class="language-solidity">function _getRelayer(address account) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>account</code></td><td><code>address</code></td><td>The account to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the account has relayer role</td></tr>
</tbody></table>
</div>
<h3 id="asset-2"><a class="header" href="#asset-2">asset</a></h3>
<p>Returns the underlying asset address (for compatibility)</p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="underlyingasset-1"><a class="header" href="#underlyingasset-1">underlyingAsset</a></h3>
<p>Returns the underlying asset address</p>
<pre><code class="language-solidity">function underlyingAsset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="name-4"><a class="header" href="#name-4">name</a></h3>
<p>Returns the vault shares token name</p>
<pre><code class="language-solidity">function name() public view override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Token name</td></tr>
</tbody></table>
</div>
<h3 id="symbol-2"><a class="header" href="#symbol-2">symbol</a></h3>
<p>Returns the vault shares token symbol</p>
<pre><code class="language-solidity">function symbol() public view override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Token symbol</td></tr>
</tbody></table>
</div>
<h3 id="decimals-2"><a class="header" href="#decimals-2">decimals</a></h3>
<pre><code class="language-solidity">function decimals() public view override returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>Token decimals</td></tr>
</tbody></table>
</div>
<h3 id="_setpaused-1"><a class="header" href="#_setpaused-1">_setPaused</a></h3>
<p>Updates the vault's operational pause state for emergency risk management</p>
<p><em>This internal function enables vault implementations to halt operations during emergencies or maintenance.
The pause mechanism: (1) Validates vault initialization to prevent invalid state changes, (2) Updates the
packed config storage with new pause state, (3) Emits event for monitoring and user notification. When paused,
state-changing operations should be blocked while view functions remain accessible for monitoring. The pause
state is stored in packed config for gas efficiency. This function provides the foundation for emergency
controls while maintaining transparency through event emission.</em></p>
<pre><code class="language-solidity">function _setPaused(bool paused_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The desired pause state (true = halt operations, false = resume normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="_converttoassets"><a class="header" href="#_converttoassets">_convertToAssets</a></h3>
<p>Converts stkToken shares to underlying asset value based on current vault performance</p>
<p><em>This function implements the core share accounting mechanism that determines asset value for stkToken
holders. The conversion process: (1) Handles edge case where total supply is zero by returning 1:1 conversion,
(2) Uses precise fixed-point math to calculate proportional asset value based on share ownership percentage,
(3) Applies current total net assets (after fees) to ensure accurate user valuations. The calculation
maintains precision through fullMulDiv to prevent rounding errors that could accumulate over time. This
function is critical for determining redemption values, share price calculations, and user balance queries.</em></p>
<pre><code class="language-solidity">function _convertToAssets(uint256 shares) internal view returns (uint256 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The quantity of stkTokens to convert to underlying asset terms</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The equivalent value in underlying assets based on current vault performance</td></tr>
</tbody></table>
</div>
<h3 id="_converttoshares"><a class="header" href="#_converttoshares">_convertToShares</a></h3>
<p>Converts underlying asset amount to equivalent stkToken shares at current vault valuation</p>
<p><em>This function determines how many stkTokens should be issued for a given asset deposit based on current
vault performance. The conversion process: (1) Handles edge case of zero total supply with 1:1 initial pricing,
(2) Calculates proportional share amount based on current vault valuation and total outstanding shares,
(3) Uses total net assets to ensure new shares are priced fairly relative to existing holders. The precise
fixed-point mathematics prevent dilution attacks and ensure fair pricing for all participants. This function
is essential for determining share issuance during staking operations and maintaining equitable vault ownership.</em></p>
<pre><code class="language-solidity">function _convertToShares(uint256 assets) internal view returns (uint256 shares);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>uint256</code></td><td>The underlying asset amount to convert to share terms</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>shares</code></td><td><code>uint256</code></td><td>The equivalent stkToken amount based on current share price</td></tr>
</tbody></table>
</div>
<h3 id="_netshareprice"><a class="header" href="#_netshareprice">_netSharePrice</a></h3>
<p>Calculates net share price per stkToken after deducting accumulated fees</p>
<p><em>This function provides the user-facing share price that reflects actual value after management and
performance fee deductions. The calculation: (1) Uses vault decimals for proper scaling to match token
precision, (2) Calls _convertToAssets with unit share amount to determine per-token value, (3) Reflects
total net assets which exclude accrued but unpaid fees. This net pricing ensures users see accurate
value after all fee obligations, providing transparent visibility into their true vault position value.
Used primarily for user-facing calculations and accurate balance reporting.</em></p>
<pre><code class="language-solidity">function _netSharePrice() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net price per stkToken in underlying asset terms (scaled to vault decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_shareprice"><a class="header" href="#_shareprice">_sharePrice</a></h3>
<p>Calculates gross share price per stkToken including accumulated fees</p>
<p><em>This function provides the total vault performance-based share price before fee deductions. The
calculation:
(1) Handles zero total supply edge case with 1:1 initial pricing, (2) Uses total gross assets including accrued
fees for complete performance measurement, (3) Applies precise fixed-point mathematics for accurate pricing.
This gross pricing is used for settlement calculations, performance fee assessments, and watermark tracking.
The inclusion of fees provides complete vault performance measurement for fee calculations and settlement
coordination.</em></p>
<pre><code class="language-solidity">function _sharePrice() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Gross price per stkToken in underlying asset terms (scaled to vault decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_totalassets"><a class="header" href="#_totalassets">_totalAssets</a></h3>
<p>Calculates total assets under management including pending stakes and accrued yields</p>
<p><em>This function determines the complete asset base managed by the vault for share price calculations.
The calculation: (1) Starts with total kToken balance held by the vault contract, (2) Subtracts pending
stakes that haven't yet been converted to stkTokens to avoid double-counting during settlement periods,
(3) Includes all accrued yields and performance gains. The pending stake adjustment is crucial for accurate
share pricing during batch processing periods when assets are deposited but shares haven't been issued.
This total forms the basis for both gross and net share price calculations.</em></p>
<pre><code class="language-solidity">function _totalAssets() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total asset value managed by the vault including yields but excluding pending operations</td></tr>
</tbody></table>
</div>
<h3 id="_totalnetassets"><a class="header" href="#_totalnetassets">_totalNetAssets</a></h3>
<p>Calculates net assets available to users after deducting accumulated fees</p>
<p><em>This function provides the user-facing asset value by removing management and performance fee obligations.
The calculation: (1) Takes total gross assets as the starting point, (2) Subtracts accumulated fees calculated
by the fee computation module, (3) Results in the net value attributable to stkToken holders. This net asset
calculation is critical for fair share pricing, ensuring new entrants pay appropriate prices and existing
holders receive accurate valuations. The fee deduction prevents users from claiming value that belongs to
vault operators through fee mechanisms.</em></p>
<pre><code class="language-solidity">function _totalNetAssets() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Net asset value available to users after all fee deductions</td></tr>
</tbody></table>
</div>
<h3 id="_accumulatedfees"><a class="header" href="#_accumulatedfees">_accumulatedFees</a></h3>
<p>Delegates fee calculation to the vault reader module for comprehensive fee computation</p>
<p><em>This function serves as a gateway to the modular fee calculation system implemented in the vault reader.
The delegation pattern: (1) Calls the reader module which implements detailed fee calculation logic including
management fee accrual and performance fee assessment, (2) Returns total accumulated fees for asset
calculations,
(3) Maintains separation of concerns by isolating complex fee logic in dedicated modules. The reader module
handles time-based management fees, watermark-based performance fees, and hurdle rate calculations.
This modular approach enables upgradeable fee calculation logic while maintaining consistent interfaces.</em></p>
<pre><code class="language-solidity">function _accumulatedFees() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>Total accumulated fees (management + performance) in underlying asset terms</td></tr>
</tbody></table>
</div>
<h3 id="whennotpaused"><a class="header" href="#whennotpaused">whenNotPaused</a></h3>
<p>Modifier to restrict function execution when contract is paused</p>
<p><em>Reverts with Paused() if isPaused is true</em></p>
<pre><code class="language-solidity">modifier whenNotPaused() virtual;
</code></pre>
<h3 id="onlykassetrouter-2"><a class="header" href="#onlykassetrouter-2">onlyKAssetRouter</a></h3>
<p>Restricts function access to the kAssetRouter contract</p>
<pre><code class="language-solidity">modifier onlyKAssetRouter();
</code></pre>
<h3 id="onlyrelayer-3"><a class="header" href="#onlyrelayer-3">onlyRelayer</a></h3>
<p>Restricts function access to the relayer</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">modifier onlyRelayer();
</code></pre>
<h2 id="events-7"><a class="header" href="#events-7">Events</a></h2>
<h3 id="stakerequestcreated"><a class="header" href="#stakerequestcreated">StakeRequestCreated</a></h3>
<p>Emitted when a stake request is created</p>
<pre><code class="language-solidity">event StakeRequestCreated(
    bytes32 indexed requestId,
    address indexed user,
    address indexed kToken,
    uint256 amount,
    address recipient,
    bytes32 batchId
);
</code></pre>
<h3 id="stakerequestredeemed"><a class="header" href="#stakerequestredeemed">StakeRequestRedeemed</a></h3>
<pre><code class="language-solidity">event StakeRequestRedeemed(bytes32 indexed requestId);
</code></pre>
<h3 id="stakerequestcancelled"><a class="header" href="#stakerequestcancelled">StakeRequestCancelled</a></h3>
<pre><code class="language-solidity">event StakeRequestCancelled(bytes32 indexed requestId);
</code></pre>
<h3 id="unstakerequestcreated"><a class="header" href="#unstakerequestcreated">UnstakeRequestCreated</a></h3>
<pre><code class="language-solidity">event UnstakeRequestCreated(
    bytes32 indexed requestId, address indexed user, uint256 amount, address recipient, bytes32 batchId
);
</code></pre>
<h3 id="unstakerequestcancelled"><a class="header" href="#unstakerequestcancelled">UnstakeRequestCancelled</a></h3>
<pre><code class="language-solidity">event UnstakeRequestCancelled(bytes32 indexed requestId);
</code></pre>
<h3 id="paused-2"><a class="header" href="#paused-2">Paused</a></h3>
<pre><code class="language-solidity">event Paused(bool paused);
</code></pre>
<h3 id="initialized-2"><a class="header" href="#initialized-2">Initialized</a></h3>
<pre><code class="language-solidity">event Initialized(address registry, address owner, address admin);
</code></pre>
<h3 id="totalassetsupdated-1"><a class="header" href="#totalassetsupdated-1">TotalAssetsUpdated</a></h3>
<pre><code class="language-solidity">event TotalAssetsUpdated(uint256 oldTotalAssets, uint256 newTotalAssets);
</code></pre>
<h2 id="errors-8"><a class="header" href="#errors-8">Errors</a></h2>
<h3 id="zeroaddress-5"><a class="header" href="#zeroaddress-5">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="invalidregistry-2"><a class="header" href="#invalidregistry-2">InvalidRegistry</a></h3>
<pre><code class="language-solidity">error InvalidRegistry();
</code></pre>
<h3 id="notinitialized-1"><a class="header" href="#notinitialized-1">NotInitialized</a></h3>
<pre><code class="language-solidity">error NotInitialized();
</code></pre>
<h3 id="contractnotfound-2"><a class="header" href="#contractnotfound-2">ContractNotFound</a></h3>
<pre><code class="language-solidity">error ContractNotFound(bytes32 identifier);
</code></pre>
<h3 id="onlykassetrouter-3"><a class="header" href="#onlykassetrouter-3">OnlyKAssetRouter</a></h3>
<pre><code class="language-solidity">error OnlyKAssetRouter();
</code></pre>
<h3 id="onlyrelayer-4"><a class="header" href="#onlyrelayer-4">OnlyRelayer</a></h3>
<pre><code class="language-solidity">error OnlyRelayer();
</code></pre>
<h3 id="zeroamount-4"><a class="header" href="#zeroamount-4">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="amountbelowdustthreshold"><a class="header" href="#amountbelowdustthreshold">AmountBelowDustThreshold</a></h3>
<pre><code class="language-solidity">error AmountBelowDustThreshold();
</code></pre>
<h3 id="contractpaused-2"><a class="header" href="#contractpaused-2">ContractPaused</a></h3>
<pre><code class="language-solidity">error ContractPaused();
</code></pre>
<h3 id="closed"><a class="header" href="#closed">Closed</a></h3>
<pre><code class="language-solidity">error Closed();
</code></pre>
<h3 id="settled"><a class="header" href="#settled">Settled</a></h3>
<pre><code class="language-solidity">error Settled();
</code></pre>
<h3 id="requestnotfound-1"><a class="header" href="#requestnotfound-1">RequestNotFound</a></h3>
<pre><code class="language-solidity">error RequestNotFound();
</code></pre>
<h3 id="requestnoteligible-1"><a class="header" href="#requestnoteligible-1">RequestNotEligible</a></h3>
<pre><code class="language-solidity">error RequestNotEligible();
</code></pre>
<h3 id="invalidvault-1"><a class="header" href="#invalidvault-1">InvalidVault</a></h3>
<pre><code class="language-solidity">error InvalidVault();
</code></pre>
<h2 id="structs-6"><a class="header" href="#structs-6">Structs</a></h2>
<h3 id="basevaultmodulestorage"><a class="header" href="#basevaultmodulestorage">BaseVaultModuleStorage</a></h3>
<p><strong>Note:</strong>
storage-location: erc7201.kam.storage.BaseVaultModule</p>
<pre><code class="language-solidity">struct BaseVaultModuleStorage {
    uint256 currentBatch;
    bytes32 currentBatchId;
    uint256 sharePriceWatermark;
    uint256 requestCounter;
    uint128 totalPendingStake;
    address registry;
    address receiverImplementation;
    address underlyingAsset;
    address kToken;
    address feeReceiver;
    uint96 dustAmount;
    uint8 decimals;
    uint16 hurdleRate;
    uint16 performanceFee;
    uint16 managementFee;
    bool initialized;
    bool paused;
    bool isHardHurdleRate;
    uint64 lastFeesChargedManagement;
    uint64 lastFeesChargedPerformance;
    string name;
    string symbol;
    mapping(bytes32 =&gt; BaseVaultModuleTypes.BatchInfo) batches;
    mapping(bytes32 =&gt; BaseVaultModuleTypes.StakeRequest) stakeRequests;
    mapping(bytes32 =&gt; BaseVaultModuleTypes.UnstakeRequest) unstakeRequests;
    mapping(address =&gt; EnumerableSetLib.Bytes32Set) userRequests;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-7"><a class="header" href="#contents-7">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/modules/BatchModule.sol/contract.BatchModule.html">BatchModule</a></li>
<li><a href="src/kStakingVault/modules/ClaimModule.sol/contract.ClaimModule.html">ClaimModule</a></li>
<li><a href="src/kStakingVault/modules/FeesModule.sol/contract.FeesModule.html">FeesModule</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="batchmodule"><a class="header" href="#batchmodule">BatchModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/modules/BatchModule.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/modules/BatchModule.sol//src/kStakingVault/base/BaseVaultModule.sol/abstract.BaseVaultModule.html">BaseVaultModule</a></p>
<p>Handles batch operations for staking and unstaking</p>
<p><em>Contains batch functions for staking and unstaking operations</em></p>
<h2 id="functions-19"><a class="header" href="#functions-19">Functions</a></h2>
<h3 id="createnewbatch-1"><a class="header" href="#createnewbatch-1">createNewBatch</a></h3>
<p>Creates a new batch for processing requests</p>
<p><em>Only callable by RELAYER_ROLE, typically called at batch intervals</em></p>
<pre><code class="language-solidity">function createNewBatch() external onlyRelayer returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address of the user who created the request</td></tr>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The address of the kToken associated with the request</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens requested</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address to which the kTokens will be sent</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID associated with the request</td></tr>
</tbody></table>
</div>
<h3 id="closebatch-1"><a class="header" href="#closebatch-1">closeBatch</a></h3>
<p><em>Only callable by RELAYER_ROLE, typically called at cutoff time</em></p>
<pre><code class="language-solidity">function closeBatch(bytes32 _batchId, bool _create) external onlyRelayer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
</tbody></table>
</div>
<h3 id="settlebatch-1"><a class="header" href="#settlebatch-1">settleBatch</a></h3>
<p>Marks a batch as settled</p>
<p><em>Only callable by kMinter, indicates assets have been distributed</em></p>
<pre><code class="language-solidity">function settleBatch(bytes32 _batchId) external onlyKAssetRouter;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the stake request</td></tr>
</tbody></table>
</div>
<h3 id="createbatchreceiver-1"><a class="header" href="#createbatchreceiver-1">createBatchReceiver</a></h3>
<p>Deploys BatchReceiver for specific batch</p>
<p><em>Only callable by kAssetRouter</em></p>
<pre><code class="language-solidity">function createBatchReceiver(bytes32 _batchId) external onlyKAssetRouter returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the unstake request</td></tr>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address of the user who created the request</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of kTokens requested</td></tr>
<tr><td><code>recipient</code></td><td><code>address</code></td><td>The address to which the kTokens will be sent</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID associated with the request</td></tr>
</tbody></table>
</div>
<h3 id="unstakerequestcancelled"><a class="header" href="#unstakerequestcancelled">UnstakeRequestCancelled</a></h3>
<p>Emitted when an unstake request is cancelled</p>
<pre><code class="language-solidity">event UnstakeRequestCancelled(bytes32 indexed requestId);
</code></pre>
<h3 id="selectors"><a class="header" href="#selectors">selectors</a></h3>
<p>Returns the selectors for functions in this module</p>
<pre><code class="language-solidity">function selectors() external pure returns (bytes4[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes4[]</code></td><td>selectors Array of function selectors</td></tr>
</tbody></table>
</div>
<h2 id="events-8"><a class="header" href="#events-8">Events</a></h2>
<h3 id="batchcreated"><a class="header" href="#batchcreated">BatchCreated</a></h3>
<pre><code class="language-solidity">event BatchCreated(bytes32 indexed batchId);
</code></pre>
<h3 id="batchreceiverdeployed"><a class="header" href="#batchreceiverdeployed">BatchReceiverDeployed</a></h3>
<pre><code class="language-solidity">event BatchReceiverDeployed(bytes32 indexed batchId, address indexed receiver);
</code></pre>
<h3 id="batchsettled-2"><a class="header" href="#batchsettled-2">BatchSettled</a></h3>
<pre><code class="language-solidity">event BatchSettled(bytes32 indexed batchId);
</code></pre>
<h3 id="batchclosed-1"><a class="header" href="#batchclosed-1">BatchClosed</a></h3>
<pre><code class="language-solidity">event BatchClosed(bytes32 indexed batchId);
</code></pre>
<h3 id="batchreceiverset"><a class="header" href="#batchreceiverset">BatchReceiverSet</a></h3>
<pre><code class="language-solidity">event BatchReceiverSet(address indexed batchReceiver, bytes32 indexed batchId);
</code></pre>
<h3 id="batchreceivercreated"><a class="header" href="#batchreceivercreated">BatchReceiverCreated</a></h3>
<pre><code class="language-solidity">event BatchReceiverCreated(address indexed receiver, bytes32 indexed batchId);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="claimmodule"><a class="header" href="#claimmodule">ClaimModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/modules/ClaimModule.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/modules/ClaimModule.sol//src/kStakingVault/base/BaseVaultModule.sol/abstract.BaseVaultModule.html">BaseVaultModule</a></p>
<p>Handles claim operations for settled batches</p>
<p><em>Contains claim functions for staking and unstaking operations</em></p>
<h2 id="functions-20"><a class="header" href="#functions-20">Functions</a></h2>
<h3 id="claimstakedshares-1"><a class="header" href="#claimstakedshares-1">claimStakedShares</a></h3>
<p>Claims stkTokens from a settled staking batch</p>
<pre><code class="language-solidity">function claimStakedShares(bytes32 batchId, bytes32 requestId) external payable nonReentrant whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused</code></td><td><code>bool</code></td><td>The new paused state</td></tr>
</tbody></table>
</div>
<h3 id="claimunstakedassets-1"><a class="header" href="#claimunstakedassets-1">claimUnstakedAssets</a></h3>
<p>Claims kTokens from a settled unstaking batch (simplified implementation)</p>
<pre><code class="language-solidity">function claimUnstakedAssets(bytes32 batchId, bytes32 requestId) external payable nonReentrant whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Batch ID to claim from</td></tr>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to claim</td></tr>
</tbody></table>
</div>
<h3 id="selectors-1"><a class="header" href="#selectors-1">selectors</a></h3>
<p>Returns the selectors for functions in this module</p>
<pre><code class="language-solidity">function selectors() external pure returns (bytes4[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes4[]</code></td><td>selectors Array of function selectors</td></tr>
</tbody></table>
</div>
<h2 id="events-9"><a class="header" href="#events-9">Events</a></h2>
<h3 id="stakingsharesclaimed"><a class="header" href="#stakingsharesclaimed">StakingSharesClaimed</a></h3>
<p>ERC20 Transfer event for stkToken operations</p>
<pre><code class="language-solidity">event StakingSharesClaimed(bytes32 indexed batchId, bytes32 requestId, address indexed user, uint256 shares);
</code></pre>
<h3 id="unstakingassetsclaimed"><a class="header" href="#unstakingassetsclaimed">UnstakingAssetsClaimed</a></h3>
<pre><code class="language-solidity">event UnstakingAssetsClaimed(bytes32 indexed batchId, bytes32 requestId, address indexed user, uint256 assets);
</code></pre>
<h3 id="stktokensissued"><a class="header" href="#stktokensissued">StkTokensIssued</a></h3>
<pre><code class="language-solidity">event StkTokensIssued(address indexed user, uint256 stkTokenAmount);
</code></pre>
<h3 id="ktokenunstaked"><a class="header" href="#ktokenunstaked">KTokenUnstaked</a></h3>
<pre><code class="language-solidity">event KTokenUnstaked(address indexed user, uint256 shares, uint256 kTokenAmount);
</code></pre>
<h2 id="errors-9"><a class="header" href="#errors-9">Errors</a></h2>
<h3 id="batchnotsettled-1"><a class="header" href="#batchnotsettled-1">BatchNotSettled</a></h3>
<pre><code class="language-solidity">error BatchNotSettled();
</code></pre>
<h3 id="invalidbatchid-1"><a class="header" href="#invalidbatchid-1">InvalidBatchId</a></h3>
<pre><code class="language-solidity">error InvalidBatchId();
</code></pre>
<h3 id="requestnotpending"><a class="header" href="#requestnotpending">RequestNotPending</a></h3>
<pre><code class="language-solidity">error RequestNotPending();
</code></pre>
<h3 id="notbeneficiary"><a class="header" href="#notbeneficiary">NotBeneficiary</a></h3>
<pre><code class="language-solidity">error NotBeneficiary();
</code></pre>
<h3 id="minimumoutputnotmet"><a class="header" href="#minimumoutputnotmet">MinimumOutputNotMet</a></h3>
<pre><code class="language-solidity">error MinimumOutputNotMet();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="feesmodule"><a class="header" href="#feesmodule">FeesModule</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/modules/FeesModule.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kStakingVault/modules/FeesModule.sol//src/kStakingVault/base/BaseVaultModule.sol/abstract.BaseVaultModule.html">BaseVaultModule</a></p>
<p>Handles batch operations for staking and unstaking</p>
<p><em>Contains batch functions for staking and unstaking operations</em></p>
<h2 id="state-variables-5"><a class="header" href="#state-variables-5">State Variables</a></h2>
<h3 id="management_fee_interval"><a class="header" href="#management_fee_interval">MANAGEMENT_FEE_INTERVAL</a></h3>
<p>Interval for management fee (1 month)</p>
<pre><code class="language-solidity">uint256 constant MANAGEMENT_FEE_INTERVAL = 657_436;
</code></pre>
<h3 id="performance_fee_interval"><a class="header" href="#performance_fee_interval">PERFORMANCE_FEE_INTERVAL</a></h3>
<p>Interval for performance fee (3 months)</p>
<pre><code class="language-solidity">uint256 constant PERFORMANCE_FEE_INTERVAL = 7_889_238;
</code></pre>
<h3 id="max_bps"><a class="header" href="#max_bps">MAX_BPS</a></h3>
<p>Maximum basis points</p>
<pre><code class="language-solidity">uint256 constant MAX_BPS = 10_000;
</code></pre>
<h3 id="secs_per_year"><a class="header" href="#secs_per_year">SECS_PER_YEAR</a></h3>
<p>Number of seconds in a year</p>
<pre><code class="language-solidity">uint256 constant SECS_PER_YEAR = 31_556_952;
</code></pre>
<h2 id="functions-21"><a class="header" href="#functions-21">Functions</a></h2>
<h3 id="sethurdlerate-1"><a class="header" href="#sethurdlerate-1">setHurdleRate</a></h3>
<p>Sets the yearly hurdle rate for the underlying asset</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setHurdleRate(uint16 _hurdleRate) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_hurdleRate</code></td><td><code>uint16</code></td><td>The new yearly hurdle rate</td></tr>
</tbody></table>
</div>
<h3 id="sethardhurdlerate-1"><a class="header" href="#sethardhurdlerate-1">setHardHurdleRate</a></h3>
<p>Sets the hard hurdle rate</p>
<p><em>If true, performance fees will only be charged to the excess return</em></p>
<pre><code class="language-solidity">function setHardHurdleRate(bool _isHard) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="setmanagementfee-1"><a class="header" href="#setmanagementfee-1">setManagementFee</a></h3>
<p>Sets the management fee</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setManagementFee(uint16 _managementFee) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Asset address</td></tr>
</tbody></table>
</div>
<h3 id="setperformancefee-1"><a class="header" href="#setperformancefee-1">setPerformanceFee</a></h3>
<p>Sets the performance fee</p>
<p><em>Fee is a basis point (1% = 100)</em></p>
<pre><code class="language-solidity">function setPerformanceFee(uint16 _performanceFee) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_performanceFee</code></td><td><code>uint16</code></td><td>The new performance fee</td></tr>
</tbody></table>
</div>
<h3 id="notifymanagementfeescharged-1"><a class="header" href="#notifymanagementfeescharged-1">notifyManagementFeesCharged</a></h3>
<p>Notifies the module that management fees have been charged from backend</p>
<p><em>Should only be called by the vault</em></p>
<pre><code class="language-solidity">function notifyManagementFeesCharged(uint64 _timestamp) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="notifyperformancefeescharged-1"><a class="header" href="#notifyperformancefeescharged-1">notifyPerformanceFeesCharged</a></h3>
<p>Notifies the module that performance fees have been charged from backend</p>
<p><em>Should only be called by the vault</em></p>
<pre><code class="language-solidity">function notifyPerformanceFeesCharged(uint64 _timestamp) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_timestamp</code></td><td><code>uint64</code></td><td>The timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="computelastbatchfees-2"><a class="header" href="#computelastbatchfees-2">computeLastBatchFees</a></h3>
<p>Computes the last fee batch</p>
<pre><code class="language-solidity">function computeLastBatchFees()
    external
    view
    returns (uint256 managementFees, uint256 performanceFees, uint256 totalFees);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>managementFees</code></td><td><code>uint256</code></td><td>The management fees for the last batch</td></tr>
<tr><td><code>performanceFees</code></td><td><code>uint256</code></td><td>The performance fees for the last batch</td></tr>
<tr><td><code>totalFees</code></td><td><code>uint256</code></td><td>The total fees for the last batch</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedmanagement-1"><a class="header" href="#lastfeeschargedmanagement-1">lastFeesChargedManagement</a></h3>
<p>Returns the last time management fees were charged</p>
<pre><code class="language-solidity">function lastFeesChargedManagement() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>lastFeesChargedManagement Timestamp of last management fee charge</td></tr>
</tbody></table>
</div>
<h3 id="lastfeeschargedperformance-1"><a class="header" href="#lastfeeschargedperformance-1">lastFeesChargedPerformance</a></h3>
<p>Returns the last time performance fees were charged</p>
<pre><code class="language-solidity">function lastFeesChargedPerformance() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>lastFeesChargedPerformance Timestamp of last performance fee charge</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerate-1"><a class="header" href="#hurdlerate-1">hurdleRate</a></h3>
<p>Returns the current hurdle rate used for performance fee calculations</p>
<pre><code class="language-solidity">function hurdleRate() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points (e.g., 500 = 5%)</td></tr>
</tbody></table>
</div>
<h3 id="performancefee-1"><a class="header" href="#performancefee-1">performanceFee</a></h3>
<p>Returns the current performance fee percentage</p>
<pre><code class="language-solidity">function performanceFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The performance fee in basis points (e.g., 2000 = 20%)</td></tr>
</tbody></table>
</div>
<h3 id="nextperformancefeetimestamp-1"><a class="header" href="#nextperformancefeetimestamp-1">nextPerformanceFeeTimestamp</a></h3>
<p>Returns the next performance fee timestamp so the backend can schedule the fee collection</p>
<pre><code class="language-solidity">function nextPerformanceFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The next performance fee timestamp</td></tr>
</tbody></table>
</div>
<h3 id="nextmanagementfeetimestamp-1"><a class="header" href="#nextmanagementfeetimestamp-1">nextManagementFeeTimestamp</a></h3>
<p>Returns the next management fee timestamp so the backend can schedule the fee collection</p>
<pre><code class="language-solidity">function nextManagementFeeTimestamp() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The next management fee timestamp</td></tr>
</tbody></table>
</div>
<h3 id="managementfee-1"><a class="header" href="#managementfee-1">managementFee</a></h3>
<p>Returns the current management fee percentage</p>
<pre><code class="language-solidity">function managementFee() external view returns (uint16);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The management fee in basis points (e.g., 100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="feereceiver-1"><a class="header" href="#feereceiver-1">feeReceiver</a></h3>
<p>Returns the address that receives collected fees</p>
<pre><code class="language-solidity">function feeReceiver() public view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The fee receiver address</td></tr>
</tbody></table>
</div>
<h3 id="sharepricewatermark-1"><a class="header" href="#sharepricewatermark-1">sharePriceWatermark</a></h3>
<p>Returns the high watermark for share price used in performance fee calculations</p>
<pre><code class="language-solidity">function sharePriceWatermark() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the current batch is closed</td></tr>
</tbody></table>
</div>
<h3 id="selectors-2"><a class="header" href="#selectors-2">selectors</a></h3>
<p>Returns the selectors for functions in this module</p>
<pre><code class="language-solidity">function selectors() external pure returns (bytes4[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes4[]</code></td><td>selectors Array of function selectors</td></tr>
</tbody></table>
</div>
<h2 id="events-10"><a class="header" href="#events-10">Events</a></h2>
<h3 id="managementfeeupdated"><a class="header" href="#managementfeeupdated">ManagementFeeUpdated</a></h3>
<p>Emitted when the management fee is updated</p>
<pre><code class="language-solidity">event ManagementFeeUpdated(uint16 oldFee, uint16 newFee);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldFee</code></td><td><code>uint16</code></td><td>Previous management fee in basis points</td></tr>
<tr><td><code>newFee</code></td><td><code>uint16</code></td><td>New management fee in basis points</td></tr>
</tbody></table>
</div>
<h3 id="performancefeeupdated"><a class="header" href="#performancefeeupdated">PerformanceFeeUpdated</a></h3>
<p>Emitted when the performance fee is updated</p>
<pre><code class="language-solidity">event PerformanceFeeUpdated(uint16 oldFee, uint16 newFee);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldFee</code></td><td><code>uint16</code></td><td>Previous performance fee in basis points</td></tr>
<tr><td><code>newFee</code></td><td><code>uint16</code></td><td>New performance fee in basis points</td></tr>
</tbody></table>
</div>
<h3 id="feesassesed"><a class="header" href="#feesassesed">FeesAssesed</a></h3>
<p>Emitted when fees are charged to the vault</p>
<pre><code class="language-solidity">event FeesAssesed(uint256 managementFees, uint256 performanceFees);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Batch receiver</td></tr>
</tbody></table>
</div>
<h3 id="hurdlerateupdated"><a class="header" href="#hurdlerateupdated">HurdleRateUpdated</a></h3>
<p>Emitted when the hurdle rate is updated</p>
<pre><code class="language-solidity">event HurdleRateUpdated(uint16 newRate);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newRate</code></td><td><code>uint16</code></td><td>New hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="hardhurdlerateupdated"><a class="header" href="#hardhurdlerateupdated">HardHurdleRateUpdated</a></h3>
<p>Emitted when the hard hurdle rate is updated</p>
<pre><code class="language-solidity">event HardHurdleRateUpdated(bool newRate);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newRate</code></td><td><code>bool</code></td><td>New hard hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="managementfeescharged"><a class="header" href="#managementfeescharged">ManagementFeesCharged</a></h3>
<p>Emitted when management fees are charged</p>
<pre><code class="language-solidity">event ManagementFeesCharged(uint256 timestamp);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="performancefeescharged"><a class="header" href="#performancefeescharged">PerformanceFeesCharged</a></h3>
<p>Emitted when performance fees are charged</p>
<pre><code class="language-solidity">event PerformanceFeesCharged(uint256 timestamp);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp of the fee charge</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchid-1"><a class="header" href="#getsafebatchid-1">getSafeBatchId</a></h3>
<p>Returns the safe batch</p>
<pre><code class="language-solidity">function getSafeBatchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Batch</td></tr>
</tbody></table>
</div>
<h3 id="contractname-3"><a class="header" href="#contractname-3">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-3"><a class="header" href="#contractversion-3">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h3 id="selectors"><a class="header" href="#selectors">selectors</a></h3>
<p>Returns the selectors for functions in this module</p>
<pre><code class="language-solidity">function selectors() public pure returns (bytes4[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes4[]</code></td><td>selectors Array of function selectors</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="contents-9"><a class="header" href="#contents-9">Contents</a></h1>
<ul>
<li><a href="src/kStakingVault/types/BaseVaultTypes.sol/library.BaseVaultTypes.html">BaseVaultTypes</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basevaultmoduletypes"><a class="header" href="#basevaultmoduletypes">BaseVaultModuleTypes</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/types/BaseVaultModuleTypes.sol">Git Source</a></p>
<p>Library containing all data structures used in the ModuleBase</p>
<p><em>Defines standardized data types for cross-contract communication and storage</em></p>
<h2 id="structs-7"><a class="header" href="#structs-7">Structs</a></h2>
<h3 id="stakerequest"><a class="header" href="#stakerequest">StakeRequest</a></h3>
<p>Stake request structure</p>
<pre><code class="language-solidity">struct StakeRequest {
    address user;
    uint128 kTokenAmount;
    address recipient;
    bytes32 batchId;
    uint64 requestTimestamp;
    RequestStatus status;
}
</code></pre>
<h3 id="unstakerequest"><a class="header" href="#unstakerequest">UnstakeRequest</a></h3>
<p>Unstake request structure</p>
<pre><code class="language-solidity">struct UnstakeRequest {
    address user;
    uint128 stkTokenAmount;
    address recipient;
    bytes32 batchId;
    uint64 requestTimestamp;
    RequestStatus status;
}
</code></pre>
<h3 id="batchinfo"><a class="header" href="#batchinfo">BatchInfo</a></h3>
<p>Batch information structure</p>
<pre><code class="language-solidity">struct BatchInfo {
    address batchReceiver;
    bool isClosed;
    bool isSettled;
    bytes32 batchId;
    uint128 sharePrice;
    uint128 netSharePrice;
}
</code></pre>
<h2 id="enums-2"><a class="header" href="#enums-2">Enums</a></h2>
<h3 id="requeststatus-1"><a class="header" href="#requeststatus-1">RequestStatus</a></h3>
<p>Request status</p>
<pre><code class="language-solidity">enum RequestStatus {
    PENDING,
    CLAIMED,
    CANCELLED
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kstakingvault"><a class="header" href="#kstakingvault">kStakingVault</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kStakingVault/kStakingVault.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, UUPSUpgradeable, <a href="src/kStakingVault/kStakingVault.sol//src/kStakingVault/base/BaseVaultModule.sol/abstract.BaseVaultModule.html">BaseVaultModule</a>, <a href="src/kStakingVault/kStakingVault.sol//src/base/MultiFacetProxy.sol/contract.MultiFacetProxy.html">MultiFacetProxy</a></p>
<p>Pure ERC20 vault with dual accounting for minter and user pools</p>
<p><em>Implements automatic yield distribution from minter to user pools with modular architecture</em></p>
<h2 id="functions-22"><a class="header" href="#functions-22">Functions</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-1"><a class="header" href="#initialize-1">initialize</a></h3>
<p>Initializes the kStakingVault with complete protocol integration and share token configuration</p>
<p><em>This function establishes the vault's integration with the KAM protocol ecosystem. The initialization
process: (1) Validates asset address to prevent deployment with invalid configuration, (2) Initializes
BaseVault foundation with registry and operational state, (3) Sets up ownership and access control through
Ownable pattern, (4) Configures share token metadata and decimals for ERC20 functionality, (5) Establishes
kToken integration through registry lookup for asset-to-token mapping, (6) Sets initial share price watermark
for performance fee calculations, (7) Deploys BatchReceiver implementation for settlement asset distribution.
The initialization creates a complete retail staking solution integrated with the protocol's institutional
flows.</em></p>
<pre><code class="language-solidity">function initialize(
    address owner_,
    address registry_,
    bool paused_,
    string memory name_,
    string memory symbol_,
    uint8 decimals_,
    uint128 dustAmount_,
    address emergencyAdmin_,
    address asset_,
    address feeCollector_
)
    external
    initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Owner address</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Admin address</td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial pause state</td></tr>
<tr><td><code>name_</code></td><td><code>string</code></td><td>Token name</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>Token symbol</td></tr>
<tr><td><code>decimals_</code></td><td><code>uint8</code></td><td>Token decimals</td></tr>
<tr><td><code>dustAmount_</code></td><td><code>uint128</code></td><td>Minimum amount threshold</td></tr>
<tr><td><code>emergencyAdmin_</code></td><td><code>address</code></td><td>Emergency admin address</td></tr>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>Underlying asset address</td></tr>
<tr><td><code>feeCollector_</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="requeststake-1"><a class="header" href="#requeststake-1">requestStake</a></h3>
<p>Request to stake kTokens for stkTokens (rebase token)</p>
<pre><code class="language-solidity">function requestStake(
    address to,
    uint256 amount
)
    external
    payable
    nonReentrant
    whenNotPaused
    returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the stkTokens after successful settlement and claiming</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this staking request through settlement and claiming</td></tr>
</tbody></table>
</div>
<h3 id="requestunstake-1"><a class="header" href="#requestunstake-1">requestUnstake</a></h3>
<p>Request to unstake stkTokens for kTokens + yield</p>
<p><em>Works with both claimed and unclaimed stkTokens (can unstake immediately after settlement)</em></p>
<pre><code class="language-solidity">function requestUnstake(
    address to,
    uint256 stkTokenAmount
)
    external
    payable
    nonReentrant
    whenNotPaused
    returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to</code></td><td><code>address</code></td><td>The recipient address that will receive the kTokens after successful settlement and claiming</td></tr>
<tr><td><code>stkTokenAmount</code></td><td><code>uint256</code></td><td>The quantity of stkTokens to unstake (must not exceed user balance, cannot be zero)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Unique identifier for tracking this unstaking request through settlement and claiming</td></tr>
</tbody></table>
</div>
<h3 id="cancelstakerequest"><a class="header" href="#cancelstakerequest">cancelStakeRequest</a></h3>
<p>Cancels a staking request</p>
<pre><code class="language-solidity">function cancelStakeRequest(bytes32 requestId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="cancelunstakerequest"><a class="header" href="#cancelunstakerequest">cancelUnstakeRequest</a></h3>
<p>Cancels an unstaking request</p>
<pre><code class="language-solidity">function cancelUnstakeRequest(bytes32 requestId) external payable nonReentrant whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>Request ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="createnewbatch-1"><a class="header" href="#createnewbatch-1">createNewBatch</a></h3>
<p>Creates a new batch to begin aggregating user requests for the next settlement period</p>
<p><em>This function initializes a fresh batch period for collecting staking and unstaking requests. Process:
(1) Increments internal batch counter for unique identification, (2) Generates deterministic batch ID using
chain-specific parameters (vault address, batch number, chainid, timestamp, asset) for collision resistance,
(3) Initializes batch storage with open state enabling new request acceptance, (4) Updates vault's current
batch tracking for request routing. Only relayers can call this function as part of the automated settlement
schedule. The timing is typically coordinated with institutional settlement cycles to optimize capital
efficiency
across the protocol. Each batch remains open until explicitly closed by relayers or governance.</em></p>
<pre><code class="language-solidity">function createNewBatch() external returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>batchId Unique deterministic identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="closebatch-1"><a class="header" href="#closebatch-1">closeBatch</a></h3>
<p>Closes a batch to prevent new requests and prepare for settlement processing</p>
<p><em>This function transitions a batch from open to closed state, finalizing the request set for settlement.
Process: (1) Validates batch exists and is currently open to prevent double-closing, (2) Marks batch as closed
preventing new stake/unstake requests from joining, (3) Optionally creates new batch for continued operations
if _create flag is true, enabling seamless transitions. Once closed, the batch awaits settlement by kAssetRouter
which will calculate final share prices and distribute yields. Only relayers can execute batch closure as part
of the coordinated settlement schedule across all protocol vaults. The timing typically aligns with DN vault
yield calculations to ensure accurate price discovery.</em></p>
<pre><code class="language-solidity">function closeBatch(bytes32 _batchId, bool _create) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The specific batch identifier to close (must be currently open)</td></tr>
<tr><td><code>_create</code></td><td><code>bool</code></td><td>Whether to immediately create a new batch after closing for continued operations</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-3"><a class="header" href="#setpaused-3">setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Only callable internally by inheriting contracts</em></p>
<pre><code class="language-solidity">function setPaused(bool paused_) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to mark as settled (must be closed, not previously settled)</td></tr>
</tbody></table>
</div>
<h3 id="createbatchreceiver-1"><a class="header" href="#createbatchreceiver-1">createBatchReceiver</a></h3>
<p>Deploys a minimal proxy BatchReceiver for isolated asset distribution to unstaking users</p>
<p><em>This function creates batch-specific receivers for secure unstaking asset distribution. Process:
(1) Checks if receiver already exists for batch to prevent duplicate deployments, (2) Clones minimal proxy
from receiver implementation to minimize gas costs while maintaining isolation, (3) Initializes receiver with
batch ID and asset type for proper operation, (4) Stores receiver address in batch info for claiming access.
The receiver pattern provides several benefits: asset isolation between batches preventing cross-contamination,
gas-efficient deployment through EIP-1167 minimal proxies, security through single-batch operation scope,
and simplified distribution logic for unstaking claims. Only kAssetRouter can create receivers as part of
settlement coordination.</em></p>
<pre><code class="language-solidity">function createBatchReceiver(bytes32 _batchId) external returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier requiring a receiver for asset distribution</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the deployed BatchReceiver contract for this specific batch</td></tr>
</tbody></table>
</div>
<h3 id="_createnewbatch"><a class="header" href="#_createnewbatch">_createNewBatch</a></h3>
<p>Internal function to create deterministic batch IDs with collision resistance</p>
<p><em>This function generates unique batch identifiers using multiple entropy sources for security. The ID
generation process: (1) Increments internal batch counter to ensure uniqueness within the vault, (2) Combines
vault address, batch number, chain ID, timestamp, and asset address for collision resistance, (3) Uses
optimized hashing function for gas efficiency, (4) Initializes batch storage with default state for new
requests. The deterministic approach enables consistent batch identification across different contexts while
the multiple entropy sources prevent prediction or collision attacks. Each batch starts in open state ready
to accept user requests until explicitly closed by relayers.</em></p>
<pre><code class="language-solidity">function _createNewBatch() private returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Deterministic batch identifier for the newly created batch period</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused"><a class="header" href="#_checkpaused">_checkPaused</a></h3>
<p>Validates vault operational state preventing actions during emergency pause</p>
<p><em>This internal validation function ensures vault safety by blocking operations when paused. Emergency
pause can be triggered by emergency admins during security incidents or market anomalies. The function
provides consistent pause checking across all vault operations while maintaining gas efficiency through
direct storage access. When paused, users cannot create new requests but can still query vault state.</em></p>
<pre><code class="language-solidity">function _checkPaused(BaseVaultStorage storage $) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>BaseVaultStorage</code></td><td>Direct storage pointer for gas-efficient pause state access</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero"><a class="header" href="#_checkamountnotzero">_checkAmountNotZero</a></h3>
<p>Validates non-zero amounts preventing invalid operations</p>
<p><em>This utility function prevents zero-amount operations that would waste gas or create invalid state.
Zero amounts are rejected for staking, unstaking, and fee operations to maintain data integrity and
prevent operational errors. The pure function enables gas-efficient validation without state access.</em></p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount value to validate (must be greater than zero)</td></tr>
</tbody></table>
</div>
<h3 id="_checkvalidbps"><a class="header" href="#_checkvalidbps">_checkValidBPS</a></h3>
<p>Validates basis point values preventing excessive fee configuration</p>
<p><em>This function ensures fee parameters remain within acceptable bounds (0-10000 bp = 0-100%) to
protect users from excessive fee extraction. The 10000 bp limit enforces the maximum fee cap while
enabling flexible fee configuration within reasonable ranges. Used for both management and performance
fee validation to maintain consistent fee bounds across all fee types.</em></p>
<pre><code class="language-solidity">function _checkValidBPS(uint256 bps) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>bps</code></td><td><code>uint256</code></td><td>The basis point value to validate (must be &lt;= 10000)</td></tr>
</tbody></table>
</div>
<h3 id="isbatchclosed-1"><a class="header" href="#isbatchclosed-1">isBatchClosed</a></h3>
<p>Returns whether the current batch is closed</p>
<pre><code class="language-solidity">function isBatchClosed() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the current batch is closed</td></tr>
</tbody></table>
</div>
<h3 id="isbatchsettled-1"><a class="header" href="#isbatchsettled-1">isBatchSettled</a></h3>
<p>Returns whether the current batch is settled</p>
<pre><code class="language-solidity">function isBatchSettled() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the current batch is settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidinfo-1"><a class="header" href="#getbatchidinfo-1">getBatchIdInfo</a></h3>
<p>Returns the current batch ID, whether it is closed, and whether it is settled</p>
<pre><code class="language-solidity">function getBatchIdInfo()
    external
    view
    returns (bytes32 batchId, address batchReceiver, bool isClosed, bool isSettled);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>Current batch ID</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>Current batch receiver</td></tr>
<tr><td><code>isClosed</code></td><td><code>bool</code></td><td>Whether the current batch is closed</td></tr>
<tr><td><code>isSettled</code></td><td><code>bool</code></td><td>Whether the current batch is settled</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidreceiver-1"><a class="header" href="#getbatchidreceiver-1">getBatchIdReceiver</a></h3>
<p>Returns the batch receiver for the current batch</p>
<pre><code class="language-solidity">function getBatchIdReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Batch receiver</td></tr>
</tbody></table>
</div>
<h3 id="getbatchreceiver-1"><a class="header" href="#getbatchreceiver-1">getBatchReceiver</a></h3>
<p>Returns the batch receiver for a given batch (alias for getBatchIdReceiver)</p>
<pre><code class="language-solidity">function getBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>Batch receiver</td></tr>
</tbody></table>
</div>
<h3 id="getsafebatchreceiver-1"><a class="header" href="#getsafebatchreceiver-1">getSafeBatchReceiver</a></h3>
<pre><code class="language-solidity">function getSafeBatchReceiver(bytes32 batchId) external view returns (address);
</code></pre>
<h3 id="_authorizeupgrade-1"><a class="header" href="#_authorizeupgrade-1">_authorizeUpgrade</a></h3>
<p>Authorize upgrade (only owner can upgrade)</p>
<p><em>This allows upgrading the main contract while keeping modules separate</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<h3 id="_authorizemodifyfunctions-1"><a class="header" href="#_authorizemodifyfunctions-1">_authorizeModifyFunctions</a></h3>
<p>Authorize function modification</p>
<p><em>This allows modifying functions while keeping modules separate</em></p>
<pre><code class="language-solidity">function _authorizeModifyFunctions(address sender) internal override;
</code></pre>
<h2 id="events-8"><a class="header" href="#events-8">Events</a></h2>
<h3 id="batchcreated"><a class="header" href="#batchcreated">BatchCreated</a></h3>
<p>Emitted when a new batch is created</p>
<pre><code class="language-solidity">event BatchCreated(bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the new batch</td></tr>
</tbody></table>
</div>
<h3 id="batchsettled-1"><a class="header" href="#batchsettled-1">BatchSettled</a></h3>
<p>Emitted when a batch is settled</p>
<pre><code class="language-solidity">event BatchSettled(bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch ID of the settled batch</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="kassetrouter"><a class="header" href="#kassetrouter">kAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kAssetRouter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kAssetRouter.sol//src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html">IkAssetRouter</a>, Initializable, UUPSUpgradeable, <a href="src/kAssetRouter.sol//src/base/kBase.sol/contract.kBase.html">kBase</a>, Multicallable</p>
<h2 id="state-variables-6"><a class="header" href="#state-variables-6">State Variables</a></h2>
<h3 id="default_vault_settlement_cooldown"><a class="header" href="#default_vault_settlement_cooldown">DEFAULT_VAULT_SETTLEMENT_COOLDOWN</a></h3>
<p>Default cooldown period for vault settlement proposals (1 hour)</p>
<p><em>Provides initial security delay between proposal creation and execution, allowing guardians
to verify yield calculations and detect potential errors before irreversible yield distribution</em></p>
<pre><code class="language-solidity">uint256 private constant DEFAULT_VAULT_SETTLEMENT_COOLDOWN = 1 hours;
</code></pre>
<h3 id="max_vault_settlement_cooldown"><a class="header" href="#max_vault_settlement_cooldown">MAX_VAULT_SETTLEMENT_COOLDOWN</a></h3>
<p>Maximum allowed cooldown period for vault settlement proposals (1 day)</p>
<p><em>Caps the maximum security delay to balance protocol safety with operational efficiency.
Prevents excessive delays that could harm user experience while maintaining security standards</em></p>
<pre><code class="language-solidity">uint256 private constant MAX_VAULT_SETTLEMENT_COOLDOWN = 1 days;
</code></pre>
<h3 id="kassetrouter_storage_location"><a class="header" href="#kassetrouter_storage_location">KASSETROUTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KASSETROUTER_STORAGE_LOCATION =
    0x72fdaf6608fcd614cdab8afd23d0b707bfc44e685019cc3a5ace611655fe7f00;
</code></pre>
<h2 id="functions-37"><a class="header" href="#functions-37">Functions</a></h2>
<h3 id="_getkassetrouterstorage"><a class="header" href="#_getkassetrouterstorage">_getkAssetRouterStorage</a></h3>
<p>Retrieves the kAssetRouter storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkAssetRouterStorage() private pure returns (kAssetRouterStorage storage $);
</code></pre>
<h3 id="whennotpaused-1"><a class="header" href="#whennotpaused-1">whenNotPaused</a></h3>
<pre><code class="language-solidity">modifier whenNotPaused();
</code></pre>
<h3 id="onlystakingvault-1"><a class="header" href="#onlystakingvault-1">onlyStakingVault</a></h3>
<pre><code class="language-solidity">modifier onlyStakingVault();
</code></pre>
<h3 id="constructor-2"><a class="header" href="#constructor-2">constructor</a></h3>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-2"><a class="header" href="#initialize-2">initialize</a></h3>
<p>Initialize the kAssetRouter with asset and admin configuration</p>
<pre><code class="language-solidity">function initialize(address registry_, address owner_, address admin_, bool paused_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the kRegistry contract</td></tr>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Address of the owner</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Address of the admin</td></tr>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>Initial pause state</td></tr>
</tbody></table>
</div>
<h3 id="kassetpush-1"><a class="header" href="#kassetpush-1">kAssetPush</a></h3>
<p>Push assets from kMinter to designated DN vault</p>
<pre><code class="language-solidity">function kAssetPush(
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyKMinter;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited (must be registered in protocol)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault for yield generation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch identifier from the DN vault for tracking and settlement</td></tr>
</tbody></table>
</div>
<h3 id="kassetrequestpull-1"><a class="header" href="#kassetrequestpull-1">kAssetRequestPull</a></h3>
<p>Request to pull assets for kMinter redemptions</p>
<pre><code class="language-solidity">function kAssetRequestPull(
    address _asset,
    address _vault,
    uint256 amount,
    bytes32 batchId
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyKMinter;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being redeemed</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The DN vault address from which assets will be withdrawn</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this redemption with other requests</td></tr>
</tbody></table>
</div>
<h3 id="kassettransfer-1"><a class="header" href="#kassettransfer-1">kAssetTransfer</a></h3>
<p>Transfers assets between kStakingVaults for optimal capital allocation and yield optimization</p>
<p><em>This function enables dynamic rebalancing of assets across the vault network to optimize yields
and manage capacity. The transfer is virtual in nature - actual underlying assets may remain in the
same physical vault while accounting balances are updated. This mechanism allows for: (1) moving
assets from lower-yield to higher-yield opportunities, (2) rebalancing vault capacity during high
demand periods, (3) optimizing capital efficiency across the protocol. The batch system ensures
all transfers are processed fairly during settlement periods.</em></p>
<pre><code class="language-solidity">function kAssetTransfer(
    address sourceVault,
    address targetVault,
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyStakingVault;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address transferring assets (will lose virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The kStakingVault address receiving assets (will gain virtual balance)</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred between vaults</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer for rebalancing</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this transfer with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpush-1"><a class="header" href="#ksharesrequestpush-1">kSharesRequestPush</a></h3>
<p>Request to pull shares for kStakingVault redemptions</p>
<pre><code class="language-solidity">function kSharesRequestPush(
    address sourceVault,
    uint256 amount,
    bytes32 batchId
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyStakingVault;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share push operations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for push to users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share operations with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpull-1"><a class="header" href="#ksharesrequestpull-1">kSharesRequestPull</a></h3>
<p>Request to pull shares for kStakingVault redemptions</p>
<pre><code class="language-solidity">function kSharesRequestPull(
    address sourceVault,
    uint256 amount,
    bytes32 batchId
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyStakingVault;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share pull for redemptions</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for pull from users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share redemptions with settlement</td></tr>
</tbody></table>
</div>
<h3 id="proposesettlebatch-1"><a class="header" href="#proposesettlebatch-1">proposeSettleBatch</a></h3>
<p>Proposes a batch settlement for a vault with yield distribution through kToken minting/burning</p>
<p><em>This is the core function that initiates yield distribution in the KAM protocol. The settlement
process involves: (1) calculating final yields after a batch period, (2) determining net new deposits/
redemptions, (3) creating a proposal with cooldown period for security verification, (4) preparing for
kToken supply adjustment to maintain 1:1 backing. Positive yields result in kToken minting (distributing
gains to all holders), while losses result in kToken burning (socializing losses). The cooldown period
allows guardians to verify calculations before execution, ensuring protocol integrity.</em></p>
<pre><code class="language-solidity">function proposeSettleBatch(
    address asset,
    address vault,
    bytes32 batchId,
    uint256 totalAssets_,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyRelayer
    returns (bytes32 proposalId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being settled (USDC, WBTC, etc.)</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address where yield was generated</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td></td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits minus redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute amount of yield generated (positive) or lost (negative)</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive (will mint kTokens), false if negative (will burn kTokens)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>Unique identifier for this settlement proposal for tracking and execution</td></tr>
</tbody></table>
</div>
<h3 id="executesettlebatch-1"><a class="header" href="#executesettlebatch-1">executeSettleBatch</a></h3>
<p>Execute a settlement proposal after cooldown period</p>
<pre><code class="language-solidity">function executeSettleBatch(bytes32 proposalId) external nonReentrant whenNotPaused;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to execute</td></tr>
</tbody></table>
</div>
<h3 id="cancelproposal-1"><a class="header" href="#cancelproposal-1">cancelProposal</a></h3>
<p>Cancel a settlement proposal before execution</p>
<pre><code class="language-solidity">function cancelProposal(bytes32 proposalId) external nonReentrant whenNotPaused onlyGuardian;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The proposal ID to cancel</td></tr>
</tbody></table>
</div>
<h3 id="updateproposal-1"><a class="header" href="#updateproposal-1">updateProposal</a></h3>
<p>Update a settlement proposal before execution</p>
<pre><code class="language-solidity">function updateProposal(
    bytes32 proposalId,
    uint256 totalAssets_,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    nonReentrant
    whenNotPaused
    onlyRelayer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The proposal ID to update</td></tr>
<tr><td><code>totalAssets_</code></td><td><code>uint256</code></td><td>New total assets value</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>New netted amount</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>New yield amount</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>New profit status</td></tr>
</tbody></table>
</div>
<h3 id="setsettlementcooldown-1"><a class="header" href="#setsettlementcooldown-1">setSettlementCooldown</a></h3>
<p>Sets the security cooldown period for settlement proposals</p>
<p><em>The cooldown period provides critical security by requiring a delay between proposal creation
and execution. This allows: (1) protocol guardians to verify yield calculations, (2) detection of
potential errors or malicious proposals, (3) emergency intervention if needed. The cooldown should
balance security (longer is safer) with operational efficiency (shorter enables faster yield
distribution). Only admin roles can modify this parameter as it affects protocol safety.</em></p>
<pre><code class="language-solidity">function setSettlementCooldown(uint256 cooldown) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds before settlement proposals can be executed</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-4"><a class="header" href="#setpaused-4">setPaused</a></h3>
<p>Set contract pause state</p>
<pre><code class="language-solidity">function setPaused(bool paused) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused</code></td><td><code>bool</code></td><td>New pause state</td></tr>
</tbody></table>
</div>
<h3 id="setsettlementcooldown-1"><a class="header" href="#setsettlementcooldown-1">setSettlementCooldown</a></h3>
<p>Set the cooldown period for settlement proposals</p>
<pre><code class="language-solidity">function setSettlementCooldown(uint256 cooldown) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>New cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementproposal-1"><a class="header" href="#getsettlementproposal-1">getSettlementProposal</a></h3>
<p>Retrieves complete details of a specific settlement proposal</p>
<p><em>Returns the full VaultSettlementProposal struct containing all parameters needed
for yield distribution verification. Essential for guardians to review proposal accuracy
during the cooldown period before execution. Contains asset amounts, yield calculations,
and timing information for comprehensive proposal analysis.</em></p>
<pre><code class="language-solidity">function getSettlementProposal(bytes32 proposalId) external view returns (VaultSettlementProposal memory proposal);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The complete settlement proposal struct with all details</td></tr>
</tbody></table>
</div>
<h3 id="canexecuteproposal-1"><a class="header" href="#canexecuteproposal-1">canExecuteProposal</a></h3>
<p>Checks if a settlement proposal is ready for execution with detailed status</p>
<p><em>Validates all execution requirements: (1) proposal exists and is pending, (2) cooldown
period has elapsed, (3) proposal hasn't been cancelled. Returns both boolean result and
human-readable reason for failures, enabling better error handling and user feedback.</em></p>
<pre><code class="language-solidity">function canExecuteProposal(bytes32 proposalId) external view returns (bool canExecute, string memory reason);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the proposal to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>canExecute</code></td><td><code>bool</code></td><td>True if the proposal can be executed immediately</td></tr>
<tr><td><code>reason</code></td><td><code>string</code></td><td>Descriptive message explaining why execution is blocked (if applicable)</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementcooldown-1"><a class="header" href="#getsettlementcooldown-1">getSettlementCooldown</a></h3>
<p>Gets the current security cooldown period for settlement proposals</p>
<p><em>The cooldown period determines how long proposals must wait before execution.
This security mechanism allows guardians to verify yield calculations and prevents
immediate execution of potentially malicious or incorrect proposals. Critical for
maintaining protocol integrity during yield distribution processes.</em></p>
<pre><code class="language-solidity">function getSettlementCooldown() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>cooldown The current cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="_virtualbalance"><a class="header" href="#_virtualbalance">_virtualBalance</a></h3>
<p>Calculates the virtual balance of assets for a vault across all its adapters</p>
<p><em>This function aggregates asset balances across all adapters connected to a vault to determine
the total virtual balance available for operations. Essential for coordination between physical
asset locations and protocol accounting. Used for settlement calculations and ensuring sufficient
assets are available for redemptions and transfers within the money flow system.</em></p>
<pre><code class="language-solidity">function _virtualBalance(address vault, address asset) private view returns (uint256 balance);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to calculate virtual balance for</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query balance for</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>balance</code></td><td><code>uint256</code></td><td>The total virtual asset balance across all vault adapters</td></tr>
</tbody></table>
</div>
<h3 id="_checkkminter"><a class="header" href="#_checkkminter">_checkKMinter</a></h3>
<p>Validates that the caller is an authorized kMinter contract</p>
<p><em>Ensures only kMinter can push assets and request pulls for institutional operations.
Critical for maintaining proper access control in the money flow coordination system.</em></p>
<pre><code class="language-solidity">function _checkKMinter(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to validate as authorized kMinter</td></tr>
</tbody></table>
</div>
<h3 id="_checkvault"><a class="header" href="#_checkvault">_checkVault</a></h3>
<p>Validates that the caller is an authorized kStakingVault contract</p>
<p><em>Ensures only registered vaults can request share operations and asset transfers.
Essential for maintaining protocol security and preventing unauthorized money flows.</em></p>
<pre><code class="language-solidity">function _checkVault(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to validate as authorized vault</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero-1"><a class="header" href="#_checkamountnotzero-1">_checkAmountNotZero</a></h3>
<p>Validates that an amount parameter is not zero to prevent invalid operations</p>
<p><em>Prevents zero-amount operations that could cause accounting errors or waste gas</em></p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount value to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero"><a class="header" href="#_checkaddressnotzero">_checkAddressNotZero</a></h3>
<p>Validates that an address parameter is not the zero address</p>
<p><em>Prevents operations with invalid zero addresses that could cause loss of funds</em></p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>The address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checksufficientvirtualbalance"><a class="header" href="#_checksufficientvirtualbalance">_checkSufficientVirtualBalance</a></h3>
<p>Check if virtual balance is sufficient</p>
<pre><code class="language-solidity">function _checkSufficientVirtualBalance(address vault, address asset, uint256 requiredAmount) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>Vault address</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address</td></tr>
<tr><td><code>requiredAmount</code></td><td><code>uint256</code></td><td>Required amount</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-1"><a class="header" href="#_checkadmin-1">_checkAdmin</a></h3>
<p>Check if caller is an admin</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused-1"><a class="header" href="#_checkpaused-1">_checkPaused</a></h3>
<p>Verifies contract is not paused</p>
<pre><code class="language-solidity">function _checkPaused() private view;
</code></pre>
<h3 id="_ispendingproposal"><a class="header" href="#_ispendingproposal">_isPendingProposal</a></h3>
<pre><code class="language-solidity">function _isPendingProposal(address vault, bytes32 proposalId) private view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>the proposalId to verify</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool proposal exists or not</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-3"><a class="header" href="#ispaused-3">isPaused</a></h3>
<p>Check if contract is paused</p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused and operations are halted</td></tr>
</tbody></table>
</div>
<h3 id="getdnvaultbyasset-1"><a class="header" href="#getdnvaultbyasset-1">getDNVaultByAsset</a></h3>
<p>Gets the DN vault address responsible for yield generation for a specific asset</p>
<p><em>Each supported asset (USDC, WBTC, etc.) has a designated DN vault that handles
yield farming strategies. This mapping is critical for routing institutional deposits
and coordinating settlement processes across the protocol's vault network.</em></p>
<pre><code class="language-solidity">function getDNVaultByAsset(address asset) external view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address that generates yield for this asset</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidbalances-1"><a class="header" href="#getbatchidbalances-1">getBatchIdBalances</a></h3>
<p>Retrieves the virtual balance accounting for a specific batch in a vault</p>
<p><em>Returns the deposited and requested amounts that are tracked virtually for batch
processing. These balances coordinate institutional flows (kMinter) and retail flows
(kStakingVault) within the same settlement period, ensuring fair processing and accurate
yield distribution across all participants in the batch.</em></p>
<pre><code class="language-solidity">function getBatchIdBalances(
    address vault,
    bytes32 batchId
)
    external
    view
    returns (uint256 deposited, uint256 requested);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query batch balances for</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to retrieve balance information</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deposited</code></td><td><code>uint256</code></td><td>Total amount of assets deposited into this batch</td></tr>
<tr><td><code>requested</code></td><td><code>uint256</code></td><td>Total amount of assets requested for redemption from this batch</td></tr>
</tbody></table>
</div>
<h3 id="getrequestedshares-1"><a class="header" href="#getrequestedshares-1">getRequestedShares</a></h3>
<p>Retrieves the total shares requested for redemption in a specific vault batch</p>
<p><em>Tracks share-based redemption requests from retail users in kStakingVaults.
This is separate from asset-based tracking and enables the protocol to coordinate
both institutional (asset-based) and retail (share-based) operations within the
same batch settlement process, ensuring consistent share price calculations.</em></p>
<pre><code class="language-solidity">function getRequestedShares(address vault, bytes32 batchId) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault address to query</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for the redemption period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of shares requested for redemption in this batch</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade-3"><a class="header" href="#_authorizeupgrade-3">_authorizeUpgrade</a></h3>
<p>Authorize contract upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="receive"><a class="header" href="#receive">receive</a></h3>
<p>Receive ETH (for gas refunds, etc.)</p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="contractname-4"><a class="header" href="#contractname-4">contractName</a></h3>
<p>Returns the standard name identifier for this contract type within the KAM protocol</p>
<p><em>Used for protocol identification and registry management. Provides a consistent way
to identify kAssetRouter contracts across the protocol ecosystem, enabling automated
contract discovery and validation by other protocol components.</em></p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string (typically "kAssetRouter")</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-4"><a class="header" href="#contractversion-4">contractVersion</a></h3>
<p>Returns the version identifier for this contract implementation</p>
<p><em>Used for upgrade management and compatibility checking within the protocol. Enables
the system to verify contract versions during upgrades and ensure compatibility between
protocol components. Critical for protocol governance and maintenance procedures.</em></p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h2 id="structs-10"><a class="header" href="#structs-10">Structs</a></h2>
<h3 id="kassetrouterstorage"><a class="header" href="#kassetrouterstorage">kAssetRouterStorage</a></h3>
<p>Core storage structure for kAssetRouter using ERC-7201 namespaced storage pattern</p>
<p><em>This structure manages all state for money flow coordination and settlement operations.
Uses the diamond storage pattern to avoid storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kAssetRouter</p>
<pre><code class="language-solidity">struct kAssetRouterStorage {
    uint256 proposalCounter;
    uint256 vaultSettlementCooldown;
    mapping(address account =&gt; mapping(bytes32 batchId =&gt; Balances)) vaultBatchBalances;
    mapping(address vault =&gt; mapping(bytes32 batchId =&gt; uint256)) vaultRequestedShares;
    mapping(bytes32 proposalId =&gt; VaultSettlementProposal) settlementProposals;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kbatchreceiver"><a class="header" href="#kbatchreceiver">kBatchReceiver</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kBatchReceiver.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kBatchReceiver.sol//src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html">IkBatchReceiver</a></p>
<p>Minimal proxy contract that holds and distributes settled assets for batch redemptions</p>
<p><em>Deployed per batch to isolate asset distribution and enable efficient settlement</em></p>
<h2 id="state-variables-7"><a class="header" href="#state-variables-7">State Variables</a></h2>
<h3 id="kminter-1"><a class="header" href="#kminter-1">kMinter</a></h3>
<p>Address of the kMinter contract authorized to interact with this receiver</p>
<p><em>Immutable reference set at construction time for gas efficiency and security. This address
has exclusive permission to call pullAssets() and rescueAssets(), ensuring only the originating
kMinter can manage asset distribution for this specific batch. The immutable nature prevents
modification and reduces gas costs for access control checks.</em></p>
<pre><code class="language-solidity">address public immutable kMinter;
</code></pre>
<h3 id="asset-3"><a class="header" href="#asset-3">asset</a></h3>
<p>Address of the underlying asset contract this receiver will distribute</p>
<p><em>Set during initialization to specify which token type (USDC, WBTC, etc.) this receiver
manages. Must match the asset type that was originally deposited and requested for redemption
in the associated batch. Used for asset transfer operations and rescue validation.</em></p>
<pre><code class="language-solidity">address public asset;
</code></pre>
<h3 id="batchid-1"><a class="header" href="#batchid-1">batchId</a></h3>
<p>Unique batch identifier linking this receiver to a specific redemption batch</p>
<p><em>Set during initialization to establish the connection between this receiver and the batch
of redemption requests it serves. Used for validation in pullAssets() to ensure operations
are performed on the correct batch, preventing cross-contamination between settlement periods.</em></p>
<pre><code class="language-solidity">bytes32 public batchId;
</code></pre>
<h3 id="isinitialised-1"><a class="header" href="#isinitialised-1">isInitialised</a></h3>
<pre><code class="language-solidity">bool public isInitialised;
</code></pre>
<h3 id="isinitialised"><a class="header" href="#isinitialised">isInitialised</a></h3>
<p>Initialization state flag preventing duplicate configuration</p>
<p><em>Boolean flag that prevents re-initialization after the receiver has been configured.
Set to true during the initialize() call to ensure batch parameters can only be set once,
maintaining the integrity of the receiver's purpose and preventing operational errors.</em></p>
<pre><code class="language-solidity">bool public isInitialised;
</code></pre>
<h2 id="functions-38"><a class="header" href="#functions-38">Functions</a></h2>
<h3 id="constructor-4"><a class="header" href="#constructor-4">constructor</a></h3>
<p>Deploys a new kBatchReceiver with immutable kMinter authorization</p>
<p><em>Constructor for minimal proxy implementation that establishes the sole authorized caller.
The kMinter address is set as immutable during deployment to ensure gas efficiency and prevent
unauthorized modifications. This constructor is called once per batch receiver deployment,
establishing the security foundation for all subsequent operations. The address validation
ensures no receiver can be deployed with invalid authorization.</em></p>
<pre><code class="language-solidity">constructor(address _kMinter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_kMinter</code></td><td><code>address</code></td><td>Address of the kMinter contract that will have exclusive interaction rights</td></tr>
</tbody></table>
</div>
<h3 id="initialize-3"><a class="header" href="#initialize-3">initialize</a></h3>
<p>Configures the receiver with batch-specific parameters after deployment</p>
<p><em>Post-deployment initialization that links this receiver to a specific batch and asset type.
This two-step deployment pattern (constructor + initialize) enables efficient minimal proxy usage
where the implementation is deployed once and initialization customizes each instance. The function:
(1) prevents duplicate initialization with isInitialised flag, (2) validates asset address,
(3) stores batch parameters for operational use, (4) emits initialization event for tracking.
Only callable once per receiver instance to maintain batch isolation integrity.</em></p>
<pre><code class="language-solidity">function initialize(bytes32 _batchId, address _asset) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The unique batch identifier this receiver will serve</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>Address of the underlying asset contract (USDC, WBTC, etc.) to distribute</td></tr>
</tbody></table>
</div>
<h3 id="pullassets-1"><a class="header" href="#pullassets-1">pullAssets</a></h3>
<p>Transfers settled assets from the receiver to a redemption user completing their withdrawal</p>
<p><em>This is the core asset distribution function that fulfills redemption requests after batch settlement.
The process works as follows: (1) kMinter calls this function with user's proportional share, (2) receiver
validates the batch ID matches to prevent cross-batch contamination, (3) assets are transferred directly
to the user completing their redemption. Only callable by the authorized kMinter contract to maintain strict
access control. This function is typically called multiple times per batch as individual users claim their
settled redemptions, ensuring fair and orderly asset distribution.</em></p>
<pre><code class="language-solidity">function pullAssets(address receiver, uint256 amount, bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>Address to receive the assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount of assets to transfer</td></tr>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>Batch ID for validation (must match this receiver's batch)</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="kminter-2"><a class="header" href="#kminter-2">kMinter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kMinter.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kMinter.sol//src/interfaces/IkMinter.sol/interface.IkMinter.html">IkMinter</a>, Initializable, UUPSUpgradeable, <a href="src/kMinter.sol//src/base/kBase.sol/contract.kBase.html">kBase</a>, <a href="src/kMinter.sol//src/abstracts/Extsload.sol/abstract.Extsload.html">Extsload</a></p>
<p>Institutional minting and redemption manager for kTokens</p>
<p><em>Manages deposits/redemptions through kStakingVault with batch settlement</em></p>
<h2 id="state-variables-8"><a class="header" href="#state-variables-8">State Variables</a></h2>
<h3 id="institution_role"><a class="header" href="#institution_role">INSTITUTION_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant INSTITUTION_ROLE = _ROLE_3;
</code></pre>
<h3 id="kminter_storage_location"><a class="header" href="#kminter_storage_location">KMINTER_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KMINTER_STORAGE_LOCATION = 0xd0574379115d2b8497bfd9020aa9e0becaffc59e5509520aa5fe8c763e40d000;
</code></pre>
<h2 id="functions-39"><a class="header" href="#functions-39">Functions</a></h2>
<h3 id="_getkminterstorage"><a class="header" href="#_getkminterstorage">_getkMinterStorage</a></h3>
<p>Retrieves the kMinter storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkMinterStorage() private pure returns (kMinterStorage storage $);
</code></pre>
<h3 id="whennotpaused-2"><a class="header" href="#whennotpaused-2">whenNotPaused</a></h3>
<p>Ensures function cannot be called when contract is paused</p>
<pre><code class="language-solidity">modifier whenNotPaused();
</code></pre>
<h3 id="onlyinstitution-1"><a class="header" href="#onlyinstitution-1">onlyInstitution</a></h3>
<p>Ensures function can only be called by an institution</p>
<pre><code class="language-solidity">modifier onlyInstitution();
</code></pre>
<h3 id="constructor-4"><a class="header" href="#constructor-4">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-4"><a class="header" href="#initialize-4">initialize</a></h3>
<p>Initializes the kMinter contract</p>
<pre><code class="language-solidity">function initialize(address registry_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>Address of the registry contract</td></tr>
</tbody></table>
</div>
<h3 id="mint-2"><a class="header" href="#mint-2">mint</a></h3>
<p>Creates new kTokens by accepting underlying asset deposits in a 1:1 ratio</p>
<p><em>Validates request parameters, transfers assets, deposits to vault, and mints tokens</em></p>
<pre><code class="language-solidity">function mint(
    address asset_,
    address to_,
    uint256 amount_
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyInstitution
    onlyRegisteredAsset(asset_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="requestredeem-1"><a class="header" href="#requestredeem-1">requestRedeem</a></h3>
<p>Initiates redemption process by burning kTokens and creating batch redemption request</p>
<p><em>Burns tokens immediately, generates unique request ID, and adds to batch for settlement</em></p>
<pre><code class="language-solidity">function requestRedeem(
    address asset_,
    address to_,
    uint256 amount_
)
    external
    payable
    nonReentrant
    whenNotPaused
    onlyInstitution
    onlyRegisteredAsset(asset_)
    returns (bytes32 requestId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>A unique bytes32 identifier for tracking and executing this redemption request</td></tr>
</tbody></table>
</div>
<h3 id="redeem-3"><a class="header" href="#redeem-3">redeem</a></h3>
<p>Executes redemption for a request in a settled batch</p>
<pre><code class="language-solidity">function redeem(bytes32 requestId) external payable nonReentrant whenNotPaused onlyInstitution;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to execute (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="cancelrequest-1"><a class="header" href="#cancelrequest-1">cancelRequest</a></h3>
<p>Cancels a redemption request before batch settlement</p>
<pre><code class="language-solidity">function cancelRequest(bytes32 requestId) external payable nonReentrant whenNotPaused onlyInstitution;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the redemption request to cancel (obtained from requestRedeem)</td></tr>
</tbody></table>
</div>
<h3 id="_checknotpaused"><a class="header" href="#_checknotpaused">_checkNotPaused</a></h3>
<p>Check if contract is not paused</p>
<pre><code class="language-solidity">function _checkNotPaused() private view;
</code></pre>
<h3 id="_checkinstitution"><a class="header" href="#_checkinstitution">_checkInstitution</a></h3>
<p>Check if caller is an institution</p>
<pre><code class="language-solidity">function _checkInstitution(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-2"><a class="header" href="#_checkadmin-2">_checkAdmin</a></h3>
<p>Check if caller is an admin</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkvalidasset"><a class="header" href="#_checkvalidasset">_checkValidAsset</a></h3>
<p>Check if asset is valid/supported</p>
<pre><code class="language-solidity">function _checkValidAsset(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkamountnotzero-3"><a class="header" href="#_checkamountnotzero-3">_checkAmountNotZero</a></h3>
<p>Check if amount is not zero</p>
<pre><code class="language-solidity">function _checkAmountNotZero(uint256 amount) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero-2"><a class="header" href="#_checkaddressnotzero-2">_checkAddressNotZero</a></h3>
<p>Check if address is not zero</p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_createredeemrequestid"><a class="header" href="#_createredeemrequestid">_createRedeemRequestId</a></h3>
<p>Generates a request ID</p>
<pre><code class="language-solidity">function _createRedeemRequestId(address user, uint256 amount, uint256 timestamp) private returns (bytes32);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>User address</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>Amount</td></tr>
<tr><td><code>timestamp</code></td><td><code>uint256</code></td><td>Timestamp</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>Request ID</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-5"><a class="header" href="#setpaused-5">setPaused</a></h3>
<p>Set contract pause state</p>
<pre><code class="language-solidity">function setPaused(bool paused) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused</code></td><td><code>bool</code></td><td>New pause state</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-4"><a class="header" href="#ispaused-4">isPaused</a></h3>
<p>Check if contract is paused</p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if paused, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="getredeemrequest-1"><a class="header" href="#getredeemrequest-1">getRedeemRequest</a></h3>
<p>Retrieves details of a specific redemption request</p>
<p><em>Returns the complete RedeemRequest struct containing all request information</em></p>
<pre><code class="language-solidity">function getRedeemRequest(bytes32 requestId) external view returns (RedeemRequest memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>requestId</code></td><td><code>bytes32</code></td><td>The unique identifier of the request</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>RedeemRequest</code></td><td>The complete RedeemRequest struct with status, amounts, and batch information</td></tr>
</tbody></table>
</div>
<h3 id="getuserrequests-1"><a class="header" href="#getuserrequests-1">getUserRequests</a></h3>
<p>Gets all redemption request IDs for a specific user</p>
<p><em>Returns request IDs from the user's enumerable set for efficient tracking</em></p>
<pre><code class="language-solidity">function getUserRequests(address user) external view returns (bytes32[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The user address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32[]</code></td><td>Array of request IDs belonging to the user</td></tr>
</tbody></table>
</div>
<h3 id="getrequestcounter-1"><a class="header" href="#getrequestcounter-1">getRequestCounter</a></h3>
<p>Gets the current request counter value</p>
<p><em>Returns the monotonically increasing counter used for generating unique request IDs</em></p>
<pre><code class="language-solidity">function getRequestCounter() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The current counter used for generating unique request IDs</td></tr>
</tbody></table>
</div>
<h3 id="gettotallockedassets-1"><a class="header" href="#gettotallockedassets-1">getTotalLockedAssets</a></h3>
<p>Gets the total locked assets for a specific asset</p>
<p><em>Returns the cumulative amount of assets deposited through mint operations for accounting</em></p>
<pre><code class="language-solidity">function getTotalLockedAssets(address asset) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of assets locked in the protocol</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade-4"><a class="header" href="#_authorizeupgrade-4">_authorizeUpgrade</a></h3>
<p>Authorizes contract upgrades</p>
<p><em>Only callable by ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="contractname-5"><a class="header" href="#contractname-5">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-5"><a class="header" href="#contractversion-5">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h2 id="structs-11"><a class="header" href="#structs-11">Structs</a></h2>
<h3 id="kminterstorage"><a class="header" href="#kminterstorage">kMinterStorage</a></h3>
<p>Core storage structure for kMinter using ERC-7201 namespaced storage pattern</p>
<p><em>This structure manages all state for institutional minting and redemption operations.
Uses the diamond storage pattern to avoid storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kMinter</p>
<pre><code class="language-solidity">struct kMinterStorage {
    mapping(address =&gt; uint256) totalLockedAssets;
    uint64 requestCounter;
    mapping(bytes32 =&gt; RedeemRequest) redeemRequests;
    mapping(address =&gt; OptimizedBytes32EnumerableSetLib.Bytes32Set) userRequests;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kregistry"><a class="header" href="#kregistry">kRegistry</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kRegistry.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/kRegistry.sol//src/interfaces/IkRegistry.sol/interface.IkRegistry.html">IkRegistry</a>, Initializable, UUPSUpgradeable, OwnableRoles</p>
<p>Central registry for KAM protocol contracts</p>
<p><em>Manages singleton contracts, vault registration, asset support, and kToken mapping</em></p>
<h2 id="state-variables-9"><a class="header" href="#state-variables-9">State Variables</a></h2>
<h3 id="admin_role-3"><a class="header" href="#admin_role-3">ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="relayer_role"><a class="header" href="#relayer_role">RELAYER_ROLE</a></h3>
<pre><code class="language-solidity">uint256 internal constant RELAYER_ROLE = _ROLE_1;
</code></pre>
<h3 id="guardian_role"><a class="header" href="#guardian_role">GUARDIAN_ROLE</a></h3>
<p>Guardian role as a circuit breaker for settlement proposals</p>
<pre><code class="language-solidity">uint256 internal constant GUARDIAN_ROLE = _ROLE_2;
</code></pre>
<h3 id="k_minter-3"><a class="header" href="#k_minter-3">K_MINTER</a></h3>
<pre><code class="language-solidity">bytes32 public constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router-3"><a class="header" href="#k_asset_router-3">K_ASSET_ROUTER</a></h3>
<p>kAssetRouter key</p>
<pre><code class="language-solidity">bytes32 public constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="usdc"><a class="header" href="#usdc">USDC</a></h3>
<p>USDC key</p>
<pre><code class="language-solidity">bytes32 public constant USDC = keccak256("USDC");
</code></pre>
<h3 id="wbtc"><a class="header" href="#wbtc">WBTC</a></h3>
<p>WBTC key</p>
<pre><code class="language-solidity">bytes32 public constant WBTC = keccak256("WBTC");
</code></pre>
<h3 id="max_bps-1"><a class="header" href="#max_bps-1">MAX_BPS</a></h3>
<p>Maximum basis points (100%)</p>
<pre><code class="language-solidity">uint256 constant MAX_BPS = 10_000;
</code></pre>
<h3 id="kregistry_storage_location"><a class="header" href="#kregistry_storage_location">KREGISTRY_STORAGE_LOCATION</a></h3>
<pre><code class="language-solidity">bytes32 private constant KREGISTRY_STORAGE_LOCATION = 0x164f5345d77b48816cdb20100c950b74361454722dab40c51ecf007b721fa800;
</code></pre>
<h2 id="functions-40"><a class="header" href="#functions-40">Functions</a></h2>
<h3 id="_getkregistrystorage"><a class="header" href="#_getkregistrystorage">_getkRegistryStorage</a></h3>
<p>Retrieves the kRegistry storage struct from its designated storage slot</p>
<p><em>Uses ERC-7201 namespaced storage pattern to access the storage struct at a deterministic location.
This approach prevents storage collisions in upgradeable contracts and allows safe addition of new
storage variables in future upgrades without affecting existing storage layout.</em></p>
<pre><code class="language-solidity">function _getkRegistryStorage() private pure returns (kRegistryStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kRegistryStorage</code></td><td>The kRegistryStorage struct reference for state modifications</td></tr>
</tbody></table>
</div>
<h3 id="constructor-6"><a class="header" href="#constructor-6">constructor</a></h3>
<p>Disables initializers to prevent implementation contract initialization</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize-5"><a class="header" href="#initialize-5">initialize</a></h3>
<p>Initializes the kRegistry contract</p>
<pre><code class="language-solidity">function initialize(address owner_, address admin_, address relayer_, address guardian_) external initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>owner_</code></td><td><code>address</code></td><td>Contract owner address</td></tr>
<tr><td><code>admin_</code></td><td><code>address</code></td><td>Admin role recipient</td></tr>
<tr><td><code>relayer_</code></td><td><code>address</code></td><td></td></tr>
<tr><td><code>guardian_</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="setsingletoncontract-1"><a class="header" href="#setsingletoncontract-1">setSingletonContract</a></h3>
<p>Set a singleton contract address</p>
<p><em>Only callable by ADMIN_ROLE</em></p>
<pre><code class="language-solidity">function setSingletonContract(bytes32 id, address contractAddress) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Unique contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>Address of the singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="registerasset-1"><a class="header" href="#registerasset-1">registerAsset</a></h3>
<p>Register support for a new asset and its corresponding kToken</p>
<p><em>Only callable by ADMIN_ROLE, establishes bidirectional mapping</em></p>
<pre><code class="language-solidity">function registerAsset(address asset, bytes32 id) external onlyRoles(ADMIN_ROLE) returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Underlying asset address (e.g., USDC, WBTC)</td></tr>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td></td></tr>
</tbody></table>
</div>
<h3 id="registervault-1"><a class="header" href="#registervault-1">registerVault</a></h3>
<p>Register a new vault in the protocol</p>
<p><em>Only callable by ADMIN_ROLE, sets as primary if first of its type</em></p>
<pre><code class="language-solidity">function registerVault(address vault, VaultType type_, address asset) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to register</td></tr>
<tr><td><code>type_</code></td><td><code>VaultType</code></td><td>The vault classification type (DN, ALPHA, BETA, etc.) determining its role</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address this vault will manage</td></tr>
</tbody></table>
</div>
<h3 id="removevault-1"><a class="header" href="#removevault-1">removeVault</a></h3>
<p>Removes a vault from the protocol registry</p>
<p><em>This function deregisters a vault, removing it from the active vault set. This operation should be
used carefully as it affects routing and asset management. Only callable by ADMIN_ROLE to ensure proper
decommissioning procedures are followed. Note that this doesn't clear all vault mappings for gas efficiency.</em></p>
<pre><code class="language-solidity">function removeVault(address vault) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault contract address to remove from the registry</td></tr>
</tbody></table>
</div>
<h3 id="settreasury-1"><a class="header" href="#settreasury-1">setTreasury</a></h3>
<p>Sets the treasury address</p>
<p><em>Treasury receives protocol fees and serves as emergency fund holder. Only callable by ADMIN_ROLE.</em></p>
<pre><code class="language-solidity">function setTreasury(address treasury_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>treasury_</code></td><td><code>address</code></td><td>The new treasury address</td></tr>
</tbody></table>
</div>
<h3 id="removevault"><a class="header" href="#removevault">removeVault</a></h3>
<pre><code class="language-solidity">function removeVault(address vault) external payable;
</code></pre>
<h3 id="registeradapter-1"><a class="header" href="#registeradapter-1">registerAdapter</a></h3>
<p>Registers an adapter for a specific vault</p>
<pre><code class="language-solidity">function registerAdapter(address vault, address adapter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the adapter</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter contract address</td></tr>
</tbody></table>
</div>
<h3 id="removeadapter-1"><a class="header" href="#removeadapter-1">removeAdapter</a></h3>
<p>Removes an adapter for a specific vault</p>
<pre><code class="language-solidity">function removeAdapter(address vault, address adapter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to remove the adapter from</td></tr>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>The adapter address to remove</td></tr>
</tbody></table>
</div>
<h3 id="sethurdlerate-1"><a class="header" href="#sethurdlerate-1">setHurdleRate</a></h3>
<p>Sets the hurdle rate for a specific asset</p>
<p><em>Only relayer can set hurdle rates (performance thresholds). Ensures hurdle rate doesn't exceed 100%.
Asset must be registered before setting hurdle rate. Sets minimum performance threshold for yield distribution.</em></p>
<pre><code class="language-solidity">function setHurdleRate(address asset, uint16 hurdleRate) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to set hurdle rate for</td></tr>
<tr><td><code>hurdleRate</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points (100 = 1%)</td></tr>
</tbody></table>
</div>
<h3 id="gethurdlerate-1"><a class="header" href="#gethurdlerate-1">getHurdleRate</a></h3>
<p>Gets the hurdle rate for a specific asset</p>
<p><em>Returns minimum performance threshold in basis points for yield distribution.
Asset must be registered to query hurdle rate.</em></p>
<pre><code class="language-solidity">function getHurdleRate(address asset) external view returns (uint16);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint16</code></td><td>The hurdle rate in basis points</td></tr>
</tbody></table>
</div>
<h3 id="getcontractbyid-1"><a class="header" href="#getcontractbyid-1">getContractById</a></h3>
<p>Retrieves a singleton contract address by identifier</p>
<p><em>Reverts if contract not registered. Used for protocol contract discovery.</em></p>
<pre><code class="language-solidity">function getContractById(bytes32 id) public view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Contract identifier (e.g., K_MINTER, K_ASSET_ROUTER)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address</td></tr>
</tbody></table>
</div>
<h3 id="getassetbyid-1"><a class="header" href="#getassetbyid-1">getAssetById</a></h3>
<p>Retrieves a singleton asset address by identifier</p>
<p><em>Reverts if asset not registered. Provides named access to common assets.</em></p>
<pre><code class="language-solidity">function getAssetById(bytes32 id) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>bytes32</code></td><td>Asset identifier (e.g., USDC, WBTC)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<h3 id="getallassets-1"><a class="header" href="#getallassets-1">getAllAssets</a></h3>
<p>Gets all protocol-supported asset addresses</p>
<p><em>Returns the complete whitelist of supported underlying assets.</em></p>
<pre><code class="language-solidity">function getAllAssets() external view returns (address[] memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of supported asset addresses</td></tr>
</tbody></table>
</div>
<h3 id="getcorecontracts-1"><a class="header" href="#getcorecontracts-1">getCoreContracts</a></h3>
<p>Retrieves core protocol contract addresses in one call</p>
<p><em>Optimized getter for frequently accessed contracts. Reverts if either not set.</em></p>
<pre><code class="language-solidity">function getCoreContracts() external view returns (address, address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>kMinter The kMinter contract address</td></tr>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>kAssetRouter The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="getvaultsbyasset-1"><a class="header" href="#getvaultsbyasset-1">getVaultsByAsset</a></h3>
<p>Gets all vaults that support a specific asset</p>
<p><em>Enables discovery of all vaults capable of handling an asset across different types.</em></p>
<pre><code class="language-solidity">function getVaultsByAsset(address asset) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>Asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of vault addresses supporting the asset</td></tr>
</tbody></table>
</div>
<h3 id="getvaultbyassetandtype-1"><a class="header" href="#getvaultbyassetandtype-1">getVaultByAssetAndType</a></h3>
<p>Retrieves the primary vault for an asset-type combination</p>
<p><em>Used for routing operations to the appropriate vault. Reverts if not found.</em></p>
<pre><code class="language-solidity">function getVaultByAssetAndType(address asset, uint8 vaultType) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
<tr><td><code>vaultType</code></td><td><code>uint8</code></td><td>The vault type classification</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The vault address for the asset-type pair</td></tr>
</tbody></table>
</div>
<h3 id="getvaulttype-1"><a class="header" href="#getvaulttype-1">getVaultType</a></h3>
<p>Gets the classification type of a vault</p>
<p><em>Returns the VaultType enum value for routing and strategy selection.</em></p>
<pre><code class="language-solidity">function getVaultType(address vault) external view returns (uint8);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The vault's type classification</td></tr>
</tbody></table>
</div>
<h3 id="isrelayer-1"><a class="header" href="#isrelayer-1">isRelayer</a></h3>
<p>Check if the caller is the relayer</p>
<pre><code class="language-solidity">function isRelayer(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the caller is the relayer</td></tr>
</tbody></table>
</div>
<h3 id="isguardian-1"><a class="header" href="#isguardian-1">isGuardian</a></h3>
<p>Checks if an address has guardian privileges</p>
<p><em>Guardian acts as circuit breaker for settlement proposals.</em></p>
<pre><code class="language-solidity">function isGuardian(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has GUARDIAN_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isregisteredasset-1"><a class="header" href="#isregisteredasset-1">isRegisteredAsset</a></h3>
<p>Check if an asset is supported</p>
<pre><code class="language-solidity">function isRegisteredAsset(address asset) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if address has RELAYER_ROLE</td></tr>
</tbody></table>
</div>
<h3 id="isinstitution-1"><a class="header" href="#isinstitution-1">isInstitution</a></h3>
<p>Checks if an address is a qualified institution</p>
<p><em>Institutions have access to privileged operations like kMinter.</em></p>
<pre><code class="language-solidity">function isInstitution(address user) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the vault is registered</td></tr>
</tbody></table>
</div>
<h3 id="issingletoncontract-1"><a class="header" href="#issingletoncontract-1">isSingletonContract</a></h3>
<p>Check if a contract is a singleton contract</p>
<pre><code class="language-solidity">function isSingletonContract(address contractAddress) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>contractAddress</code></td><td><code>address</code></td><td>Contract address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the contract is a singleton contract</td></tr>
</tbody></table>
</div>
<h3 id="getadapters-1"><a class="header" href="#getadapters-1">getAdapters</a></h3>
<p>Gets all adapters registered for a specific vault</p>
<p><em>Returns external protocol integrations enabling yield strategies.</em></p>
<pre><code class="language-solidity">function getAdapters(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of adapter addresses for the vault</td></tr>
</tbody></table>
</div>
<h3 id="isadapterregistered-1"><a class="header" href="#isadapterregistered-1">isAdapterRegistered</a></h3>
<p>Check if an adapter is registered</p>
<pre><code class="language-solidity">function isAdapterRegistered(address adapter) external view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>adapter</code></td><td><code>address</code></td><td>Adapter address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if adapter is registered for the vault</td></tr>
</tbody></table>
</div>
<h3 id="getvaultassets-1"><a class="header" href="#getvaultassets-1">getVaultAssets</a></h3>
<p>Gets all assets managed by a specific vault</p>
<p><em>Most vaults manage single asset, some (like kMinter) handle multiple.</em></p>
<pre><code class="language-solidity">function getVaultAssets(address vault) external view returns (address[] memory);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address[]</code></td><td>Array of asset addresses the vault manages</td></tr>
</tbody></table>
</div>
<h3 id="assettoktoken-1"><a class="header" href="#assettoktoken-1">assetToKToken</a></h3>
<p>Gets the kToken address for a specific underlying asset</p>
<p><em>Critical for minting/redemption operations. Reverts if no kToken exists.</em></p>
<pre><code class="language-solidity">function assetToKToken(address asset) external view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>KToken address</td></tr>
</tbody></table>
</div>
<h3 id="_hasrole"><a class="header" href="#_hasrole">_hasRole</a></h3>
<p>Internal helper to check if a user has a specific role</p>
<p><em>Wraps the OptimizedOwnableRoles hasAnyRole function for role verification</em></p>
<pre><code class="language-solidity">function _hasRole(address user, uint256 role_) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for role membership</td></tr>
<tr><td><code>role_</code></td><td><code>uint256</code></td><td>The role constant to check (e.g., ADMIN_ROLE, VENDOR_ROLE)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the user has the specified role, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="_checkadmin-3"><a class="header" href="#_checkadmin-3">_checkAdmin</a></h3>
<p>Check if caller has admin role</p>
<pre><code class="language-solidity">function _checkAdmin(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkvendor"><a class="header" href="#_checkvendor">_checkVendor</a></h3>
<p>Check if caller has vendor role</p>
<pre><code class="language-solidity">function _checkVendor(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkrelayer-1"><a class="header" href="#_checkrelayer-1">_checkRelayer</a></h3>
<p>Check if caller has relayer role</p>
<pre><code class="language-solidity">function _checkRelayer(address user) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkaddressnotzero-3"><a class="header" href="#_checkaddressnotzero-3">_checkAddressNotZero</a></h3>
<p>Check if address is not zero</p>
<pre><code class="language-solidity">function _checkAddressNotZero(address addr) private pure;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>addr</code></td><td><code>address</code></td><td>Address to check</td></tr>
</tbody></table>
</div>
<h3 id="_checkassetnotregistered"><a class="header" href="#_checkassetnotregistered">_checkAssetNotRegistered</a></h3>
<p>Validates that an asset is not already registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ALREADY_REGISTERED if the asset exists in supportedAssets set.
Used to prevent duplicate registrations and maintain protocol integrity.</em></p>
<pre><code class="language-solidity">function _checkAssetNotRegistered(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkassetregistered"><a class="header" href="#_checkassetregistered">_checkAssetRegistered</a></h3>
<p>Validates that an asset is registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ASSET_NOT_SUPPORTED if the asset doesn't exist in supportedAssets set.
Used to ensure operations only occur on whitelisted assets.</em></p>
<pre><code class="language-solidity">function _checkAssetRegistered(address asset) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_checkvaultregistered"><a class="header" href="#_checkvaultregistered">_checkVaultRegistered</a></h3>
<p>Validates that a vault is registered in the protocol</p>
<p><em>Reverts with KREGISTRY_ASSET_NOT_SUPPORTED if the vault doesn't exist in allVaults set.
Used to ensure operations only occur on registered vaults. Note: error message could be improved.</em></p>
<pre><code class="language-solidity">function _checkVaultRegistered(address vault) private view;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to validate</td></tr>
</tbody></table>
</div>
<h3 id="_trygetassetdecimals"><a class="header" href="#_trygetassetdecimals">_tryGetAssetDecimals</a></h3>
<p>*Helper function to get the decimals of the underlying asset.
Useful for setting the return value of <code>_underlyingDecimals</code> during initialization.
If the retrieval succeeds, <code>success</code> will be true, and <code>result</code> will hold the result.
Otherwise, <code>success</code> will be false, and <code>result</code> will be zero.
Example usage:</p>
<pre><code>(bool success, uint8 result) = _tryGetAssetDecimals(underlying);
_decimals = success ? result : _DEFAULT_UNDERLYING_DECIMALS;
```*


```solidity
function _tryGetAssetDecimals(address underlying) internal view returns (bool success, uint8 result);
</code></pre>
<h3 id="_authorizeupgrade-5"><a class="header" href="#_authorizeupgrade-5">_authorizeUpgrade</a></h3>
<p>Authorizes contract upgrades</p>
<p><em>Only callable by contract owner</em></p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal view override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newImplementation</code></td><td><code>address</code></td><td>New implementation address</td></tr>
</tbody></table>
</div>
<h3 id="receive-3"><a class="header" href="#receive-3">receive</a></h3>
<p>Receive ETH (for gas refunds, etc.)</p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="contractname-6"><a class="header" href="#contractname-6">contractName</a></h3>
<p>Returns the contract name</p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract name</td></tr>
</tbody></table>
</div>
<h3 id="contractversion-6"><a class="header" href="#contractversion-6">contractVersion</a></h3>
<p>Returns the contract version</p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>Contract version</td></tr>
</tbody></table>
</div>
<h2 id="structs-12"><a class="header" href="#structs-12">Structs</a></h2>
<h3 id="kregistrystorage"><a class="header" href="#kregistrystorage">kRegistryStorage</a></h3>
<p>Core storage structure for kRegistry using ERC-7201 namespaced storage pattern</p>
<p><em>This structure maintains all protocol configuration state including contracts, assets, vaults, and
permissions.
Uses the diamond storage pattern to prevent storage collisions in upgradeable contracts.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kRegistry</p>
<pre><code class="language-solidity">struct kRegistryStorage {
    mapping(bytes32 =&gt; address) singletonContracts;
    mapping(address =&gt; uint8 vaultType) vaultType;
    mapping(address =&gt; mapping(uint8 vaultType =&gt; address)) assetToVault;
    mapping(address =&gt; EnumerableSetLib.AddressSet) vaultAsset;
    EnumerableSetLib.AddressSet allVaults;
    mapping(address =&gt; EnumerableSetLib.AddressSet) vaultsByAsset;
    mapping(bytes32 =&gt; address) singletonAssets;
    mapping(address =&gt; address) assetToKToken;
    mapping(address =&gt; bool) isRegisteredAsset;
    EnumerableSetLib.AddressSet supportedAssets;
    mapping(address =&gt; EnumerableSetLib.AddressSet) vaultAdapters;
    mapping(address =&gt; bool) registeredAdapters;
    mapping(address =&gt; uint16) assetHurdleRate;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ktoken-1"><a class="header" href="#ktoken-1">kToken</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/d9f3bcfb40b15ca7c34b1d780c519322be4b7590/src/kToken.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC20, OwnableRoles, ReentrancyGuard, Multicallable</p>
<p>ERC20 token with role-based minting and burning capabilities</p>
<p><em>Implements UUPS upgradeable pattern with 1:1 backing by underlying assets</em></p>
<h2 id="state-variables-10"><a class="header" href="#state-variables-10">State Variables</a></h2>
<h3 id="admin_role-4"><a class="header" href="#admin_role-4">ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant ADMIN_ROLE = _ROLE_0;
</code></pre>
<h3 id="emergency_admin_role-1"><a class="header" href="#emergency_admin_role-1">EMERGENCY_ADMIN_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant EMERGENCY_ADMIN_ROLE = _ROLE_1;
</code></pre>
<h3 id="minter_role"><a class="header" href="#minter_role">MINTER_ROLE</a></h3>
<pre><code class="language-solidity">uint256 public constant MINTER_ROLE = _ROLE_2;
</code></pre>
<h3 id="_ispaused"><a class="header" href="#_ispaused">_isPaused</a></h3>
<pre><code class="language-solidity">bool _isPaused;
</code></pre>
<h3 id="_name"><a class="header" href="#_name">_name</a></h3>
<pre><code class="language-solidity">string _name;
</code></pre>
<h3 id="_symbol"><a class="header" href="#_symbol">_symbol</a></h3>
<pre><code class="language-solidity">string _symbol;
</code></pre>
<h3 id="_decimals"><a class="header" href="#_decimals">_decimals</a></h3>
<pre><code class="language-solidity">uint8 _decimals;
</code></pre>
<h2 id="functions-27"><a class="header" href="#functions-27">Functions</a></h2>
<h3 id="whennotpaused-3"><a class="header" href="#whennotpaused-3">whenNotPaused</a></h3>
<p>Prevents function execution when contract is in paused state</p>
<p><em>Checks isPaused flag in storage and reverts with Paused error if true</em></p>
<pre><code class="language-solidity">modifier whenNotPaused();
</code></pre>
<h3 id="constructor-6"><a class="header" href="#constructor-6">constructor</a></h3>
<p>Disables initializers to prevent implementation contract from being initialized</p>
<p><em>Calls _disableInitializers from Solady's Initializable to lock implementation</em></p>
<pre><code class="language-solidity">constructor(address owner_, address admin_, address emergencyAdmin_, address minter_, uint8 decimals_);
</code></pre>
<h3 id="setupmetadata"><a class="header" href="#setupmetadata">setupMetadata</a></h3>
<p>Sets token metadata (separate call to avoid stack too deep)</p>
<p><em>Must be called after initialize, only by admin</em></p>
<pre><code class="language-solidity">function setupMetadata(string calldata name_, string calldata symbol_) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name_</code></td><td><code>string</code></td><td>Token name</td></tr>
<tr><td><code>symbol_</code></td><td><code>string</code></td><td>Token symbol</td></tr>
</tbody></table>
</div>
<h3 id="mint-3"><a class="header" href="#mint-3">mint</a></h3>
<p>Creates new kTokens and assigns them to the specified address</p>
<p><em>This function serves two critical purposes in the KAM protocol: (1) kMinter calls this when institutional
users deposit underlying assets, minting kTokens 1:1 to maintain backing ratio, (2) kAssetRouter calls this
to distribute positive yield to vaults, increasing the kToken supply to reflect earned returns. The function
is restricted to MINTER_ROLE holders (kMinter, kAssetRouter) and requires the contract to not be paused.
All minting operations emit a Minted event for transparency and tracking.</em></p>
<pre><code class="language-solidity">function mint(address _to, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_to</code></td><td><code>address</code></td><td>The address that will receive the newly minted kTokens</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to create (matches asset amount for deposits, yield amount for distributions)</td></tr>
</tbody></table>
</div>
<h3 id="burn-1"><a class="header" href="#burn-1">burn</a></h3>
<p>Destroys kTokens from the specified address</p>
<p><em>This function handles token destruction for two main scenarios: (1) kMinter burns escrowed kTokens during
successful redemptions, reducing total supply to match the underlying assets being withdrawn, (2) kAssetRouter
burns kTokens from vaults when negative yield/losses occur, ensuring the kToken supply accurately reflects the
reduced underlying asset value. The burn operation is permanent and irreversible, requiring careful validation.
Only MINTER_ROLE holders can execute burns, and the contract must not be paused.</em></p>
<pre><code class="language-solidity">function burn(address _from, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_from</code></td><td><code>address</code></td><td>The address from which kTokens will be permanently destroyed</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to burn (matches redeemed assets or loss amounts)</td></tr>
</tbody></table>
</div>
<h3 id="burnfrom-1"><a class="header" href="#burnfrom-1">burnFrom</a></h3>
<p>Destroys kTokens from a specified address using the ERC20 allowance mechanism</p>
<p><em>This function enables more complex burning scenarios where the token holder has pre-approved the burn
operation. The process involves: (1) checking and consuming the allowance between token owner and the minter,
(2) burning the specified amount from the owner's balance. This is useful for automated systems or contracts
that need to burn tokens on behalf of users, such as complex redemption flows or third-party integrations.
The allowance model provides additional security by requiring explicit approval before token destruction.</em></p>
<pre><code class="language-solidity">function burnFrom(address _from, uint256 _amount) external onlyRoles(MINTER_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_from</code></td><td><code>address</code></td><td>The address from which kTokens will be burned (must have approved the burn amount)</td></tr>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>The quantity of kTokens to burn using the allowance mechanism</td></tr>
</tbody></table>
</div>
<h3 id="name-6"><a class="header" href="#name-6">name</a></h3>
<p>Retrieves the human-readable name of the token</p>
<p><em>Returns the name stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function name() public view virtual override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The token name as a string</td></tr>
</tbody></table>
</div>
<h3 id="symbol-4"><a class="header" href="#symbol-4">symbol</a></h3>
<p>Retrieves the abbreviated symbol of the token</p>
<p><em>Returns the symbol stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function symbol() public view virtual override returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The token symbol as a string</td></tr>
</tbody></table>
</div>
<h3 id="decimals-4"><a class="header" href="#decimals-4">decimals</a></h3>
<p>Retrieves the number of decimal places for the token</p>
<p><em>Returns the decimals value stored in contract storage during initialization</em></p>
<pre><code class="language-solidity">function decimals() public view virtual override returns (uint8);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint8</code></td><td>The number of decimal places as uint8</td></tr>
</tbody></table>
</div>
<h3 id="ispaused-7"><a class="header" href="#ispaused-7">isPaused</a></h3>
<p>Checks whether the contract is currently in paused state</p>
<p><em>Reads the isPaused flag from contract storage</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Boolean indicating if contract operations are paused</td></tr>
</tbody></table>
</div>
<h3 id="grantadminrole-1"><a class="header" href="#grantadminrole-1">grantAdminRole</a></h3>
<p>Grants administrative privileges to a new address</p>
<p><em>Only the contract owner can grant admin roles, establishing the highest level of access control.
Admins can manage emergency admins and minter roles but cannot bypass owner-only functions.</em></p>
<pre><code class="language-solidity">function grantAdminRole(address admin) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to receive administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeadminrole-1"><a class="header" href="#revokeadminrole-1">revokeAdminRole</a></h3>
<p>Removes administrative privileges from an address</p>
<p><em>Only the contract owner can revoke admin roles, maintaining strict access control hierarchy.
Revoking admin status prevents the address from managing emergency admins and minter roles.</em></p>
<pre><code class="language-solidity">function revokeAdminRole(address admin) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>admin</code></td><td><code>address</code></td><td>The address to lose administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantemergencyrole-1"><a class="header" href="#grantemergencyrole-1">grantEmergencyRole</a></h3>
<p>Grants emergency administrative privileges for protocol safety operations</p>
<p><em>Emergency admins can pause/unpause the contract and execute emergency withdrawals during crises.
This role is critical for protocol security and should only be granted to trusted addresses with
operational procedures in place. Only existing admins can grant emergency roles.</em></p>
<pre><code class="language-solidity">function grantEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to receive emergency administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeemergencyrole-1"><a class="header" href="#revokeemergencyrole-1">revokeEmergencyRole</a></h3>
<p>Removes emergency administrative privileges from an address</p>
<p><em>Removes the ability to pause contracts and execute emergency operations. This should be done
carefully as it reduces the protocol's ability to respond to emergencies.</em></p>
<pre><code class="language-solidity">function revokeEmergencyRole(address emergency) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>emergency</code></td><td><code>address</code></td><td>The address to lose emergency administrative privileges</td></tr>
</tbody></table>
</div>
<h3 id="grantminterrole-1"><a class="header" href="#grantminterrole-1">grantMinterRole</a></h3>
<p>Assigns minter role privileges to the specified address</p>
<p><em>Calls internal _grantRoles function to assign MINTER_ROLE</em></p>
<pre><code class="language-solidity">function grantMinterRole(address minter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address that will receive minter role privileges</td></tr>
</tbody></table>
</div>
<h3 id="revokeminterrole-1"><a class="header" href="#revokeminterrole-1">revokeMinterRole</a></h3>
<p>Removes minter role privileges from the specified address</p>
<p><em>Calls internal _removeRoles function to remove MINTER_ROLE</em></p>
<pre><code class="language-solidity">function revokeMinterRole(address minter) external onlyRoles(ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The address that will lose minter role privileges</td></tr>
</tbody></table>
</div>
<h3 id="setpaused-6"><a class="header" href="#setpaused-6">setPaused</a></h3>
<p>Sets the pause state of the contract</p>
<p><em>Updates the isPaused flag in storage and emits PauseState event</em></p>
<pre><code class="language-solidity">function setPaused(bool isPaused_) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>isPaused_</code></td><td><code>bool</code></td><td>True to pause all operations, false to resume normal operations</td></tr>
</tbody></table>
</div>
<h3 id="emergencywithdraw"><a class="header" href="#emergencywithdraw">emergencyWithdraw</a></h3>
<p>Emergency recovery function for accidentally sent assets</p>
<p><em>This function provides a safety mechanism to recover tokens or ETH accidentally sent to the kToken
contract.
It's designed for emergency situations where users mistakenly transfer assets to the wrong address.
The function can handle both ERC20 tokens and native ETH. Only emergency admins can execute withdrawals
to prevent unauthorized asset extraction. This should not be used for regular operations.</em></p>
<pre><code class="language-solidity">function emergencyWithdraw(address token, address to, uint256 amount) external onlyRoles(EMERGENCY_ADMIN_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>address</code></td><td>The token contract address to withdraw (use address(0) for native ETH)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address to receive the recovered assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens or ETH to recover</td></tr>
</tbody></table>
</div>
<h3 id="_checkpaused-2"><a class="header" href="#_checkpaused-2">_checkPaused</a></h3>
<p>Internal function to validate that the contract is not in emergency pause state</p>
<p><em>Called before all token operations (transfers, mints, burns) to enforce emergency stops.
Reverts with KTOKEN_IS_PAUSED if the contract is paused, effectively halting all token activity.</em></p>
<pre><code class="language-solidity">function _checkPaused() private view;
</code></pre>
<h3 id="_beforetokentransfer-1"><a class="header" href="#_beforetokentransfer-1">_beforeTokenTransfer</a></h3>
<p>Internal hook that executes before any token transfer, mint, or burn operation</p>
<p><em>This critical function enforces the pause mechanism across all token operations by checking the pause
state before allowing any balance changes. It intercepts transfers, mints (from=0), and burns (to=0) to
ensure protocol-wide emergency stops work correctly. The hook pattern allows centralized control over
all token movements while maintaining ERC20 compatibility.</em></p>
<pre><code class="language-solidity">function _beforeTokenTransfer(address from, address to, uint256 amount) internal virtual override;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The source address (address(0) for minting operations)</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address (address(0) for burning operations)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens being transferred/minted/burned</td></tr>
</tbody></table>
</div>
<h2 id="events-11"><a class="header" href="#events-11">Events</a></h2>
<h3 id="minted-2"><a class="header" href="#minted-2">Minted</a></h3>
<pre><code class="language-solidity">event Minted(address indexed to, uint256 amount);
</code></pre>
<h3 id="burned-1"><a class="header" href="#burned-1">Burned</a></h3>
<pre><code class="language-solidity">event Burned(address indexed from, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address from which tokens are burned</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens burned</td></tr>
</tbody></table>
</div>
<h3 id="tokencreated"><a class="header" href="#tokencreated">TokenCreated</a></h3>
<pre><code class="language-solidity">event TokenCreated(address indexed token, address owner);
</code></pre>
<h3 id="tokeninitialized-1"><a class="header" href="#tokeninitialized-1">TokenInitialized</a></h3>
<pre><code class="language-solidity">event TokenInitialized(string name, string symbol, uint8 decimals);
</code></pre>
<h3 id="pausestate-1"><a class="header" href="#pausestate-1">PauseState</a></h3>
<pre><code class="language-solidity">event PauseState(bool isPaused);
</code></pre>
<h3 id="authorizedcallerupdated-1"><a class="header" href="#authorizedcallerupdated-1">AuthorizedCallerUpdated</a></h3>
<pre><code class="language-solidity">event AuthorizedCallerUpdated(address indexed caller, bool authorized);
</code></pre>
<h3 id="emergencywithdrawal-1"><a class="header" href="#emergencywithdrawal-1">EmergencyWithdrawal</a></h3>
<pre><code class="language-solidity">event EmergencyWithdrawal(address indexed token, address indexed to, uint256 amount, address indexed admin);
</code></pre>
<h2 id="errors-10"><a class="header" href="#errors-10">Errors</a></h2>
<h3 id="paused-3"><a class="header" href="#paused-3">Paused</a></h3>
<pre><code class="language-solidity">error Paused();
</code></pre>
<h3 id="zeroaddress-6"><a class="header" href="#zeroaddress-6">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="zeroamount-5"><a class="header" href="#zeroamount-5">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="contractnotpaused-1"><a class="header" href="#contractnotpaused-1">ContractNotPaused</a></h3>
<pre><code class="language-solidity">error ContractNotPaused();
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
