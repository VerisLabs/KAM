<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>IkAssetRouter - KAM Contracts Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">KAM Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/VerisLabs/KAM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ikassetrouter"><a class="header" href="#ikassetrouter">IkAssetRouter</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkAssetRouter.sol">Git Source</a></p>
<p>Central money flow coordinator for the KAM protocol managing all asset movements and settlements</p>
<p><em>This interface defines the core functionality for kAssetRouter, which serves as the primary coordinator
for all asset movements within the KAM protocol ecosystem. Key responsibilities include: (1) Managing asset
flows from kMinter institutional deposits to DN vaults for yield generation, (2) Coordinating asset transfers
between kStakingVaults for optimal allocation, (3) Processing batch settlements with yield distribution through
kToken minting/burning, (4) Maintaining virtual balance tracking across all vaults, (5) Implementing settlement
cooldown periods for security, (6) Executing peg protection mechanisms during market stress. The router acts as
the central hub that enables efficient capital allocation while maintaining the 1:1 backing guarantee of kTokens
through precise yield distribution and loss management across the protocol's vault network.</em></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="kassetpush"><a class="header" href="#kassetpush">kAssetPush</a></h3>
<p>Pushes assets from kMinter institutional deposits to the designated DN vault for yield generation</p>
<p><em>This function is called by kMinter when institutional users deposit underlying assets. The process
involves: (1) receiving assets already transferred from kMinter, (2) forwarding them to the appropriate
DN vault for the asset type, (3) updating virtual balance tracking for accurate accounting. This enables
immediate kToken minting (1:1 with deposits) while assets begin generating yield in the vault system.
The assets enter the current batch for eventual settlement and yield distribution back to kToken holders.</em></p>
<pre><code class="language-solidity">function kAssetPush(address _asset, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited (must be registered in protocol)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault for yield generation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch identifier from the DN vault for tracking and settlement</td></tr>
</tbody></table>
</div>
<h3 id="kassetrequestpull"><a class="header" href="#kassetrequestpull">kAssetRequestPull</a></h3>
<p>Requests asset withdrawal from vault to fulfill institutional redemption through kMinter</p>
<p><em>This function initiates the first phase of the institutional redemption process. The workflow
involves: (1) registering the redemption request with the vault, (2) creating a kBatchReceiver minimal
proxy to hold assets for distribution, (3) updating virtual balance accounting, (4) preparing for
batch settlement. The actual asset transfer occurs later during batch settlement when the vault
processes all pending requests together. This two-phase approach optimizes gas costs and ensures
fair settlement across all institutional redemption requests in the batch.</em></p>
<pre><code class="language-solidity">function kAssetRequestPull(address _asset, address _vault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being redeemed</td></tr>
<tr><td><code>_vault</code></td><td><code>address</code></td><td>The DN vault address from which assets will be withdrawn</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this redemption with other requests</td></tr>
</tbody></table>
</div>
<h3 id="kassettransfer"><a class="header" href="#kassettransfer">kAssetTransfer</a></h3>
<p>Transfers assets between kStakingVaults for optimal capital allocation and yield optimization</p>
<p><em>This function enables dynamic rebalancing of assets across the vault network to optimize yields
and manage capacity. The transfer is virtual in nature - actual underlying assets may remain in the
same physical vault while accounting balances are updated. This mechanism allows for: (1) moving
assets from lower-yield to higher-yield opportunities, (2) rebalancing vault capacity during high
demand periods, (3) optimizing capital efficiency across the protocol. The batch system ensures
all transfers are processed fairly during settlement periods.</em></p>
<pre><code class="language-solidity">function kAssetTransfer(
    address sourceVault,
    address targetVault,
    address _asset,
    uint256 amount,
    bytes32 batchId
)
    external
    payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address transferring assets (will lose virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The kStakingVault address receiving assets (will gain virtual balance)</td></tr>
<tr><td><code>_asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred between vaults</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer for rebalancing</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating this transfer with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpush"><a class="header" href="#ksharesrequestpush">kSharesRequestPush</a></h3>
<p>Requests shares to be pushed for kStakingVault staking operations and batch processing</p>
<p><em>This function is part of the share-based accounting system for retail users in kStakingVaults.
When users stake kTokens, the vault requests shares to be pushed to track their ownership. The
process coordinates: (1) conversion of kTokens to vault shares at current share price, (2) updating
user balances in the vault system, (3) preparing for batch settlement. Share requests are batched
to optimize gas costs and ensure fair pricing across all users in the same settlement period.</em></p>
<pre><code class="language-solidity">function kSharesRequestPush(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share push operations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for push to users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share operations with settlement</td></tr>
</tbody></table>
</div>
<h3 id="ksharesrequestpull"><a class="header" href="#ksharesrequestpull">kSharesRequestPull</a></h3>
<p>Requests shares to be pulled for kStakingVault redemption operations</p>
<p><em>This function handles the share-based redemption process for retail users withdrawing from
kStakingVaults. The process involves: (1) calculating share amounts to redeem based on user
requests, (2) preparing for conversion back to kTokens at settlement time, (3) coordinating
with the batch settlement system for fair pricing. Unlike institutional redemptions through
kMinter, this uses share-based accounting to handle smaller, more frequent retail operations
efficiently through the vault's batch processing system.</em></p>
<pre><code class="language-solidity">function kSharesRequestPull(address sourceVault, uint256 amount, bytes32 batchId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The kStakingVault address requesting share pull for redemptions</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being requested for pull from users</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for coordinating share redemptions with settlement</td></tr>
</tbody></table>
</div>
<h3 id="proposesettlebatch"><a class="header" href="#proposesettlebatch">proposeSettleBatch</a></h3>
<p>Proposes a batch settlement for a vault with yield distribution through kToken minting/burning</p>
<p><em>This is the core function that initiates yield distribution in the KAM protocol. The settlement
process involves: (1) calculating final yields after a batch period, (2) determining net new deposits/
redemptions, (3) creating a proposal with cooldown period for security verification, (4) preparing for
kToken supply adjustment to maintain 1:1 backing. Positive yields result in kToken minting (distributing
gains to all holders), while losses result in kToken burning (socializing losses). The cooldown period
allows guardians to verify calculations before execution, ensuring protocol integrity.</em></p>
<pre><code class="language-solidity">function proposeSettleBatch(
    address asset,
    address vault,
    bytes32 batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit
)
    external
    payable
    returns (bytes32 proposalId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being settled (USDC, WBTC, etc.)</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address where yield was generated</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation/loss</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits minus redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute amount of yield generated (positive) or lost (negative)</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive (will mint kTokens), false if negative (will burn kTokens)</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>Unique identifier for this settlement proposal for tracking and execution</td></tr>
</tbody></table>
</div>
<h3 id="executesettlebatch"><a class="header" href="#executesettlebatch">executeSettleBatch</a></h3>
<p>Executes a settlement proposal after the security cooldown period has elapsed</p>
<p><em>This function completes the yield distribution process by: (1) verifying the cooldown period has
passed, (2) executing the actual kToken minting/burning to distribute yield or account for losses,
(3) updating all vault balances and user accounting, (4) processing any pending redemption requests
from the batch. This is where the 1:1 backing is maintained - the kToken supply is adjusted to exactly
reflect the underlying asset changes, ensuring every kToken remains backed by real assets plus distributed
yield.</em></p>
<pre><code class="language-solidity">function executeSettleBatch(bytes32 proposalId) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to execute</td></tr>
</tbody></table>
</div>
<h3 id="cancelproposal"><a class="header" href="#cancelproposal">cancelProposal</a></h3>
<p>Cancels a settlement proposal before execution if errors are detected</p>
<p><em>Provides a safety mechanism for guardians to cancel potentially incorrect settlement proposals.
This can be used when: (1) yield calculations appear incorrect, (2) system errors are detected,
(3) market conditions require recalculation. Cancellation allows for proposal correction and
resubmission with accurate data, preventing incorrect yield distribution that could affect the
protocol's 1:1 backing guarantee. Only callable before the proposal execution.</em></p>
<pre><code class="language-solidity">function cancelProposal(bytes32 proposalId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to cancel</td></tr>
</tbody></table>
</div>
<h3 id="setsettlementcooldown"><a class="header" href="#setsettlementcooldown">setSettlementCooldown</a></h3>
<p>Sets the security cooldown period for settlement proposals</p>
<p><em>The cooldown period provides critical security by requiring a delay between proposal creation
and execution. This allows: (1) protocol guardians to verify yield calculations, (2) detection of
potential errors or malicious proposals, (3) emergency intervention if needed. The cooldown should
balance security (longer is safer) with operational efficiency (shorter enables faster yield
distribution). Only admin roles can modify this parameter as it affects protocol safety.</em></p>
<pre><code class="language-solidity">function setSettlementCooldown(uint256 cooldown) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds before settlement proposals can be executed</td></tr>
</tbody></table>
</div>
<h3 id="getpendingproposals"><a class="header" href="#getpendingproposals">getPendingProposals</a></h3>
<p>Retrieves all pending settlement proposals for a specific vault</p>
<p><em>Returns proposal IDs that have been created but not yet executed or cancelled.
Used for monitoring and management of the settlement queue. Essential for guardians
to track proposals awaiting verification during the cooldown period.</em></p>
<pre><code class="language-solidity">function getPendingProposals(address vault_) external view returns (bytes32[] memory pendingProposals);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault_</code></td><td><code>address</code></td><td>The vault address to query for pending settlement proposals</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pendingProposals</code></td><td><code>bytes32[]</code></td><td>Array of proposal IDs currently pending execution</td></tr>
</tbody></table>
</div>
<h3 id="getdnvaultbyasset"><a class="header" href="#getdnvaultbyasset">getDNVaultByAsset</a></h3>
<p>Gets the DN vault address responsible for yield generation for a specific asset</p>
<p><em>Each supported asset (USDC, WBTC, etc.) has a designated DN vault that handles
yield farming strategies. This mapping is critical for routing institutional deposits
and coordinating settlement processes across the protocol's vault network.</em></p>
<pre><code class="language-solidity">function getDNVaultByAsset(address asset) external view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The DN vault address that generates yield for this asset</td></tr>
</tbody></table>
</div>
<h3 id="getbatchidbalances"><a class="header" href="#getbatchidbalances">getBatchIdBalances</a></h3>
<p>Retrieves the virtual balance accounting for a specific batch in a vault</p>
<p><em>Returns the deposited and requested amounts that are tracked virtually for batch
processing. These balances coordinate institutional flows (kMinter) and retail flows
(kStakingVault) within the same settlement period, ensuring fair processing and accurate
yield distribution across all participants in the batch.</em></p>
<pre><code class="language-solidity">function getBatchIdBalances(
    address vault,
    bytes32 batchId
)
    external
    view
    returns (uint256 deposited, uint256 requested);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query batch balances for</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier to retrieve balance information</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>deposited</code></td><td><code>uint256</code></td><td>Total amount of assets deposited into this batch</td></tr>
<tr><td><code>requested</code></td><td><code>uint256</code></td><td>Total amount of assets requested for redemption from this batch</td></tr>
</tbody></table>
</div>
<h3 id="getrequestedshares"><a class="header" href="#getrequestedshares">getRequestedShares</a></h3>
<p>Retrieves the total shares requested for redemption in a specific vault batch</p>
<p><em>Tracks share-based redemption requests from retail users in kStakingVaults.
This is separate from asset-based tracking and enables the protocol to coordinate
both institutional (asset-based) and retail (share-based) operations within the
same batch settlement process, ensuring consistent share price calculations.</em></p>
<pre><code class="language-solidity">function getRequestedShares(address vault, bytes32 batchId) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault address to query</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for the redemption period</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>The total amount of shares requested for redemption in this batch</td></tr>
</tbody></table>
</div>
<h3 id="ispaused"><a class="header" href="#ispaused">isPaused</a></h3>
<p>Checks if the kAssetRouter contract is currently paused</p>
<p><em>When paused, all critical functions (asset movements, settlements) are halted
for emergency protection. This affects the entire protocol's money flow coordination,
preventing new deposits, redemptions, and yield distributions until unpaused.</em></p>
<pre><code class="language-solidity">function isPaused() external view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>True if the contract is paused and operations are halted</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementproposal"><a class="header" href="#getsettlementproposal">getSettlementProposal</a></h3>
<p>Retrieves complete details of a specific settlement proposal</p>
<p><em>Returns the full VaultSettlementProposal struct containing all parameters needed
for yield distribution verification. Essential for guardians to review proposal accuracy
during the cooldown period before execution. Contains asset amounts, yield calculations,
and timing information for comprehensive proposal analysis.</em></p>
<pre><code class="language-solidity">function getSettlementProposal(bytes32 proposalId) external view returns (VaultSettlementProposal memory proposal);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the settlement proposal to query</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposal</code></td><td><code>VaultSettlementProposal</code></td><td>The complete settlement proposal struct with all details</td></tr>
</tbody></table>
</div>
<h3 id="canexecuteproposal"><a class="header" href="#canexecuteproposal">canExecuteProposal</a></h3>
<p>Checks if a settlement proposal is ready for execution with detailed status</p>
<p><em>Validates all execution requirements: (1) proposal exists and is pending, (2) cooldown
period has elapsed, (3) proposal hasn't been cancelled. Returns both boolean result and
human-readable reason for failures, enabling better error handling and user feedback.</em></p>
<pre><code class="language-solidity">function canExecuteProposal(bytes32 proposalId) external view returns (bool canExecute, string memory reason);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the proposal to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>canExecute</code></td><td><code>bool</code></td><td>True if the proposal can be executed immediately</td></tr>
<tr><td><code>reason</code></td><td><code>string</code></td><td>Descriptive message explaining why execution is blocked (if applicable)</td></tr>
</tbody></table>
</div>
<h3 id="getsettlementcooldown"><a class="header" href="#getsettlementcooldown">getSettlementCooldown</a></h3>
<p>Gets the current security cooldown period for settlement proposals</p>
<p><em>The cooldown period determines how long proposals must wait before execution.
This security mechanism allows guardians to verify yield calculations and prevents
immediate execution of potentially malicious or incorrect proposals. Critical for
maintaining protocol integrity during yield distribution processes.</em></p>
<pre><code class="language-solidity">function getSettlementCooldown() external view returns (uint256 cooldown);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>cooldown</code></td><td><code>uint256</code></td><td>The current cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h3 id="contractname"><a class="header" href="#contractname">contractName</a></h3>
<p>Returns the standard name identifier for this contract type within the KAM protocol</p>
<p><em>Used for protocol identification and registry management. Provides a consistent way
to identify kAssetRouter contracts across the protocol ecosystem, enabling automated
contract discovery and validation by other protocol components.</em></p>
<pre><code class="language-solidity">function contractName() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract name as a string (typically "kAssetRouter")</td></tr>
</tbody></table>
</div>
<h3 id="contractversion"><a class="header" href="#contractversion">contractVersion</a></h3>
<p>Returns the version identifier for this contract implementation</p>
<p><em>Used for upgrade management and compatibility checking within the protocol. Enables
the system to verify contract versions during upgrades and ensure compatibility between
protocol components. Critical for protocol governance and maintenance procedures.</em></p>
<pre><code class="language-solidity">function contractVersion() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>The contract version as a string (e.g., "1.0.0")</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="contractinitialized"><a class="header" href="#contractinitialized">ContractInitialized</a></h3>
<p>Emitted when the kAssetRouter contract is initialized with registry configuration</p>
<pre><code class="language-solidity">event ContractInitialized(address indexed registry);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry</code></td><td><code>address</code></td><td>The address of the kRegistry contract that manages protocol configuration</td></tr>
</tbody></table>
</div>
<h3 id="assetspushed"><a class="header" href="#assetspushed">AssetsPushed</a></h3>
<p>Emitted when assets are pushed from kMinter to a DN vault for yield generation</p>
<p><em>This occurs when institutional users deposit assets through kMinter, and the router
forwards these assets to the appropriate DN vault for yield farming strategies</em></p>
<pre><code class="language-solidity">event AssetsPushed(address indexed from, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>from</code></td><td><code>address</code></td><td>The address initiating the asset push (typically kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being pushed to the vault</td></tr>
</tbody></table>
</div>
<h3 id="assetsrequestpulled"><a class="header" href="#assetsrequestpulled">AssetsRequestPulled</a></h3>
<p>Emitted when assets are requested for pull from a vault to fulfill kMinter redemptions</p>
<p><em>Part of the two-phase redemption process - assets are first requested, then later pulled
after batch settlement. The batchReceiver is deployed to hold assets for distribution.</em></p>
<pre><code class="language-solidity">event AssetsRequestPulled(address indexed vault, address indexed asset, address indexed batchReceiver, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address from which assets are being requested</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being requested for redemption</td></tr>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The minimal proxy contract that will receive and distribute assets</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets requested for redemption</td></tr>
</tbody></table>
</div>
<h3 id="assetstransfered"><a class="header" href="#assetstransfered">AssetsTransfered</a></h3>
<p>Emitted when assets are transferred between kStakingVaults for optimal allocation</p>
<p><em>This is a virtual transfer for accounting purposes - actual assets may remain in the same
physical location while vault balances are updated to reflect the new allocation</em></p>
<pre><code class="language-solidity">event AssetsTransfered(address indexed sourceVault, address indexed targetVault, address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault transferring assets (losing virtual balance)</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets (gaining virtual balance)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets being transferred between vaults</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpushed"><a class="header" href="#sharesrequestedpushed">SharesRequestedPushed</a></h3>
<p>Emitted when shares are requested for push operations in kStakingVault flows</p>
<p><em>Part of the share-based accounting system for retail users in kStakingVaults</em></p>
<pre><code class="language-solidity">event SharesRequestedPushed(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share push operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this operation</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pushed</td></tr>
</tbody></table>
</div>
<h3 id="sharesrequestedpulled"><a class="header" href="#sharesrequestedpulled">SharesRequestedPulled</a></h3>
<p>Emitted when shares are requested for pull operations in kStakingVault redemptions</p>
<p><em>Coordinates share-based redemptions for retail users through the batch system</em></p>
<pre><code class="language-solidity">event SharesRequestedPulled(address indexed vault, bytes32 indexed batchId, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The kStakingVault requesting the share pull operation</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this redemption batch</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of shares being pulled for redemption</td></tr>
</tbody></table>
</div>
<h3 id="sharessettled"><a class="header" href="#sharessettled">SharesSettled</a></h3>
<p>Emitted when shares are settled across multiple vaults with calculated share prices</p>
<p><em>Marks the completion of a cross-vault settlement with final share price determination</em></p>
<pre><code class="language-solidity">event SharesSettled(
    address[] vaults, bytes32 indexed batchId, uint256 totalRequestedShares, uint256[] totalAssets, uint256 sharePrice
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vaults</code></td><td><code>address[]</code></td><td>Array of vault addresses participating in the settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for this settlement period</td></tr>
<tr><td><code>totalRequestedShares</code></td><td><code>uint256</code></td><td>Total shares requested across all vaults in this settlement</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256[]</code></td><td>Array of total assets for each vault after settlement</td></tr>
<tr><td><code>sharePrice</code></td><td><code>uint256</code></td><td>The final calculated share price for this settlement period</td></tr>
</tbody></table>
</div>
<h3 id="batchsettled"><a class="header" href="#batchsettled">BatchSettled</a></h3>
<p>Emitted when a vault batch is settled with final asset accounting</p>
<p><em>Indicates completion of yield distribution and final asset allocation for a batch</em></p>
<pre><code class="language-solidity">event BatchSettled(address indexed vault, bytes32 indexed batchId, uint256 totalAssets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that completed batch settlement</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>The final total asset value in the vault after settlement</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionactivated"><a class="header" href="#pegprotectionactivated">PegProtectionActivated</a></h3>
<p>Emitted when peg protection mechanism is activated due to vault shortfall</p>
<p><em>Triggered when a vault cannot fulfill redemption requests, requiring asset transfers
from other vaults to maintain the protocol's 1:1 backing guarantee</em></p>
<pre><code class="language-solidity">event PegProtectionActivated(address indexed vault, uint256 shortfall);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault experiencing shortfall that triggered peg protection</td></tr>
<tr><td><code>shortfall</code></td><td><code>uint256</code></td><td>The amount of assets needed to fulfill pending redemption requests</td></tr>
</tbody></table>
</div>
<h3 id="pegprotectionexecuted"><a class="header" href="#pegprotectionexecuted">PegProtectionExecuted</a></h3>
<p>Emitted when peg protection transfers assets between vaults to cover shortfalls</p>
<p><em>Maintains protocol solvency by redistributing assets from surplus to deficit vaults</em></p>
<pre><code class="language-solidity">event PegProtectionExecuted(address indexed sourceVault, address indexed targetVault, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>sourceVault</code></td><td><code>address</code></td><td>The vault providing assets to cover the shortfall</td></tr>
<tr><td><code>targetVault</code></td><td><code>address</code></td><td>The vault receiving assets to fulfill its redemption obligations</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets transferred for peg protection</td></tr>
</tbody></table>
</div>
<h3 id="yielddistributed"><a class="header" href="#yielddistributed">YieldDistributed</a></h3>
<p>Emitted when yield is distributed through kToken minting/burning operations</p>
<p><em>This is the core mechanism for maintaining 1:1 backing while distributing yield.
Positive yield increases kToken supply, negative yield (losses) decreases supply.</em></p>
<pre><code class="language-solidity">event YieldDistributed(address indexed vault, uint256 yield, bool isProfit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault that generated the yield being distributed</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>The absolute amount of yield (positive or negative) being distributed</td></tr>
<tr><td><code>isProfit</code></td><td><code>bool</code></td><td>True if yield is positive (minting kTokens), false if negative (burning kTokens)</td></tr>
</tbody></table>
</div>
<h3 id="deposited"><a class="header" href="#deposited">Deposited</a></h3>
<p>Emitted when assets are deposited into a vault through various protocol mechanisms</p>
<p><em>Tracks all asset deposits whether from kMinter institutional flows or other sources</em></p>
<pre><code class="language-solidity">event Deposited(address indexed vault, address indexed asset, uint256 amount, bool isKMinter);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address receiving the deposit</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address being deposited</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets deposited</td></tr>
<tr><td><code>isKMinter</code></td><td><code>bool</code></td><td>True if deposit originated from kMinter, false for other sources</td></tr>
</tbody></table>
</div>
<h3 id="settlementproposed"><a class="header" href="#settlementproposed">SettlementProposed</a></h3>
<p>Emitted when a new settlement proposal is created with cooldown period</p>
<p><em>Begins the settlement process with a security cooldown to allow verification</em></p>
<pre><code class="language-solidity">event SettlementProposed(
    bytes32 indexed proposalId,
    address indexed vault,
    bytes32 indexed batchId,
    uint256 totalAssets,
    uint256 netted,
    uint256 yield,
    bool profit,
    uint256 executeAfter
);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier for this settlement proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement is proposed</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier being settled</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Total asset value in the vault after yield generation</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Net amount of new deposits/redemptions in this batch</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Absolute yield amount generated in this batch</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>True if yield is positive, false if negative</td></tr>
<tr><td><code>executeAfter</code></td><td><code>uint256</code></td><td>Timestamp after which the proposal can be executed</td></tr>
</tbody></table>
</div>
<h3 id="settlementexecuted"><a class="header" href="#settlementexecuted">SettlementExecuted</a></h3>
<p>Emitted when a settlement proposal is successfully executed</p>
<p><em>Marks completion of the settlement process with yield distribution</em></p>
<pre><code class="language-solidity">event SettlementExecuted(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId, address executor);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the executed proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address that was settled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier that was settled</td></tr>
<tr><td><code>executor</code></td><td><code>address</code></td><td>The address that executed the settlement (guardian or admin)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcancelled"><a class="header" href="#settlementcancelled">SettlementCancelled</a></h3>
<p>Emitted when a settlement proposal is cancelled before execution</p>
<p><em>Allows guardians to cancel potentially incorrect settlement proposals</em></p>
<pre><code class="language-solidity">event SettlementCancelled(bytes32 indexed proposalId, address indexed vault, bytes32 indexed batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the cancelled proposal</td></tr>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address for which settlement was cancelled</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for which settlement was cancelled</td></tr>
</tbody></table>
</div>
<h3 id="settlementupdated"><a class="header" href="#settlementupdated">SettlementUpdated</a></h3>
<p>Emitted when a settlement proposal is updated with new yield calculation data</p>
<p><em>Allows for correction of settlement proposals before execution if needed</em></p>
<pre><code class="language-solidity">event SettlementUpdated(bytes32 indexed proposalId, uint256 totalAssets, uint256 netted, uint256 yield, bool profit);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>proposalId</code></td><td><code>bytes32</code></td><td>The unique identifier of the updated proposal</td></tr>
<tr><td><code>totalAssets</code></td><td><code>uint256</code></td><td>Updated total asset value in the vault</td></tr>
<tr><td><code>netted</code></td><td><code>uint256</code></td><td>Updated net amount of deposits/redemptions</td></tr>
<tr><td><code>yield</code></td><td><code>uint256</code></td><td>Updated yield amount for distribution</td></tr>
<tr><td><code>profit</code></td><td><code>bool</code></td><td>Updated profit flag (true for gains, false for losses)</td></tr>
</tbody></table>
</div>
<h3 id="settlementcooldownupdated"><a class="header" href="#settlementcooldownupdated">SettlementCooldownUpdated</a></h3>
<p>Emitted when the settlement cooldown period is updated by protocol governance</p>
<p><em>Cooldown provides security by allowing time to verify settlement proposals before execution</em></p>
<pre><code class="language-solidity">event SettlementCooldownUpdated(uint256 oldCooldown, uint256 newCooldown);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>oldCooldown</code></td><td><code>uint256</code></td><td>The previous cooldown period in seconds</td></tr>
<tr><td><code>newCooldown</code></td><td><code>uint256</code></td><td>The new cooldown period in seconds</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="balances"><a class="header" href="#balances">Balances</a></h3>
<p>Tracks requested and deposited asset amounts for batch processing coordination</p>
<p><em>Used by kAssetRouter to maintain virtual balance accounting across vaults and coordinate
asset flows between kMinter redemption requests and vault settlements. Enables efficient
batch processing by tracking pending operations before physical asset movement occurs.</em></p>
<pre><code class="language-solidity">struct Balances {
    uint128 requested;
    uint128 deposited;
}
</code></pre>
<h3 id="vaultsettlementproposal"><a class="header" href="#vaultsettlementproposal">VaultSettlementProposal</a></h3>
<p>Contains all parameters for a batch settlement proposal in the yield distribution system</p>
<p><em>Settlement proposals implement a cooldown mechanism for security, allowing guardians to verify
yield calculations before execution. Once executed, the proposal triggers kToken minting/burning to
distribute yield or account for losses, maintaining the 1:1 backing ratio across all kTokens.</em></p>
<pre><code class="language-solidity">struct VaultSettlementProposal {
    address asset;
    address vault;
    bytes32 batchId;
    uint256 totalAssets;
    uint256 netted;
    uint256 yield;
    bool profit;
    uint256 executeAfter;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/interfaces/IVaultFees.sol/interface.IVaultFees.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/interfaces/IVaultFees.sol/interface.IVaultFees.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/interfaces/IkBatchReceiver.sol/interface.IkBatchReceiver.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
