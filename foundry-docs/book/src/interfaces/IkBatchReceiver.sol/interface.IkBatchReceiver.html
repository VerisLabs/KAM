<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>IkBatchReceiver - KAM Contracts Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">KAM Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/VerisLabs/KAM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ikbatchreceiver"><a class="header" href="#ikbatchreceiver">IkBatchReceiver</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/interfaces/IkBatchReceiver.sol">Git Source</a></p>
<p>Interface for minimal proxy contracts that manage asset distribution for completed batch redemptions</p>
<p><em>kBatchReceiver contracts are deployed as minimal proxies (one per batch) to efficiently manage the distribution
of settled assets to users who requested redemptions. This design pattern provides: (1) gas-efficient deployment
since each batch gets its own isolated distribution contract, (2) clear asset segregation preventing cross-batch
contamination, (3) simplified accounting where each receiver holds exactly the assets needed for one batch.
The contract serves as a temporary holding mechanism - kMinter transfers settled assets to the receiver, then users
can pull their proportional share. This architecture ensures fair distribution and prevents front-running during
the redemption settlement process. Only the originating kMinter contract can interact with receivers, maintaining
strict access control throughout the asset distribution phase.</em></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="kminter"><a class="header" href="#kminter">kMinter</a></h3>
<p>Retrieves the address of the kMinter contract authorized to interact with this receiver</p>
<p><em>Returns the immutable kMinter address set during receiver deployment. This address has
exclusive permission to call pullAssets() and rescueAssets(), ensuring only the originating
kMinter can manage asset distribution for this batch. Critical for maintaining access control
and preventing unauthorized asset movements during the redemption settlement process.</em></p>
<pre><code class="language-solidity">function kMinter() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The address of the kMinter contract with administrative permissions over this receiver</td></tr>
</tbody></table>
</div>
<h3 id="asset"><a class="header" href="#asset">asset</a></h3>
<p>Retrieves the underlying asset contract address managed by this receiver</p>
<p><em>Returns the asset address configured during initialization (e.g., USDC, WBTC). This
determines which token type the receiver will distribute to redemption users. The asset type
must match the asset that was originally deposited and requested for redemption in the batch.</em></p>
<pre><code class="language-solidity">function asset() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The contract address of the underlying asset this receiver distributes</td></tr>
</tbody></table>
</div>
<h3 id="batchid"><a class="header" href="#batchid">batchId</a></h3>
<p>Retrieves the unique batch identifier this receiver serves</p>
<p><em>Returns the batch ID set during initialization, which links this receiver to a specific
batch of redemption requests. Used for validation when pulling assets to ensure operations
are performed on the correct batch. Essential for maintaining batch isolation and preventing
cross-contamination between different settlement periods.</em></p>
<pre><code class="language-solidity">function batchId() external view returns (bytes32);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bytes32</code></td><td>The unique batch identifier as a bytes32 hash</td></tr>
</tbody></table>
</div>
<h3 id="pullassets"><a class="header" href="#pullassets">pullAssets</a></h3>
<p>Transfers settled assets from the receiver to a redemption user completing their withdrawal</p>
<p><em>This is the core asset distribution function that fulfills redemption requests after batch settlement.
The process works as follows: (1) kMinter calls this function with user's proportional share, (2) receiver
validates the batch ID matches to prevent cross-batch contamination, (3) assets are transferred directly
to the user completing their redemption. Only callable by the authorized kMinter contract to maintain strict
access control. This function is typically called multiple times per batch as individual users claim their
settled redemptions, ensuring fair and orderly asset distribution.</em></p>
<pre><code class="language-solidity">function pullAssets(address receiver, uint256 amount, bytes32 _batchId) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that will receive the settled assets (the user completing redemption)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets to transfer based on the user's proportional share</td></tr>
<tr><td><code>_batchId</code></td><td><code>bytes32</code></td><td>The batch identifier for validation (must match this receiver's configured batch)</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets"><a class="header" href="#rescueassets">rescueAssets</a></h3>
<p>Emergency recovery function for accidentally sent assets to prevent permanent loss</p>
<p><em>Provides a safety mechanism for recovering tokens or ETH that were mistakenly sent to the receiver
outside of normal settlement operations. The function handles both ERC20 tokens and native ETH recovery.
For ERC20 tokens, it validates that the rescue asset is not the receiver's designated settlement asset
(to prevent interfering with normal operations). Only the authorized kMinter can execute rescues, ensuring
recovered assets return to the proper custodial system. Essential for maintaining protocol security while
preventing accidental asset loss during the receiver contract's operational lifecycle.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The contract address of the asset to rescue (use address(0) for native ETH recovery)</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="batchreceiverinitialized"><a class="header" href="#batchreceiverinitialized">BatchReceiverInitialized</a></h3>
<p>Emitted when a new batch receiver is initialized and ready for asset distribution</p>
<p><em>This event marks the successful deployment and configuration of a minimal proxy receiver
for a specific batch. Essential for tracking the lifecycle of batch settlement processes and
enabling off-chain systems to monitor when settlement assets can begin flowing to receivers.</em></p>
<pre><code class="language-solidity">event BatchReceiverInitialized(address indexed kMinter, bytes32 indexed batchId, address asset);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kMinter</code></td><td><code>address</code></td><td>The address of the kMinter contract authorized to interact with this receiver</td></tr>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The unique identifier of the batch this receiver will serve</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address (USDC, WBTC, etc.) this receiver will distribute</td></tr>
</tbody></table>
</div>
<h3 id="pulledassets"><a class="header" href="#pulledassets">PulledAssets</a></h3>
<p>Emitted when assets are successfully distributed from the receiver to a redemption user</p>
<p><em>This event tracks the actual fulfillment of redemption requests, recording when users
receive their settled assets. Critical for reconciliation and ensuring all batch participants
receive their proportional share during the distribution phase.</em></p>
<pre><code class="language-solidity">event PulledAssets(address indexed receiver, address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>The address that received the distributed assets (the redeeming user)</td></tr>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset contract address that was transferred</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of assets successfully distributed to the receiver</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets"><a class="header" href="#rescuedassets">RescuedAssets</a></h3>
<p>Emitted when accidentally sent ERC20 tokens are rescued from the receiver contract</p>
<p><em>Provides a safety mechanism for recovering tokens that were mistakenly sent to the receiver
outside of normal operations. This prevents permanent loss of assets while maintaining security.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset, address indexed to, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address of the ERC20 token contract that was rescued</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The address that received the rescued tokens (typically the kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The quantity of tokens that were successfully rescued</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth"><a class="header" href="#rescuedeth">RescuedETH</a></h3>
<p>Emitted when accidentally sent ETH is rescued from the receiver contract</p>
<p><em>Handles recovery of native ETH that was mistakenly sent to the contract, ensuring no
value is permanently locked in the receiver contracts during their operational lifecycle.</em></p>
<pre><code class="language-solidity">event RescuedETH(address indexed asset, uint256 amount);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The address that received the rescued ETH (typically the kMinter)</td></tr>
<tr><td><code>amount</code></td><td><code>uint256</code></td><td>The amount of ETH (in wei) that was successfully rescued</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/interfaces/IkMinter.sol/interface.IkMinter.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/interfaces/IkAssetRouter.sol/interface.IkAssetRouter.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/interfaces/IkMinter.sol/interface.IkMinter.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
