<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>kBase - KAM Contracts Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">KAM Contracts Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/VerisLabs/KAM" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="kbase"><a class="header" href="#kbase">kBase</a></h1>
<p><a href="https://github.com/VerisLabs/KAM/blob/39577197165fca22f4727dda301114283fca8759/src/base/kBase.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/src/abstracts/OptimizedReentrancyGuardTransient.sol/abstract.OptimizedReentrancyGuardTransient.html">OptimizedReentrancyGuardTransient</a></p>
<p>Foundation contract providing essential shared functionality and registry integration for all KAM protocol
contracts</p>
<p><em>This abstract contract serves as the architectural foundation for the entire KAM protocol, establishing
critical patterns and utilities that ensure consistency across all protocol components. Key responsibilities
include: (1) Registry integration through a singleton pattern that enables dynamic protocol configuration and
contract discovery, (2) Role-based access control validation that enforces protocol governance permissions,
(3) Emergency pause functionality for protocol-wide risk mitigation during critical events, (4) Asset rescue
mechanisms to recover stuck funds while protecting protocol assets, (5) Vault and asset validation to ensure
only registered components interact, (6) Batch processing coordination through ID management and receiver tracking.
The contract employs ERC-7201 namespaced storage to prevent storage collisions during upgrades and enable safe
inheritance patterns. All inheriting contracts (kMinter, kAssetRouter, etc.) leverage these utilities to maintain
protocol integrity, reduce code duplication, and ensure consistent security checks across the ecosystem. The
registry serves as the single source of truth for protocol configuration, making the system highly modular and
upgradeable.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="k_minter"><a class="header" href="#k_minter">K_MINTER</a></h3>
<p>Registry lookup key for the kMinter singleton contract</p>
<p><em>This hash is used to retrieve the kMinter address from the registry's contract mapping.
kMinter handles institutional minting/redemption flows, so many contracts need to identify it
for access control and routing decisions. The hash ensures consistent lookups across the protocol.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_MINTER = keccak256("K_MINTER");
</code></pre>
<h3 id="k_asset_router"><a class="header" href="#k_asset_router">K_ASSET_ROUTER</a></h3>
<p>Registry lookup key for the kAssetRouter singleton contract</p>
<p><em>This hash is used to retrieve the kAssetRouter address from the registry's contract mapping.
kAssetRouter coordinates all asset movements and settlements, making it a critical dependency
for vaults and other protocol components. The hash-based lookup enables dynamic upgrades.</em></p>
<pre><code class="language-solidity">bytes32 internal constant K_ASSET_ROUTER = keccak256("K_ASSET_ROUTER");
</code></pre>
<h3 id="kbase_storage_location"><a class="header" href="#kbase_storage_location">KBASE_STORAGE_LOCATION</a></h3>
<p><em>ERC-7201 storage location calculated as: keccak256(abi.encode(uint256(keccak256("kam.storage.kBase")) - 1))
&amp; ~bytes32(uint256(0xff))
This specific slot is chosen to avoid any possible collision with standard storage layouts while maintaining
deterministic addressing. The calculation ensures the storage location is unique to this namespace and won't
conflict with other inherited contracts or future upgrades. The 0xff mask ensures proper alignment.</em></p>
<pre><code class="language-solidity">bytes32 private constant KBASE_STORAGE_LOCATION = 0xe91688684975c4d7d54a65dd96da5d4dcbb54b8971c046d5351d3c111e43a800;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="_getbasestorage"><a class="header" href="#_getbasestorage">_getBaseStorage</a></h3>
<p><em>Returns the kBase storage pointer using ERC-7201 namespaced storage pattern</em></p>
<pre><code class="language-solidity">function _getBaseStorage() internal pure returns (kBaseStorage storage $);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$</code></td><td><code>kBaseStorage</code></td><td>Storage pointer to the kBaseStorage struct at the designated storage location This function uses inline assembly to directly set the storage pointer to our namespaced location, ensuring efficient access to storage variables while maintaining upgrade safety. The pure modifier is used because we're only returning a storage pointer, not reading storage values.</td></tr>
</tbody></table>
</div>
<h3 id="__kbase_init"><a class="header" href="#__kbase_init">__kBase_init</a></h3>
<p>Initializes the base contract with registry integration and default operational state</p>
<p><em>This internal initialization function establishes the foundational connection between any inheriting
contract and the protocol's registry system. The initialization process: (1) Validates that initialization
hasn't occurred to prevent reinitialization attacks in proxy patterns, (2) Ensures registry address is valid
since the registry is critical for all protocol operations, (3) Sets the contract to unpaused state enabling
normal operations, (4) Marks initialization complete to prevent future calls. This function MUST be called
by all inheriting contracts during their initialization phase to establish proper protocol integration.
The internal visibility ensures only inheriting contracts can initialize, preventing external manipulation.</em></p>
<pre><code class="language-solidity">function __kBase_init(address registry_) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>registry_</code></td><td><code>address</code></td><td>The kRegistry contract address that serves as the protocol's configuration and discovery hub</td></tr>
</tbody></table>
</div>
<h3 id="setpaused"><a class="header" href="#setpaused">setPaused</a></h3>
<p>Toggles the emergency pause state affecting all protocol operations in this contract</p>
<p><em>This function provides critical risk management capability by allowing emergency admins to halt
contract operations during security incidents or market anomalies. The pause mechanism: (1) Affects all
state-changing operations in inheriting contracts that check _isPaused(), (2) Does not affect view/pure
functions ensuring protocol state remains readable, (3) Enables rapid response to potential exploits by
halting operations protocol-wide, (4) Requires emergency admin role ensuring only authorized governance
can trigger pauses. Inheriting contracts should check _isPaused() modifier in critical functions to
respect the pause state. The external visibility with role check prevents unauthorized pause manipulation.</em></p>
<pre><code class="language-solidity">function setPaused(bool paused_) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The desired pause state (true = halt operations, false = resume normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="rescueassets"><a class="header" href="#rescueassets">rescueAssets</a></h3>
<p>Rescues accidentally sent assets (ETH or ERC20 tokens) preventing permanent loss of funds</p>
<p><em>This function implements a critical safety mechanism for recovering tokens or ETH that become stuck
in the contract through user error or airdrops. The rescue process: (1) Validates admin authorization to
prevent unauthorized fund extraction, (2) Ensures recipient address is valid to prevent burning funds,
(3) For ETH rescue (asset_=address(0)): validates balance sufficiency and uses low-level call for transfer,
(4) For ERC20 rescue: critically checks the token is NOT a registered protocol asset (USDC, WBTC, etc.) to
protect user deposits and protocol integrity, then validates balance and uses SafeTransferLib for secure
transfer. The distinction between ETH and ERC20 handling accounts for their different transfer mechanisms.
Protocol assets are explicitly blocked from rescue to prevent admin abuse and maintain user trust.</em></p>
<pre><code class="language-solidity">function rescueAssets(address asset_, address to_, uint256 amount_) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The asset to rescue (use address(0) for native ETH, otherwise ERC20 token address)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address that will receive the rescued assets (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity to rescue (must not exceed available balance)</td></tr>
</tbody></table>
</div>
<h3 id="registry"><a class="header" href="#registry">registry</a></h3>
<p>Returns the registry contract address</p>
<p><em>Reverts if contract not initialized</em></p>
<pre><code class="language-solidity">function registry() external view returns (address);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>The kRegistry contract address</td></tr>
</tbody></table>
</div>
<h3 id="_registry"><a class="header" href="#_registry">_registry</a></h3>
<p>Returns the registry contract interface</p>
<p><em>Internal helper for typed registry access</em></p>
<pre><code class="language-solidity">function _registry() internal view returns (IkRegistry);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>IkRegistry</code></td><td>IkRegistry interface for registry interaction</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchid"><a class="header" href="#_getbatchid">_getBatchId</a></h3>
<p>Gets the current batch ID for a given vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchId(address vault) internal view returns (bytes32 batchId);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchId</code></td><td><code>bytes32</code></td><td>The current batch ID</td></tr>
</tbody></table>
</div>
<h3 id="_getbatchreceiver"><a class="header" href="#_getbatchreceiver">_getBatchReceiver</a></h3>
<p>Gets the current batch receiver for a given batchId</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getBatchReceiver(address vault_, bytes32 batchId_) internal view returns (address batchReceiver);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault_</code></td><td><code>address</code></td><td>The vault address</td></tr>
<tr><td><code>batchId_</code></td><td><code>bytes32</code></td><td>The batch ID</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>batchReceiver</code></td><td><code>address</code></td><td>The address of the batchReceiver where tokens will be sent</td></tr>
</tbody></table>
</div>
<h3 id="_getkminter"><a class="header" href="#_getkminter">_getKMinter</a></h3>
<p>Gets the kMinter singleton contract address</p>
<p><em>Reverts if kMinter not set in registry</em></p>
<pre><code class="language-solidity">function _getKMinter() internal view returns (address minter);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>minter</code></td><td><code>address</code></td><td>The kMinter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getkassetrouter"><a class="header" href="#_getkassetrouter">_getKAssetRouter</a></h3>
<p>Gets the kAssetRouter singleton contract address</p>
<p><em>Reverts if kAssetRouter not set in registry</em></p>
<pre><code class="language-solidity">function _getKAssetRouter() internal view returns (address router);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>router</code></td><td><code>address</code></td><td>The kAssetRouter contract address</td></tr>
</tbody></table>
</div>
<h3 id="_getktokenforasset"><a class="header" href="#_getktokenforasset">_getKTokenForAsset</a></h3>
<p>Gets the kToken address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getKTokenForAsset(address asset) internal view returns (address kToken);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The underlying asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>kToken</code></td><td><code>address</code></td><td>The corresponding kToken address</td></tr>
</tbody></table>
</div>
<h3 id="_getvaultassets"><a class="header" href="#_getvaultassets">_getVaultAssets</a></h3>
<p>Gets the asset managed by a vault</p>
<p><em>Reverts if vault not registered</em></p>
<pre><code class="language-solidity">function _getVaultAssets(address vault) internal view returns (address[] memory assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>assets</code></td><td><code>address[]</code></td><td>The asset address managed by the vault</td></tr>
</tbody></table>
</div>
<h3 id="_getdnvaultbyasset"><a class="header" href="#_getdnvaultbyasset">_getDNVaultByAsset</a></h3>
<p>Gets the DN vault address for a given asset</p>
<p><em>Reverts if asset not supported</em></p>
<pre><code class="language-solidity">function _getDNVaultByAsset(address asset) internal view returns (address vault);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The corresponding DN vault address</td></tr>
</tbody></table>
</div>
<h3 id="_isadmin"><a class="header" href="#_isadmin">_isAdmin</a></h3>
<p>Checks if an address has admin role in the protocol governance</p>
<p><em>Admins can execute critical functions like asset rescue and protocol configuration changes.
This validation is used throughout inheriting contracts to enforce permission boundaries.</em></p>
<pre><code class="language-solidity">function _isAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an admin in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isemergencyadmin"><a class="header" href="#_isemergencyadmin">_isEmergencyAdmin</a></h3>
<p>Checks if an address has emergency admin role for critical protocol interventions</p>
<p><em>Emergency admins can pause/unpause contracts during security incidents or market anomalies.
This elevated role enables rapid response to threats while limiting scope to emergency functions only.</em></p>
<pre><code class="language-solidity">function _isEmergencyAdmin(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for emergency admin privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an emergency admin in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isguardian"><a class="header" href="#_isguardian">_isGuardian</a></h3>
<p>Checks if an address has guardian role for protocol monitoring and verification</p>
<p><em>Guardians verify settlement proposals and can cancel incorrect settlements during cooldown periods.
This role provides an additional security layer for yield distribution accuracy.</em></p>
<pre><code class="language-solidity">function _isGuardian(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for guardian privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as a guardian in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isrelayer"><a class="header" href="#_isrelayer">_isRelayer</a></h3>
<p>Checks if an address has relayer role for automated protocol operations</p>
<p><em>Relayers execute batched operations and trigger settlements on behalf of users to optimize gas costs.
This role enables automation while maintaining security through limited permissions.</em></p>
<pre><code class="language-solidity">function _isRelayer(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for relayer privileges</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as a relayer in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_isinstitution"><a class="header" href="#_isinstitution">_isInstitution</a></h3>
<p>Checks if an address is registered as an institutional user</p>
<p><em>Institutions have special privileges in kMinter for large-scale minting and redemption operations.
This distinction enables optimized flows for high-volume users while maintaining retail accessibility.</em></p>
<pre><code class="language-solidity">function _isInstitution(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check for institutional status</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is registered as an institution in the registry</td></tr>
</tbody></table>
</div>
<h3 id="_ispaused"><a class="header" href="#_ispaused">_isPaused</a></h3>
<p>Checks if the contract is currently in emergency pause state</p>
<p><em>Used by inheriting contracts to halt operations during emergencies. When paused, state-changing
functions should revert while view functions remain accessible for protocol monitoring.</em></p>
<pre><code class="language-solidity">function _isPaused() internal view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the contract is currently paused</td></tr>
</tbody></table>
</div>
<h3 id="_iskminter"><a class="header" href="#_iskminter">_isKMinter</a></h3>
<p>Checks if an address is the kMinter contract</p>
<p><em>Validates if the caller is the protocol's kMinter singleton for access control in vault operations.
Used to ensure only kMinter can trigger institutional deposit and redemption flows.</em></p>
<pre><code class="language-solidity">function _isKMinter(address user) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>user</code></td><td><code>address</code></td><td>The address to check against kMinter</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is the registered kMinter contract</td></tr>
</tbody></table>
</div>
<h3 id="_isvault"><a class="header" href="#_isvault">_isVault</a></h3>
<p>Checks if an address is a registered vault</p>
<pre><code class="language-solidity">function _isVault(address vault) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the address is a registered vault</td></tr>
</tbody></table>
</div>
<h3 id="_isasset"><a class="header" href="#_isasset">_isAsset</a></h3>
<p>Checks if an asset is registered</p>
<pre><code class="language-solidity">function _isAsset(address asset) internal view returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset</code></td><td><code>address</code></td><td>The asset address to check</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>Whether the asset is registered</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="paused"><a class="header" href="#paused">Paused</a></h3>
<p>Emitted when the emergency pause state is toggled for protocol-wide risk mitigation</p>
<p><em>This event signals a critical protocol state change that affects all inheriting contracts.
When paused=true, protocol operations are halted to prevent potential exploits or manage emergencies.
Only emergency admins can trigger this, providing rapid response capability during security incidents.</em></p>
<pre><code class="language-solidity">event Paused(bool paused_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>paused_</code></td><td><code>bool</code></td><td>The new pause state (true = operations halted, false = normal operation)</td></tr>
</tbody></table>
</div>
<h3 id="rescuedassets"><a class="header" href="#rescuedassets">RescuedAssets</a></h3>
<p>Emitted when ERC20 tokens are rescued from the contract to prevent permanent loss</p>
<p><em>This rescue mechanism is restricted to non-protocol assets only - registered assets (USDC, WBTC, etc.)
cannot be rescued to protect user funds and maintain protocol integrity. Typically used to recover
accidentally sent tokens or airdrops. Only admin role can execute rescues as a security measure.</em></p>
<pre><code class="language-solidity">event RescuedAssets(address indexed asset_, address indexed to_, uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>asset_</code></td><td><code>address</code></td><td>The ERC20 token address being rescued (must not be a registered protocol asset)</td></tr>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address receiving the rescued tokens (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity of tokens rescued (must not exceed contract balance)</td></tr>
</tbody></table>
</div>
<h3 id="rescuedeth"><a class="header" href="#rescuedeth">RescuedETH</a></h3>
<p>Emitted when native ETH is rescued from the contract to recover stuck funds</p>
<p><em>ETH rescue is separate from ERC20 rescue due to different transfer mechanisms. This prevents
ETH from being permanently locked if sent to the contract accidentally. Uses low-level call for
ETH transfer with proper success checking. Only admin role authorized for security.</em></p>
<pre><code class="language-solidity">event RescuedETH(address indexed to_, uint256 amount_);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>to_</code></td><td><code>address</code></td><td>The recipient address receiving the rescued ETH (cannot be zero address)</td></tr>
<tr><td><code>amount_</code></td><td><code>uint256</code></td><td>The quantity of ETH rescued in wei (must not exceed contract balance)</td></tr>
</tbody></table>
</div>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="kbasestorage"><a class="header" href="#kbasestorage">kBaseStorage</a></h3>
<p><em>Storage struct following ERC-7201 namespaced storage pattern to prevent collisions during upgrades.
This pattern ensures that storage layout remains consistent across proxy upgrades and prevents
accidental overwriting when contracts inherit from multiple base contracts. The namespace
"kam.storage.kBase" uniquely identifies this storage area within the contract's storage space.</em></p>
<p><strong>Note:</strong>
storage-location: erc7201:kam.storage.kBase</p>
<pre><code class="language-solidity">struct kBaseStorage {
    address registry;
    bool initialized;
    bool paused;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../src/base/MultiFacetProxy.sol/abstract.MultiFacetProxy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../src/errors/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../src/base/MultiFacetProxy.sol/abstract.MultiFacetProxy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../src/errors/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
